<?php

namespace App\Http\Controllers\Presentation;
require_once "/srv/www/htdocs/core/autoload.php";
use App\Http\Controllers\Controller;
use Illuminate\Http\Request;
use App\Models\InterviewProcess\InterviewProcess;
use App\Models\InterviewProcess\InterviewDetailsProcess;
use App\Models\InterviewProcess\InterviewProcessFailed;
use Session;
use App\Models\Job\JobOpening;
use App\Models\Visa\visaType;
use App\Models\Company\Department;
use App\Models\Recruiter\Designation;
use App\Models\Onboarding\DocumentCollectionDetails;
use App\Models\Onboarding\DocumentCollectionDetailsValues;
use Carbon\Carbon;
use App\Models\Onboarding\RecruiterDetails;
use App\Models\Employee\Employee_details;
use App\Models\Consultancy\ConsultancyModel;
use App\Models\Entry\Employee;
use App\Models\Logs\InterviewProcessLog;
use App\Models\Visa\Visaprocess;
use App\Models\SEPayout\AgentPayoutMashreq;
use App\Models\SEPayout\AgentPayoutDeem;
use App\Models\SEPayout\AgentPayout;
use App\Models\SEPayout\AgentPayoutB;
use App\Models\SEPayout\WorkTimeRange;
use App\Models\Dashboard\SalesDashboardValues;
use App\Models\Dashboard\SalesDashboardValuesLog;
use App\Models\Dashboard\SalesDashboardPanelTitle;
use App\Models\Dashboard\EnbdPayoutEmpId;
use App\Models\Dashboard\MashreqEmpDetails;
use App\Models\Dashboard\BanksAgentHistroyLogs;
use App\Models\Dashboard\MashreqAttrition;
use App\Models\Dashboard\EnbdAttrition;
use App\Models\Employee\Employee_attribute;
use File;
class PresentationController extends Controller
{
    public function funnelDisplay(Request $request)
	{
		//echo "hello";exit;
			$departmentArray = Department::where("status",1)->get();
		$recruiterDetails = RecruiterDetails::where("status",1)->get();
		$whereRawInterview = '';
		$whereRawDocumentCollection = '';
		$deptFilterArray = array();
		$fromDateValue = '';
		$toDateValue = '';
		
	/*
	*interview process
	*/
			if( $request->session()->get('presentation_dept_f') != '')
			{
				$presentation_dept_f = $request->session()->get('presentation_dept_f');
				$presentation_dept_fArray = explode(",",$presentation_dept_f);
				$deptFilterArray = explode(",",$presentation_dept_f);
			
					if($whereRawInterview == '')
					{
						
						$whereRawInterview = ' department IN ('.$presentation_dept_f.')';
					}
					else
					{
						$whereRawInterview .= 'AND department IN ('.$presentation_dept_f.')';
					}
				
			}
			
			if( $request->session()->get('presentation_recruiter_f') != '')
			{
				$presentation_recruiter_f = $request->session()->get('presentation_recruiter_f');
				
			
					if($whereRawInterview == '')
					{
						
						$whereRawInterview = ' recruiter IN ('.$presentation_recruiter_f.')';
					}
					else
					{
						$whereRawInterview .= 'AND recruiter IN ('.$presentation_recruiter_f.')';
					}
				
			}
			
			if( $request->session()->get('presentation_location_f') != '')
			{
				$presentation_location_f = $request->session()->get('presentation_location_f');
				$presentation_location_fArray = explode(",",$presentation_location_f);
				
				$presentation_location_fsttr1 = '';
				foreach($presentation_location_fArray as $_parray)
				{
					if($presentation_location_fsttr1 == '')
					{
						$presentation_location_fsttr1 = '"'.$_parray.'"';
					}
					else
					{
						$presentation_location_fsttr1 = $presentation_location_fsttr1.',"'.$_parray.'"';
					}
				}
			
					if($whereRawInterview == '')
					{
						
						$whereRawInterview = ' location IN ('.$presentation_location_fsttr1.')';
					}
					else
					{
						$whereRawInterview .= 'AND location IN ('.$presentation_location_fsttr1.')';
					}
				
			}
			
			
			if($request->session()->get('presentation_from_f') != '')
			{
				$fromDateValue = $request->session()->get('presentation_from_f');
				$fromDate = date("Y-m-d 00:00:00",strtotime($request->session()->get('presentation_from_f')));
				if($whereRawInterview == '')
					{
						$whereRawInterview = ' created_at >= "'.$fromDate.'"';
					}
					else
					{
						$whereRawInterview .=' AND created_at >= "'.$fromDate.'"';
					}
			}
			
			if($request->session()->get('presentation_to_f') != '')
			{
				$toDateValue = $request->session()->get('presentation_to_f');
				$fromDate = date("Y-m-d 12:00:00",strtotime($request->session()->get('presentation_to_f')));
				if($whereRawInterview == '')
					{
						$whereRawInterview = ' created_at <= "'.$fromDate.'"';
					}
					else
					{
						$whereRawInterview .=' AND created_at <= "'.$fromDate.'"';
					}
			}
			//echo $whereRawInterview;exit;
	/*
	*interview process
	*/		
			
			
			if( $request->session()->get('presentation_dept_f') != '')
			{
				$presentation_dept_f = $request->session()->get('presentation_dept_f');
					if($whereRawDocumentCollection == '')
					{
						$whereRawDocumentCollection = ' department IN ('.$presentation_dept_f.')';
					}
					else
					{
						$whereRawDocumentCollection .=' AND department IN ('.$presentation_dept_f.')';;
					}
			}
			
			
			if( $request->session()->get('presentation_recruiter_f') != '')
			{
				$presentation_recruiter_f = $request->session()->get('presentation_recruiter_f');
					if($whereRawDocumentCollection == '')
					{
						$whereRawDocumentCollection = ' recruiter_name IN ('.$presentation_recruiter_f.')';
					}
					else
					{
						$whereRawDocumentCollection .=' AND recruiter_name IN ('.$presentation_recruiter_f.')';;
					}
			}
			if( $request->session()->get('presentation_location_f') != '')
			{
				$presentation_location_f = $request->session()->get('presentation_location_f');
				$presentation_location_fArray = explode(",",$presentation_location_f);
				$presentation_location_fsttr = '';
				foreach($presentation_location_fArray as $_parray)
				{
					if($presentation_location_fsttr == '')
					{
						$presentation_location_fsttr = '"'.$_parray.'"';
					}
					else
					{
						$presentation_location_fsttr = $presentation_location_fsttr.',"'.$_parray.'"';
					}
				}
					if($whereRawDocumentCollection == '')
					{
						$whereRawDocumentCollection = ' location IN ('.$presentation_location_fsttr.')';
					}
					else
					{
						$whereRawDocumentCollection .=' AND location IN ('.$presentation_location_fsttr.')';;
					}
			}
			
			if($request->session()->get('presentation_from_f') != '')
			{
				$fromDateValue = $request->session()->get('presentation_from_f');
				$fromDate = date("Y-m-d 00:00:00",strtotime($request->session()->get('presentation_from_f')));
				if($whereRawDocumentCollection == '')
					{
						$whereRawDocumentCollection = ' created_at >= "'.$fromDate.'"';
					}
					else
					{
						$whereRawDocumentCollection .=' AND created_at >= "'.$fromDate.'"';
					}
			}
			
			if($request->session()->get('presentation_to_f') != '')
			{
				$toDateValue = $request->session()->get('presentation_to_f');
				$fromDate = date("Y-m-d 12:00:00",strtotime($request->session()->get('presentation_to_f')));
				if($whereRawDocumentCollection == '')
					{
						$whereRawDocumentCollection = ' created_at <= "'.$fromDate.'"';
					}
					else
					{
						$whereRawDocumentCollection .=' AND created_at <= "'.$fromDate.'"';
					}
			}
			//echo $whereRawDocumentCollection;exit;
			/* echo $whereRawInterview;
			echo '<br />';
			echo $whereRawDocumentCollection;
			
			exit; */
		if($whereRawInterview == '')
		{
			$interview1Count = InterviewDetailsProcess::where("interview_type","Interview1")->get()->count();
		}
		else
		{
			$interview1Count = InterviewDetailsProcess::where("interview_type","Interview1")->whereRaw($whereRawInterview)->get()->count();
		}
		if($whereRawInterview == '')
		{
			$finalDiscussionCount = InterviewDetailsProcess::where("interview_type","Final Discussion")->where("status",2)->get()->count();
		}
		else
		{
			$finalDiscussionCount = InterviewDetailsProcess::where("interview_type","Final Discussion")->where("status",2)->whereRaw($whereRawInterview)->get()->count();
		}
		
		if($whereRawDocumentCollection == '')
		{
			$noOfOfferletterRelease = DocumentCollectionDetails::where("offer_letter_relased_status",2)->where("offer_letter_onboarding_status",1)->get()->count();
		}
		else
		{
			$noOfOfferletterRelease = DocumentCollectionDetails::where("offer_letter_relased_status",2)->where("offer_letter_onboarding_status",1)->whereRaw($whereRawDocumentCollection)->get()->count();
		}
		
		
		if($whereRawDocumentCollection == '')
		{
			$noOfVisaRequested = DocumentCollectionDetails::where("ok_visa",3)->get()->count();
		}
		else
		{
			$noOfVisaRequested = DocumentCollectionDetails::where("ok_visa",3)->whereRaw($whereRawDocumentCollection)->get()->count();
		}
		
		if($whereRawDocumentCollection == '')
		{
			$noOfVisaApproved = DocumentCollectionDetails::where("ok_visa",2)->get()->count();
		}
		else
		{
			$noOfVisaApproved = DocumentCollectionDetails::where("ok_visa",2)->whereRaw($whereRawDocumentCollection)->get()->count();
		}
		
		if($whereRawDocumentCollection != '')
		{
			$offerletterCompleted = DocumentCollectionDetails::where("offer_letter_onboarding_status",2)
			->whereIn("ok_visa",array(1,4))
			->whereIn("visa_process_status",array(1,0))
			->whereRaw($whereRawDocumentCollection)->get()->count();
		}
		else
		{
			$offerletterCompleted = DocumentCollectionDetails::where("offer_letter_onboarding_status",2)->get()->count();	
		}
		if($whereRawDocumentCollection != '')
		{
			$visaProcessInprogress = DocumentCollectionDetails::where("visa_process_status",2)->whereRaw($whereRawDocumentCollection)->get()->count();
		}
		else
		{
			$visaProcessInprogress = DocumentCollectionDetails::where("visa_process_status",2)->get()->count();
		}
		
		if($whereRawDocumentCollection != '')
		{
			$visaProcessCompleted = DocumentCollectionDetails::where("visa_process_status",4)->whereRaw($whereRawDocumentCollection)->get()->count();
		}
		else
		{
			$visaProcessCompleted = DocumentCollectionDetails::where("visa_process_status",4)->get()->count();	
		}
		if($whereRawDocumentCollection != '')
		{
			$OnboardingCompleted = DocumentCollectionDetails::where("onboard_status",2)->whereRaw($whereRawDocumentCollection)->get()->count();
		}
		else
		{
			$OnboardingCompleted = DocumentCollectionDetails::where("onboard_status",2)->get()->count();	
		}
		
		
		$recNameArray = array();
		$locationFilterArray = array();
		return view("presentation/funnelDisplay",compact('noOfVisaApproved','noOfVisaRequested','noOfOfferletterRelease','fromDateValue','toDateValue','deptFilterArray','recNameArray','locationFilterArray','departmentArray','recruiterDetails','interview1Count','finalDiscussionCount','offerletterCompleted','visaProcessInprogress','visaProcessCompleted','OnboardingCompleted'));
	}
	public function DashboardPresentation(Request $request)
	{
	$departmentArray = Department::where("status",1)->get();
		$recruiterDetails = RecruiterDetails::where("status",1)->get();
			$deptFilterArray_f = array();
			if( $request->session()->get('presentation_dept_f') != '')
			{
				$presentation_dept_f = $request->session()->get('presentation_dept_f');
				$presentation_dept_fArray = explode(",",$presentation_dept_f);
				$deptFilterArray_f = explode(",",$presentation_dept_f);
			}
		if( $request->session()->get('presentation_jobopening_dept') != '')
			{
			$deptFilter = $request->session()->get('presentation_jobopening_dept');
						$deptFilterArray = explode(",",$deptFilter);
			}
			else
			{
			$deptFilterArray = array(9);
			}

if( $request->session()->get('presentation_jobopening_location') != '')
		{
				$locationFilter = $request->session()->get('presentation_jobopening_location');
			$locationFilterArray = explode(",",$locationFilter);
		}
		else
		{
			$locationFilterArray = array('DXB');
		}


if( $request->session()->get('presentation_jobopening_recruiter') != '')
		{
$recName = $request->session()->get('presentation_jobopening_recruiter');
$recNameArray = explode(",",$recName);
}
else
{

$recNameArray = array();
}


	$recNameArray_f = array();
	if( $request->session()->get('presentation_recruiter_f') != '')
			{
				$presentation_recruiter_f = $request->session()->get('presentation_recruiter_f');
				$recNameArray_f = explode(",",$presentation_recruiter_f);
			}
	$locationFilterArray_f = array();
	if( $request->session()->get('presentation_location_f') != '')
		{
			$locationFilterArray_f = explode(",",$request->session()->get('presentation_location_f'));
		}
	$fromDateValue = '';
	$toDateValue = '';
			if($request->session()->get('presentation_from_f') != '')
			{
				$fromDateValue = $request->session()->get('presentation_from_f');
			}
			
			if($request->session()->get('presentation_to_f') != '')
			{
				$toDateValue = $request->session()->get('presentation_to_f');
			}
			$fromjobopeningDate1 = '';
			$tojobopeningDate1 = '';
		if( $request->session()->get('presentation_jobopening_from') != '')
			{
					$fromjobopeningDate1 = date("Y-m-d",strtotime($request->session()->get('presentation_jobopening_from')));
					
			}
			
		if( $request->session()->get('presentation_jobopening_to') != '')
			{
					$tojobopeningDate1 = date("Y-m-d",strtotime($request->session()->get('presentation_jobopening_to')));
					
			}	
			/*
			*sales reporting work
			*/
			
			$TLDetails = AgentPayoutMashreq::groupBy('tl_name')
				->selectRaw('count(*) as total, tl_name')
				->get();
			/*
			*sales reporting work
			*/
			/**
			*sales report state maintain
			*/
			$userId = $request->session()->get('EmployeeId');
			$salesDashboardModel = SalesDashboardValues::where("user_id",$userId)->get();
			/* echo "<pre>";
			print_r($salesDashboardModel);
			exit; */
			/**
			*sales report state maintain
			*/
			$salesDashboardModelPanel1 = SalesDashboardValues::where("user_id",$userId)->where("panel_id",1)->first();
			
		return view("presentation/dashboardpresentation",compact('fromjobopeningDate1','tojobopeningDate1','fromDateValue','toDateValue','deptFilterArray_f','recNameArray_f','locationFilterArray_f','departmentArray','deptFilterArray','recruiterDetails','locationFilterArray','recNameArray','TLDetails','salesDashboardModel','salesDashboardModelPanel1'));
	}
	
	public function onboardingPresentation(Request $request)
	{
		$whererawDocCollection = '';
		if( $request->session()->get('presentation_jobopening_from') != '')
			{
					$fromjobopeningDate = date("Y-m-d 00:00:00",strtotime($request->session()->get('presentation_jobopening_from')));
					if($whererawDocCollection == '')
					{
						$whererawDocCollection = 'created_at >= "'.$fromjobopeningDate.'"';
					}
					else
					{
						$whererawDocCollection .= ' AND created_at >= "'.$fromjobopeningDate.'"';
					}
			}
			
		if( $request->session()->get('presentation_jobopening_to') != '')
			{
					$tojobopeningDate = date("Y-m-d 12:00:00",strtotime($request->session()->get('presentation_jobopening_to')));
					if($whererawDocCollection == '')
					{
						$whererawDocCollection = 'created_at <= "'.$tojobopeningDate.'"';
					}
					else
					{
						$whererawDocCollection .= ' AND created_at <= "'.$tojobopeningDate.'"';
					}
			}	
			
		//echo $whererawDocCollection;exit;
		if( $request->session()->get('presentation_jobopening_recruiter') != '')
			{
				$recName = $request->session()->get('presentation_jobopening_recruiter');
				$recNameArray = explode(",",$recName);
				if($whererawDocCollection == '')
				{
					$collection = DocumentCollectionDetails::whereIn("recruiter_name",$recNameArray)->groupBy('job_opening')
					->selectRaw('count(*) as total, job_opening')
					->get();
				}
				else
				{
					$collection = DocumentCollectionDetails::whereIn("recruiter_name",$recNameArray)->whereRaw($whererawDocCollection)->groupBy('job_opening')
					->selectRaw('count(*) as total, job_opening')
					->get();
				}
			}
		else
			{
				if($whererawDocCollection == '')
				{
					$collection = DocumentCollectionDetails::groupBy('job_opening')
					->selectRaw('count(*) as total, job_opening')
					->get();
				}
				else
				{
					$collection = DocumentCollectionDetails::groupBy('job_opening')->whereRaw($whererawDocCollection)
					->selectRaw('count(*) as total, job_opening')
					->get();
				}
				$recNameArray = '';
			}
	
	
	$departmentArray = Department::where("status",1)->get();
	$recruiterDetails = RecruiterDetails::where("status",1)->get();

	$colorCode = array("#4F5060","#67819D","#ADBD37","#588133","#003B45");
	$data = array();
	$index = 0;
	$indexColor = 0;
	$whereRaw = '';
	foreach($collection as $_collection)
	{
		
		if( $request->session()->get('presentation_jobopening_dept') != '')
		{
			$deptFilter = $request->session()->get('presentation_jobopening_dept');
			$deptFilterArray = explode(",",$deptFilter);
			if($whereRaw == '')
			{
				$whereRaw = 'department IN ('.$deptFilter.')';
			}
			else
			{
				$whereRaw .= ' AND department IN ('.$deptFilter.')';
			}
		}
		else
		{
			$deptFilterArray = array(9);
			if($whereRaw == '')
			{
				$whereRaw = 'department IN (9)';
			}
			else
			{
				$whereRaw .= ' AND department IN (9)';
			}
			
		}

if( $request->session()->get('presentation_jobopening_location') != '')
		{
			$locationFilter = $request->session()->get('presentation_jobopening_location');
			$locationFilterArray = explode(",",$locationFilter);
$locationFilter1 = '';
			foreach($locationFilterArray as $loc)
				{
					if($locationFilter1 == '')
					{
						$locationFilter1  = "'".$loc."'";
					}
					else
					{
						$locationFilter1 = $locationFilter1.","."'".$loc."'";
					}
		
				}
			if($whereRaw == '')
			{
				
				$whereRaw = "location IN (".$locationFilter1.")";
			}
			else
			{
				$whereRaw .= " AND location IN (".$locationFilter1.")";
			}
		}
		else
		{
			$locationFilterArray = array('DXB');
			if($whereRaw == '')
			{
				$whereRaw = 'location IN ("DXB")';
			}
			else
			{
				$whereRaw .= ' AND location IN ("DXB")';
			}
			
		}
		
		
		$jobOpeningData = JobOpening::where("id",$_collection->job_opening)->whereRaw($whereRaw)->first();
		
		if($jobOpeningData != '')
		{
		$data[$index]['jobopening']= $jobOpeningData->name.'-'.$jobOpeningData->location.'-'.$this->getDepartmentName($jobOpeningData->department);
		$data[$index]['total']= $_collection->total;
		$data[$index]['color']= $colorCode[$indexColor];
		$data[$index]['idJobOpening']= $jobOpeningData->id;
		if($indexColor == 4)
		{
				$indexColor = 0;
		}
		else
		{
		$indexColor++;
		}
		$index++;
		}
	}
	
	
	
/* 	echo '<pre>';
	print_r($data);
	exit; */
		return view("presentation/onboardingpresentation",compact('data','departmentArray','deptFilterArray','recruiterDetails','locationFilterArray'));
	}

protected function getDepartmentName($deptId)
	{
		return Department::where("id",$deptId)->first()->department_name;
	}

public function searchjobopeningwidget(Request $request)
{

	$department = $request->department;
   
	$recruiter = $request->recruiter;
	$locationdata = $request->locationdata;
	$from_date = $request->from_date;
	$to_date = $request->to_date;
		if($department!=''){
			$deptarr = array_filter($department);
			$deptstr=implode(",", $deptarr);
			}
		else
			{
			$deptstr='';
			}

			if($locationdata!=''){
			$locationarr = array_filter($locationdata);
			$locationstr=implode(",", $locationarr);
			}
		else
			{
			$locationstr='';
			}


if($recruiter!=''){
			$recarr = array_filter($recruiter);
			$recstr=implode(",", $recarr);
			}
		else
			{
			$recstr='';
			}

	$request->session()->put('presentation_jobopening_dept',$deptstr);
	$request->session()->put('presentation_jobopening_location',$locationstr);
	$request->session()->put('presentation_jobopening_recruiter',$recstr);
	$request->session()->put('presentation_jobopening_from',$from_date);
	$request->session()->put('presentation_jobopening_to',$to_date);
	
}



public function searchFunnelwidget(Request $request)
{
	

	$departmentf = $request->department_f;
	$recruiterf = $request->recruiter_f;
	$locationdataf = $request->locationdata_f;
	$from_datef = $request->from_date_f;
	$to_datef = $request->to_date_f;
		if($departmentf!=''){
			$deptarr = array_filter($departmentf);
			$deptstr=implode(",", $deptarr);
			}
		else
			{
			$deptstr='';
			}

			if($locationdataf!=''){
			$locationarr = array_filter($locationdataf);
			$locationstr=implode(",", $locationarr);
			}
		else
			{
			$locationstr='';
			}


		if($recruiterf!=''){
			$recarr = array_filter($recruiterf);
			$recstr=implode(",", $recarr);
			}
		else
			{
			$recstr='';
			}

	$request->session()->put('presentation_dept_f',$deptstr);
	$request->session()->put('presentation_location_f',$locationstr);
	$request->session()->put('presentation_recruiter_f',$recstr);
	$request->session()->put('presentation_from_f',$from_datef);
	$request->session()->put('presentation_to_f',$to_datef);
	
}

public function resetFunnelwidget(Request $request)
{
	$request->session()->put('presentation_dept_f','');
	$request->session()->put('presentation_location_f','');
	$request->session()->put('presentation_recruiter_f','');
	$request->session()->put('presentation_from_f','');
	$request->session()->put('presentation_to_f','');
}

public function resetJobOpeningWidget(Request $request)
{
$request->session()->put('presentation_jobopening_dept','');
$request->session()->put('presentation_jobopening_location','');
$request->session()->put('presentation_jobopening_recruiter','');
	$request->session()->put('presentation_jobopening_from','');
	$request->session()->put('presentation_jobopening_to','');
}
	
public function visaApproval()
{
  $approvalData = DocumentCollectionDetails::where("ok_visa",3)->get();
  return view("presentation/visaApproval",compact('approvalData'));
}

public function loadVisaProcess()
{
	$visaData = DocumentCollectionDetails::where("visa_process_status",2)->get();
    return view("presentation/loadVisaProcess",compact('visaData'));
}
	
public static function getvisaTypeName($id)
{
	$visaPModel = Visaprocess::where("document_id",$id)->first();
	if($visaPModel != '')
	{
		$visatypeid = $visaPModel->visa_type;
		return visaType::where("id",$visatypeid)->first()->title;
	}
	else
	{
		return "-";
	}
}

public function moveInterview(Request $request,$areaID)
{

	if($areaID == 2)
	{
			$request->session()->put('interview_name_filter_inner_list','');
			$request->session()->put('interview_mobile_filter_inner_list','');
			$request->session()->put('interview_jobopning_filter_inner_list','');
			$request->session()->put('interview_currentstatus_filter_inner_list','');
			$request->session()->put('interview_currentstatus_filter_inner_list',2);
			$request->session()->put('interview_recruiter_filter_inner_list','');
			$request->session()->put('interview_currentinterview_filter_inner_list','');
			$request->session()->put('interview_currentinterview_filter_inner_list','final discussion');
			return redirect('InterviewProcess');
			
	}
	else
	{
		echo "done2";exit;
	}
}

public function goOfferletterComplete(Request $request)
{
	
	$request->session()->put('cname_emp_filter_inner_list','');
			$request->session()->put('opening_cand_filter_inner_list','');
			
			$request->session()->put('company_backout_filter_inner_list','');
			$request->session()->put('company_visastage_status_filter_inner_list','');
			$request->session()->put('departmentId_candAll_filter_inner_list','');
			$request->session()->put('departmentId_canddepartmentListofferletter_filter_inner_list','');
			$request->session()->put('departmentId_candofferlettercomplete_filter_inner_list','');
			$request->session()->put('departmentId_candonboard_filter_inner_list','');
			$request->session()->put('departmentId_candbackout_filter_inner_list','');
			$request->session()->put('filterpendingofferletter_filter_inner_list','');
			$request->session()->put('company_RecruiterName_filter_inner_list','');
			/*
			*set Filter from dashboard
			*start code
			*/
			if($request->session()->get('presentation_recruiter_f') != '')
			{
				$rName = $request->session()->get('presentation_recruiter_f');
				$request->session()->put('company_RecruiterName_filter_inner_list',$rName);
			}
			/*
			*set Filter from dashboard
			*end code
			*/
	$request->session()->put('tab_onboarding_dasboard','OfferletterComplete');
	return redirect('documentcollectionAjax');
}

public function govisaRequested(Request $request)
{
	$request->session()->put('cname_emp_filter_inner_list','');
			$request->session()->put('opening_cand_filter_inner_list','');
			
			$request->session()->put('company_backout_filter_inner_list','');
			$request->session()->put('company_visastage_status_filter_inner_list','');
			$request->session()->put('departmentId_candAll_filter_inner_list','');
			$request->session()->put('departmentId_canddepartmentListofferletter_filter_inner_list','');
			$request->session()->put('departmentId_candofferlettercomplete_filter_inner_list','');
			$request->session()->put('departmentId_candonboard_filter_inner_list','');
			$request->session()->put('departmentId_candbackout_filter_inner_list','');
			$request->session()->put('filterpendingofferletter_filter_inner_list','');
			$request->session()->put('company_RecruiterName_filter_inner_list','');
			/*
			*set Filter from dashboard
			*start code
			*/
			if($request->session()->get('presentation_recruiter_f') != '')
			{
				$rName = $request->session()->get('presentation_recruiter_f');
				$request->session()->put('company_RecruiterName_filter_inner_list',$rName);
			}
			/*
			*set Filter from dashboard
			*end code
			*/
	$request->session()->put('tab_onboarding_dasboard','visaRequested');
	return redirect('documentcollectionAjax');
}

public function govisaApproval(Request $request)
{
	$request->session()->put('cname_emp_filter_inner_list','');
			$request->session()->put('opening_cand_filter_inner_list','');
			
			$request->session()->put('company_backout_filter_inner_list','');
			$request->session()->put('company_visastage_status_filter_inner_list','');
			$request->session()->put('departmentId_candAll_filter_inner_list','');
			$request->session()->put('departmentId_canddepartmentListofferletter_filter_inner_list','');
			$request->session()->put('departmentId_candofferlettercomplete_filter_inner_list','');
			$request->session()->put('departmentId_candonboard_filter_inner_list','');
			$request->session()->put('departmentId_candbackout_filter_inner_list','');
			$request->session()->put('filterpendingofferletter_filter_inner_list','');
			$request->session()->put('company_RecruiterName_filter_inner_list','');
			/*
			*set Filter from dashboard
			*start code
			*/
			if($request->session()->get('presentation_recruiter_f') != '')
			{
				$rName = $request->session()->get('presentation_recruiter_f');
				$request->session()->put('company_RecruiterName_filter_inner_list',$rName);
			}
			/*
			*set Filter from dashboard
			*end code
			*/
	$request->session()->put('tab_onboarding_dasboard','visaApproval');
	return redirect('documentcollectionAjax');
}
public function govisaInProgress(Request $request)
{
	$request->session()->put('cname_emp_filter_inner_list','');
			$request->session()->put('opening_cand_filter_inner_list','');
			
			$request->session()->put('company_backout_filter_inner_list','');
			$request->session()->put('company_visastage_status_filter_inner_list','');
			$request->session()->put('departmentId_candAll_filter_inner_list','');
			$request->session()->put('departmentId_canddepartmentListofferletter_filter_inner_list','');
			$request->session()->put('departmentId_candofferlettercomplete_filter_inner_list','');
			$request->session()->put('departmentId_candonboard_filter_inner_list','');
			$request->session()->put('departmentId_candbackout_filter_inner_list','');
			$request->session()->put('filterpendingofferletter_filter_inner_list','');
			$request->session()->put('company_RecruiterName_filter_inner_list','');
			/*
			*set Filter from dashboard
			*start code
			*/
			if($request->session()->get('presentation_recruiter_f') != '')
			{
				$rName = $request->session()->get('presentation_recruiter_f');
				$request->session()->put('company_RecruiterName_filter_inner_list',$rName);
			}
			/*
			*set Filter from dashboard
			*end code
			*/
	$request->session()->put('tab_onboarding_dasboard','visaInProgress');
	return redirect('documentcollectionAjax');
}
public function govisaComplete(Request $request)
{
	$request->session()->put('cname_emp_filter_inner_list','');
			$request->session()->put('opening_cand_filter_inner_list','');
			
			$request->session()->put('company_backout_filter_inner_list','');
			$request->session()->put('company_visastage_status_filter_inner_list','');
			$request->session()->put('departmentId_candAll_filter_inner_list','');
			$request->session()->put('departmentId_canddepartmentListofferletter_filter_inner_list','');
			$request->session()->put('departmentId_candofferlettercomplete_filter_inner_list','');
			$request->session()->put('departmentId_candonboard_filter_inner_list','');
			$request->session()->put('departmentId_candbackout_filter_inner_list','');
			$request->session()->put('filterpendingofferletter_filter_inner_list','');
			$request->session()->put('company_RecruiterName_filter_inner_list','');
			/*
			*set Filter from dashboard
			*start code
			*/
			if($request->session()->get('presentation_recruiter_f') != '')
			{
				$rName = $request->session()->get('presentation_recruiter_f');
				$request->session()->put('company_RecruiterName_filter_inner_list',$rName);
			}
			/*
			*set Filter from dashboard
			*end code
			*/
	$request->session()->put('tab_onboarding_dasboard','visaComplete');
	
	return redirect('documentcollectionAjax');
}
public function goOnBoard(Request $request)
{
	$request->session()->put('cname_emp_filter_inner_list','');
			$request->session()->put('opening_cand_filter_inner_list','');
			
			$request->session()->put('company_backout_filter_inner_list','');
			$request->session()->put('company_visastage_status_filter_inner_list','');
			$request->session()->put('departmentId_candAll_filter_inner_list','');
			$request->session()->put('departmentId_canddepartmentListofferletter_filter_inner_list','');
			$request->session()->put('departmentId_candofferlettercomplete_filter_inner_list','');
			$request->session()->put('departmentId_candonboard_filter_inner_list','');
			$request->session()->put('departmentId_candbackout_filter_inner_list','');
			$request->session()->put('filterpendingofferletter_filter_inner_list','');
			$request->session()->put('company_RecruiterName_filter_inner_list','');
			/*
			*set Filter from dashboard
			*start code
			*/
			if($request->session()->get('presentation_recruiter_f') != '')
			{
				$rName = $request->session()->get('presentation_recruiter_f');
				$request->session()->put('company_RecruiterName_filter_inner_list',$rName);
			}
			/*
			*set Filter from dashboard
			*end code
			*/
	$request->session()->put('tab_onboarding_dasboard','goOnBoard');
	return redirect('documentcollectionAjax');
}
public function govisaInProgressData(Request $request,$name)
{
	$request->session()->put('cname_emp_filter_inner_list','');
			$request->session()->put('opening_cand_filter_inner_list','');
			
			$request->session()->put('company_backout_filter_inner_list','');
			$request->session()->put('company_visastage_status_filter_inner_list','');
			$request->session()->put('departmentId_candAll_filter_inner_list','');
			$request->session()->put('departmentId_canddepartmentListofferletter_filter_inner_list','');
			$request->session()->put('departmentId_candofferlettercomplete_filter_inner_list','');
			$request->session()->put('departmentId_candonboard_filter_inner_list','');
			$request->session()->put('departmentId_candbackout_filter_inner_list','');
			$request->session()->put('filterpendingofferletter_filter_inner_list','');
			$request->session()->put('company_RecruiterName_filter_inner_list','');
	$request->session()->put('tab_onboarding_dasboard','visaInProgress');
	$request->session()->put('cname_emp_filter_inner_list',$name);
	return redirect('documentcollectionAjax');
}

public function filterAsPerJobOpening(Request $request,$jobOpeningname)
{
			$request->session()->put('cname_emp_filter_inner_list','');
			$request->session()->put('opening_cand_filter_inner_list','');
			
			$request->session()->put('company_backout_filter_inner_list','');
			$request->session()->put('company_visastage_status_filter_inner_list','');
			$request->session()->put('departmentId_candAll_filter_inner_list','');
			$request->session()->put('departmentId_canddepartmentListofferletter_filter_inner_list','');
			$request->session()->put('departmentId_candofferlettercomplete_filter_inner_list','');
			$request->session()->put('departmentId_candonboard_filter_inner_list','');
			$request->session()->put('departmentId_candbackout_filter_inner_list','');
			$request->session()->put('filterpendingofferletter_filter_inner_list','');
			$request->session()->put('company_RecruiterName_filter_inner_list','');
	$jobopeningArray = explode("-",$jobOpeningname);
	$jobopeningName = trim($jobopeningArray[0]);
	$location = trim($jobopeningArray[1]);
	$Department = trim($jobopeningArray[2]);
/* 	echo '<pre>';
	print_r($jobopeningArray);
	exit; */
	$deaprtmentModel =Department::where("department_name",$Department)->first();
	if($deaprtmentModel != '')
	{
		$jobOpeningModel = JobOpening::where("name",$jobopeningName)->where("location",$jobopeningArray[1])->where("department",$deaprtmentModel->id)->first();
		if($jobOpeningModel != '')
		{
			
			$request->session()->put('opening_cand_filter_inner_list',$jobOpeningModel->id);
		}
		else
		{
			
			$request->session()->put('opening_cand_filter_inner_list','');
		}
	}
	else
	{
		
		$request->session()->put('opening_cand_filter_inner_list','');
	}
	/*
	*setting others search filters
	*start code
	*/
	$request->session()->put('company_RecruiterName_filter_inner_list','');
	
	if( $request->session()->get('presentation_jobopening_recruiter') != '')
	{
		$recruiterId = $request->session()->get('presentation_jobopening_recruiter');
		$request->session()->put('company_RecruiterName_filter_inner_list',$recruiterId);
	}
	/*
	*setting others search filters
	*end code
	*/
	return redirect('documentcollectionAjax');
}
public function goOfferletterReleased(Request $request)
{
	$request->session()->put('cname_emp_filter_inner_list','');
			$request->session()->put('opening_cand_filter_inner_list','');
			
			$request->session()->put('company_backout_filter_inner_list','');
			$request->session()->put('company_visastage_status_filter_inner_list','');
			$request->session()->put('departmentId_candAll_filter_inner_list','');
			$request->session()->put('departmentId_canddepartmentListofferletter_filter_inner_list','');
			$request->session()->put('departmentId_candofferlettercomplete_filter_inner_list','');
			$request->session()->put('departmentId_candonboard_filter_inner_list','');
			$request->session()->put('departmentId_candbackout_filter_inner_list','');
			$request->session()->put('filterpendingofferletter_filter_inner_list','');
			$request->session()->put('company_RecruiterName_filter_inner_list','');
			$request->session()->put('tab_onboarding_dasboard','OfferletterPending');
			$request->session()->put('filterpendingofferletter_filter_inner_list',2);
			return redirect('documentcollectionAjax');
}

public function loadWidgetHR(Request $request)
{
		$whereRawInterview = '';
		$whereRawInterviewOnboarding = '';
		if($whereRawInterview == '')
		{
			$interview1Count = InterviewDetailsProcess::where("interview_type","Interview1")->get()->count();
		}
		else
		{
			$interview1Count = InterviewDetailsProcess::where("interview_type","Interview1")->whereRaw($whereRawInterview)->get()->count();
		}
		
		if($whereRawInterviewOnboarding == '')
		{
			$onboardingCount = DocumentCollectionDetails::get()->count();
		}
		else
		{
			$onboardingCount = DocumentCollectionDetails::whereRaw($whereRawInterviewOnboarding)->get()->count();
		}
		
		
		if($whereRawInterviewOnboarding == '')
		{
			$noOfVisaRequested = DocumentCollectionDetails::where("ok_visa",3)->get()->count();
		}
		else
		{
			$noOfVisaRequested = DocumentCollectionDetails::where("ok_visa",3)->whereRaw($whereRawInterviewOnboarding)->get()->count();
		}
		
		if($whereRawInterviewOnboarding != '')
		{
			$visaProcessInprogress = DocumentCollectionDetails::where("visa_process_status",2)->whereRaw($whereRawInterviewOnboarding)->get()->count();
		}
		else
		{
			$visaProcessInprogress = DocumentCollectionDetails::where("visa_process_status",2)->get()->count();
		}
		$colorCode = array("#4F5060","#67819D","#ADBD37","#588133","#003B45");
		$data = array();
		$data[0]['cName']= 'Number of Interviews';
		$data[0]['total']= $interview1Count;
		$data[0]['color']= $colorCode[0];
		
		$data[1]['cName']= 'Number of On-boardings';
		$data[1]['total']= $onboardingCount;
		$data[1]['color']= $colorCode[1];
		
		$data[2]['cName']= 'Visa Requested Widget';
		$data[2]['total']= $noOfVisaRequested;
		$data[2]['color']= $colorCode[2];
		
		$data[3]['cName']= 'Visa In-Process Widget';
		$data[3]['total']= $visaProcessInprogress;
		$data[3]['color']= $colorCode[3];
		
		return view("presentation/loadWidgetHR",compact('data'));
		
}


public function loadWidgetHR1(Request $request)
{
		$whereRawInterview = '';
		$whereRawInterviewOnboarding = '';
		if($whereRawInterview == '')
		{
			$interview1Count = InterviewDetailsProcess::where("interview_type","Interview1")->get()->count();
		}
		else
		{
			$interview1Count = InterviewDetailsProcess::where("interview_type","Interview1")->whereRaw($whereRawInterview)->get()->count();
		}
		
		if($whereRawInterviewOnboarding == '')
		{
			$onboardingCount = DocumentCollectionDetails::get()->count();
		}
		else
		{
			$onboardingCount = DocumentCollectionDetails::whereRaw($whereRawInterviewOnboarding)->get()->count();
		}
		
		
		if($whereRawInterviewOnboarding == '')
		{
			$noOfVisaRequested = DocumentCollectionDetails::where("ok_visa",3)->get()->count();
		}
		else
		{
			$noOfVisaRequested = DocumentCollectionDetails::where("ok_visa",3)->whereRaw($whereRawInterviewOnboarding)->get()->count();
		}
		
		if($whereRawInterviewOnboarding != '')
		{
			$visaProcessInprogress = DocumentCollectionDetails::where("visa_process_status",2)->whereRaw($whereRawInterviewOnboarding)->get()->count();
		}
		else
		{
			$visaProcessInprogress = DocumentCollectionDetails::where("visa_process_status",2)->get()->count();
		}
		$colorCode = array("#4F5060","#67819D","#ADBD37","#588133","#003B45");
		$data = array();
		$data[0]['cName']= 'Number of Interviews';
		$data[0]['total']= $interview1Count;
		$data[0]['color']= $colorCode[0];
		
		$data[1]['cName']= 'Number of On-boardings';
		$data[1]['total']= $onboardingCount;
		$data[1]['color']= $colorCode[1];
		
		$data[2]['cName']= 'Visa Requested Widget';
		$data[2]['total']= $noOfVisaRequested;
		$data[2]['color']= $colorCode[2];
		
		$data[3]['cName']= 'Visa In-Process Widget';
		$data[3]['total']= $visaProcessInprogress;
		$data[3]['color']= $colorCode[3];
		
		return view("presentation/loadWidgetHR1",compact('data'));
		
}


	public function getSalesReport(Request $request)
	{
			$parametersInput = $request->input();
			
			$from_dateSI = $parametersInput['from_dateSI']."-10";
			$to_dateSI = $parametersInput['to_dateSI']."-10";
			if($parametersInput['tl_name_SI'] == '' || $parametersInput['tl_name_SI'] == NULL)
			{
				$tl_name_SI = 'No';
			}
			else{
				$tl_name_SI = $parametersInput['tl_name_SI'];
			}
			
			if($parametersInput['agent_name_SI'] == '' || $parametersInput['agent_name_SI'] == NULL)
			{
				$agent_name_SI = 'No';
			}
			else{
				$agent_name_SI = $parametersInput['agent_name_SI'];
			}
			
			
			$data = array();
			$data['fromM'] = date("m",strtotime($from_dateSI));
			$data['fromY'] = date("Y",strtotime($from_dateSI));
			$data['toM'] = date("m",strtotime($to_dateSI));
			$data['toY'] = date("Y",strtotime($to_dateSI));
			$data['TL'] = $tl_name_SI;
			$data['Agent'] = $agent_name_SI;
			echo json_encode($data);
			exit;
			
	}
	
	public function loadSalesAgentforReporting(Request $request)
	{
		$from_dateSI = $request->fromDataTxt."-10";;
		$to_dateSI = $request->toDataTxt."-10";;
		
		$salesMonthFrom =  date("m",strtotime($from_dateSI));
		$salesYearFrom =  date("Y",strtotime($from_dateSI));
		$salesMonthTo = date("m",strtotime($to_dateSI));
		$salesYearTo =  date("Y",strtotime($to_dateSI));
		
		$salesTimeArray = array();
		$year = $salesYearFrom;
		$conditions = $salesMonthTo;
		if($salesYearFrom < $salesYearTo)
		{
			if($salesMonthFrom != 12)
			{
				$interval = 12-$salesMonthFrom;
				$conditions = $salesMonthFrom+$salesMonthTo+$interval;
			}
			else
			{
			$conditions = $salesMonthFrom+$salesMonthTo;
			}
		}
		//echo $conditions;exit;
		$m = $salesMonthFrom;
		for($i=$salesMonthFrom;$i<=$conditions;$i++)
		{
			
			if($m  > 12)
			{
				$m  = 1;
				$year = $year+1;
			}
			$salesTimeArray[] = $m."-".$year;
			$m++;
		}
		
			$agentDetails = AgentPayoutMashreq::groupBy('agent_name')
				->selectRaw('count(*) as total, agent_name')->whereIn("end_sales_time",$salesTimeArray)->get();
				$html = '<option value="">Agent Name..</option>	';
				foreach($agentDetails as $_agent)
				{
					$agentId = AgentPayoutMashreq::where("agent_name",$_agent->agent_name)->whereIn("end_sales_time",$salesTimeArray)->first()->id;
					$html .= '<option value="'.$agentId.'">'.$_agent->agent_name.'</option>';
				}
				
				echo $html;exit;
				
	}
	
	public function addMoreWidgetD(Request $request)
	{
		$widgetDCount = $request->widgetDCount;
			/*
			*sales reporting work
			*/
			
			$TLDetails = AgentPayoutMashreq::groupBy('tl_name')
				->selectRaw('count(*) as total, tl_name')
				->get();
			/*
			*sales reporting work
			*/
			/**
			*sales report state maintain
			*/
			$userId = $request->session()->get('EmployeeId');
			$salesDashboardModel = SalesDashboardValues::where("user_id",$userId)->get();
			/* echo "<pre>";
			print_r($salesDashboardModel);
			exit; */
			/**
			*sales report state maintain
			*/
			
			$salesDashboardModelPanel1 = SalesDashboardValues::where("user_id",$userId)->where("panel_id",$widgetDCount)->first();
			
		return view("presentation/SalesReport/addMoreWidgetD",compact('widgetDCount','TLDetails','salesDashboardModelPanel1'));
	}
	
	public function getWidgetDynamicReport(Request $request)
	{
		$parameterInput = $request->input();
	      
		
		
		/*
		*variable declaration
		*/
		$parametersInput = $request->input();
		
		
		if(isset($parametersInput['widgetContentType']))
		{
			$widgetContentType = $parametersInput['widgetContentType'];
		}
		else
		{
			$widgetContentType = 'table';
		}
			
			$from_dateSI = $parametersInput['from_dateSI']."-10";
			$to_dateSI = $parametersInput['to_dateSI']."-10";
			
			
			
			
			
			 $salesMonthFrom =  date("m",strtotime($from_dateSI));
		
			 $salesYearFrom =  date("Y",strtotime($from_dateSI));
		
			 $salesMonthTo = date("m",strtotime($to_dateSI));
			
			 $salesYearTo =  date("Y",strtotime($to_dateSI));
			
			$fromRange = date("M Y",strtotime($from_dateSI));
			$toRange = date("M Y",strtotime($to_dateSI));
			
			if(isset($parameterInput['tl_name_SI']))
			{
				$tl_name_array = $parameterInput['tl_name_SI']; 
			}
			else
			{
				$tl_name_array = array();
			}
			$historical_data = '';
			if(isset($parameterInput['historical_data']))
			{
				$historical_data = $parameterInput['historical_data']; 
			}
			else
			{
				$historical_data = '';
			}
			
			/* echo "<pre>";
			print_r( $tl_name_array);exit; */
			if(isset($parameterInput['vintage_name_SI']))
			{
				$vintage_name_SI = implode(",",$parameterInput['vintage_name_SI']); 
			}
			else
			{
				$vintage_name_SI = 'No';
			}
			
			if(isset($parameterInput['teamleaderwithout']) && $parameterInput['teamleaderwithout'] == 'yes')
			{
				$teamleaderwithout = $parameterInput['teamleaderwithout'];
			}
			else
			{
				$teamleaderwithout = 'No';
			}
			
			if(isset($parameterInput['his_report']) && $parameterInput['his_report'] == 'yes')
			{
				$his_report = $parameterInput['his_report'];
			}
			else
			{
				$his_report = 'No';
			}
			
			
			
			$productSI = $parameterInput['product_SI'];
			if($productSI == '')
			{
				$productSI = 'No';
			}
			else
			{
				if($productSI == 'Card')
				{
					$productSI = 'CARDS';	
				}
				else
				{
					$productSI = 'Loan';
				}
				
			}
			
			if($parameterInput['location_SI'] == '')
			{
				$location_SI = "No";
			}
			else
			{
				if($parameterInput['location_SI'] == 'DXB')
				{
					$location_SI = "DUBAI";
				}
				else
				{
					$location_SI = "ABU DHABI";
				}
				
			}
			/*start code*/
						$salesTimeArray = array();
						$year = $salesYearFrom;
						$conditions = $salesMonthTo;
						if($salesYearFrom < $salesYearTo)
						{
							if($salesMonthFrom != 12)
							{
								$interval = 12-$salesMonthFrom;
								$conditions = $salesMonthFrom+$salesMonthTo+$interval;
							}
							else
							{
							$conditions = $salesMonthFrom+$salesMonthTo;
							}
						}
						//echo $conditions;exit;
						$m = $salesMonthFrom;
						for($i=$salesMonthFrom;$i<=$conditions;$i++)
						{
							
							if($m  > 12)
							{
								$m  = 1;
								$year = $year+1;
							}
							$salesTimeArray[] = ltrim($m, "0")."-".$year;
							$m++;
						}
						/*
						*code for mashreq bank
						*/
						 /* echo "<pre>";
						print_r($salesTimeArray);
						exit; */ 
						/* echo count($salesTimeArray);
						exit; */
						
						/*
						*Update dashboard Content in Table for state maintain
						*Code Start
						*/
						$userId = $request->session()->get('EmployeeId');
						$panelId = $parameterInput['panelID'];
						$salesDMod = SalesDashboardValues::where("user_id",$userId)->where("panel_id",$panelId)->first();
						if($salesDMod != '')
						{
							$salesDashboardMod = SalesDashboardValues::find($salesDMod->id);
						}
						else
						{
							$salesDashboardMod = new SalesDashboardValues();
						}
						$salesDashboardMod->from_date = $parameterInput['from_dateSI'];
						$salesDashboardMod->to_date = $parameterInput['to_dateSI'];
						$salesDashboardMod->bank = $parameterInput['bank_name'];
						$salesDashboardMod->location = $location_SI;
						$salesDashboardMod->team_leader = implode(",",$tl_name_array);
						$salesDashboardMod->without_tl = $teamleaderwithout;
						$salesDashboardMod->vintage = $vintage_name_SI;
						$salesDashboardMod->product = $productSI;
						$salesDashboardMod->performance = $parameterInput['performance_name'];
						$salesDashboardMod->user_id = $request->session()->get('EmployeeId');
						$salesDashboardMod->panel_id = $parameterInput['panelID'];
						if(isset($parameterInput['historical_data']) && $parameterInput['historical_data'] != '')
						{
						$salesDashboardMod->historical_data = $parameterInput['historical_data'];
						}
						else
						{
							$salesDashboardMod->historical_data = "No";
						}
						$salesDashboardMod->save();
						/*
						*Update dashboard Content in Table for state maintain
						*Code End
						*/
						
						/*
						*Update dashboard Content in Table for state maintain
						*Code Start Logs
						*/
						$salesDashboardModLog = new SalesDashboardValuesLog();
						$salesDashboardModLog->from_date = $parameterInput['from_dateSI'];
						$salesDashboardModLog->to_date = $parameterInput['to_dateSI'];
						$salesDashboardModLog->bank = $parameterInput['bank_name'];
						$salesDashboardModLog->location = $location_SI;
						$salesDashboardModLog->team_leader = implode(",",$tl_name_array);
						$salesDashboardModLog->without_tl = $teamleaderwithout;
						$salesDashboardModLog->vintage = $vintage_name_SI;
						$salesDashboardModLog->product = $productSI;
						$salesDashboardModLog->performance = $parameterInput['performance_name'];
						$salesDashboardModLog->user_id = $request->session()->get('EmployeeId');
						$salesDashboardModLog->panel_id = $parameterInput['panelID'];
						if(isset($parameterInput['historical_data']) && $parameterInput['historical_data'] != '')
						{
						$salesDashboardModLog->historical_data = $parameterInput['historical_data'];
						}
						else
						{
							$salesDashboardModLog->historical_data = "No";
						}
						$salesDashboardModLog->save();
						/*
						*Update dashboard Content in Table for state maintain
						*Code End Logs
						*/
					$title = '';	
			if($parameterInput['bank_name'] == 'Mashreq')
			{			
		
						$graphArray = array();
						
						if($parameterInput['performance_name'] == 'target')
						{
	
							if(count($tl_name_array) >0)
							{
								$graphArray = $this->getDataAsPerTL($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
								
									
									
							}
							else
							{
								if($his_report != "yes")
								{
								$collectionWithAllTL = AgentPayoutMashreq::groupBy('tl_name')
								->selectRaw('count(*) as total, tl_name')->whereIn("end_sales_time",$salesTimeArray)
								->get();
								}
								else
								{
									
								$collectionWithAllTL = AgentPayoutMashreq::groupBy('tl_name')
								->selectRaw('count(*) as total, tl_name')
								->get();	
								}
								foreach($collectionWithAllTL as $tl)
								{
									$tl_name_array[] = $tl->tl_name;
								}
								
								if(count($tl_name_array) >0)
									{
										$graphArray = $this->getDataAsPerTL($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
									}
								
							}
							
							$title = 'Target-Mashreq';	
						}
						else if($parameterInput['performance_name'] == 'XS_Cards')
						{
							$title = 'XS Cards-Mashreq';	
							if(count($tl_name_array) >0)
							{
								$graphArray = $this->getDataAsXS_Card($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
								
									
									
							}
							else
							{
								
								if($his_report != "yes")
								{
								$collectionWithAllTL = AgentPayoutMashreq::groupBy('tl_name')
								->selectRaw('count(*) as total, tl_name')->whereIn("end_sales_time",$salesTimeArray)
								->get();
								}
								else
								{
									$collectionWithAllTL = AgentPayoutMashreq::groupBy('tl_name')
								->selectRaw('count(*) as total, tl_name')
								->get();
								}
								foreach($collectionWithAllTL as $tl)
								{
									$tl_name_array[] = $tl->tl_name;
								}
								if(count($tl_name_array) >0)
									{
										$graphArray = $this->getDataAsXS_Card($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
									}
								
							}
						}
						
						else if($parameterInput['performance_name'] == 'XS_Loan')
						{
							$title = 'XS Loan-Mashreq';	
							if(count($tl_name_array) >0)
							{
								$graphArray = $this->getDataAsXS_Loan($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
								
									
									
							}
							else
							{
								if($his_report != "yes")
								{
								$collectionWithAllTL = AgentPayoutMashreq::groupBy('tl_name')
								->selectRaw('count(*) as total, tl_name')->whereIn("end_sales_time",$salesTimeArray)
								->get();
								}
								else
								{
									$collectionWithAllTL = AgentPayoutMashreq::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')
									->get();
								}
								foreach($collectionWithAllTL as $tl)
								{
									$tl_name_array[] = $tl->tl_name;
								}
								if(count($tl_name_array) >0)
									{
										$graphArray = $this->getDataAsXS_Loan($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
									}
								
							}
						}
						
						else if($parameterInput['performance_name'] == 'mean_median_rev')
						{
							$title = 'Mean Median Rev-Mashreq';	
							if(count($tl_name_array) >0)
							{
								$graphArray = $this->getDataAsmean_median_rev($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
								
									
									
							}
							else
							{
								if($his_report != "yes")
								{
								$collectionWithAllTL = AgentPayoutMashreq::groupBy('tl_name')
								->selectRaw('count(*) as total, tl_name')->whereIn("end_sales_time",$salesTimeArray)
								->get();
								}
								else
								{
								$collectionWithAllTL = AgentPayoutMashreq::groupBy('tl_name')
								->selectRaw('count(*) as total, tl_name')
								->get();	
								}
								foreach($collectionWithAllTL as $tl)
								{
									$tl_name_array[] = $tl->tl_name;
								}
								if(count($tl_name_array) >0)
									{
										$graphArray = $this->getDataAsmean_median_rev($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
									}
								
							}
						}
						
						else if($parameterInput['performance_name'] == 'mean_median_rev_p')
						{
							$title = 'Mean Median Rev Productivity-Mashreq';	
							if(count($tl_name_array) >0)
							{
								$graphArray = $this->getDataAsmean_median_rev_p($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
								
									
									
							}
							else
							{
								if($his_report != "yes")
								{
								$collectionWithAllTL = AgentPayoutMashreq::groupBy('tl_name')
								->selectRaw('count(*) as total, tl_name')->whereIn("end_sales_time",$salesTimeArray)
								->get();
								}
								else
								{
								$collectionWithAllTL = AgentPayoutMashreq::groupBy('tl_name')
								->selectRaw('count(*) as total, tl_name')
								->get();	
								}
								foreach($collectionWithAllTL as $tl)
								{
									$tl_name_array[] = $tl->tl_name;
								}
								if(count($tl_name_array) >0)
									{
										$graphArray = $this->getDataAsmean_median_rev_p($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
									}
								
							}
						}
						
						else if($parameterInput['performance_name'] == 'quartile')
						{
							$title = 'Quartile-Mashreq';
							if(count($tl_name_array) >0)
							{
								$graphArray = $this->getDataAsquartile($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
								
									
									
							}
							else
							{
								if($his_report != "yes")
								{
								$collectionWithAllTL = AgentPayoutMashreq::groupBy('tl_name')
								->selectRaw('count(*) as total, tl_name')->whereIn("end_sales_time",$salesTimeArray)
								->get();
								}
								else
								{
								$collectionWithAllTL = AgentPayoutMashreq::groupBy('tl_name')
								->selectRaw('count(*) as total, tl_name')
								->get();
								}
								foreach($collectionWithAllTL as $tl)
								{
									$tl_name_array[] = $tl->tl_name;
								}
								if(count($tl_name_array) >0)
									{
										$graphArray = $this->getDataAsquartile($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
									}
								
							}
						}
						else if($parameterInput['performance_name'] == 'quartile_p')
						{
							$title = 'Quartile Productivity-Mashreq';
							if(count($tl_name_array) >0)
							{
								$graphArray = $this->getDataAsquartile_p($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
								
									
									
							}
							else
							{
								if($his_report != "yes")
								{
								$collectionWithAllTL = AgentPayoutMashreq::groupBy('tl_name')
								->selectRaw('count(*) as total, tl_name')->whereIn("end_sales_time",$salesTimeArray)
								->get();
								}
								else
								{
								$collectionWithAllTL = AgentPayoutMashreq::groupBy('tl_name')
								->selectRaw('count(*) as total, tl_name')
								->get();
								}
								foreach($collectionWithAllTL as $tl)
								{
									$tl_name_array[] = $tl->tl_name;
								}
								if(count($tl_name_array) >0)
									{
										$graphArray = $this->getDataAsquartile_p($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
									}
								
							}
						}
						else if($parameterInput['performance_name'] == 'revenue_distribution')
						{
							$title = 'Revenue Distribution-Mashreq';
							if(count($tl_name_array) >0)
							{
								$graphArray = $this->revenue_distribution($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
								
									
									
							}
							else
							{
								if($his_report != "yes")
								{
								$collectionWithAllTL = AgentPayoutMashreq::groupBy('tl_name')
								->selectRaw('count(*) as total, tl_name')->whereIn("end_sales_time",$salesTimeArray)
								->get();
								}
								else
								{
									$collectionWithAllTL = AgentPayoutMashreq::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')
									->get();
								}
								foreach($collectionWithAllTL as $tl)
								{
									$tl_name_array[] = $tl->tl_name;
								}
								if(count($tl_name_array) >0)
									{
										$graphArray = $this->revenue_distribution($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
									}
								
							}
						}
						else
						{
							
						}
			}
						/*
						*code for mashreq bank
						*/
						/*
						*code for ENBD bank
						*/
			else if($parameterInput['bank_name'] == 'ENBD')
			{
				
						$graphArray = array();
						
						if($parameterInput['performance_name'] == 'target')
						{
							$title = 'Target-ENBD';
							if(count($tl_name_array) >0)
							{
								$graphArray = $this->getDataAsPerTLENBD($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
								
									
									
							}
							else
							{
								
								if($location_SI == 'No')
								{
									if($his_report != "yes")
									{
										$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')->whereIn("sales_time",$salesTimeArray)
									->get();
									}
									else
									{
									$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')
									->get();	
									}
									
								}
								else
								{
									if($his_report != "yes")
									{
										$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')->whereIn("sales_time",$salesTimeArray)->where("location",$location_SI)
									->get();
									}
									else
									{
										$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')->where("location",$location_SI)
									->get();
									}
									
								}
								foreach($collectionWithAllTL as $tl)
								{
									$tl_name_array[] = $tl->tl_name;
								}
								if(count($tl_name_array) >0)
									{
										
										$graphArray = $this->getDataAsPerTLENBD($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
									}
								
							}
						}
						else if($parameterInput['performance_name'] == 'XS_Cards')
						{
							$title = 'XS Cards-ENBD';
							/* echo "yes";
							exit; */
							if(count($tl_name_array) >0)
							{
								$graphArray = $this->getDataAsXS_Card_ENBD($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
								
									
									
							}
							else
							{
								
								if($location_SI == 'No')
								{
									if($his_report != "yes")
									{
										$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')->whereIn("sales_time",$salesTimeArray)
									->get();
									}
									else
									{
									$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')
									->get();	
									}
									
								}
								else
								{
									if($his_report != "yes")
									{
										$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')->whereIn("sales_time",$salesTimeArray)->where("location",$location_SI)
									->get();
									}
									else
									{
										$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')->where("location",$location_SI)
									->get();
									}
									
								}
								foreach($collectionWithAllTL as $tl)
								{
									$tl_name_array[] = $tl->tl_name;
								}
								if(count($tl_name_array) >0)
									{
										$graphArray = $this->getDataAsXS_Card_ENBD($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
									}
								
							}
						}
						else if($parameterInput['performance_name'] == 'Plastic')
						{
							$title = 'Plastic-ENBD';
							/* echo "yes";
							exit; */
							if(count($tl_name_array) >0)
							{
								$graphArray = $this->getPlastic_ENBD($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
								
									
									
							}
							else
							{
								
								if($location_SI == 'No')
								{
									if($his_report != "yes")
									{
										$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')->whereIn("sales_time",$salesTimeArray)
									->get();
									}
									else
									{
									$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')
									->get();	
									}
									
								}
								else
								{
									if($his_report != "yes")
									{
										$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')->whereIn("sales_time",$salesTimeArray)->where("location",$location_SI)
									->get();
									}
									else
									{
										$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')->where("location",$location_SI)
									->get();
									}
									
								}
								foreach($collectionWithAllTL as $tl)
								{
									$tl_name_array[] = $tl->tl_name;
								}
								if(count($tl_name_array) >0)
									{
										$graphArray = $this->getPlastic_ENBD($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
									}
								
							}
						}
						else if($parameterInput['performance_name'] == 'XS_Loan')
						{
							$title = 'XS Loan-ENBD';
							if(count($tl_name_array) >0)
							{
								$graphArray = $this->getDataAsXS_Loan_ENBD($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
								
									
									
							}
							else
							{
								/* echo "Dfdsf";
								exit; */
								if($location_SI == 'No')
								{
									if($his_report != "yes")
									{
										$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')->whereIn("sales_time",$salesTimeArray)
									->get();
									}
									else
									{
									$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')
									->get();	
									}
									
								}
								else
								{
									if($his_report != "yes")
									{
										$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')->whereIn("sales_time",$salesTimeArray)->where("location",$location_SI)
									->get();
									}
									else
									{
										$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')->where("location",$location_SI)
									->get();
									}
									
								}
								foreach($collectionWithAllTL as $tl)
								{
									$tl_name_array[] = $tl->tl_name;
								}
/* 								echo "<pre>";
								print_r($tl_name_array);
								exit; */
								if(count($tl_name_array) >0)
									{
										$graphArray = $this->getDataAsXS_Loan_ENBD($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
									}
								
							}
						}
						else if($parameterInput['performance_name'] == 'mean_median_rev')
						{
							$title = 'Mean Median Rev-ENBD';
							if(count($tl_name_array) >0)
							{
								$graphArray = $this->getDataAsmean_median_rev_ENBD($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
								
									
									
							}
							else
							{
								
								if($location_SI == 'No')
								{
									if($his_report != "yes")
									{
										$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')->whereIn("sales_time",$salesTimeArray)
									->get();
									}
									else
									{
										$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')
									->get();
									}
									
								}
								else
								{
									if($his_report != "yes")
									{
										$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')->whereIn("sales_time",$salesTimeArray)->where("location",$location_SI)
									->get();
									}
									else
									{
										$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')->where("location",$location_SI)
									->get();
									}
									
								}
								foreach($collectionWithAllTL as $tl)
								{
									$tl_name_array[] = $tl->tl_name;
								}
								if(count($tl_name_array) >0)
									{
										$graphArray = $this->getDataAsmean_median_rev_ENBD($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
									}
								
							}
						}
						else if($parameterInput['performance_name'] == 'mean_median_rev_p')
						{
							$title = 'Mean Median Rev Productivity-ENBD';
							if(count($tl_name_array) >0)
							{
								$graphArray = $this->getDataAsmean_median_rev_ENBD_p($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
								
									
									
							}
							else
							{
								
								if($location_SI == 'No')
								{
									if($his_report != "yes")
									{
										$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')->whereIn("sales_time",$salesTimeArray)
									->get();
									}
									else
									{
										$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')
									->get();
									}
									
								}
								else
								{
									if($his_report != "yes")
									{
										$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')->whereIn("sales_time",$salesTimeArray)->where("location",$location_SI)
									->get();
									}
									else
									{
										$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')->where("location",$location_SI)
									->get();
									}
									
								}
								foreach($collectionWithAllTL as $tl)
								{
									$tl_name_array[] = $tl->tl_name;
								}
								if(count($tl_name_array) >0)
									{
										$graphArray = $this->getDataAsmean_median_rev_ENBD_p($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
									}
								
							}
						}
						else if($parameterInput['performance_name'] == 'quartile')
						{
							$title = 'Quartile-ENBD';
							if(count($tl_name_array) >0)
							{
								$graphArray = $this->getDataAsquartile_ENBD($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
								
									
									
							}
							else
							{
								
								if($location_SI == 'No')
								{
									if($his_report != "yes")
									{
										$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')->whereIn("sales_time",$salesTimeArray)
									->get();
									}
									else
									{
									$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')
									->get();	
									}
									
								}
								else
								{
									if($his_report != "yes")
									{
										$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')->whereIn("sales_time",$salesTimeArray)->where("location",$location_SI)
									->get();
									}
									else
									{
									$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')->where("location",$location_SI)
									->get();	
									}
									
								}
								foreach($collectionWithAllTL as $tl)
								{
									$tl_name_array[] = $tl->tl_name;
								}
								if(count($tl_name_array) >0)
									{
										$graphArray = $this->getDataAsquartile_ENBD($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
									}
								
							}
						}
						else if($parameterInput['performance_name'] == 'quartile_p')
						{
							$title = 'Quartile Productivity-ENBD';
							if(count($tl_name_array) >0)
							{
								$graphArray = $this->getDataAsquartile_ENBD_p($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
								
									
									
							}
							else
							{
								
								if($location_SI == 'No')
								{
									if($his_report != "yes")
									{
										$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')->whereIn("sales_time",$salesTimeArray)
									->get();
									}
									else
									{
									$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')
									->get();	
									}
									
								}
								else
								{
									if($his_report != "yes")
									{
										$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')->whereIn("sales_time",$salesTimeArray)->where("location",$location_SI)
									->get();
									}
									else
									{
									$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')->where("location",$location_SI)
									->get();	
									}
									
								}
								foreach($collectionWithAllTL as $tl)
								{
									$tl_name_array[] = $tl->tl_name;
								}
								if(count($tl_name_array) >0)
									{
										$graphArray = $this->getDataAsquartile_ENBD_p($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
									}
								
							}
						}
						else if($parameterInput['performance_name'] == 'revenue_distribution')
						{
							$title = 'Revenue Distribution-ENBD';
							if(count($tl_name_array) >0)
							{
								
								$graphArray = $this->revenue_distribution_ENBD($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
								
									
									
							}
							else
							{
								
								if($location_SI == 'No')
								{
									
										$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')->whereIn("sales_time",$salesTimeArray)
									->get();
									
									
								}
								else
								{
									
										$collectionWithAllTL = AgentPayout::groupBy('tl_name')
									->selectRaw('count(*) as total, tl_name')->whereIn("sales_time",$salesTimeArray)->where("location",$location_SI)
									->get();
									
									
								}
								foreach($collectionWithAllTL as $tl)
								{
									$tl_name_array[] = $tl->tl_name;
								}
								
								if(count($tl_name_array) >0)
									{
										$graphArray = $this->revenue_distribution_ENBD($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
									}
								
							}
						}
						else
						{
							echo "others";
							exit;
						}
			}
						/*
						*code for ENBD bank
						*/
			if($widgetContentType == 'table')
			{				
				return view("presentation/SalesReport/widgetDynamicPanel",compact('graphArray','title','salesTimeArray'));
			}
			else if($widgetContentType == 'bar_graph')
			{
				return view("presentation/SalesReport/widgetDynamicPanelBarG",compact('graphArray','title','salesTimeArray'));
			}
			else if($widgetContentType == 'line_graph')
			{
				return view("presentation/SalesReport/widgetDynamicPanelLineG",compact('graphArray','title','salesTimeArray'));
			}
			else
			{
				return view("presentation/SalesReport/widgetDynamicPanel",compact('graphArray','title','salesTimeArray'));
			}
			
			/*
			*variable declaration
			*/
			
	}
	protected function getDataAsquartile($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
	{
		if($teamleaderwithout != "yes")
		{
		$indexC = 0;
				
					foreach($tl_name_array as $tl_name)
					{
						$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						$graphArray[$indexC]['TL Name'] = $tl_name;
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray[$indexC]['Total Revenue'] = "AED ".number_format($totalReveue);
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									 if(count($salesTimeArray) == 1)
									 {
									  $graphArray[$indexC]['Total Head Count'] =$countR;
									 }
									  //$graphArray[$indexC]['Mean'] = "AED ".$avg;
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray[$indexC]['median'] = "AED ".number_format($takeReveue[$medianIndex]);
									 /*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />"; */
									  if($q10Index-1 <0)
									  {
										  $q10Index = $q10Index+1;
									  }
									  $graphArray[$indexC]['quartilile 10%'] = "AED ".number_format($takeReveue[$q10Index-1]);
									   if($q25Index-1 <0)
									  {
										  $q25Index = $q25Index+1;
									  }
									  $graphArray[$indexC]['quartilile 25%'] = "AED ".number_format($takeReveue[$q25Index-1]);
									  if($q75Index-1 <0)
									  {
										  $q75Index = $q75Index+1;
									  }
									  $graphArray[$indexC]['quartilile 75%'] = "AED ".number_format($takeReveue[$q75Index-1]);
									    if($q100Index-1 <0)
									  {
										  $q75Index = $q100Index+1;
									  }
									  $graphArray[$indexC]['quartilile 100%'] = "AED ".number_format($takeReveue[$q100Index-1]);
									  
									/*   echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										
										
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray[$indexC]['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
											 $graphArray[$indexC]['Total Head Count'] = 0;
												}
											/*  $graphArray[$indexC]['Mean'] = "AED 0"; */
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['quartilile 10%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 25%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 75%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 100%'] = "AED 0";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray[$indexC]['Total Revenue'] = "AED 0";
								  if(count($salesTimeArray) == 1)
									 {
								 $graphArray[$indexC]['Total Head Count'] = 0;
									 }
								 $graphArray[$indexC]['median'] = "AED 0";
								 $graphArray[$indexC]['quartilile 10%'] = "AED 0";
								 $graphArray[$indexC]['quartilile 25%'] = "AED 0";
								 $graphArray[$indexC]['quartilile 75%'] = "AED 0";
								 $graphArray[$indexC]['quartilile 100%'] = "AED 0";
								 $graphArray[$indexC]['Total Productivity'] = "AED 0";
							}
							if($historical_data == "yes")
							{
							$graphArray1 = $this->getDataAsquartileHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
						
					}
					$graphArrayM[$indexC] = $this->getDataAsquartileTotal($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
					return $graphArrayM;
		}
		else
		{
			$indexC = 0;
			$tl_name = '';	
			$graphArray = array();
			
			if(count($salesTimeArray) == 1 && $vintage_name_SI != 'No')
			{
			/*
			*report as per vintage
			*coding start
			*/
			$vintage_name_SIArray = explode(",",$vintage_name_SI);
			foreach($vintage_name_SIArray as $vintage)
			{
				$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id = ".$vintage;
							}
							else
							{
								$whereRaw .= " AND range_id = ".$vintage;
							}
							$graphArray[$indexC]['Vintage'] = $vintage;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray[$indexC]['Total Revenue'] = "AED ".number_format($totalReveue);
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									  if(count($salesTimeArray) == 1)
										 {
										  $graphArray[$indexC]['Total Head Count'] =$countR;
										 }
									  //$graphArray[$indexC]['Mean'] = "AED ".$avg;
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray[$indexC]['median'] = "AED ".number_format($takeReveue[$medianIndex]);
									 /*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />"; */
									  if($q10Index-1 <0)
									  {
										  $q10Index = $q10Index+1;
									  }
									  $graphArray[$indexC]['quartilile 10%'] = "AED ".number_format($takeReveue[$q10Index-1]);
									   if($q25Index-1 <0)
									  {
										  $q25Index = $q25Index+1;
									  }
									  $graphArray[$indexC]['quartilile 25%'] = "AED ".number_format($takeReveue[$q25Index-1]);
									  if($q75Index-1 <0)
									  {
										  $q75Index = $q75Index+1;
									  }
									  $graphArray[$indexC]['quartilile 75%'] = "AED ".number_format($takeReveue[$q75Index-1]);
									    if($q100Index-1 <0)
									  {
										  $q75Index = $q100Index+1;
									  }
									  $graphArray[$indexC]['quartilile 100%'] = "AED ".number_format($takeReveue[$q100Index-1]);
									  
									/*   echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										
										
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray[$indexC]['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
												 $graphArray[$indexC]['Total Head Count'] = 0;
												}
											/*  $graphArray[$indexC]['Mean'] = "AED 0"; */
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['quartilile 10%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 25%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 75%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 100%'] = "AED 0";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray[$indexC]['Total Revenue'] = "AED 0";
								  if(count($salesTimeArray) == 1)
									 {
								 $graphArray[$indexC]['Total Head Count'] = 0;
									 }
								 $graphArray[$indexC]['median'] = "AED 0";
								 $graphArray[$indexC]['quartilile 10%'] = "AED 0";
								 $graphArray[$indexC]['quartilile 25%'] = "AED 0";
								 $graphArray[$indexC]['quartilile 75%'] = "AED 0";
								 $graphArray[$indexC]['quartilile 100%'] = "AED 0";
								 $graphArray[$indexC]['Total Productivity'] = "AED 0";
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsquartileHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
			}
			
			/*
			*report as per vintage
			*coding start
			*/
			
			}
			else
			{
			/*
			*report as per sales time
			*coding start
			*/
			foreach($salesTimeArray as $_salesT)
			{
				$graphArray[$indexC]['Sales Time'] = $_salesT;
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::where("end_sales_time",$_salesT)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray[$indexC]['Total Revenue'] = "AED ".number_format($totalReveue);
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									  if(count($salesTimeArray) == 1)
										 {
										  $graphArray[$indexC]['Total Head Count'] =$countR;
										 }
									  //$graphArray[$indexC]['Mean'] = "AED ".$avg;
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray[$indexC]['median'] = "AED ".number_format($takeReveue[$medianIndex]);
									 /*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />"; */
									  if($q10Index-1 <0)
									  {
										  $q10Index = $q10Index+1;
									  }
									  $graphArray[$indexC]['quartilile 10%'] = "AED ".number_format($takeReveue[$q10Index-1]);
									   if($q25Index-1 <0)
									  {
										  $q25Index = $q25Index+1;
									  }
									  $graphArray[$indexC]['quartilile 25%'] = "AED ".number_format($takeReveue[$q25Index-1]);
									  if($q75Index-1 <0)
									  {
										  $q75Index = $q75Index+1;
									  }
									  $graphArray[$indexC]['quartilile 75%'] = "AED ".number_format($takeReveue[$q75Index-1]);
									    if($q100Index-1 <0)
									  {
										  $q75Index = $q100Index+1;
									  }
									  $graphArray[$indexC]['quartilile 100%'] = "AED ".number_format($takeReveue[$q100Index-1]);
									  
									/*   echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										
										
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray[$indexC]['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
												 $graphArray[$indexC]['Total Head Count'] = 0;
												}
											/*  $graphArray[$indexC]['Mean'] = "AED 0"; */
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['quartilile 10%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 25%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 75%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 100%'] = "AED 0";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray[$indexC]['Total Revenue'] = "AED 0";
								  if(count($salesTimeArray) == 1)
									 {
								 $graphArray[$indexC]['Total Head Count'] = 0;
									 }
								 $graphArray[$indexC]['median'] = "AED 0";
								 $graphArray[$indexC]['quartilile 10%'] = "AED 0";
								 $graphArray[$indexC]['quartilile 25%'] = "AED 0";
								 $graphArray[$indexC]['quartilile 75%'] = "AED 0";
								 $graphArray[$indexC]['quartilile 100%'] = "AED 0";
								 $graphArray[$indexC]['Total Productivity'] = "AED 0";
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsquartileHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
			}
			/*
			*report as per sales time
			*coding end
			*/
			}
					
						$graphArray[$indexC]['Sales Time'] = "Total";
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray[$indexC]['Total Revenue'] = "AED ".number_format($totalReveue);
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									  if(count($salesTimeArray) == 1)
										 {
										  $graphArray[$indexC]['Total Head Count'] =$countR;
										 }
									  //$graphArray[$indexC]['Mean'] = "AED ".$avg;
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray[$indexC]['median'] = "AED ".number_format($takeReveue[$medianIndex]);
									 /*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />"; */
									  if($q10Index-1 <0)
									  {
										  $q10Index = $q10Index+1;
									  }
									  $graphArray[$indexC]['quartilile 10%'] = "AED ".number_format($takeReveue[$q10Index-1]);
									   if($q25Index-1 <0)
									  {
										  $q25Index = $q25Index+1;
									  }
									  $graphArray[$indexC]['quartilile 25%'] = "AED ".number_format($takeReveue[$q25Index-1]);
									  if($q75Index-1 <0)
									  {
										  $q75Index = $q75Index+1;
									  }
									  $graphArray[$indexC]['quartilile 75%'] = "AED ".number_format($takeReveue[$q75Index-1]);
									    if($q100Index-1 <0)
									  {
										  $q75Index = $q100Index+1;
									  }
									  $graphArray[$indexC]['quartilile 100%'] = "AED ".number_format($takeReveue[$q100Index-1]);
									  
									/*   echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										
										
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray[$indexC]['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
												 $graphArray[$indexC]['Total Head Count'] = 0;
												}
											/*  $graphArray[$indexC]['Mean'] = "AED 0"; */
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['quartilile 10%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 25%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 75%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 100%'] = "AED 0";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray[$indexC]['Total Revenue'] = "AED 0";
								  if(count($salesTimeArray) == 1)
									 {
								 $graphArray[$indexC]['Total Head Count'] = 0;
									 }
								 $graphArray[$indexC]['median'] = "AED 0";
								 $graphArray[$indexC]['quartilile 10%'] = "AED 0";
								 $graphArray[$indexC]['quartilile 25%'] = "AED 0";
								 $graphArray[$indexC]['quartilile 75%'] = "AED 0";
								 $graphArray[$indexC]['quartilile 100%'] = "AED 0";
								 $graphArray[$indexC]['Total Productivity'] = "AED 0";
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsquartileHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
					return $graphArrayM;
		}
	}
	protected function getDataAsquartileTotal($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
	{
						$graphArray = array();
						$graphArray['Sales Time'] = "Total";
						$graphArray['TL Name'] = "";
						$graphArray['Bank'] = "Mashreq";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray['Total Revenue'] = "AED ".number_format($totalReveue);
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									 if(count($salesTimeArray) == 1)
									 {
									  $graphArray['Total Head Count'] =$countR;
									 }
									  //$graphArray[$indexC]['Mean'] = "AED ".$avg;
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray['median'] = "AED ".number_format($takeReveue[$medianIndex]);
									 /*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />"; */
									  if($q10Index-1 <0)
									  {
										  $q10Index = $q10Index+1;
									  }
									  $graphArray['quartilile 10%'] = "AED ".number_format($takeReveue[$q10Index-1]);
									   if($q25Index-1 <0)
									  {
										  $q25Index = $q25Index+1;
									  }
									  $graphArray['quartilile 25%'] = "AED ".number_format($takeReveue[$q25Index-1]);
									  if($q75Index-1 <0)
									  {
										  $q75Index = $q75Index+1;
									  }
									  $graphArray['quartilile 75%'] = "AED ".number_format($takeReveue[$q75Index-1]);
									    if($q100Index-1 <0)
									  {
										  $q75Index = $q100Index+1;
									  }
									  $graphArray['quartilile 100%'] = "AED ".number_format($takeReveue[$q100Index-1]);
									  
									/*   echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										
										
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											 $graphArray['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
											 $graphArray['Total Head Count'] = 0;
												}
											/*  $graphArray[$indexC]['Mean'] = "AED 0"; */
											 $graphArray['median'] = "AED 0";
											 $graphArray['quartilile 10%'] = "AED 0";
											 $graphArray['quartilile 25%'] = "AED 0";
											 $graphArray['quartilile 75%'] = "AED 0";
											 $graphArray['quartilile 100%'] = "AED 0";
											 $graphArray['Total Productivity'] = "AED 0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray['Total Revenue'] = "AED 0";
								  if(count($salesTimeArray) == 1)
									 {
								 $graphArray['Total Head Count'] = 0;
									 }
								 $graphArray['median'] = "AED 0";
								 $graphArray['quartilile 10%'] = "AED 0";
								 $graphArray['quartilile 25%'] = "AED 0";
								 $graphArray['quartilile 75%'] = "AED 0";
								 $graphArray['quartilile 100%'] = "AED 0";
								 $graphArray['Total Productivity'] = "AED 0";
							}
							if($historical_data == "yes")
							{
							$graphArrayT = $this->getDataAsquartileHistroyTotal($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout);
							$graphArrayTD = array_merge($graphArray,$graphArrayT);
							}
							else
							{
								$graphArrayTD = $graphArray;
							}
							return $graphArrayTD;
						
					
	}
	protected function getDataAsquartileHistroyTotal($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout)
	{
			$whereRaw = '';
						/* if($teamleaderwithout != "yes")
						{
							if($tl_name != 'No')
							{
								if($whereRaw == '')
								{
									$whereRaw = "tl_name = '".$tl_name."'";
								}
								else
								{
									$whereRaw .= " AND tl_name= '".$tl_name."'";
								}
							} 
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereraw($whereRaw)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray['Historical Total Revenue'] = "AED ".number_format($totalReveue);
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									 /*  $graphArray[$indexC]['Historical Total Head Count'] =$countR; */
									  //$graphArray[$indexC]['Mean'] = "AED ".$avg;
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray['Historical median'] = "AED ".number_format($takeReveue[$medianIndex]);
									 /*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />"; */
									  if($q10Index-1 <0)
									  {
										  $q10Index = $q10Index+1;
									  }
									  $graphArray['Historical quartilile 10%'] = "AED ".number_format($takeReveue[$q10Index-1]);
									   if($q25Index-1 <0)
									  {
										  $q25Index = $q25Index+1;
									  }
									  $graphArray['Historical quartilile 25%'] = "AED ".number_format($takeReveue[$q25Index-1]);
									  if($q75Index-1 <0)
									  {
										  $q75Index = $q75Index+1;
									  }
									  $graphArray['Historical quartilile 75%'] = "AED ".number_format($takeReveue[$q75Index-1]);
									    if($q100Index-1 <0)
									  {
										  $q75Index = $q100Index+1;
									  }
									  $graphArray['Historical quartilile 100%'] = "AED ".number_format($takeReveue[$q100Index-1]);
									  
									/*   echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										
										
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray['Historical Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											 $graphArray['Historical Total Revenue'] = "AED 0";
											/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											/*  $graphArray[$indexC]['Mean'] = "AED 0"; */
											 $graphArray['Historical median'] = "AED 0";
											 $graphArray['Historical quartilile 10%'] = "AED 0";
											 $graphArray['Historical quartilile 25%'] = "AED 0";
											 $graphArray['Historical quartilile 75%'] = "AED 0";
											 $graphArray['Historical quartilile 100%'] = "AED 0";
											 $graphArray['Historical Total Productivity'] = "AED 0";
										}
							
						
						/*end code*/
						}
						else
							{
											$graphArray['Historical Total Revenue'] = "AED 0";
											/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											/*  $graphArray[$indexC]['Mean'] = "AED 0"; */
											 $graphArray['Historical median'] = "AED 0";
											 $graphArray['Historical quartilile 10%'] = "AED 0";
											 $graphArray['Historical quartilile 25%'] = "AED 0";
											 $graphArray['Historical quartilile 75%'] = "AED 0";
											 $graphArray['Historical quartilile 100%'] = "AED 0";
											 $graphArray['Historical Total Productivity'] = "AED 0";
							}
							return $graphArray;
	}
	protected function getDataAsquartileHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC)
	{

						
						
						$whereRaw = '';
						if($teamleaderwithout != "yes")
						{
							if($tl_name != 'No')
							{
								if($whereRaw == '')
								{
									$whereRaw = "tl_name = '".$tl_name."'";
								}
								else
								{
									$whereRaw .= " AND tl_name= '".$tl_name."'";
								}
							} 
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereraw($whereRaw)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray[$indexC]['Historical Total Revenue'] = "AED ".number_format($totalReveue);
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									 /*  $graphArray[$indexC]['Historical Total Head Count'] =$countR; */
									  //$graphArray[$indexC]['Mean'] = "AED ".$avg;
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray[$indexC]['Historical median'] = "AED ".number_format($takeReveue[$medianIndex]);
									 /*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />"; */
									  if($q10Index-1 <0)
									  {
										  $q10Index = $q10Index+1;
									  }
									  $graphArray[$indexC]['Historical quartilile 10%'] = "AED ".number_format($takeReveue[$q10Index-1]);
									   if($q25Index-1 <0)
									  {
										  $q25Index = $q25Index+1;
									  }
									  $graphArray[$indexC]['Historical quartilile 25%'] = "AED ".number_format($takeReveue[$q25Index-1]);
									  if($q75Index-1 <0)
									  {
										  $q75Index = $q75Index+1;
									  }
									  $graphArray[$indexC]['Historical quartilile 75%'] = "AED ".number_format($takeReveue[$q75Index-1]);
									    if($q100Index-1 <0)
									  {
										  $q75Index = $q100Index+1;
									  }
									  $graphArray[$indexC]['Historical quartilile 100%'] = "AED ".number_format($takeReveue[$q100Index-1]);
									  
									/*   echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										
										
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray[$indexC]['Historical Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											 $graphArray[$indexC]['Historical Total Revenue'] = "AED 0";
											/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											/*  $graphArray[$indexC]['Mean'] = "AED 0"; */
											 $graphArray[$indexC]['Historical median'] = "AED 0";
											 $graphArray[$indexC]['Historical quartilile 10%'] = "AED 0";
											 $graphArray[$indexC]['Historical quartilile 25%'] = "AED 0";
											 $graphArray[$indexC]['Historical quartilile 75%'] = "AED 0";
											 $graphArray[$indexC]['Historical quartilile 100%'] = "AED 0";
											 $graphArray[$indexC]['Historical Total Productivity'] = "AED 0";
										}
							
						
						/*end code*/
						}
						else
							{
								$graphArray[$indexC]['Historical Total Revenue'] = "AED 0";
											/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											/*  $graphArray[$indexC]['Mean'] = "AED 0"; */
											 $graphArray[$indexC]['Historical median'] = "AED 0";
											 $graphArray[$indexC]['Historical quartilile 10%'] = "AED 0";
											 $graphArray[$indexC]['Historical quartilile 25%'] = "AED 0";
											 $graphArray[$indexC]['Historical quartilile 75%'] = "AED 0";
											 $graphArray[$indexC]['Historical quartilile 100%'] = "AED 0";
											 $graphArray[$indexC]['Historical Total Productivity'] = "AED 0";
							}
							return $graphArray;
	}
	protected function getDataAsmean_median_rev($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
	{
		
		if($teamleaderwithout != "yes")
		{
		$indexC = 0;
				
					foreach($tl_name_array as $tl_name)
					{
						$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						$graphArray[$indexC]['TL Name'] = $tl_name;
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
							$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->get();	
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->get();	
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray[$indexC]['Total Revenue'] = "AED ".number_format($totalReveue);
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									 if(count($salesTimeArray) == 1)
									{
									  $graphArray[$indexC]['Total Head Count'] =$countR;
									}
									  $graphArray[$indexC]['Mean'] = "AED ".number_format($avg);
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray[$indexC]['median'] = "AED ".number_format($takeReveue[$medianIndex]);
									/*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />";
									  echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										/*
										*top 10% revenue
										*/
										$top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										}
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										}
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										$top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										}
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										$top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										}
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray[$indexC]['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											$graphArray[$indexC]['Total Revenue'] = "AED 0";
											if(count($salesTimeArray) == 1)
												{
											 $graphArray[$indexC]['Total Head Count'] = 0;
												}
								 $graphArray[$indexC]['Mean'] = "AED 0";
								 $graphArray[$indexC]['median'] = "AED 0";
								/*  $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray[$indexC]['Total Productivity'] = "AED 0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray[$indexC]['Total Revenue'] = "AED 0";
								 if(count($salesTimeArray) == 1)
									{
								 $graphArray[$indexC]['Total Head Count'] = 0;
									}
								 $graphArray[$indexC]['Mean'] = "AED 0";
								 $graphArray[$indexC]['median'] = "AED 0";
								 /* $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray[$indexC]['Total Productivity'] = "AED 0";
							}
							if($historical_data == "yes")
							{
							$graphArray1 = $this->getDataAsmean_median_revHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
						
					}
					$graphArrayM[$indexC] = $this->getDataAsmean_median_revTotal($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
					return $graphArrayM;
		}
		else
		{
			$indexC = 0;
				$tl_name ='';
				$graphArray = array();
				
				if(count($salesTimeArray) == 1 && $vintage_name_SI != 'No')
				{
				/*
				*report as per vintage
				*coding start
				*/
				$vintage_name_SIArray = explode(",",$vintage_name_SI);
				foreach($vintage_name_SIArray as $vintage)
				{
					    $graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
					/* 	$graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id = ".$vintage;
							}
							else
							{
								$whereRaw .= " AND range_id = ".$vintage;
							}
							$graphArray[$indexC]['Vintage'] = $vintage;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->get();	
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray[$indexC]['Total Revenue'] = "AED ".number_format($totalReveue);
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									 if(count($salesTimeArray) == 1)
									{
									  $graphArray[$indexC]['Total Head Count'] =$countR;
									}
									  $graphArray[$indexC]['Mean'] = "AED ".number_format($avg);
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray[$indexC]['median'] = "AED ".number_format($takeReveue[$medianIndex]);
									/*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />";
									  echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										/*
										*top 10% revenue
										*/
										$top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										}
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										}
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										$top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										}
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										$top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										}
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray[$indexC]['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											$graphArray[$indexC]['Total Revenue'] = "AED 0";
											if(count($salesTimeArray) == 1)
											{
										 $graphArray[$indexC]['Total Head Count'] = 0;
											}
								 $graphArray[$indexC]['Mean'] = "AED 0";
								 $graphArray[$indexC]['median'] = "AED 0";
								/*  $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray[$indexC]['Total Productivity'] = "AED 0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray[$indexC]['Total Revenue'] = "AED 0";
								 if(count($salesTimeArray) == 1)
									{
									$graphArray[$indexC]['Total Head Count'] = 0;
									}
								 $graphArray[$indexC]['Mean'] = "AED 0";
								 $graphArray[$indexC]['median'] = "AED 0";
								 /* $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray[$indexC]['Total Productivity'] = "AED 0";
							}
							if($historical_data == "yes")
							{
							$graphArray1 = $this->getDataAsmean_median_revHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
				}
				
				/*
				*report as per vintage
				*coding start
				*/
				}
				else
				{
				
				/*
				*report as per sales time
				*coding start
				*/
				foreach($salesTimeArray as $_salesT)
				{
					$graphArray[$indexC]['Sales Time'] = $_salesT;
					/* 	$graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::where("end_sales_time",$_salesT)->get();	
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray[$indexC]['Total Revenue'] = "AED ".number_format($totalReveue);
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									 if(count($salesTimeArray) == 1)
									{
									  $graphArray[$indexC]['Total Head Count'] =$countR;
									}
									  $graphArray[$indexC]['Mean'] = "AED ".number_format($avg);
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray[$indexC]['median'] = "AED ".number_format($takeReveue[$medianIndex]);
									/*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />";
									  echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										/*
										*top 10% revenue
										*/
										$top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										}
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										}
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										$top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										}
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										$top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										}
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray[$indexC]['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											$graphArray[$indexC]['Total Revenue'] = "AED 0";
											if(count($salesTimeArray) == 1)
											{
										 $graphArray[$indexC]['Total Head Count'] = 0;
											}
								 $graphArray[$indexC]['Mean'] = "AED 0";
								 $graphArray[$indexC]['median'] = "AED 0";
								/*  $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray[$indexC]['Total Productivity'] = "AED 0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray[$indexC]['Total Revenue'] = "AED 0";
								 if(count($salesTimeArray) == 1)
									{
									$graphArray[$indexC]['Total Head Count'] = 0;
									}
								 $graphArray[$indexC]['Mean'] = "AED 0";
								 $graphArray[$indexC]['median'] = "AED 0";
								 /* $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray[$indexC]['Total Productivity'] = "AED 0";
							}
							if($historical_data == "yes")
							{
							$graphArray1 = $this->getDataAsmean_median_revHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
				}
				/*
				*report as per sales time
				*coding end
				*/
				}
					
						$graphArray[$indexC]['Sales Time'] = "Total";
					/* 	$graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->get();	
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray[$indexC]['Total Revenue'] = "AED ".number_format($totalReveue);
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									 if(count($salesTimeArray) == 1)
									{
									  $graphArray[$indexC]['Total Head Count'] =$countR;
									}
									  $graphArray[$indexC]['Mean'] = "AED ".number_format($avg);
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray[$indexC]['median'] = "AED ".number_format($takeReveue[$medianIndex]);
									/*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />";
									  echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										/*
										*top 10% revenue
										*/
										$top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										}
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										}
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										$top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										}
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										$top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										}
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray[$indexC]['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											$graphArray[$indexC]['Total Revenue'] = "AED 0";
											if(count($salesTimeArray) == 1)
											{
										 $graphArray[$indexC]['Total Head Count'] = 0;
											}
								 $graphArray[$indexC]['Mean'] = "AED 0";
								 $graphArray[$indexC]['median'] = "AED 0";
								/*  $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray[$indexC]['Total Productivity'] = "AED 0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray[$indexC]['Total Revenue'] = "AED 0";
								 if(count($salesTimeArray) == 1)
									{
									$graphArray[$indexC]['Total Head Count'] = 0;
									}
								 $graphArray[$indexC]['Mean'] = "AED 0";
								 $graphArray[$indexC]['median'] = "AED 0";
								 /* $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray[$indexC]['Total Productivity'] = "AED 0";
							}
							if($historical_data == "yes")
							{
							$graphArray1 = $this->getDataAsmean_median_revHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
					return $graphArrayM;
		}
	}
	protected function getDataAsmean_median_revTotal($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
	{
		$graphArray = array();
						$graphArray['Sales Time'] = "Total";
						$graphArray['TL Name'] = "";
						$graphArray['Bank'] = "Mashreq";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
							$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->whereIn("tl_name",$tl_name_array)->get();	
							
							
						}
						else
						{
							
							$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->whereIn("tl_name",$tl_name_array)->get();	
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray['Total Revenue'] = "AED ".number_format($totalReveue);
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									 if(count($salesTimeArray) == 1)
									{
									  $graphArray['Total Head Count'] =$countR;
									}
									  $graphArray['Mean'] = "AED ".number_format($avg);
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray['median'] = "AED ".number_format($takeReveue[$medianIndex]);
									/*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />";
									  echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										/*
										*top 10% revenue
										*/
										$top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										}
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										}
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										$top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										}
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										$top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										}
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											$graphArray['Total Revenue'] = "AED 0";
											if(count($salesTimeArray) == 1)
												{
											 $graphArray['Total Head Count'] = 0;
												}
								 $graphArray['Mean'] = "AED 0";
								 $graphArray['median'] = "AED 0";
								/*  $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray['Total Productivity'] = "AED 0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray['Total Revenue'] = "AED 0";
								 if(count($salesTimeArray) == 1)
									{
								 $graphArray['Total Head Count'] = 0;
									}
								 $graphArray['Mean'] = "AED 0";
								 $graphArray['median'] = "AED 0";
								 /* $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray['Total Productivity'] = "AED 0";
							}
							if($historical_data == "yes")
							{
							$graphArrayT = $this->getDataAsmean_median_revHistroyTotal($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout);
							$graphArrayTD = array_merge($graphArray,$graphArrayT);
							}
							else
							{
								$graphArrayTD = $graphArray;
							}
							
						return $graphArrayTD;
					
	}
	
	protected function getDataAsmean_median_revHistroyTotal($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout)
	{
			$whereRaw = '';
						
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("tl_name",$tl_name_array)->get();	
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereraw($whereRaw)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray['Historical Total Revenue'] = "AED ".number_format($totalReveue);
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									  /* $graphArray[$indexC]['Historical Total Head Count'] =$countR; */
									  $graphArray['Historical Mean'] = "AED ".number_format($avg);
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray['Historical median'] = "AED ".number_format($takeReveue[$medianIndex]);
									/*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />";
									  echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										/*
										*top 10% revenue
										*/
										$top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										}
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										}
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										$top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										}
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										$top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										}
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray['Historical Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											$graphArray['Historical Total Revenue'] = "AED 0";
								/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
								 $graphArray['Historical Mean'] = "AED 0";
								 $graphArray['Historical median'] = "AED 0";
								/*  $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray['Historical Total Productivity'] = "AED 0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray['Historical Total Revenue'] = "AED 0";
								/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
								 $graphArray['Historical Mean'] = "AED 0";
								 $graphArray['Historical median'] = "AED 0";
								 /* $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray['Historical Total Productivity'] = "AED 0";
							}
							return $graphArray;
	}
	protected function getDataAsmean_median_revHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC)
	{
	
					
						
						
						$whereRaw = '';
						if($teamleaderwithout != "yes")
						{
						 if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} 
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::get();	
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereraw($whereRaw)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray[$indexC]['Historical Total Revenue'] = "AED ".number_format($totalReveue);
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									  /* $graphArray[$indexC]['Historical Total Head Count'] =$countR; */
									  $graphArray[$indexC]['Historical Mean'] = "AED ".number_format($avg);
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray[$indexC]['Historical median'] = "AED ".number_format($takeReveue[$medianIndex]);
									/*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />";
									  echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										/*
										*top 10% revenue
										*/
										$top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										}
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										}
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										$top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										}
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										$top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										}
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray[$indexC]['Historical Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											$graphArray[$indexC]['Historical Total Revenue'] = "AED 0";
								/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
								 $graphArray[$indexC]['Historical Mean'] = "AED 0";
								 $graphArray[$indexC]['Historical median'] = "AED 0";
								/*  $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray[$indexC]['Historical Total Productivity'] = "AED 0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray[$indexC]['Historical Total Revenue'] = "AED 0";
								/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
								 $graphArray[$indexC]['Historical Mean'] = "AED 0";
								 $graphArray[$indexC]['Historical median'] = "AED 0";
								 /* $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray[$indexC]['Historical Total Productivity'] = "AED 0";
							}
							return $graphArray;
	}
	
	public function revenue_distribution($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
	{
		if($teamleaderwithout != "yes")
		{
		$indexC = 0;
				
					foreach($tl_name_array as $tl_name)
					{
						$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						$graphArray[$indexC]['TL Name'] = $tl_name;
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray[$indexC]['Total Revenue'] = "AED ".number_format($totalReveue);
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									 if(count($salesTimeArray) == 1)
										{
										  $graphArray[$indexC]['Total Head Count'] =$countR;
										}
									 /*  $graphArray[$indexC]['Mean'] = "AED ".$avg; */
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray[$indexC]['median'] = "AED ".number_format($takeReveue[$medianIndex]);
									/*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />";
									  echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										/*
										*top 10% revenue
										*/
										$top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										}
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										}
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										$top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										}
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										$top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										}
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										$graphArray[$indexC]['Top Revenue 10%'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['Top Revenue 25%'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['Top Revenue 75%'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['Top Revenue 100%'] = round(($top100Revenue/$totalReveue)*100)."%";
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray[$indexC]['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											$graphArray[$indexC]['Total Revenue'] = "AED 0";
											if(count($salesTimeArray) == 1)
											{
												$graphArray[$indexC]['Total Head Count'] = 0;
											}
								 /* $graphArray[$indexC]['Mean'] = "AED 0"; */
								 $graphArray[$indexC]['median'] = "AED 0";
								 $graphArray[$indexC]['Top Revenue 10%'] = "0%";
								 $graphArray[$indexC]['Top Revenue 25%'] = "0%";
								 $graphArray[$indexC]['Top Revenue 75%'] = "0%";
								 $graphArray[$indexC]['Top Revenue 100%'] = "0%";
								 $graphArray[$indexC]['Total Productivity'] = "AED 0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray[$indexC]['Total Revenue'] = "AED 0";
								 if(count($salesTimeArray) == 1)
											{
												$graphArray[$indexC]['Total Head Count'] = 0;
											}
								/*  $graphArray[$indexC]['Mean'] = "AED 0"; */
								 $graphArray[$indexC]['median'] = "AED 0";
								 $graphArray[$indexC]['Top Revenue 10%'] = "0%";
								 $graphArray[$indexC]['Top Revenue 25%'] = "0%";
								 $graphArray[$indexC]['Top Revenue 75%'] = "0%";
								 $graphArray[$indexC]['Top Revenue 100%'] = "0%";
								 $graphArray[$indexC]['Total Productivity'] = "AED 0";
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->revenue_distributionHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							
							$indexC++;
					}
					$graphArrayM[$indexC] = $this->revenue_distributionTotal($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
					return $graphArrayM;
		}
		else
		{
			$indexC = 0;
				$tl_name = '';
				$graphArray = array();
				
				if(count($salesTimeArray) == 1 && $vintage_name_SI != 'No')
				{
				/*
				*report as per Vintage
				*start code
				*/
				$vintage_name_SIArray = explode(",",$vintage_name_SI);
				foreach($vintage_name_SIArray as $vintage)
					{
						$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id = ".$vintage;
							}
							else
							{
								$whereRaw .= " AND range_id = ".$vintage;
							}
							$graphArray[$indexC]['Vintage'] = $vintage;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray[$indexC]['Total Revenue'] = "AED ".number_format($totalReveue);
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									 if(count($salesTimeArray) == 1)
											{
												$graphArray[$indexC]['Total Head Count'] =$countR;
											}
									 /*  $graphArray[$indexC]['Mean'] = "AED ".$avg; */
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray[$indexC]['median'] = "AED ".number_format($takeReveue[$medianIndex]);
									/*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />";
									  echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										/*
										*top 10% revenue
										*/
										$top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										}
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										}
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										$top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										}
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										$top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										}
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										$graphArray[$indexC]['Top Revenue 10%'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['Top Revenue 25%'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['Top Revenue 75%'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['Top Revenue 100%'] = round(($top100Revenue/$totalReveue)*100)."%";
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray[$indexC]['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											$graphArray[$indexC]['Total Revenue'] = "AED 0";
											 if(count($salesTimeArray) == 1)
											{
												$graphArray[$indexC]['Total Head Count'] = 0;
											}
											 /* $graphArray[$indexC]['Mean'] = "AED 0"; */
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['Top Revenue 10%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 25%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 75%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 100%'] = "0%";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray[$indexC]['Total Revenue'] = "AED 0";
								  if(count($salesTimeArray) == 1)
											{
												$graphArray[$indexC]['Total Head Count'] = 0;
											}
								/*  $graphArray[$indexC]['Mean'] = "AED 0"; */
								 $graphArray[$indexC]['median'] = "AED 0";
								 $graphArray[$indexC]['Top Revenue 10%'] = "0%";
								 $graphArray[$indexC]['Top Revenue 25%'] = "0%";
								 $graphArray[$indexC]['Top Revenue 75%'] = "0%";
								 $graphArray[$indexC]['Top Revenue 100%'] = "0%";
								 $graphArray[$indexC]['Total Productivity'] = "AED 0";
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->revenue_distributionHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
					}
				
				/*
				*report as per Vintage
				*start code
				*/
				}
				else
				{
				
				/*
				*report as per salesTime
				*start code
				*/
					foreach($salesTimeArray as $_salesT)
					{
						$graphArray[$indexC]['Sales Time'] = $_salesT;
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::where("end_sales_time",$_salesT)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray[$indexC]['Total Revenue'] = "AED ".number_format($totalReveue);
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									 if(count($salesTimeArray) == 1)
											{
												$graphArray[$indexC]['Total Head Count'] =$countR;
											}
									 /*  $graphArray[$indexC]['Mean'] = "AED ".$avg; */
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray[$indexC]['median'] = "AED ".number_format($takeReveue[$medianIndex]);
									/*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />";
									  echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										/*
										*top 10% revenue
										*/
										$top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										}
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										}
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										$top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										}
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										$top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										}
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										$graphArray[$indexC]['Top Revenue 10%'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['Top Revenue 25%'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['Top Revenue 75%'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['Top Revenue 100%'] = round(($top100Revenue/$totalReveue)*100)."%";
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray[$indexC]['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											$graphArray[$indexC]['Total Revenue'] = "AED 0";
											 if(count($salesTimeArray) == 1)
											{
												$graphArray[$indexC]['Total Head Count'] = 0;
											}
											 /* $graphArray[$indexC]['Mean'] = "AED 0"; */
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['Top Revenue 10%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 25%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 75%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 100%'] = "0%";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray[$indexC]['Total Revenue'] = "AED 0";
								  if(count($salesTimeArray) == 1)
											{
												$graphArray[$indexC]['Total Head Count'] = 0;
											}
								/*  $graphArray[$indexC]['Mean'] = "AED 0"; */
								 $graphArray[$indexC]['median'] = "AED 0";
								 $graphArray[$indexC]['Top Revenue 10%'] = "0%";
								 $graphArray[$indexC]['Top Revenue 25%'] = "0%";
								 $graphArray[$indexC]['Top Revenue 75%'] = "0%";
								 $graphArray[$indexC]['Top Revenue 100%'] = "0%";
								 $graphArray[$indexC]['Total Productivity'] = "AED 0";
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->revenue_distributionHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
					}
				/*
				*report as per salesTime
				*start code
				*/	
				}
						$graphArray[$indexC]['Sales Time'] = "Total";
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray[$indexC]['Total Revenue'] = "AED ".number_format($totalReveue);
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									 if(count($salesTimeArray) == 1)
											{
												$graphArray[$indexC]['Total Head Count'] =$countR;
											}
									 /*  $graphArray[$indexC]['Mean'] = "AED ".$avg; */
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray[$indexC]['median'] = "AED ".number_format($takeReveue[$medianIndex]);
									/*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />";
									  echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										/*
										*top 10% revenue
										*/
										$top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										}
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										}
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										$top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										}
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										$top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										}
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										$graphArray[$indexC]['Top Revenue 10%'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['Top Revenue 25%'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['Top Revenue 75%'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['Top Revenue 100%'] = round(($top100Revenue/$totalReveue)*100)."%";
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray[$indexC]['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											$graphArray[$indexC]['Total Revenue'] = "AED 0";
											 if(count($salesTimeArray) == 1)
											{
												$graphArray[$indexC]['Total Head Count'] = 0;
											}
											 /* $graphArray[$indexC]['Mean'] = "AED 0"; */
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['Top Revenue 10%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 25%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 75%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 100%'] = "0%";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray[$indexC]['Total Revenue'] = "AED 0";
								  if(count($salesTimeArray) == 1)
											{
												$graphArray[$indexC]['Total Head Count'] = 0;
											}
								/*  $graphArray[$indexC]['Mean'] = "AED 0"; */
								 $graphArray[$indexC]['median'] = "AED 0";
								 $graphArray[$indexC]['Top Revenue 10%'] = "0%";
								 $graphArray[$indexC]['Top Revenue 25%'] = "0%";
								 $graphArray[$indexC]['Top Revenue 75%'] = "0%";
								 $graphArray[$indexC]['Top Revenue 100%'] = "0%";
								 $graphArray[$indexC]['Total Productivity'] = "AED 0";
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->revenue_distributionHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
						
					return $graphArrayM;
		}
	}
	protected function revenue_distributionTotal($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
	{
		$graphArray = array();
						$graphArray['Sales Time'] = "Total";
						$graphArray['TL Name'] = "";
						$graphArray['Bank'] = "Mashreq";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray['Total Revenue'] = "AED ".number_format($totalReveue);
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									 if(count($salesTimeArray) == 1)
										{
										  $graphArray['Total Head Count'] =$countR;
										}
									 /*  $graphArray[$indexC]['Mean'] = "AED ".$avg; */
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray['median'] = "AED ".number_format($takeReveue[$medianIndex]);
									/*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />";
									  echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										/*
										*top 10% revenue
										*/
										$top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										}
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										}
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										$top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										}
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										$top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										}
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										$graphArray['Top Revenue 10%'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray['Top Revenue 25%'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray['Top Revenue 75%'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray['Top Revenue 100%'] = round(($top100Revenue/$totalReveue)*100)."%";
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											$graphArray['Total Revenue'] = "AED 0";
											if(count($salesTimeArray) == 1)
											{
												$graphArray['Total Head Count'] = 0;
											}
								 /* $graphArray[$indexC]['Mean'] = "AED 0"; */
								 $graphArray['median'] = "AED 0";
								 $graphArray['Top Revenue 10%'] = "0%";
								 $graphArray['Top Revenue 25%'] = "0%";
								 $graphArray['Top Revenue 75%'] = "0%";
								 $graphArray['Top Revenue 100%'] = "0%";
								 $graphArray['Total Productivity'] = "AED 0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray['Total Revenue'] = "AED 0";
								 if(count($salesTimeArray) == 1)
											{
												$graphArray['Total Head Count'] = 0;
											}
								/*  $graphArray[$indexC]['Mean'] = "AED 0"; */
								 $graphArray['median'] = "AED 0";
								 $graphArray['Top Revenue 10%'] = "0%";
								 $graphArray['Top Revenue 25%'] = "0%";
								 $graphArray['Top Revenue 75%'] = "0%";
								 $graphArray['Top Revenue 100%'] = "0%";
								 $graphArray['Total Productivity'] = "AED 0";
							}
							if($historical_data == "yes")
							{
								$graphArrayT = $this->revenue_distributionHistroyTotal($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout);
								$graphArrayTD = array_merge($graphArray,$graphArrayT);
							}
							else
							{
								$graphArrayTD = $graphArray;
							}
							
							return $graphArrayTD;
					
	}
	
	protected function revenue_distributionHistroyTotal($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout)
	{
		$whereRaw = '';
						
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}

						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereraw($whereRaw)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray['Historical Total Revenue'] = "AED ".number_format($totalReveue);
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									 /*  $graphArray[$indexC]['Historical Total Head Count'] =$countR; */
									 /*  $graphArray[$indexC]['Mean'] = "AED ".$avg; */
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray['Historical median'] = "AED ".number_format($takeReveue[$medianIndex]);
									/*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />";
									  echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										/*
										*top 10% revenue
										*/
										$top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										}
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										}
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										$top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										}
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										$top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										}
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										$graphArray['Historical top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray['Historical top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray['Historical top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray['Historical top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%";
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray['Historical Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											$graphArray['Historical Total Revenue'] = "AED 0";
								/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
								 /* $graphArray[$indexC]['Mean'] = "AED 0"; */
								 $graphArray['Historical median'] = "AED 0";
								 $graphArray['Historical top10 Revenue'] = "0%";
								 $graphArray['Historical top25 Revenue'] = "0%";
								 $graphArray['Historical top75 Revenue'] = "0%";
								 $graphArray['Historical top100 Revenue'] = "0%";
								 $graphArray['Historical Total Productivity'] = "AED 0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray['Historical Total Revenue'] = "AED 0";
								/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
								/*  $graphArray[$indexC]['Mean'] = "AED 0"; */
								 $graphArray['Historical median'] = "AED 0";
								 $graphArray['Historical top10 Revenue'] = "0%";
								 $graphArray['Historical top25 Revenue'] = "0%";
								 $graphArray['Historical top75 Revenue'] = "0%";
								 $graphArray['Historical top100 Revenue'] = "0%";
								 $graphArray['Historical Total Productivity'] = "AED 0";
							}
							
							return  $graphArray; 
	}
	protected function revenue_distributionHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC)
	{
		
						
						$whereRaw = '';
						if($teamleaderwithout != "yes")
						{
						   if($tl_name != 'No')
							{
								if($whereRaw == '')
								{
									$whereRaw = "tl_name = '".$tl_name."'";
								}
								else
								{
									$whereRaw .= " AND tl_name= '".$tl_name."'";
								}
							} 
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}

						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereraw($whereRaw)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray[$indexC]['Historical Total Revenue'] = "AED ".number_format($totalReveue);
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									 /*  $graphArray[$indexC]['Historical Total Head Count'] =$countR; */
									 /*  $graphArray[$indexC]['Mean'] = "AED ".$avg; */
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray[$indexC]['Historical median'] = "AED ".number_format($takeReveue[$medianIndex]);
									/*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />";
									  echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										/*
										*top 10% revenue
										*/
										$top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										}
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										}
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										$top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										}
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										$top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										}
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										$graphArray[$indexC]['Historical top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['Historical top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['Historical top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['Historical top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%";
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray[$indexC]['Historical Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											$graphArray[$indexC]['Historical Total Revenue'] = "AED 0";
								/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
								 /* $graphArray[$indexC]['Mean'] = "AED 0"; */
								 $graphArray[$indexC]['Historical median'] = "AED 0";
								 $graphArray[$indexC]['Historical top10 Revenue'] = "0%";
								 $graphArray[$indexC]['Historical top25 Revenue'] = "0%";
								 $graphArray[$indexC]['Historical top75 Revenue'] = "0%";
								 $graphArray[$indexC]['Historical top100 Revenue'] = "0%";
								 $graphArray[$indexC]['Historical Total Productivity'] = "AED 0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray[$indexC]['Historical Total Revenue'] = "AED 0";
								/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
								/*  $graphArray[$indexC]['Mean'] = "AED 0"; */
								 $graphArray[$indexC]['Historical median'] = "AED 0";
								 $graphArray[$indexC]['Historical top10 Revenue'] = "0%";
								 $graphArray[$indexC]['Historical top25 Revenue'] = "0%";
								 $graphArray[$indexC]['Historical top75 Revenue'] = "0%";
								 $graphArray[$indexC]['Historical top100 Revenue'] = "0%";
								 $graphArray[$indexC]['Historical Total Productivity'] = "AED 0";
							}
							
							return  $graphArray; 
	}
	
	protected function getDataAsPerTL($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
	{
		
		if($teamleaderwithout != "yes")
		{
		
					$indexC = 0;
				
					foreach($tl_name_array as $tl_name)
					{
						$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						$graphArray[$indexC]['TL Name'] = $tl_name;
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("end_sales_time",$salesTimeArray)->get();
							
						}
						else
						{
							
							$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
						}
						
						if(count($allMashreqData) >0)
							{
								
									/*
									*count 80% target not achive
									*/
									$targetNotAchive80 = 0;
									$totalCards = 0;
									$totalCardsCS = 0;
									$totalCardsCSOnly = 0;
									$totalCardsCount = 0;
								
									
									$totalLoan = 0;
									$totalLoanCount = 0;
									
									$totalLoanCS = 0;
									$totalLoanCSOnly = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										$agentTarget80 = round(($AgentTarget/100)*80);
										$totalCardsCS = $totalCardsCS+$_tdata->cards_point_m;
										
										
										$totalLoanCS = $totalLoanCS+$_tdata->final_loan;
										
										if($_tdata->agent_product == 'CARDS')
										{
											$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan;
											$totalCards = $totalCards+$_tdata->cards_point_m;
											$totalCardsCount++;
											if($agentTarget80 > $_tdata->cards_point_m)
											{
												$targetNotAchive80++;
											}
										}
										else
										{
											$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->cards_point_m;
											$totalLoan = $totalLoan+$_tdata->final_loan;
											$totalLoanCount++;
											if($agentTarget80 > $_tdata->final_loan)
											{
												$targetNotAchive80++;
											}
										}
									}
									
									
									
									/*
									*count 80% target not achive
									*/
									
									/*
									*candidate count achived target
									*/
									$achivedCandidate = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										if($_tdata->agent_product == 'CARDS')
										{
											if($AgentTarget <= $_tdata->cards_point_m)
											{
												$achivedCandidate++;
											}
										}
										else
										{
											if($AgentTarget <= $_tdata->final_loan)
											{
												$achivedCandidate++;
											}
										}
									}
									/*
									*candidate count achived target
									*/
									
								/* 	$dataPie[0]['cName']= 'Total Agents Head Count';
									$dataPie[0]['total']= count($allMashreqData);
									$dataPie[0]['color']= $colorCode[0]; */
									$totalHeadCount = count($allMashreqData);
									if(count($salesTimeArray) == 1)
									{
									$graphArray[$indexC]['Total Agents'] = $totalHeadCount;
									}
									$graphArray[$indexC]['Target Achived'] = $achivedCandidate;
									
									
									
									
									if(count($allMashreqData) >0)
									{
										$graphArray[$indexC]['Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
										//echo "<br />";
										//echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%";
										
									}
									else
									{
										$graphArray[$indexC]['Target Achived (%)'] = "0%";
										//echo "<br />";
										//echo "Agent Percentage who achived their Target  0%";
									}
									
								
									$graphArray[$indexC]['Target Achived Less 80%'] = $targetNotAchive80;
									
									
									
									
							}
							else
							{
								if(count($salesTimeArray) == 1)
									{
								$graphArray[$indexC]['Target Agents'] = 0;
									}
								$graphArray[$indexC]['Target Achived'] = 0;
								$graphArray[$indexC]['Target Achived (%)'] = "0%";
								$graphArray[$indexC]['Target Achived Less 80%'] = 0;
							}
							if($historical_data == "yes")
							{
							$graphArray1 = $this->getDataAsPerTLHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
						$indexC++;
						/*end code*/
					}
					
					$graphArrayM[$indexC] = $this->getDataAsPerTLTotal($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
					
					/* echo "<pre>";
					print_r($graphArrayM);
					exit; */
					return $graphArrayM;
		}
		else
		{
			
					$indexC = 0;
					$graphArray = array();
					$tl_name = '';
					if(count($salesTimeArray) == 1 && $vintage_name_SI != "No")
					{
						/*
						*report as per vintage
						*/
						$vintage_name_SIArray = explode(",",$vintage_name_SI);
						
						foreach($vintage_name_SIArray as $_vintage)
						{
						
					
						$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
					/* 	if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id  = ".$_vintage;
							}
							else
							{
								$whereRaw .= " AND range_id = ".$_vintage;
							}
							$graphArray[$indexC]['Vintage'] = $_vintage;
						}
						
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						/*
						*difffer SalesTime Data Render
						*Start Code
						*/
						
						
							if($whereRaw == '')
							{
							
									$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("end_sales_time",$salesTimeArray)->get();
								
							}
							else
							{
								
									$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							}
							
							if(count($allMashreqData) >0)
							{
								
									/*
									*count 80% target not achive
									*/
									$targetNotAchive80 = 0;
									$totalCards = 0;
									$totalCardsCS = 0;
									$totalCardsCSOnly = 0;
									$totalCardsCount = 0;
								
									
									$totalLoan = 0;
									$totalLoanCount = 0;
									
									$totalLoanCS = 0;
									$totalLoanCSOnly = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										$agentTarget80 = round(($AgentTarget/100)*80);
										$totalCardsCS = $totalCardsCS+$_tdata->cards_point_m;
										
										
										$totalLoanCS = $totalLoanCS+$_tdata->final_loan;
										
										if($_tdata->agent_product == 'CARDS')
										{
											$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan;
											$totalCards = $totalCards+$_tdata->cards_point_m;
											$totalCardsCount++;
											if($agentTarget80 > $_tdata->cards_point_m)
											{
												$targetNotAchive80++;
											}
										}
										else
										{
											$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->cards_point_m;
											$totalLoan = $totalLoan+$_tdata->final_loan;
											$totalLoanCount++;
											if($agentTarget80 > $_tdata->final_loan)
											{
												$targetNotAchive80++;
											}
										}
									}
									
									
									
									/*
									*count 80% target not achive
									*/
									
									/*
									*candidate count achived target
									*/
									$achivedCandidate = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										if($_tdata->agent_product == 'CARDS')
										{
											if($AgentTarget <= $_tdata->cards_point_m)
											{
												$achivedCandidate++;
											}
										}
										else
										{
											if($AgentTarget <= $_tdata->final_loan)
											{
												$achivedCandidate++;
											}
										}
									}
									/*
									*candidate count achived target
									*/
									
								/* 	$dataPie[0]['cName']= 'Total Agents Head Count';
									$dataPie[0]['total']= count($allMashreqData);
									$dataPie[0]['color']= $colorCode[0]; */
									$totalHeadCount = count($allMashreqData);
									if(count($salesTimeArray) == 1)
									{
									$graphArray[$indexC]['Total Agents'] = $totalHeadCount;
									}
									$graphArray[$indexC]['Target Achived'] = $achivedCandidate;
									
									
									
									
									if(count($allMashreqData) >0)
									{
										$graphArray[$indexC]['Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
										//echo "<br />";
										//echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%";
										
									}
									else
									{
										$graphArray[$indexC]['Target Achived (%)'] = "0%";
										//echo "<br />";
										//echo "Agent Percentage who achived their Target  0%";
									}
									
								
									$graphArray[$indexC]['Target Achived Less 80%'] = $targetNotAchive80;
									
									
									
									
							}
							else
							{
								if(count($salesTimeArray) == 1)
									{
								$graphArray[$indexC]['Target Agents'] = 0;
									}
								$graphArray[$indexC]['Target Achived'] = 0;
								$graphArray[$indexC]['Target Achived (%)'] = "0%";
								$graphArray[$indexC]['Target Achived Less 80%'] = 0;
							}
							 if($historical_data == "yes")
							{
							$graphArray1 = $this->getDataAsPerTLHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							} 
							$indexC++;
						}
						/*
						*report as per vintage
						*/
					}
					else
					{
						
						foreach($salesTimeArray as $_salesT)
						{
					$tl_name = '';
					
						$graphArray[$indexC]['Sales Time'] = $_salesT;
						
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
					/* 	if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						/*
						*difffer SalesTime Data Render
						*Start Code
						*/
						
						
							if($whereRaw == '')
							{
							
									$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->where("end_sales_time",$_salesT)->get();
								
							}
							else
							{
								
									$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->where("end_sales_time",$_salesT)->whereraw($whereRaw)->get();
							
							}
							
							if(count($allMashreqData) >0)
							{
								
									/*
									*count 80% target not achive
									*/
									$targetNotAchive80 = 0;
									$totalCards = 0;
									$totalCardsCS = 0;
									$totalCardsCSOnly = 0;
									$totalCardsCount = 0;
								
									
									$totalLoan = 0;
									$totalLoanCount = 0;
									
									$totalLoanCS = 0;
									$totalLoanCSOnly = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										$agentTarget80 = round(($AgentTarget/100)*80);
										$totalCardsCS = $totalCardsCS+$_tdata->cards_point_m;
										
										
										$totalLoanCS = $totalLoanCS+$_tdata->final_loan;
										
										if($_tdata->agent_product == 'CARDS')
										{
											$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan;
											$totalCards = $totalCards+$_tdata->cards_point_m;
											$totalCardsCount++;
											if($agentTarget80 > $_tdata->cards_point_m)
											{
												$targetNotAchive80++;
											}
										}
										else
										{
											$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->cards_point_m;
											$totalLoan = $totalLoan+$_tdata->final_loan;
											$totalLoanCount++;
											if($agentTarget80 > $_tdata->final_loan)
											{
												$targetNotAchive80++;
											}
										}
									}
									
									
									
									/*
									*count 80% target not achive
									*/
									
									/*
									*candidate count achived target
									*/
									$achivedCandidate = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										if($_tdata->agent_product == 'CARDS')
										{
											if($AgentTarget <= $_tdata->cards_point_m)
											{
												$achivedCandidate++;
											}
										}
										else
										{
											if($AgentTarget <= $_tdata->final_loan)
											{
												$achivedCandidate++;
											}
										}
									}
									/*
									*candidate count achived target
									*/
									
								/* 	$dataPie[0]['cName']= 'Total Agents Head Count';
									$dataPie[0]['total']= count($allMashreqData);
									$dataPie[0]['color']= $colorCode[0]; */
									$totalHeadCount = count($allMashreqData);
									if(count($salesTimeArray) == 1)
									{
									$graphArray[$indexC]['Total Agents'] = $totalHeadCount;
									}
									$graphArray[$indexC]['Target Achived'] = $achivedCandidate;
									
									
									
									
									if(count($allMashreqData) >0)
									{
										$graphArray[$indexC]['Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
										//echo "<br />";
										//echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%";
										
									}
									else
									{
										$graphArray[$indexC]['Target Achived (%)'] = "0%";
										//echo "<br />";
										//echo "Agent Percentage who achived their Target  0%";
									}
									
								
									$graphArray[$indexC]['Target Achived Less 80%'] = $targetNotAchive80;
									
									
									
									
							}
							else
							{
								if(count($salesTimeArray) == 1)
									{
								$graphArray[$indexC]['Target Agents'] = 0;
									}
								$graphArray[$indexC]['Target Achived'] = 0;
								$graphArray[$indexC]['Target Achived (%)'] = "0%";
								$graphArray[$indexC]['Target Achived Less 80%'] = 0;
							}
							 if($historical_data == "yes")
							{
							$graphArray1 = $this->getDataAsPerTLHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							} 
							$indexC++;
						}
					}
						
						
						
						$graphArray[$indexC]['Sales Time'] = "Total";
						
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
					/* 	if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						
						/*
						*difffer SalesTime Data Render
						*End Code
						*/
						
						if($whereRaw == '')
						{
						
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("end_sales_time",$salesTimeArray)->get();
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
						
						}
						 /* echo "<pre>";
						echo count($allMashreqData);
						exit;  */
						if(count($allMashreqData) >0)
							{
								
									/*
									*count 80% target not achive
									*/
									$targetNotAchive80 = 0;
									$totalCards = 0;
									$totalCardsCS = 0;
									$totalCardsCSOnly = 0;
									$totalCardsCount = 0;
								
									
									$totalLoan = 0;
									$totalLoanCount = 0;
									
									$totalLoanCS = 0;
									$totalLoanCSOnly = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										$agentTarget80 = round(($AgentTarget/100)*80);
										$totalCardsCS = $totalCardsCS+$_tdata->cards_point_m;
										
										
										$totalLoanCS = $totalLoanCS+$_tdata->final_loan;
										
										if($_tdata->agent_product == 'CARDS')
										{
											$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan;
											$totalCards = $totalCards+$_tdata->cards_point_m;
											$totalCardsCount++;
											if($agentTarget80 > $_tdata->cards_point_m)
											{
												$targetNotAchive80++;
											}
										}
										else
										{
											$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->cards_point_m;
											$totalLoan = $totalLoan+$_tdata->final_loan;
											$totalLoanCount++;
											if($agentTarget80 > $_tdata->final_loan)
											{
												$targetNotAchive80++;
											}
										}
									}
									
									
									
									/*
									*count 80% target not achive
									*/
									
									/*
									*candidate count achived target
									*/
									$achivedCandidate = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										if($_tdata->agent_product == 'CARDS')
										{
											if($AgentTarget <= $_tdata->cards_point_m)
											{
												$achivedCandidate++;
											}
										}
										else
										{
											if($AgentTarget <= $_tdata->final_loan)
											{
												$achivedCandidate++;
											}
										}
									}
									/*
									*candidate count achived target
									*/
									
								/* 	$dataPie[0]['cName']= 'Total Agents Head Count';
									$dataPie[0]['total']= count($allMashreqData);
									$dataPie[0]['color']= $colorCode[0]; */
									$totalHeadCount = count($allMashreqData);
									if(count($salesTimeArray) == 1)
									{
									$graphArray[$indexC]['Total Agents'] = $totalHeadCount;
									}
									$graphArray[$indexC]['Target Achived'] = $achivedCandidate;
									
									
									
									
									if(count($allMashreqData) >0)
									{
										$graphArray[$indexC]['Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
										//echo "<br />";
										//echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%";
										
									}
									else
									{
										$graphArray[$indexC]['Target Achived (%)'] = "0%";
										//echo "<br />";
										//echo "Agent Percentage who achived their Target  0%";
									}
									
								
									$graphArray[$indexC]['Target Achived Less 80%'] = $targetNotAchive80;
									
									
									
									
							}
							else
							{
								if(count($salesTimeArray) == 1)
									{
								$graphArray[$indexC]['Target Agents'] = 0;
									}
								$graphArray[$indexC]['Target Achived'] = 0;
								$graphArray[$indexC]['Target Achived (%)'] = "0%";
								$graphArray[$indexC]['Target Achived Less 80%'] = 0;
							}
							if($historical_data == "yes")
							{
							$graphArray1 = $this->getDataAsPerTLHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
						$indexC++;
						/*end code*/
						
						
					return $graphArrayM;
		}
	}
	
protected function getDataAsPerTLTotal($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
{
	
				
					
						$graphArray['Sales Time'] = "Total";
						$graphArray['TL Name'] = "";
						$graphArray['Bank'] = "Mashreq";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("end_sales_time",$salesTimeArray)->whereIn("tl_name",$tl_name_array)->get();
							
						}
						else
						{
							
							$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("end_sales_time",$salesTimeArray)->whereIn("tl_name",$tl_name_array)->whereraw($whereRaw)->get();
							
						}
						
						if(count($allMashreqData) >0)
							{
								
									/*
									*count 80% target not achive
									*/
									$targetNotAchive80 = 0;
									$totalCards = 0;
									$totalCardsCS = 0;
									$totalCardsCSOnly = 0;
									$totalCardsCount = 0;
								
									
									$totalLoan = 0;
									$totalLoanCount = 0;
									
									$totalLoanCS = 0;
									$totalLoanCSOnly = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										$agentTarget80 = round(($AgentTarget/100)*80);
										$totalCardsCS = $totalCardsCS+$_tdata->cards_point_m;
										
										
										$totalLoanCS = $totalLoanCS+$_tdata->final_loan;
										
										if($_tdata->agent_product == 'CARDS')
										{
											$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan;
											$totalCards = $totalCards+$_tdata->cards_point_m;
											$totalCardsCount++;
											if($agentTarget80 > $_tdata->cards_point_m)
											{
												$targetNotAchive80++;
											}
										}
										else
										{
											$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->cards_point_m;
											$totalLoan = $totalLoan+$_tdata->final_loan;
											$totalLoanCount++;
											if($agentTarget80 > $_tdata->final_loan)
											{
												$targetNotAchive80++;
											}
										}
									}
									
									
									
									/*
									*count 80% target not achive
									*/
									
									/*
									*candidate count achived target
									*/
									$achivedCandidate = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										if($_tdata->agent_product == 'CARDS')
										{
											if($AgentTarget <= $_tdata->cards_point_m)
											{
												$achivedCandidate++;
											}
										}
										else
										{
											if($AgentTarget <= $_tdata->final_loan)
											{
												$achivedCandidate++;
											}
										}
									}
									/*
									*candidate count achived target
									*/
									
								/* 	$dataPie[0]['cName']= 'Total Agents Head Count';
									$dataPie[0]['total']= count($allMashreqData);
									$dataPie[0]['color']= $colorCode[0]; */
									$totalHeadCount = count($allMashreqData);
									if(count($salesTimeArray) == 1)
									{
									$graphArray['Total Agents'] = $totalHeadCount;
									}
									$graphArray['Target Achived'] = $achivedCandidate;
									
									
									
									
									if(count($allMashreqData) >0)
									{
										$graphArray['Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
										//echo "<br />";
										//echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%";
										
									}
									else
									{
										$graphArray['Target Achived (%)'] = "0%";
										//echo "<br />";
										//echo "Agent Percentage who achived their Target  0%";
									}
									
								
									$graphArray['Target Achived Less 80%'] = $targetNotAchive80;
									
									
									
									
							}
							else
							{
								if(count($salesTimeArray) == 1)
									{
								$graphArray['Target Agents'] = 0;
									}
								$graphArray['Target Achived'] = 0;
								$graphArray['Target Achived (%)'] = "0%";
								$graphArray['Target Achived Less 80%'] = 0;
							}
							if($historical_data == "yes")
							{
							$graphArrayT = $this->getDataAsPerTLHistroyTotal($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout);
							$graphArrayTSet = array_merge($graphArray,$graphArrayT);
							}
							else
							{
							$graphArrayTSet = $graphArray;
							}
							
							  /* echo "<pre>";
							print_r($graphArrayTSet);
							exit;  */
						return $graphArrayTSet;
						/*end code*/
					
}	

protected function getDataAsPerTLHistroyTotal($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout)
{
						
						
						
						
						$whereRaw = '';
						/* if($teamleaderwithout != "yes")
						{
								if($tl_name != 'No')
								{
									if($whereRaw == '')
									{
										$whereRaw = "tl_name = '".$tl_name."'";
									}
									else
									{
										$whereRaw .= " AND tl_name= '".$tl_name."'";
									}
								}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
						
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("tl_name",$tl_name_array)->get();
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereraw($whereRaw)->whereIn("tl_name",$tl_name_array)->get();
						
						}
						 /* echo "<pre>";
						echo count($allMashreqData);
						exit;  */
						if(count($allMashreqData) >0)
							{
								
									/*
									*count 80% target not achive
									*/
									$targetNotAchive80 = 0;
									$totalCards = 0;
									$totalCardsCS = 0;
									$totalCardsCSOnly = 0;
									$totalCardsCount = 0;
								
									
									$totalLoan = 0;
									$totalLoanCount = 0;
									
									$totalLoanCS = 0;
									$totalLoanCSOnly = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										$agentTarget80 = round(($AgentTarget/100)*80);
										$totalCardsCS = $totalCardsCS+$_tdata->cards_point_m;
										
										
										$totalLoanCS = $totalLoanCS+$_tdata->final_loan;
										
										if($_tdata->agent_product == 'CARDS')
										{
											$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan;
											$totalCards = $totalCards+$_tdata->cards_point_m;
											$totalCardsCount++;
											if($agentTarget80 > $_tdata->cards_point_m)
											{
												$targetNotAchive80++;
											}
										}
										else
										{
											$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->cards_point_m;
											$totalLoan = $totalLoan+$_tdata->final_loan;
											$totalLoanCount++;
											if($agentTarget80 > $_tdata->final_loan)
											{
												$targetNotAchive80++;
											}
										}
									}
									
									
									
									/*
									*count 80% target not achive
									*/
									
									/*
									*candidate count achived target
									*/
									$achivedCandidate = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										if($_tdata->agent_product == 'CARDS')
										{
											if($AgentTarget <= $_tdata->cards_point_m)
											{
												$achivedCandidate++;
											}
										}
										else
										{
											if($AgentTarget <= $_tdata->final_loan)
											{
												$achivedCandidate++;
											}
										}
									}
									/*
									*candidate count achived target
									*/
									
								/* 	$dataPie[0]['cName']= 'Total Agents Head Count';
									$dataPie[0]['total']= count($allMashreqData);
									$dataPie[0]['color']= $colorCode[0]; */
									$totalHeadCount = count($allMashreqData);
									
									/*$graphArray[$indexC]['Historical Total Agents'] = $totalHeadCount;*/
									$graphArray['Historical Target Achived'] = $achivedCandidate;
									
									
									
									
									if(count($allMashreqData) >0)
									{
										$graphArray['Historical Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
										//echo "<br />";
										//echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%";
										
									}
									else
									{
										$graphArray['Historical Target Achived (%)'] = "0%";
										//echo "<br />";
										//echo "Agent Percentage who achived their Target  0%";
									}
									
								
									$graphArray['Historical Target Achived Less 80%'] = $targetNotAchive80;
									
									
									
									
							}
							else
							{
								/* $graphArray[$indexC]['Historical Target Agents'] = 0; */
								$graphArray['Historical Target Achived'] = 0;
								$graphArray['Historical Target Achived (%)'] = '0%';
								$graphArray['Historical Target Achived Less 80%'] = 0;
							}
							/* echo "<pre>";
							print_r($graphArray);
							exit; */
							return $graphArray;
}	

protected function getDataAsPerTLHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC)
{
						
						
						
						
						$whereRaw = '';
						if($teamleaderwithout != "yes")
						{
								if($tl_name != 'No')
								{
									if($whereRaw == '')
									{
										$whereRaw = "tl_name = '".$tl_name."'";
									}
									else
									{
										$whereRaw .= " AND tl_name= '".$tl_name."'";
									}
								}
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
						
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->get();
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereraw($whereRaw)->get();
						
						}
						 /* echo "<pre>";
						echo count($allMashreqData);
						exit;  */
						if(count($allMashreqData) >0)
							{
								
									/*
									*count 80% target not achive
									*/
									$targetNotAchive80 = 0;
									$totalCards = 0;
									$totalCardsCS = 0;
									$totalCardsCSOnly = 0;
									$totalCardsCount = 0;
								
									
									$totalLoan = 0;
									$totalLoanCount = 0;
									
									$totalLoanCS = 0;
									$totalLoanCSOnly = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										$agentTarget80 = round(($AgentTarget/100)*80);
										$totalCardsCS = $totalCardsCS+$_tdata->cards_point_m;
										
										
										$totalLoanCS = $totalLoanCS+$_tdata->final_loan;
										
										if($_tdata->agent_product == 'CARDS')
										{
											$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan;
											$totalCards = $totalCards+$_tdata->cards_point_m;
											$totalCardsCount++;
											if($agentTarget80 > $_tdata->cards_point_m)
											{
												$targetNotAchive80++;
											}
										}
										else
										{
											$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->cards_point_m;
											$totalLoan = $totalLoan+$_tdata->final_loan;
											$totalLoanCount++;
											if($agentTarget80 > $_tdata->final_loan)
											{
												$targetNotAchive80++;
											}
										}
									}
									
									
									
									/*
									*count 80% target not achive
									*/
									
									/*
									*candidate count achived target
									*/
									$achivedCandidate = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										if($_tdata->agent_product == 'CARDS')
										{
											if($AgentTarget <= $_tdata->cards_point_m)
											{
												$achivedCandidate++;
											}
										}
										else
										{
											if($AgentTarget <= $_tdata->final_loan)
											{
												$achivedCandidate++;
											}
										}
									}
									/*
									*candidate count achived target
									*/
									
								/* 	$dataPie[0]['cName']= 'Total Agents Head Count';
									$dataPie[0]['total']= count($allMashreqData);
									$dataPie[0]['color']= $colorCode[0]; */
									$totalHeadCount = count($allMashreqData);
									
									/*$graphArray[$indexC]['Historical Total Agents'] = $totalHeadCount;*/
									$graphArray[$indexC]['Historical Target Achived'] = $achivedCandidate;
									
									
									
									
									if(count($allMashreqData) >0)
									{
										$graphArray[$indexC]['Historical Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
										//echo "<br />";
										//echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%";
										
									}
									else
									{
										$graphArray[$indexC]['Historical Target Achived (%)'] = "0%";
										//echo "<br />";
										//echo "Agent Percentage who achived their Target  0%";
									}
									
								
									$graphArray[$indexC]['Historical Target Achived Less 80%'] = $targetNotAchive80;
									
									
									
									
							}
							else
							{
								/* $graphArray[$indexC]['Historical Target Agents'] = 0; */
								$graphArray[$indexC]['Historical Target Achived'] = 0;
								$graphArray[$indexC]['Historical Target Achived (%)'] = '0%';
								$graphArray[$indexC]['Historical Target Achived Less 80%'] = 0;
							}
							
							return $graphArray;
}	
	
public function getDataAsXS_Card($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
	{
		if($teamleaderwithout != "yes")
			{
					$indexC = 0;
				
					foreach($tl_name_array as $tl_name)
					{
						$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						$graphArray[$indexC]['TL Name'] = $tl_name;
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("end_sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
						
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
						}
						 /* echo "<pre>";
						echo count($allMashreqData);
						exit;  */
						if(count($allMashreqData) >0)
							{
								
									/*
									*count 80% target not achive
									*/
									$targetNotAchive80 = 0;
									$totalCards = 0;
									$totalCardsCS = 0;
									$totalCardsCSOnly = 0;
									$totalCardsCount = 0;
								
									
									$totalLoan = 0;
									$totalLoanCount = 0;
									
									$totalLoanCS = 0;
									$totalLoanCSOnly = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										$agentTarget80 = round(($AgentTarget/100)*80);
										$totalCardsCS = $totalCardsCS+$_tdata->cards_point_m;
										
										
										$totalLoanCS = $totalLoanCS+$_tdata->final_loan;
										
										if($_tdata->agent_product == 'CARDS')
										{
											$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan;
											$totalCards = $totalCards+$_tdata->cards_point_m;
											$totalCardsCount++;
											if($agentTarget80 > $_tdata->cards_point_m)
											{
												$targetNotAchive80++;
											}
										}
										else
										{
											$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->cards_point_m;
											$totalLoan = $totalLoan+$_tdata->final_loan;
											$totalLoanCount++;
											if($agentTarget80 > $_tdata->final_loan)
											{
												$targetNotAchive80++;
											}
										}
									}
									
									
									
									/*
									*count 80% target not achive
									*/
									
									/*
									*candidate count achived target
									*/
									$achivedCandidate = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										if($_tdata->agent_product == 'CARDS')
										{
											if($AgentTarget <= $_tdata->cards_point_m)
											{
												$achivedCandidate++;
											}
										}
										else
										{
											if($AgentTarget <= $_tdata->final_loan)
											{
												$achivedCandidate++;
											}
										}
									}
									/*
									*candidate count achived target
									*/
									
								/* 	$dataPie[0]['cName']= 'Total Agents Head Count';
									$dataPie[0]['total']= count($allMashreqData);
									$dataPie[0]['color']= $colorCode[0]; */
									$totalHeadCount = count($allMashreqData);
									if(count($salesTimeArray) == 1)
									{
									 $graphArray[$indexC]['Total Agents'] = count($allMashreqData);
									 $graphArray[$indexC]['Agents in Cards'] = $totalCardsCount;
									}
									
									/* $graphArray[$indexC]['Agents in Loan'] = $totalLoanCount; */
									if($totalCardsCount >0)
										{
											$graphArray[$indexC]['Core Team Productivity (Cards)'] = round($totalCards/$totalCardsCount,2);
										}
										else
										{
											$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
										}
									/* 	if($totalLoanCount > 0)
										{
											$graphArray[$indexC]['Core Team Productivity (Loan)'] = round($totalLoan/$totalLoanCount,2);
											
										}
										else
										{
											$graphArray[$indexC]['Core Team Productivity (Loan)'] = 0;
										} */
											
										if($totalCardsCount >0)
										{
											$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
												
										}
										else
										{
											$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
										}
										/* if($totalLoanCount >0)
										{
											$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = round($totalLoanCS/$totalLoanCount,2);
												
										}
										else
										{
											$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = 0;
										} */
										if($totalCardsCS >0)
										{
											$graphArray[$indexC]['XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
												
										}
										else
										{
											$graphArray[$indexC]['XS (Card)'] = '0%';
												
										}
										/* if($totalLoanCS >0)
										{
												$graphArray[$indexC]['XS (Loan)'] = round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
												
										}
										else
										{
												$graphArray[$indexC]['XS (Loan)'] = '0%';
										} */
									
									
									
									
									
								
									
									
									
									
									
							}
							else
							{
								if(count($salesTimeArray) == 1)
									{
								$graphArray[$indexC]['Total Agents'] = 0;
								$graphArray[$indexC]['Agents in Cards'] = 0;
									}
								
							
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
								
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
							
								$graphArray[$indexC]['XS (Card)'] = 0;
								
							}
							if($historical_data == "yes")
							{
							$graphArray1 = $this->getDataAsXS_CardHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							
						$indexC++;
						/*end code*/
					}
					$graphArrayM[$indexC] = $this->getDataAsXS_CardTotal($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
					return $graphArrayM;
			}
			else
			{
					$indexC = 0;
				    $graphArray = array();
					$tl_name = '';
					
					if(count($salesTimeArray) == 1 && $vintage_name_SI != 'No')
					{
					/*
					*report as per Vintage
					*start code
					*/
					$vintage_name_SIArray = explode(",",$vintage_name_SI);
					foreach($vintage_name_SIArray as $vintage)
					{
						$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id = ".$vintage;
							}
							else
							{
								$whereRaw .= " AND range_id = ".$vintage;
							}
							$graphArray[$indexC]['Vintage'] = $vintage;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("end_sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->get();	
							
							
						}
						 /* echo "<pre>";
						echo count($allMashreqData);
						exit;  */
						if(count($allMashreqData) >0)
							{
								
									/*
									*count 80% target not achive
									*/
									$targetNotAchive80 = 0;
									$totalCards = 0;
									$totalCardsCS = 0;
									$totalCardsCSOnly = 0;
									$totalCardsCount = 0;
								
									
									$totalLoan = 0;
									$totalLoanCount = 0;
									
									$totalLoanCS = 0;
									$totalLoanCSOnly = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										$agentTarget80 = round(($AgentTarget/100)*80);
										$totalCardsCS = $totalCardsCS+$_tdata->cards_point_m;
										
										
										$totalLoanCS = $totalLoanCS+$_tdata->final_loan;
										
										if($_tdata->agent_product == 'CARDS')
										{
											$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan;
											$totalCards = $totalCards+$_tdata->cards_point_m;
											$totalCardsCount++;
											if($agentTarget80 > $_tdata->cards_point_m)
											{
												$targetNotAchive80++;
											}
										}
										else
										{
											$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->cards_point_m;
											$totalLoan = $totalLoan+$_tdata->final_loan;
											$totalLoanCount++;
											if($agentTarget80 > $_tdata->final_loan)
											{
												$targetNotAchive80++;
											}
										}
									}
									
									
									
									/*
									*count 80% target not achive
									*/
									
									/*
									*candidate count achived target
									*/
									$achivedCandidate = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										if($_tdata->agent_product == 'CARDS')
										{
											if($AgentTarget <= $_tdata->cards_point_m)
											{
												$achivedCandidate++;
											}
										}
										else
										{
											if($AgentTarget <= $_tdata->final_loan)
											{
												$achivedCandidate++;
											}
										}
									}
									/*
									*candidate count achived target
									*/
									
								/* 	$dataPie[0]['cName']= 'Total Agents Head Count';
									$dataPie[0]['total']= count($allMashreqData);
									$dataPie[0]['color']= $colorCode[0]; */
									$totalHeadCount = count($allMashreqData);
									if(count($salesTimeArray) == 1)
									{
									 $graphArray[$indexC]['Total Agents'] = count($allMashreqData);
									 $graphArray[$indexC]['Agents in Cards'] = $totalCardsCount;
									}
									
									/* $graphArray[$indexC]['Agents in Loan'] = $totalLoanCount; */
									if($totalCardsCount >0)
										{
											$graphArray[$indexC]['Core Team Productivity (Cards)'] = round($totalCards/$totalCardsCount,2);
										}
										else
										{
											$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
										}
									/* 	if($totalLoanCount > 0)
										{
											$graphArray[$indexC]['Core Team Productivity (Loan)'] = round($totalLoan/$totalLoanCount,2);
											
										}
										else
										{
											$graphArray[$indexC]['Core Team Productivity (Loan)'] = 0;
										} */
											
										if($totalCardsCount >0)
										{
											$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
												
										}
										else
										{
											$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
										}
										/* if($totalLoanCount >0)
										{
											$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = round($totalLoanCS/$totalLoanCount,2);
												
										}
										else
										{
											$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = 0;
										} */
										if($totalCardsCS >0)
										{
											$graphArray[$indexC]['XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
												
										}
										else
										{
											$graphArray[$indexC]['XS (Card)'] = '0%';
												
										}
										/* if($totalLoanCS >0)
										{
												$graphArray[$indexC]['XS (Loan)'] = round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
												
										}
										else
										{
												$graphArray[$indexC]['XS (Loan)'] = '0%';
										} */
									
									
									
									
									
								
									
									
									
									
									
							}
							else
							{
								if(count($salesTimeArray) == 1)
									{
								$graphArray[$indexC]['Total Agents'] = 0;
								$graphArray[$indexC]['Agents in Cards'] = 0;
									}
								
							
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
								
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
							
								$graphArray[$indexC]['XS (Card)'] = 0;
								
							}
							if($historical_data == "yes")
							{
					$graphArray1 = $this->getDataAsXS_CardHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
						/*end code*/
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
					/*
					*report as per salesTime
					*end code
					*/
					}
					
					/*
					*report as per Vintage
					*start code
					*/
					}
					else
					{
					
					/*
					*report as per salesTime
					*start code
					*/
					foreach($salesTimeArray as $_salesT)
					{
						$graphArray[$indexC]['Sales Time'] = $_salesT;
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->where("end_sales_time",$_salesT)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->where("end_sales_time",$_salesT)->whereraw($whereRaw)->get();	
							
							
						}
						 /* echo "<pre>";
						echo count($allMashreqData);
						exit;  */
						if(count($allMashreqData) >0)
							{
								
									/*
									*count 80% target not achive
									*/
									$targetNotAchive80 = 0;
									$totalCards = 0;
									$totalCardsCS = 0;
									$totalCardsCSOnly = 0;
									$totalCardsCount = 0;
								
									
									$totalLoan = 0;
									$totalLoanCount = 0;
									
									$totalLoanCS = 0;
									$totalLoanCSOnly = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										$agentTarget80 = round(($AgentTarget/100)*80);
										$totalCardsCS = $totalCardsCS+$_tdata->cards_point_m;
										
										
										$totalLoanCS = $totalLoanCS+$_tdata->final_loan;
										
										if($_tdata->agent_product == 'CARDS')
										{
											$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan;
											$totalCards = $totalCards+$_tdata->cards_point_m;
											$totalCardsCount++;
											if($agentTarget80 > $_tdata->cards_point_m)
											{
												$targetNotAchive80++;
											}
										}
										else
										{
											$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->cards_point_m;
											$totalLoan = $totalLoan+$_tdata->final_loan;
											$totalLoanCount++;
											if($agentTarget80 > $_tdata->final_loan)
											{
												$targetNotAchive80++;
											}
										}
									}
									
									
									
									/*
									*count 80% target not achive
									*/
									
									/*
									*candidate count achived target
									*/
									$achivedCandidate = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										if($_tdata->agent_product == 'CARDS')
										{
											if($AgentTarget <= $_tdata->cards_point_m)
											{
												$achivedCandidate++;
											}
										}
										else
										{
											if($AgentTarget <= $_tdata->final_loan)
											{
												$achivedCandidate++;
											}
										}
									}
									/*
									*candidate count achived target
									*/
									
								/* 	$dataPie[0]['cName']= 'Total Agents Head Count';
									$dataPie[0]['total']= count($allMashreqData);
									$dataPie[0]['color']= $colorCode[0]; */
									$totalHeadCount = count($allMashreqData);
									if(count($salesTimeArray) == 1)
									{
									 $graphArray[$indexC]['Total Agents'] = count($allMashreqData);
									 $graphArray[$indexC]['Agents in Cards'] = $totalCardsCount;
									}
									
									/* $graphArray[$indexC]['Agents in Loan'] = $totalLoanCount; */
									if($totalCardsCount >0)
										{
											$graphArray[$indexC]['Core Team Productivity (Cards)'] = round($totalCards/$totalCardsCount,2);
										}
										else
										{
											$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
										}
									/* 	if($totalLoanCount > 0)
										{
											$graphArray[$indexC]['Core Team Productivity (Loan)'] = round($totalLoan/$totalLoanCount,2);
											
										}
										else
										{
											$graphArray[$indexC]['Core Team Productivity (Loan)'] = 0;
										} */
											
										if($totalCardsCount >0)
										{
											$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
												
										}
										else
										{
											$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
										}
										/* if($totalLoanCount >0)
										{
											$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = round($totalLoanCS/$totalLoanCount,2);
												
										}
										else
										{
											$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = 0;
										} */
										if($totalCardsCS >0)
										{
											$graphArray[$indexC]['XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
												
										}
										else
										{
											$graphArray[$indexC]['XS (Card)'] = '0%';
												
										}
										/* if($totalLoanCS >0)
										{
												$graphArray[$indexC]['XS (Loan)'] = round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
												
										}
										else
										{
												$graphArray[$indexC]['XS (Loan)'] = '0%';
										} */
									
									
									
									
									
								
									
									
									
									
									
							}
							else
							{
								if(count($salesTimeArray) == 1)
									{
								$graphArray[$indexC]['Total Agents'] = 0;
								$graphArray[$indexC]['Agents in Cards'] = 0;
									}
								
							
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
								
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
							
								$graphArray[$indexC]['XS (Card)'] = 0;
								
							}
							if($historical_data == "yes")
							{
					$graphArray1 = $this->getDataAsXS_CardHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
						/*end code*/
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
					/*
					*report as per salesTime
					*end code
					*/
					}
					}
					
						$graphArray[$indexC]['Sales Time'] = "Total";
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("end_sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->get();	
							
							
						}
						 /* echo "<pre>";
						echo count($allMashreqData);
						exit;  */
						if(count($allMashreqData) >0)
							{
								
									/*
									*count 80% target not achive
									*/
									$targetNotAchive80 = 0;
									$totalCards = 0;
									$totalCardsCS = 0;
									$totalCardsCSOnly = 0;
									$totalCardsCount = 0;
								
									
									$totalLoan = 0;
									$totalLoanCount = 0;
									
									$totalLoanCS = 0;
									$totalLoanCSOnly = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										$agentTarget80 = round(($AgentTarget/100)*80);
										$totalCardsCS = $totalCardsCS+$_tdata->cards_point_m;
										
										
										$totalLoanCS = $totalLoanCS+$_tdata->final_loan;
										
										if($_tdata->agent_product == 'CARDS')
										{
											$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan;
											$totalCards = $totalCards+$_tdata->cards_point_m;
											$totalCardsCount++;
											if($agentTarget80 > $_tdata->cards_point_m)
											{
												$targetNotAchive80++;
											}
										}
										else
										{
											$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->cards_point_m;
											$totalLoan = $totalLoan+$_tdata->final_loan;
											$totalLoanCount++;
											if($agentTarget80 > $_tdata->final_loan)
											{
												$targetNotAchive80++;
											}
										}
									}
									
									
									
									/*
									*count 80% target not achive
									*/
									
									/*
									*candidate count achived target
									*/
									$achivedCandidate = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										if($_tdata->agent_product == 'CARDS')
										{
											if($AgentTarget <= $_tdata->cards_point_m)
											{
												$achivedCandidate++;
											}
										}
										else
										{
											if($AgentTarget <= $_tdata->final_loan)
											{
												$achivedCandidate++;
											}
										}
									}
									/*
									*candidate count achived target
									*/
									
								/* 	$dataPie[0]['cName']= 'Total Agents Head Count';
									$dataPie[0]['total']= count($allMashreqData);
									$dataPie[0]['color']= $colorCode[0]; */
									$totalHeadCount = count($allMashreqData);
									if(count($salesTimeArray) == 1)
									{
									 $graphArray[$indexC]['Total Agents'] = count($allMashreqData);
									 $graphArray[$indexC]['Agents in Cards'] = $totalCardsCount;
									}
									
									/* $graphArray[$indexC]['Agents in Loan'] = $totalLoanCount; */
									if($totalCardsCount >0)
										{
											$graphArray[$indexC]['Core Team Productivity (Cards)'] = round($totalCards/$totalCardsCount,2);
										}
										else
										{
											$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
										}
									/* 	if($totalLoanCount > 0)
										{
											$graphArray[$indexC]['Core Team Productivity (Loan)'] = round($totalLoan/$totalLoanCount,2);
											
										}
										else
										{
											$graphArray[$indexC]['Core Team Productivity (Loan)'] = 0;
										} */
											
										if($totalCardsCount >0)
										{
											$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
												
										}
										else
										{
											$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
										}
										/* if($totalLoanCount >0)
										{
											$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = round($totalLoanCS/$totalLoanCount,2);
												
										}
										else
										{
											$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = 0;
										} */
										if($totalCardsCS >0)
										{
											$graphArray[$indexC]['XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
												
										}
										else
										{
											$graphArray[$indexC]['XS (Card)'] = '0%';
												
										}
										/* if($totalLoanCS >0)
										{
												$graphArray[$indexC]['XS (Loan)'] = round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
												
										}
										else
										{
												$graphArray[$indexC]['XS (Loan)'] = '0%';
										} */
									
									
									
									
									
								
									
									
									
									
									
							}
							else
							{
								if(count($salesTimeArray) == 1)
									{
								$graphArray[$indexC]['Total Agents'] = 0;
								$graphArray[$indexC]['Agents in Cards'] = 0;
									}
								
							
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
								
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
							
								$graphArray[$indexC]['XS (Card)'] = 0;
								
							}
							if($historical_data == "yes")
							{
					$graphArray1 = $this->getDataAsXS_CardHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
						/*end code*/
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
					
					
					return $graphArrayM;
			}
	}
	
	protected function getDataAsXS_CardTotal($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
	{
						$graphArray = array();
						$graphArray['Sales Time'] = "Total";
						$graphArray['TL Name'] = "";
						$graphArray['Bank'] = "Mashreq";
						
						$whereRaw = '';
					/* 	if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("end_sales_time",$salesTimeArray)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						else
						{
						
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("end_sales_time",$salesTimeArray)->whereIn("tl_name",$tl_name_array)->whereraw($whereRaw)->get();
							
						}
						 /* echo "<pre>";
						echo count($allMashreqData);
						exit;  */
						if(count($allMashreqData) >0)
							{
								
									/*
									*count 80% target not achive
									*/
									$targetNotAchive80 = 0;
									$totalCards = 0;
									$totalCardsCS = 0;
									$totalCardsCSOnly = 0;
									$totalCardsCount = 0;
								
									
									$totalLoan = 0;
									$totalLoanCount = 0;
									
									$totalLoanCS = 0;
									$totalLoanCSOnly = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										$agentTarget80 = round(($AgentTarget/100)*80);
										$totalCardsCS = $totalCardsCS+$_tdata->cards_point_m;
										
										
										$totalLoanCS = $totalLoanCS+$_tdata->final_loan;
										
										if($_tdata->agent_product == 'CARDS')
										{
											$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan;
											$totalCards = $totalCards+$_tdata->cards_point_m;
											$totalCardsCount++;
											if($agentTarget80 > $_tdata->cards_point_m)
											{
												$targetNotAchive80++;
											}
										}
										else
										{
											$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->cards_point_m;
											$totalLoan = $totalLoan+$_tdata->final_loan;
											$totalLoanCount++;
											if($agentTarget80 > $_tdata->final_loan)
											{
												$targetNotAchive80++;
											}
										}
									}
									
									
									
									/*
									*count 80% target not achive
									*/
									
									/*
									*candidate count achived target
									*/
									$achivedCandidate = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										if($_tdata->agent_product == 'CARDS')
										{
											if($AgentTarget <= $_tdata->cards_point_m)
											{
												$achivedCandidate++;
											}
										}
										else
										{
											if($AgentTarget <= $_tdata->final_loan)
											{
												$achivedCandidate++;
											}
										}
									}
									/*
									*candidate count achived target
									*/
									
								/* 	$dataPie[0]['cName']= 'Total Agents Head Count';
									$dataPie[0]['total']= count($allMashreqData);
									$dataPie[0]['color']= $colorCode[0]; */
									$totalHeadCount = count($allMashreqData);
									if(count($salesTimeArray) == 1)
									{
									 $graphArray['Total Agents'] = count($allMashreqData);
									 $graphArray['Agents in Cards'] = $totalCardsCount;
									}
									
									/* $graphArray[$indexC]['Agents in Loan'] = $totalLoanCount; */
									if($totalCardsCount >0)
										{
											$graphArray['Core Team Productivity (Cards)'] = round($totalCards/$totalCardsCount,2);
										}
										else
										{
											$graphArray['Core Team Productivity (Cards)'] = 0;
										}
									/* 	if($totalLoanCount > 0)
										{
											$graphArray[$indexC]['Core Team Productivity (Loan)'] = round($totalLoan/$totalLoanCount,2);
											
										}
										else
										{
											$graphArray[$indexC]['Core Team Productivity (Loan)'] = 0;
										} */
											
										if($totalCardsCount >0)
										{
											$graphArray['Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
												
										}
										else
										{
											$graphArray['Team Cards Productivity (Cards including XS)'] = 0;
										}
										/* if($totalLoanCount >0)
										{
											$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = round($totalLoanCS/$totalLoanCount,2);
												
										}
										else
										{
											$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = 0;
										} */
										if($totalCardsCS >0)
										{
											$graphArray['XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
												
										}
										else
										{
											$graphArray['XS (Card)'] = '0%';
												
										}
										/* if($totalLoanCS >0)
										{
												$graphArray[$indexC]['XS (Loan)'] = round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
												
										}
										else
										{
												$graphArray[$indexC]['XS (Loan)'] = '0%';
										} */
									
									
									
									
									
								
									
									
									
									
									
							}
							else
							{
								if(count($salesTimeArray) == 1)
									{
								$graphArray['Total Agents'] = 0;
								$graphArray['Agents in Cards'] = 0;
									}
								
							
								$graphArray['Core Team Productivity (Cards)'] = 0;
								
								$graphArray['Team Cards Productivity (Cards including XS)'] = 0;
							
								$graphArray['XS (Card)'] = 0;
								
							}
							if($historical_data == "yes")
							{
							$graphArrayT = $this->getDataAsXS_CardHistroyTotal($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout);
							
							$graphArrayTD = array_merge($graphArray,$graphArrayT);
							}
							else
							{
								$graphArrayTD = $graphArray;
							}
							
					return $graphArrayTD;
						/*end code*/
					
	}
	protected function getDataAsXS_CardHistroyTotal($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout)
	{
	
				
						
						$whereRaw = '';
						
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("tl_name",$tl_name_array)->whereraw($whereRaw)->get();	
							
							
						}
						 /* echo "<pre>";
						echo count($allMashreqData);
						exit;  */
						if(count($allMashreqData) >0)
							{
								
									/*
									*count 80% target not achive
									*/
									$targetNotAchive80 = 0;
									$totalCards = 0;
									$totalCardsCS = 0;
									$totalCardsCSOnly = 0;
									$totalCardsCount = 0;
								
									
									$totalLoan = 0;
									$totalLoanCount = 0;
									
									$totalLoanCS = 0;
									$totalLoanCSOnly = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										$agentTarget80 = round(($AgentTarget/100)*80);
										$totalCardsCS = $totalCardsCS+$_tdata->cards_point_m;
										
										
										$totalLoanCS = $totalLoanCS+$_tdata->final_loan;
										
										if($_tdata->agent_product == 'CARDS')
										{
											$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan;
											$totalCards = $totalCards+$_tdata->cards_point_m;
											$totalCardsCount++;
											if($agentTarget80 > $_tdata->cards_point_m)
											{
												$targetNotAchive80++;
											}
										}
										else
										{
											$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->cards_point_m;
											$totalLoan = $totalLoan+$_tdata->final_loan;
											$totalLoanCount++;
											if($agentTarget80 > $_tdata->final_loan)
											{
												$targetNotAchive80++;
											}
										}
									}
									
									
									
									/*
									*count 80% target not achive
									*/
									
									/*
									*candidate count achived target
									*/
									$achivedCandidate = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										if($_tdata->agent_product == 'CARDS')
										{
											if($AgentTarget <= $_tdata->cards_point_m)
											{
												$achivedCandidate++;
											}
										}
										else
										{
											if($AgentTarget <= $_tdata->final_loan)
											{
												$achivedCandidate++;
											}
										}
									}
									/*
									*candidate count achived target
									*/
									
								/* 	$dataPie[0]['cName']= 'Total Agents Head Count';
									$dataPie[0]['total']= count($allMashreqData);
									$dataPie[0]['color']= $colorCode[0]; */
									$totalHeadCount = count($allMashreqData);
									/*  $graphArray[$indexC]['Historical Total Agents'] = count($allMashreqData); */
									/* $graphArray[$indexC]['Historical  Agents in Cards'] = $totalCardsCount; */
									/* $graphArray[$indexC]['Agents in Loan'] = $totalLoanCount; */
									if($totalCardsCount >0)
										{
											$graphArray['Historical Core Team Productivity (Cards)'] = round($totalCards/$totalCardsCount,2);
										}
										else
										{
											$graphArray['Historical Core Team Productivity (Cards)'] = 0;
										}
									/* 	if($totalLoanCount > 0)
										{
											$graphArray[$indexC]['Core Team Productivity (Loan)'] = round($totalLoan/$totalLoanCount,2);
											
										}
										else
										{
											$graphArray[$indexC]['Core Team Productivity (Loan)'] = 0;
										} */
											
										if($totalCardsCount >0)
										{
											$graphArray['Historical Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
												
										}
										else
										{
											$graphArray['Historical Team Cards Productivity (Cards including XS)'] = 0;
										}
										/* if($totalLoanCount >0)
										{
											$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = round($totalLoanCS/$totalLoanCount,2);
												
										}
										else
										{
											$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = 0;
										} */
										if($totalCardsCS >0)
										{
											$graphArray['Historical XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
												
										}
										else
										{
											$graphArray['XS (Card)'] = '0%';
												
										}
										/* if($totalLoanCS >0)
										{
												$graphArray[$indexC]['XS (Loan)'] = round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
												
										}
										else
										{
												$graphArray[$indexC]['XS (Loan)'] = '0%';
										} */
									
									
									
									
									
								
									
									
									
									
									
							}
							else
							{
								/* $graphArray[$indexC]['Historical Total Agents'] = 0; */
								/* $graphArray[$indexC]['Historical Agents in Cards'] = 0; */
							
								$graphArray['Historical Core Team Productivity (Cards)'] = 0;
								
								$graphArray['Historical Team Cards Productivity (Cards including XS)'] = 0;
							
								$graphArray['Historical XS (Card)'] = 0;
								
							}
							
					return $graphArray;
	}
	protected function getDataAsXS_CardHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC)
	{
	
				
						
						$whereRaw = '';
						if($teamleaderwithout != "yes")
						{
							if($tl_name != 'No')
							{
								if($whereRaw == '')
								{
									$whereRaw = "tl_name = '".$tl_name."'";
								}
								else
								{
									$whereRaw .= " AND tl_name= '".$tl_name."'";
								}
							}
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereraw($whereRaw)->get();	
							
							
						}
						 /* echo "<pre>";
						echo count($allMashreqData);
						exit;  */
						if(count($allMashreqData) >0)
							{
								
									/*
									*count 80% target not achive
									*/
									$targetNotAchive80 = 0;
									$totalCards = 0;
									$totalCardsCS = 0;
									$totalCardsCSOnly = 0;
									$totalCardsCount = 0;
								
									
									$totalLoan = 0;
									$totalLoanCount = 0;
									
									$totalLoanCS = 0;
									$totalLoanCSOnly = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										$agentTarget80 = round(($AgentTarget/100)*80);
										$totalCardsCS = $totalCardsCS+$_tdata->cards_point_m;
										
										
										$totalLoanCS = $totalLoanCS+$_tdata->final_loan;
										
										if($_tdata->agent_product == 'CARDS')
										{
											$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan;
											$totalCards = $totalCards+$_tdata->cards_point_m;
											$totalCardsCount++;
											if($agentTarget80 > $_tdata->cards_point_m)
											{
												$targetNotAchive80++;
											}
										}
										else
										{
											$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->cards_point_m;
											$totalLoan = $totalLoan+$_tdata->final_loan;
											$totalLoanCount++;
											if($agentTarget80 > $_tdata->final_loan)
											{
												$targetNotAchive80++;
											}
										}
									}
									
									
									
									/*
									*count 80% target not achive
									*/
									
									/*
									*candidate count achived target
									*/
									$achivedCandidate = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										if($_tdata->agent_product == 'CARDS')
										{
											if($AgentTarget <= $_tdata->cards_point_m)
											{
												$achivedCandidate++;
											}
										}
										else
										{
											if($AgentTarget <= $_tdata->final_loan)
											{
												$achivedCandidate++;
											}
										}
									}
									/*
									*candidate count achived target
									*/
									
								/* 	$dataPie[0]['cName']= 'Total Agents Head Count';
									$dataPie[0]['total']= count($allMashreqData);
									$dataPie[0]['color']= $colorCode[0]; */
									$totalHeadCount = count($allMashreqData);
									/*  $graphArray[$indexC]['Historical Total Agents'] = count($allMashreqData); */
									/* $graphArray[$indexC]['Historical  Agents in Cards'] = $totalCardsCount; */
									/* $graphArray[$indexC]['Agents in Loan'] = $totalLoanCount; */
									if($totalCardsCount >0)
										{
											$graphArray[$indexC]['Historical Core Team Productivity (Cards)'] = round($totalCards/$totalCardsCount,2);
										}
										else
										{
											$graphArray[$indexC]['Historical Core Team Productivity (Cards)'] = 0;
										}
									/* 	if($totalLoanCount > 0)
										{
											$graphArray[$indexC]['Core Team Productivity (Loan)'] = round($totalLoan/$totalLoanCount,2);
											
										}
										else
										{
											$graphArray[$indexC]['Core Team Productivity (Loan)'] = 0;
										} */
											
										if($totalCardsCount >0)
										{
											$graphArray[$indexC]['Historical Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
												
										}
										else
										{
											$graphArray[$indexC]['Historical Team Cards Productivity (Cards including XS)'] = 0;
										}
										/* if($totalLoanCount >0)
										{
											$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = round($totalLoanCS/$totalLoanCount,2);
												
										}
										else
										{
											$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = 0;
										} */
										if($totalCardsCS >0)
										{
											$graphArray[$indexC]['Historical XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
												
										}
										else
										{
											$graphArray[$indexC]['XS (Card)'] = '0%';
												
										}
										/* if($totalLoanCS >0)
										{
												$graphArray[$indexC]['XS (Loan)'] = round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
												
										}
										else
										{
												$graphArray[$indexC]['XS (Loan)'] = '0%';
										} */
									
									
									
									
									
								
									
									
									
									
									
							}
							else
							{
								/* $graphArray[$indexC]['Historical Total Agents'] = 0; */
								/* $graphArray[$indexC]['Historical Agents in Cards'] = 0; */
							
								$graphArray[$indexC]['Historical Core Team Productivity (Cards)'] = 0;
								
								$graphArray[$indexC]['Historical Team Cards Productivity (Cards including XS)'] = 0;
							
								$graphArray[$indexC]['Historical XS (Card)'] = 0;
								
							}
							
					return $graphArray;
	}
	protected function getDataAsXS_Loan($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
	{
		if($teamleaderwithout != "yes")
		{
					$indexC = 0;
				
					foreach($tl_name_array as $tl_name)
					{
						$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						$graphArray[$indexC]['TL Name'] = $tl_name;
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("end_sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
							$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->get();	
							
							
						}
						 /* echo "<pre>";
						echo count($allMashreqData);
						exit;  */
						if(count($allMashreqData) >0)
							{
								
									/*
									*count 80% target not achive
									*/
									$targetNotAchive80 = 0;
									$totalCards = 0;
									$totalCardsCS = 0;
									$totalCardsCSOnly = 0;
									$totalCardsCount = 0;
								
									
									$totalLoan = 0;
									$totalLoanCount = 0;
									
									$totalLoanCS = 0;
									$totalLoanCSOnly = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										$agentTarget80 = round(($AgentTarget/100)*80);
										$totalCardsCS = $totalCardsCS+$_tdata->cards_point_m;
										
										
										$totalLoanCS = $totalLoanCS+$_tdata->final_loan;
										
										if($_tdata->agent_product == 'CARDS')
										{
											$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan;
											$totalCards = $totalCards+$_tdata->cards_point_m;
											$totalCardsCount++;
											if($agentTarget80 > $_tdata->cards_point_m)
											{
												$targetNotAchive80++;
											}
										}
										else
										{
											$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->cards_point_m;
											$totalLoan = $totalLoan+$_tdata->final_loan;
											$totalLoanCount++;
											if($agentTarget80 > $_tdata->final_loan)
											{
												$targetNotAchive80++;
											}
										}
									}
									
									
									
									/*
									*count 80% target not achive
									*/
									
									/*
									*candidate count achived target
									*/
									$achivedCandidate = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										if($_tdata->agent_product == 'CARDS')
										{
											if($AgentTarget <= $_tdata->cards_point_m)
											{
												$achivedCandidate++;
											}
										}
										else
										{
											if($AgentTarget <= $_tdata->final_loan)
											{
												$achivedCandidate++;
											}
										}
									}
									/*
									*candidate count achived target
									*/
									
								/* 	$dataPie[0]['cName']= 'Total Agents Head Count';
									$dataPie[0]['total']= count($allMashreqData);
									$dataPie[0]['color']= $colorCode[0]; */
									$totalHeadCount = count($allMashreqData);
									if(count($salesTimeArray) == 1)
									{
									$graphArray[$indexC]['Total Agents'] = count($allMashreqData);
									$graphArray[$indexC]['Agents in Loan'] = $totalLoanCount;
									}
									/* $graphArray[$indexC]['Agents in Cards'] = $totalCardsCount; */
									
									/* if($totalCardsCount >0)
										{
											$graphArray[$indexC]['Core Team Productivity (Cards)'] = round($totalCards/$totalCardsCount,2);
										}
										else
										{
											$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
										} */
										if($totalLoanCount > 0)
										{
											$graphArray[$indexC]['Core Team Productivity (Loan)'] = round($totalLoan/$totalLoanCount,2);
											
										}
										else
										{
											$graphArray[$indexC]['Core Team Productivity (Loan)'] = 0;
										}
											
										/* if($totalCardsCount >0)
										{
											$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
												
										}
										else
										{
											$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
										} */
										if($totalLoanCount >0)
										{
											$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = round($totalLoanCS/$totalLoanCount,2);
												
										}
										else
										{
											$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = 0;
										}
										/* if($totalCardsCS >0)
										{
											$graphArray[$indexC]['XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
												
										}
										else
										{
											$graphArray[$indexC]['XS (Card)'] = '0%';
												
										} */
										if($totalLoanCS >0)
										{
												$graphArray[$indexC]['XS (Loan)'] = round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
												
										}
										else
										{
												$graphArray[$indexC]['XS (Loan)'] = '0%';
										}
									
									
									
									
									
								
									
									
									
									
									
							}
							else
							{
								if(count($salesTimeArray) == 1)
									{
									$graphArray[$indexC]['Total Agents'] = 0;
									$graphArray[$indexC]['Agents in Loan'] = 0;
									}
								
								
								$graphArray[$indexC]['Core Team Productivity (Loan)'] = 0;
								
								$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = 0;
							
								$graphArray[$indexC]['XS (Loan)'] = 0;
							}
							if($historical_data == "yes")
							{
							$graphArray1 = $this->getDataAsXS_LoanHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
						$indexC++;
						/*end code*/
					}
					$graphArrayM[$indexC] = $this->getDataAsXS_LoanTotal($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
					return $graphArrayM;
		}
		else
		{
			$indexC = 0;
				$graphArray = array();
				$tl_name = '';	
				
				if(count($salesTimeArray) == 1 && $vintage_name_SI != 'No')
				{
					
				/*
				*report as per Vintage
				*start code
				*/
				$vintage_name_SIArray = explode(",",$vintage_name_SI);
				foreach($vintage_name_SIArray as $vintage)
				{
					$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id = ".$vintage;
							}
							else
							{
								$whereRaw .= " AND range_id = ".$vintage;
							}
							$graphArray[$indexC]['Vintage'] = $vintage;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
							$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("end_sales_time",$salesTimeArray)->get();	
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						 /* echo "<pre>";
						echo count($allMashreqData);
						exit;  */
						if(count($allMashreqData) >0)
							{
								
									/*
									*count 80% target not achive
									*/
									$targetNotAchive80 = 0;
									$totalCards = 0;
									$totalCardsCS = 0;
									$totalCardsCSOnly = 0;
									$totalCardsCount = 0;
								
									
									$totalLoan = 0;
									$totalLoanCount = 0;
									
									$totalLoanCS = 0;
									$totalLoanCSOnly = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										$agentTarget80 = round(($AgentTarget/100)*80);
										$totalCardsCS = $totalCardsCS+$_tdata->cards_point_m;
										
										
										$totalLoanCS = $totalLoanCS+$_tdata->final_loan;
										
										if($_tdata->agent_product == 'CARDS')
										{
											$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan;
											$totalCards = $totalCards+$_tdata->cards_point_m;
											$totalCardsCount++;
											if($agentTarget80 > $_tdata->cards_point_m)
											{
												$targetNotAchive80++;
											}
										}
										else
										{
											$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->cards_point_m;
											$totalLoan = $totalLoan+$_tdata->final_loan;
											$totalLoanCount++;
											if($agentTarget80 > $_tdata->final_loan)
											{
												$targetNotAchive80++;
											}
										}
									}
									
									
									
									/*
									*count 80% target not achive
									*/
									
									/*
									*candidate count achived target
									*/
									$achivedCandidate = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										if($_tdata->agent_product == 'CARDS')
										{
											if($AgentTarget <= $_tdata->cards_point_m)
											{
												$achivedCandidate++;
											}
										}
										else
										{
											if($AgentTarget <= $_tdata->final_loan)
											{
												$achivedCandidate++;
											}
										}
									}
									/*
									*candidate count achived target
									*/
									
								/* 	$dataPie[0]['cName']= 'Total Agents Head Count';
									$dataPie[0]['total']= count($allMashreqData);
									$dataPie[0]['color']= $colorCode[0]; */
									$totalHeadCount = count($allMashreqData);
									if(count($salesTimeArray) == 1)
									{
									$graphArray[$indexC]['Total Agents'] = count($allMashreqData);
									$graphArray[$indexC]['Agents in Loan'] = $totalLoanCount;
									}
									/* $graphArray[$indexC]['Agents in Cards'] = $totalCardsCount; */
									
									/* if($totalCardsCount >0)
										{
											$graphArray[$indexC]['Core Team Productivity (Cards)'] = round($totalCards/$totalCardsCount,2);
										}
										else
										{
											$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
										} */
										if($totalLoanCount > 0)
										{
											$graphArray[$indexC]['Core Team Productivity (Loan)'] = round($totalLoan/$totalLoanCount,2);
											
										}
										else
										{
											$graphArray[$indexC]['Core Team Productivity (Loan)'] = 0;
										}
											
										/* if($totalCardsCount >0)
										{
											$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
												
										}
										else
										{
											$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
										} */
										if($totalLoanCount >0)
										{
											$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = round($totalLoanCS/$totalLoanCount,2);
												
										}
										else
										{
											$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = 0;
										}
										/* if($totalCardsCS >0)
										{
											$graphArray[$indexC]['XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
												
										}
										else
										{
											$graphArray[$indexC]['XS (Card)'] = '0%';
												
										} */
										if($totalLoanCS >0)
										{
												$graphArray[$indexC]['XS (Loan)'] = round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
												
										}
										else
										{
												$graphArray[$indexC]['XS (Loan)'] = '0%';
										}
									
									
									
									
									
								
									
									
									
									
									
							}
							else
							{
								if(count($salesTimeArray) == 1)
									{
								$graphArray[$indexC]['Total Agents'] = 0;
								$graphArray[$indexC]['Agents in Loan'] = 0;
									}
								
								
								$graphArray[$indexC]['Core Team Productivity (Loan)'] = 0;
								
								$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = 0;
							
								$graphArray[$indexC]['XS (Loan)'] = 0;
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsXS_LoanHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
				}
				/*
				*report as per Vintage
				*end code
				*/
				
				}
				else
				{
				/*
				*report as per salesTime
				*start code
				*/
				foreach($salesTimeArray as $_salesT)
				{
					$graphArray[$indexC]['Sales Time'] = $_salesT;
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
							$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->where("end_sales_time",$_salesT)->get();	
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->where("end_sales_time",$_salesT)->whereraw($whereRaw)->get();
							
							
						}
						 /* echo "<pre>";
						echo count($allMashreqData);
						exit;  */
						if(count($allMashreqData) >0)
							{
								
									/*
									*count 80% target not achive
									*/
									$targetNotAchive80 = 0;
									$totalCards = 0;
									$totalCardsCS = 0;
									$totalCardsCSOnly = 0;
									$totalCardsCount = 0;
								
									
									$totalLoan = 0;
									$totalLoanCount = 0;
									
									$totalLoanCS = 0;
									$totalLoanCSOnly = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										$agentTarget80 = round(($AgentTarget/100)*80);
										$totalCardsCS = $totalCardsCS+$_tdata->cards_point_m;
										
										
										$totalLoanCS = $totalLoanCS+$_tdata->final_loan;
										
										if($_tdata->agent_product == 'CARDS')
										{
											$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan;
											$totalCards = $totalCards+$_tdata->cards_point_m;
											$totalCardsCount++;
											if($agentTarget80 > $_tdata->cards_point_m)
											{
												$targetNotAchive80++;
											}
										}
										else
										{
											$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->cards_point_m;
											$totalLoan = $totalLoan+$_tdata->final_loan;
											$totalLoanCount++;
											if($agentTarget80 > $_tdata->final_loan)
											{
												$targetNotAchive80++;
											}
										}
									}
									
									
									
									/*
									*count 80% target not achive
									*/
									
									/*
									*candidate count achived target
									*/
									$achivedCandidate = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										if($_tdata->agent_product == 'CARDS')
										{
											if($AgentTarget <= $_tdata->cards_point_m)
											{
												$achivedCandidate++;
											}
										}
										else
										{
											if($AgentTarget <= $_tdata->final_loan)
											{
												$achivedCandidate++;
											}
										}
									}
									/*
									*candidate count achived target
									*/
									
								/* 	$dataPie[0]['cName']= 'Total Agents Head Count';
									$dataPie[0]['total']= count($allMashreqData);
									$dataPie[0]['color']= $colorCode[0]; */
									$totalHeadCount = count($allMashreqData);
									if(count($salesTimeArray) == 1)
									{
									$graphArray[$indexC]['Total Agents'] = count($allMashreqData);
									$graphArray[$indexC]['Agents in Loan'] = $totalLoanCount;
									}
									/* $graphArray[$indexC]['Agents in Cards'] = $totalCardsCount; */
									
									/* if($totalCardsCount >0)
										{
											$graphArray[$indexC]['Core Team Productivity (Cards)'] = round($totalCards/$totalCardsCount,2);
										}
										else
										{
											$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
										} */
										if($totalLoanCount > 0)
										{
											$graphArray[$indexC]['Core Team Productivity (Loan)'] = round($totalLoan/$totalLoanCount,2);
											
										}
										else
										{
											$graphArray[$indexC]['Core Team Productivity (Loan)'] = 0;
										}
											
										/* if($totalCardsCount >0)
										{
											$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
												
										}
										else
										{
											$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
										} */
										if($totalLoanCount >0)
										{
											$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = round($totalLoanCS/$totalLoanCount,2);
												
										}
										else
										{
											$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = 0;
										}
										/* if($totalCardsCS >0)
										{
											$graphArray[$indexC]['XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
												
										}
										else
										{
											$graphArray[$indexC]['XS (Card)'] = '0%';
												
										} */
										if($totalLoanCS >0)
										{
												$graphArray[$indexC]['XS (Loan)'] = round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
												
										}
										else
										{
												$graphArray[$indexC]['XS (Loan)'] = '0%';
										}
									
									
									
									
									
								
									
									
									
									
									
							}
							else
							{
								if(count($salesTimeArray) == 1)
									{
								$graphArray[$indexC]['Total Agents'] = 0;
								$graphArray[$indexC]['Agents in Loan'] = 0;
									}
								
								
								$graphArray[$indexC]['Core Team Productivity (Loan)'] = 0;
								
								$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = 0;
							
								$graphArray[$indexC]['XS (Loan)'] = 0;
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsXS_LoanHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
				}
				
				/*
				*report as per salesTime
				*end code
				*/
				}
						$graphArray[$indexC]['Sales Time'] = "Total";
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
							$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("end_sales_time",$salesTimeArray)->get();	
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						 /* echo "<pre>";
						echo count($allMashreqData);
						exit;  */
						if(count($allMashreqData) >0)
							{
								
									/*
									*count 80% target not achive
									*/
									$targetNotAchive80 = 0;
									$totalCards = 0;
									$totalCardsCS = 0;
									$totalCardsCSOnly = 0;
									$totalCardsCount = 0;
								
									
									$totalLoan = 0;
									$totalLoanCount = 0;
									
									$totalLoanCS = 0;
									$totalLoanCSOnly = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										$agentTarget80 = round(($AgentTarget/100)*80);
										$totalCardsCS = $totalCardsCS+$_tdata->cards_point_m;
										
										
										$totalLoanCS = $totalLoanCS+$_tdata->final_loan;
										
										if($_tdata->agent_product == 'CARDS')
										{
											$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan;
											$totalCards = $totalCards+$_tdata->cards_point_m;
											$totalCardsCount++;
											if($agentTarget80 > $_tdata->cards_point_m)
											{
												$targetNotAchive80++;
											}
										}
										else
										{
											$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->cards_point_m;
											$totalLoan = $totalLoan+$_tdata->final_loan;
											$totalLoanCount++;
											if($agentTarget80 > $_tdata->final_loan)
											{
												$targetNotAchive80++;
											}
										}
									}
									
									
									
									/*
									*count 80% target not achive
									*/
									
									/*
									*candidate count achived target
									*/
									$achivedCandidate = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										if($_tdata->agent_product == 'CARDS')
										{
											if($AgentTarget <= $_tdata->cards_point_m)
											{
												$achivedCandidate++;
											}
										}
										else
										{
											if($AgentTarget <= $_tdata->final_loan)
											{
												$achivedCandidate++;
											}
										}
									}
									/*
									*candidate count achived target
									*/
									
								/* 	$dataPie[0]['cName']= 'Total Agents Head Count';
									$dataPie[0]['total']= count($allMashreqData);
									$dataPie[0]['color']= $colorCode[0]; */
									$totalHeadCount = count($allMashreqData);
									if(count($salesTimeArray) == 1)
									{
									$graphArray[$indexC]['Total Agents'] = count($allMashreqData);
									$graphArray[$indexC]['Agents in Loan'] = $totalLoanCount;
									}
									/* $graphArray[$indexC]['Agents in Cards'] = $totalCardsCount; */
									
									/* if($totalCardsCount >0)
										{
											$graphArray[$indexC]['Core Team Productivity (Cards)'] = round($totalCards/$totalCardsCount,2);
										}
										else
										{
											$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
										} */
										if($totalLoanCount > 0)
										{
											$graphArray[$indexC]['Core Team Productivity (Loan)'] = round($totalLoan/$totalLoanCount,2);
											
										}
										else
										{
											$graphArray[$indexC]['Core Team Productivity (Loan)'] = 0;
										}
											
										/* if($totalCardsCount >0)
										{
											$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
												
										}
										else
										{
											$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
										} */
										if($totalLoanCount >0)
										{
											$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = round($totalLoanCS/$totalLoanCount,2);
												
										}
										else
										{
											$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = 0;
										}
										/* if($totalCardsCS >0)
										{
											$graphArray[$indexC]['XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
												
										}
										else
										{
											$graphArray[$indexC]['XS (Card)'] = '0%';
												
										} */
										if($totalLoanCS >0)
										{
												$graphArray[$indexC]['XS (Loan)'] = round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
												
										}
										else
										{
												$graphArray[$indexC]['XS (Loan)'] = '0%';
										}
									
									
									
									
									
								
									
									
									
									
									
							}
							else
							{
								if(count($salesTimeArray) == 1)
									{
								$graphArray[$indexC]['Total Agents'] = 0;
								$graphArray[$indexC]['Agents in Loan'] = 0;
									}
								
								
								$graphArray[$indexC]['Core Team Productivity (Loan)'] = 0;
								
								$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = 0;
							
								$graphArray[$indexC]['XS (Loan)'] = 0;
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsXS_LoanHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
						/*end code*/
					
					
					return $graphArrayM;
			
		}
	
	}
	
	protected function getDataAsXS_LoanTotal($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
	{
		$graphArray = array();
						$graphArray['Sales Time'] = "Total";
						$graphArray['TL Name'] = "";
						$graphArray['Bank'] = "Mashreq";
						
						$whereRaw = '';
						
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("end_sales_time",$salesTimeArray)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						else
						{
							
							$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("end_sales_time",$salesTimeArray)->whereIn("tl_name",$tl_name_array)->whereraw($whereRaw)->get();	
							
							
						}
						 /* echo "<pre>";
						echo count($allMashreqData);
						exit;  */
						if(count($allMashreqData) >0)
							{
								
									/*
									*count 80% target not achive
									*/
									$targetNotAchive80 = 0;
									$totalCards = 0;
									$totalCardsCS = 0;
									$totalCardsCSOnly = 0;
									$totalCardsCount = 0;
								
									
									$totalLoan = 0;
									$totalLoanCount = 0;
									
									$totalLoanCS = 0;
									$totalLoanCSOnly = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										$agentTarget80 = round(($AgentTarget/100)*80);
										$totalCardsCS = $totalCardsCS+$_tdata->cards_point_m;
										
										
										$totalLoanCS = $totalLoanCS+$_tdata->final_loan;
										
										if($_tdata->agent_product == 'CARDS')
										{
											$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan;
											$totalCards = $totalCards+$_tdata->cards_point_m;
											$totalCardsCount++;
											if($agentTarget80 > $_tdata->cards_point_m)
											{
												$targetNotAchive80++;
											}
										}
										else
										{
											$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->cards_point_m;
											$totalLoan = $totalLoan+$_tdata->final_loan;
											$totalLoanCount++;
											if($agentTarget80 > $_tdata->final_loan)
											{
												$targetNotAchive80++;
											}
										}
									}
									
									
									
									/*
									*count 80% target not achive
									*/
									
									/*
									*candidate count achived target
									*/
									$achivedCandidate = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										if($_tdata->agent_product == 'CARDS')
										{
											if($AgentTarget <= $_tdata->cards_point_m)
											{
												$achivedCandidate++;
											}
										}
										else
										{
											if($AgentTarget <= $_tdata->final_loan)
											{
												$achivedCandidate++;
											}
										}
									}
									/*
									*candidate count achived target
									*/
									
								/* 	$dataPie[0]['cName']= 'Total Agents Head Count';
									$dataPie[0]['total']= count($allMashreqData);
									$dataPie[0]['color']= $colorCode[0]; */
									$totalHeadCount = count($allMashreqData);
									if(count($salesTimeArray) == 1)
									{
									$graphArray['Total Agents'] = count($allMashreqData);
									$graphArray['Agents in Loan'] = $totalLoanCount;
									}
									/* $graphArray[$indexC]['Agents in Cards'] = $totalCardsCount; */
									
									/* if($totalCardsCount >0)
										{
											$graphArray[$indexC]['Core Team Productivity (Cards)'] = round($totalCards/$totalCardsCount,2);
										}
										else
										{
											$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
										} */
										if($totalLoanCount > 0)
										{
											$graphArray['Core Team Productivity (Loan)'] = round($totalLoan/$totalLoanCount,2);
											
										}
										else
										{
											$graphArray['Core Team Productivity (Loan)'] = 0;
										}
											
										/* if($totalCardsCount >0)
										{
											$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
												
										}
										else
										{
											$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
										} */
										if($totalLoanCount >0)
										{
											$graphArray['Team Loan Productivity (Loan including XS)'] = round($totalLoanCS/$totalLoanCount,2);
												
										}
										else
										{
											$graphArray['Team Loan Productivity (Loan including XS)'] = 0;
										}
										/* if($totalCardsCS >0)
										{
											$graphArray[$indexC]['XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
												
										}
										else
										{
											$graphArray[$indexC]['XS (Card)'] = '0%';
												
										} */
										if($totalLoanCS >0)
										{
												$graphArray['XS (Loan)'] = round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
												
										}
										else
										{
												$graphArray['XS (Loan)'] = '0%';
										}
									
									
									
									
									
								
									
									
									
									
									
							}
							else
							{
								if(count($salesTimeArray) == 1)
									{
									$graphArray['Total Agents'] = 0;
									$graphArray['Agents in Loan'] = 0;
									}
								
								
								$graphArray['Core Team Productivity (Loan)'] = 0;
								
								$graphArray['Team Loan Productivity (Loan including XS)'] = 0;
							
								$graphArray['XS (Loan)'] = 0;
							}
							if($historical_data == "yes")
							{
							$graphArrayT = $this->getDataAsXS_LoanHistroyTotal($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout);
							$graphArrayTD = array_merge($graphArray,$graphArrayT);
							}
							else
							{
								$graphArrayTD = $graphArray;
							}
							return $graphArrayTD;
					
	}
	
	protected function getDataAsXS_LoanHistroyTotal($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout)
	{
			$whereRaw = '';
												
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereIn("tl_name",$tl_name_array)->get();	
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereraw($whereRaw)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						 /* echo "<pre>";
						echo count($allMashreqData);
						exit;  */
						if(count($allMashreqData) >0)
							{
								
									/*
									*count 80% target not achive
									*/
									$targetNotAchive80 = 0;
									$totalCards = 0;
									$totalCardsCS = 0;
									$totalCardsCSOnly = 0;
									$totalCardsCount = 0;
								
									
									$totalLoan = 0;
									$totalLoanCount = 0;
									
									$totalLoanCS = 0;
									$totalLoanCSOnly = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										$agentTarget80 = round(($AgentTarget/100)*80);
										$totalCardsCS = $totalCardsCS+$_tdata->cards_point_m;
										
										
										$totalLoanCS = $totalLoanCS+$_tdata->final_loan;
										
										if($_tdata->agent_product == 'CARDS')
										{
											$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan;
											$totalCards = $totalCards+$_tdata->cards_point_m;
											$totalCardsCount++;
											if($agentTarget80 > $_tdata->cards_point_m)
											{
												$targetNotAchive80++;
											}
										}
										else
										{
											$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->cards_point_m;
											$totalLoan = $totalLoan+$_tdata->final_loan;
											$totalLoanCount++;
											if($agentTarget80 > $_tdata->final_loan)
											{
												$targetNotAchive80++;
											}
										}
									}
									
									
									
									/*
									*count 80% target not achive
									*/
									
									/*
									*candidate count achived target
									*/
									$achivedCandidate = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										if($_tdata->agent_product == 'CARDS')
										{
											if($AgentTarget <= $_tdata->cards_point_m)
											{
												$achivedCandidate++;
											}
										}
										else
										{
											if($AgentTarget <= $_tdata->final_loan)
											{
												$achivedCandidate++;
											}
										}
									}
									/*
									*candidate count achived target
									*/
									
								/* 	$dataPie[0]['cName']= 'Total Agents Head Count';
									$dataPie[0]['total']= count($allMashreqData);
									$dataPie[0]['color']= $colorCode[0]; */
									$totalHeadCount = count($allMashreqData);
									/* $graphArray[$indexC]['Historical Total Agents'] = count($allMashreqData); */
									
									/* $graphArray[$indexC]['Agents in Cards'] = $totalCardsCount; */
									/* $graphArray[$indexC]['Historical Agents in Loan'] = $totalLoanCount; */
									/* if($totalCardsCount >0)
										{
											$graphArray[$indexC]['Core Team Productivity (Cards)'] = round($totalCards/$totalCardsCount,2);
										}
										else
										{
											$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
										} */
										if($totalLoanCount > 0)
										{
											$graphArray['Historical Core Team Productivity (Loan)'] = round($totalLoan/$totalLoanCount,2);
											
										}
										else
										{
											$graphArray['Historical Core Team Productivity (Loan)'] = 0;
										}
											
										/* if($totalCardsCount >0)
										{
											$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
												
										}
										else
										{
											$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
										} */
										if($totalLoanCount >0)
										{
											$graphArray['Historical Team Loan Productivity (Loan including XS)'] = round($totalLoanCS/$totalLoanCount,2);
												
										}
										else
										{
											$graphArray['Historical Team Loan Productivity (Loan including XS)'] = 0;
										}
										/* if($totalCardsCS >0)
										{
											$graphArray[$indexC]['XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
												
										}
										else
										{
											$graphArray[$indexC]['XS (Card)'] = '0%';
												
										} */
										if($totalLoanCS >0)
										{
												$graphArray['Historical XS (Loan)'] = round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
												
										}
										else
										{
												$graphArray['Historical XS (Loan)'] = '0%';
										}
									
									
									
									
									
								
									
									
									
									
									
							}
							else
							{
								/* $graphArray[$indexC]['Historical Total Agents'] = 0; */
								/* $graphArray[$indexC]['Historical Agents in Loan'] = 0; */
								
								$graphArray['Historical Core Team Productivity (Loan)'] = 0;
								
								$graphArray['Historical Team Loan Productivity (Loan including XS)'] = 0;
							
								$graphArray['Historical XS (Loan)'] = 0;
							}
						return $graphArray;
	}
	protected function getDataAsXS_LoanHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC)
	{
		
						
						
						$whereRaw = '';
						if($teamleaderwithout != "yes")
						{
							if($tl_name != 'No')
								{
									if($whereRaw == '')
									{
										$whereRaw = "tl_name = '".$tl_name."'";
									}
									else
									{
										$whereRaw .= " AND tl_name= '".$tl_name."'";
									}
								}
						}							
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->get();	
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::where("agent_target","!=",0)->whereraw($whereRaw)->get();
							
							
						}
						 /* echo "<pre>";
						echo count($allMashreqData);
						exit;  */
						if(count($allMashreqData) >0)
							{
								
									/*
									*count 80% target not achive
									*/
									$targetNotAchive80 = 0;
									$totalCards = 0;
									$totalCardsCS = 0;
									$totalCardsCSOnly = 0;
									$totalCardsCount = 0;
								
									
									$totalLoan = 0;
									$totalLoanCount = 0;
									
									$totalLoanCS = 0;
									$totalLoanCSOnly = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										$agentTarget80 = round(($AgentTarget/100)*80);
										$totalCardsCS = $totalCardsCS+$_tdata->cards_point_m;
										
										
										$totalLoanCS = $totalLoanCS+$_tdata->final_loan;
										
										if($_tdata->agent_product == 'CARDS')
										{
											$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan;
											$totalCards = $totalCards+$_tdata->cards_point_m;
											$totalCardsCount++;
											if($agentTarget80 > $_tdata->cards_point_m)
											{
												$targetNotAchive80++;
											}
										}
										else
										{
											$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->cards_point_m;
											$totalLoan = $totalLoan+$_tdata->final_loan;
											$totalLoanCount++;
											if($agentTarget80 > $_tdata->final_loan)
											{
												$targetNotAchive80++;
											}
										}
									}
									
									
									
									/*
									*count 80% target not achive
									*/
									
									/*
									*candidate count achived target
									*/
									$achivedCandidate = 0;
									foreach($allMashreqData as $_tdata)
									{
										$AgentTarget = $_tdata->agent_target;
										if($_tdata->agent_product == 'CARDS')
										{
											if($AgentTarget <= $_tdata->cards_point_m)
											{
												$achivedCandidate++;
											}
										}
										else
										{
											if($AgentTarget <= $_tdata->final_loan)
											{
												$achivedCandidate++;
											}
										}
									}
									/*
									*candidate count achived target
									*/
									
								/* 	$dataPie[0]['cName']= 'Total Agents Head Count';
									$dataPie[0]['total']= count($allMashreqData);
									$dataPie[0]['color']= $colorCode[0]; */
									$totalHeadCount = count($allMashreqData);
									/* $graphArray[$indexC]['Historical Total Agents'] = count($allMashreqData); */
									
									/* $graphArray[$indexC]['Agents in Cards'] = $totalCardsCount; */
									/* $graphArray[$indexC]['Historical Agents in Loan'] = $totalLoanCount; */
									/* if($totalCardsCount >0)
										{
											$graphArray[$indexC]['Core Team Productivity (Cards)'] = round($totalCards/$totalCardsCount,2);
										}
										else
										{
											$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
										} */
										if($totalLoanCount > 0)
										{
											$graphArray[$indexC]['Historical Core Team Productivity (Loan)'] = round($totalLoan/$totalLoanCount,2);
											
										}
										else
										{
											$graphArray[$indexC]['Historical Core Team Productivity (Loan)'] = 0;
										}
											
										/* if($totalCardsCount >0)
										{
											$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
												
										}
										else
										{
											$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
										} */
										if($totalLoanCount >0)
										{
											$graphArray[$indexC]['Historical Team Loan Productivity (Loan including XS)'] = round($totalLoanCS/$totalLoanCount,2);
												
										}
										else
										{
											$graphArray[$indexC]['Historical Team Loan Productivity (Loan including XS)'] = 0;
										}
										/* if($totalCardsCS >0)
										{
											$graphArray[$indexC]['XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
												
										}
										else
										{
											$graphArray[$indexC]['XS (Card)'] = '0%';
												
										} */
										if($totalLoanCS >0)
										{
												$graphArray[$indexC]['Historical XS (Loan)'] = round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
												
										}
										else
										{
												$graphArray[$indexC]['Historical XS (Loan)'] = '0%';
										}
									
									
									
									
									
								
									
									
									
									
									
							}
							else
							{
								/* $graphArray[$indexC]['Historical Total Agents'] = 0; */
								/* $graphArray[$indexC]['Historical Agents in Loan'] = 0; */
								
								$graphArray[$indexC]['Historical Core Team Productivity (Loan)'] = 0;
								
								$graphArray[$indexC]['Historical Team Loan Productivity (Loan including XS)'] = 0;
							
								$graphArray[$indexC]['Historical XS (Loan)'] = 0;
							}
						return $graphArray;
	}

public function filtersPoupOpt(Request $request)
{
	$indexID = $request->indexID;
			
			/*
			*vintage work`
			*/
			$vintageData = WorkTimeRange::get();
			/*
			*vintage work
			*/
			/**
			*check for update 
			*/
			$panelUpdateData = SalesDashboardValues::where("panel_id",$indexID)->where("user_id",$request->session()->get('EmployeeId'))->orderBy("id","DESC")->first();
			/* echo "<pre>";
			print_r($panelUpdateData);
			exit; */
			/**
			*check for update
			*/
			
			/*
			*sales reporting work
			*/
			if($panelUpdateData == '')
			{
			$TLDetails = AgentPayoutMashreq::groupBy('tl_name')
				->selectRaw('count(*) as total, tl_name')
				->get();
			}
			else
			{
				if($panelUpdateData->bank == "ENBD")
				{
					$TLDetails = AgentPayout::groupBy('tl_name')
				->selectRaw('count(*) as total, tl_name')
				->get();
				}
				else
				{
					$TLDetails = AgentPayoutMashreq::groupBy('tl_name')
				->selectRaw('count(*) as total, tl_name')
				->get();
				}
			}
			/*
			*sales reporting work
			*/
	return view("presentation/SalesReport/filtersPoupOpt",compact('indexID','TLDetails','vintageData','panelUpdateData'));
}	


protected function getDataAsPerTLENBD($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
{
	if($teamleaderwithout != "yes")
	{
					$indexC = 0;
					$graphArray = array();
					foreach($tl_name_array as $tl_name)
					{
						$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						$graphArray[$indexC]['TL Name'] = $tl_name;
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
									$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->get();
							
						
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
							$targetNotAchive80 = 0;
							$totalCards = 0;
							$totalCardsCS = 0;
							$totalCardsCSOnly = 0;
							$totalCardsCount = 0;
						
							
							$totalLoan = 0;
							$totalLoanCount = 0;
							
							$totalLoanCS = 0;
							$totalLoanCSOnly = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTarget80 = round(($AgentTarget/100)*80);
								$totalCardsCS = $totalCardsCS+$_tdata->tc_card;
								
								
								$totalLoanCS = $totalLoanCS+$_tdata->final_loan_amount;
								
								if($_tdata->agent_product == 'CARD')
								{
									$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan_amount;
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsCount++;
									if($agentTarget80 > $_tdata->tc_card)
									{
										$targetNotAchive80++;
									}
								}
								else
								{
									$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->tc_card;
									$totalLoan = $totalLoan+$_tdata->final_loan_amount;
									$totalLoanCount++;
									if($agentTarget80 > $_tdata->final_loan_amount)
									{
										$targetNotAchive80++;
									}
								}
							}
							/*
							*count 80% target not achive
							*/
							
							/*
							*candidate count achived target
							*/
							$achivedCandidate = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								if($_tdata->agent_product == 'CARDS')
								{
									if($AgentTarget <= $_tdata->tc_card)
									{
										$achivedCandidate++;
									}
								}
								else
								{
									if($AgentTarget <= $_tdata->final_loan_amount)
									{
										$achivedCandidate++;
									}
								}
							}
							/*
							*candidate count achived target
							*/
							 if(count($salesTimeArray) == 1)
								{
							$graphArray[$indexC]['Total Agents'] = count($allMashreqData);
								}
							$graphArray[$indexC]['Target Achived'] = $achivedCandidate;
							/* echo "Total Agents Head Count  ".count($allMashreqData);
							echo "<br />";
							echo "Agent Count who achived their Target  ".$achivedCandidate; */
							if(count($allMashreqData) >0)
							{
								$graphArray[$indexC]['Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
								/* echo "<br />";
								echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%"; */
							}
							else
							{
								$graphArray[$indexC]['Target Achived (%)'] = "0%";
								/* echo "<br />";
								echo "Agent Percentage who achived their Target  0%"; */
							}
							$graphArray[$indexC]['Target Achived Less 80%'] = $targetNotAchive80;
							/* echo "<br />";
							echo "Agents Achived less than 80% of Target   ".$targetNotAchive80; */
							/* if($qt != 'No')
							{
							
							$targetNotAchiveD = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTargetD = round(($AgentTarget/100)*$qt);
								if($_tdata->agent_product == 'CARD')
								{
									if($agentTargetD > $_tdata->tc_card)
									{
										$targetNotAchiveD++;
									}
								}
								else
								{
									if($agentTargetD > $_tdata->final_loan_amount)
									{
										$targetNotAchiveD++;
									}
								}
							}
							echo "<br />";
							echo "Agents Achived less than ".$qt."% of Target   ".$targetNotAchiveD;
							} */
							/* echo "<br />";
							echo "Total Agents in Card ".$totalCardsCount;
							echo "<br />";
							echo "Total Agents in loan ".$totalLoanCount;
							if($totalCardsCount >0)
							{
								echo "<br />";
								echo "Core Team Productivity (Cards) ".round($totalCards/$totalCardsCount,2);
							}
							else
							{
								echo "<br />";
								echo "Core Team Productivity (Cards) 0";
							}
							if($totalLoanCount >0)
							{
								echo "<br />";
								echo "Core Team Productivity (PLs) ".round($totalLoan/$totalLoanCount,2);
							}
							else
							{
								echo "<br />";
								echo "Core Team Productivity (PLs) 0";
							}
							if($totalCardsCount >0)
							{
								echo "<br />";
								echo "Team Cards Productivity (Cards including XS) ".round($totalCardsCS/$totalCardsCount,2);
							}
							else
							{
								echo "<br />";
								echo "Team Cards Productivity (Cards including XS) 0";

							}
							if($totalLoanCount >0)
							{
								echo "<br />";
								echo "Team Loan Productivity (Loan including XS) ".round($totalLoanCS/$totalLoanCount,2);
							}
							else
							{
								echo "<br />";
								echo "Team Loan Productivity (Loan including XS) 0";
							}
							if($totalCardsCS >0)
							{
								echo "<br />";
								echo "XS (Card)  ".round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
							}
							else
							{
								echo "<br />";
								echo "XS (Card)  0%";

							}
							if($totalLoanCS >0)
							{
							echo "<br />";
							echo "XS (Loan)   ".round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
							}
							else
							{
								echo "<br />";
							echo "XS (Loan)   0%";
							}
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "Total Cards with XS -".$totalCardsCS;
							echo "<br />";
							echo "Total Cards By Loan Agent -".$totalCardsCSOnly;
							echo "<br />";
							echo "Total Loan with XS -".$totalLoanCS;
							echo "<br />";
							echo "Total Loan By Card Agent -".$totalLoanCSOnly; */
							/*
							*count dynamic target not achive
							*/
							
								/* if($agentId != "No")
								{
										$agentDetails = AgentPayout::where("id",$agentId)->first();
										if($agentDetails != '')
										{
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
											echo "<br />";
											echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
											echo "<br />";
											echo "Agent Target   <b>".$agentDetails->agent_target.'</b>';
											echo "<br />";
											echo "Agent Product   <b>".$agentDetails->agent_product.'</b>';
											echo "<br />";
											
											if($agentDetails->agent_product == 'CARD')
											{
												echo "Agent CARD   <b>".$agentDetails->tc_card.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->tc_card/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
											else
											{
												echo "Agent Loan AED<b>".$agentDetails->final_loan_amount.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->final_loan_amount/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
										}
										else
										{
											echo "Agent not found";
										}
										
								} */
								/*
								*count dynamic target not achive
								*/
							}
							else
							{
									 if(count($salesTimeArray) == 1)
										{
									$graphArray[$indexC]['Total Agents'] = 0;
										}
									$graphArray[$indexC]['Target Achived'] = 0;
									$graphArray[$indexC]['Target Achived (%)'] = "0%";
									$graphArray[$indexC]['Target Achived Less 80%'] = 0;
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsPerTLENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							
							$indexC++;
					}
					$graphArrayM[$indexC] = $this->getDataAsPerTLENBDTotal($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
					/* echo "<pre>";
					print_r($graphArrayM);
					exit; */
					return $graphArrayM;
	}
	else
	{
		$indexC = 0;
		
		
		$graphArray = array();
		$tl_name = '';
		if(count($salesTimeArray) == 1 && $vintage_name_SI != 'No')
		{
		/*
		*show data as per Vintage
		*start code
		*/
		 $vintage_name_SIArray = explode(",", $vintage_name_SI);
		foreach($vintage_name_SIArray as $_vintage)
		{
						$graphArray[$indexC]['Sales Time'] =  $fromRange.'-'.$toRange;
						
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id = ".$_vintage;
							}
							else
							{
								$whereRaw .= " AND range_id = ".$_vintage;
							}
							$graphArray[$indexC]['Vintage'] = $_vintage;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
							$targetNotAchive80 = 0;
							$totalCards = 0;
							$totalCardsCS = 0;
							$totalCardsCSOnly = 0;
							$totalCardsCount = 0;
						
							
							$totalLoan = 0;
							$totalLoanCount = 0;
							
							$totalLoanCS = 0;
							$totalLoanCSOnly = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTarget80 = round(($AgentTarget/100)*80);
								$totalCardsCS = $totalCardsCS+$_tdata->tc_card;
								
								
								$totalLoanCS = $totalLoanCS+$_tdata->final_loan_amount;
								
								if($_tdata->agent_product == 'CARD')
								{
									$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan_amount;
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsCount++;
									if($agentTarget80 > $_tdata->tc_card)
									{
										$targetNotAchive80++;
									}
								}
								else
								{
									$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->tc_card;
									$totalLoan = $totalLoan+$_tdata->final_loan_amount;
									$totalLoanCount++;
									if($agentTarget80 > $_tdata->final_loan_amount)
									{
										$targetNotAchive80++;
									}
								}
							}
							/*
							*count 80% target not achive
							*/
							
							/*
							*candidate count achived target
							*/
							$achivedCandidate = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								if($_tdata->agent_product == 'CARDS')
								{
									if($AgentTarget <= $_tdata->tc_card)
									{
										$achivedCandidate++;
									}
								}
								else
								{
									if($AgentTarget <= $_tdata->final_loan_amount)
									{
										$achivedCandidate++;
									}
								}
							}
							/*
							*candidate count achived target
							*/
							 if(count($salesTimeArray) == 1)
								{
									$graphArray[$indexC]['Total Agents'] = count($allMashreqData);
								}
							$graphArray[$indexC]['Target Achived'] = $achivedCandidate;
							/* echo "Total Agents Head Count  ".count($allMashreqData);
							echo "<br />";
							echo "Agent Count who achived their Target  ".$achivedCandidate; */
							if(count($allMashreqData) >0)
							{
								$graphArray[$indexC]['Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
								/* echo "<br />";
								echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%"; */
							}
							else
							{
								$graphArray[$indexC]['Target Achived (%)'] = "0%";
								/* echo "<br />";
								echo "Agent Percentage who achived their Target  0%"; */
							}
							$graphArray[$indexC]['Target Achived Less 80%'] = $targetNotAchive80;
							/* echo "<br />";
							echo "Agents Achived less than 80% of Target   ".$targetNotAchive80; */
							/* if($qt != 'No')
							{
							
							$targetNotAchiveD = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTargetD = round(($AgentTarget/100)*$qt);
								if($_tdata->agent_product == 'CARD')
								{
									if($agentTargetD > $_tdata->tc_card)
									{
										$targetNotAchiveD++;
									}
								}
								else
								{
									if($agentTargetD > $_tdata->final_loan_amount)
									{
										$targetNotAchiveD++;
									}
								}
							}
							echo "<br />";
							echo "Agents Achived less than ".$qt."% of Target   ".$targetNotAchiveD;
							} */
							/* echo "<br />";
							echo "Total Agents in Card ".$totalCardsCount;
							echo "<br />";
							echo "Total Agents in loan ".$totalLoanCount;
							if($totalCardsCount >0)
							{
								echo "<br />";
								echo "Core Team Productivity (Cards) ".round($totalCards/$totalCardsCount,2);
							}
							else
							{
								echo "<br />";
								echo "Core Team Productivity (Cards) 0";
							}
							if($totalLoanCount >0)
							{
								echo "<br />";
								echo "Core Team Productivity (PLs) ".round($totalLoan/$totalLoanCount,2);
							}
							else
							{
								echo "<br />";
								echo "Core Team Productivity (PLs) 0";
							}
							if($totalCardsCount >0)
							{
								echo "<br />";
								echo "Team Cards Productivity (Cards including XS) ".round($totalCardsCS/$totalCardsCount,2);
							}
							else
							{
								echo "<br />";
								echo "Team Cards Productivity (Cards including XS) 0";

							}
							if($totalLoanCount >0)
							{
								echo "<br />";
								echo "Team Loan Productivity (Loan including XS) ".round($totalLoanCS/$totalLoanCount,2);
							}
							else
							{
								echo "<br />";
								echo "Team Loan Productivity (Loan including XS) 0";
							}
							if($totalCardsCS >0)
							{
								echo "<br />";
								echo "XS (Card)  ".round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
							}
							else
							{
								echo "<br />";
								echo "XS (Card)  0%";

							}
							if($totalLoanCS >0)
							{
							echo "<br />";
							echo "XS (Loan)   ".round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
							}
							else
							{
								echo "<br />";
							echo "XS (Loan)   0%";
							}
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "Total Cards with XS -".$totalCardsCS;
							echo "<br />";
							echo "Total Cards By Loan Agent -".$totalCardsCSOnly;
							echo "<br />";
							echo "Total Loan with XS -".$totalLoanCS;
							echo "<br />";
							echo "Total Loan By Card Agent -".$totalLoanCSOnly; */
							/*
							*count dynamic target not achive
							*/
							
								/* if($agentId != "No")
								{
										$agentDetails = AgentPayout::where("id",$agentId)->first();
										if($agentDetails != '')
										{
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
											echo "<br />";
											echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
											echo "<br />";
											echo "Agent Target   <b>".$agentDetails->agent_target.'</b>';
											echo "<br />";
											echo "Agent Product   <b>".$agentDetails->agent_product.'</b>';
											echo "<br />";
											
											if($agentDetails->agent_product == 'CARD')
											{
												echo "Agent CARD   <b>".$agentDetails->tc_card.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->tc_card/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
											else
											{
												echo "Agent Loan AED<b>".$agentDetails->final_loan_amount.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->final_loan_amount/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
										}
										else
										{
											echo "Agent not found";
										}
										
								} */
								/*
								*count dynamic target not achive
								*/
							}
							else
							{
								 if(count($salesTimeArray) == 1)
									{
										$graphArray[$indexC]['Total Agents'] = 0;
									}
									$graphArray[$indexC]['Target Achived'] = 0;
									$graphArray[$indexC]['Target Achived (%)'] = "0%";
									$graphArray[$indexC]['Target Achived Less 80%'] = 0;
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsPerTLENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
		/*
		*show data as per Vintage
		*end code
		*/
		}
		}
		else
		{
		
		/*
		*show data as per sales time
		*start code
		*/
		foreach($salesTimeArray as $_salesT)
		{
			$graphArray[$indexC]['Sales Time'] = $_salesT;
						
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->where("sales_time",$_salesT)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->where("sales_time",$_salesT)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
							$targetNotAchive80 = 0;
							$totalCards = 0;
							$totalCardsCS = 0;
							$totalCardsCSOnly = 0;
							$totalCardsCount = 0;
						
							
							$totalLoan = 0;
							$totalLoanCount = 0;
							
							$totalLoanCS = 0;
							$totalLoanCSOnly = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTarget80 = round(($AgentTarget/100)*80);
								$totalCardsCS = $totalCardsCS+$_tdata->tc_card;
								
								
								$totalLoanCS = $totalLoanCS+$_tdata->final_loan_amount;
								
								if($_tdata->agent_product == 'CARD')
								{
									$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan_amount;
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsCount++;
									if($agentTarget80 > $_tdata->tc_card)
									{
										$targetNotAchive80++;
									}
								}
								else
								{
									$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->tc_card;
									$totalLoan = $totalLoan+$_tdata->final_loan_amount;
									$totalLoanCount++;
									if($agentTarget80 > $_tdata->final_loan_amount)
									{
										$targetNotAchive80++;
									}
								}
							}
							/*
							*count 80% target not achive
							*/
							
							/*
							*candidate count achived target
							*/
							$achivedCandidate = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								if($_tdata->agent_product == 'CARDS')
								{
									if($AgentTarget <= $_tdata->tc_card)
									{
										$achivedCandidate++;
									}
								}
								else
								{
									if($AgentTarget <= $_tdata->final_loan_amount)
									{
										$achivedCandidate++;
									}
								}
							}
							/*
							*candidate count achived target
							*/
							 if(count($salesTimeArray) == 1)
								{
									$graphArray[$indexC]['Total Agents'] = count($allMashreqData);
								}
							$graphArray[$indexC]['Target Achived'] = $achivedCandidate;
							/* echo "Total Agents Head Count  ".count($allMashreqData);
							echo "<br />";
							echo "Agent Count who achived their Target  ".$achivedCandidate; */
							if(count($allMashreqData) >0)
							{
								$graphArray[$indexC]['Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
								/* echo "<br />";
								echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%"; */
							}
							else
							{
								$graphArray[$indexC]['Target Achived (%)'] = "0%";
								/* echo "<br />";
								echo "Agent Percentage who achived their Target  0%"; */
							}
							$graphArray[$indexC]['Target Achived Less 80%'] = $targetNotAchive80;
							/* echo "<br />";
							echo "Agents Achived less than 80% of Target   ".$targetNotAchive80; */
							/* if($qt != 'No')
							{
							
							$targetNotAchiveD = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTargetD = round(($AgentTarget/100)*$qt);
								if($_tdata->agent_product == 'CARD')
								{
									if($agentTargetD > $_tdata->tc_card)
									{
										$targetNotAchiveD++;
									}
								}
								else
								{
									if($agentTargetD > $_tdata->final_loan_amount)
									{
										$targetNotAchiveD++;
									}
								}
							}
							echo "<br />";
							echo "Agents Achived less than ".$qt."% of Target   ".$targetNotAchiveD;
							} */
							/* echo "<br />";
							echo "Total Agents in Card ".$totalCardsCount;
							echo "<br />";
							echo "Total Agents in loan ".$totalLoanCount;
							if($totalCardsCount >0)
							{
								echo "<br />";
								echo "Core Team Productivity (Cards) ".round($totalCards/$totalCardsCount,2);
							}
							else
							{
								echo "<br />";
								echo "Core Team Productivity (Cards) 0";
							}
							if($totalLoanCount >0)
							{
								echo "<br />";
								echo "Core Team Productivity (PLs) ".round($totalLoan/$totalLoanCount,2);
							}
							else
							{
								echo "<br />";
								echo "Core Team Productivity (PLs) 0";
							}
							if($totalCardsCount >0)
							{
								echo "<br />";
								echo "Team Cards Productivity (Cards including XS) ".round($totalCardsCS/$totalCardsCount,2);
							}
							else
							{
								echo "<br />";
								echo "Team Cards Productivity (Cards including XS) 0";

							}
							if($totalLoanCount >0)
							{
								echo "<br />";
								echo "Team Loan Productivity (Loan including XS) ".round($totalLoanCS/$totalLoanCount,2);
							}
							else
							{
								echo "<br />";
								echo "Team Loan Productivity (Loan including XS) 0";
							}
							if($totalCardsCS >0)
							{
								echo "<br />";
								echo "XS (Card)  ".round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
							}
							else
							{
								echo "<br />";
								echo "XS (Card)  0%";

							}
							if($totalLoanCS >0)
							{
							echo "<br />";
							echo "XS (Loan)   ".round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
							}
							else
							{
								echo "<br />";
							echo "XS (Loan)   0%";
							}
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "Total Cards with XS -".$totalCardsCS;
							echo "<br />";
							echo "Total Cards By Loan Agent -".$totalCardsCSOnly;
							echo "<br />";
							echo "Total Loan with XS -".$totalLoanCS;
							echo "<br />";
							echo "Total Loan By Card Agent -".$totalLoanCSOnly; */
							/*
							*count dynamic target not achive
							*/
							
								/* if($agentId != "No")
								{
										$agentDetails = AgentPayout::where("id",$agentId)->first();
										if($agentDetails != '')
										{
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
											echo "<br />";
											echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
											echo "<br />";
											echo "Agent Target   <b>".$agentDetails->agent_target.'</b>';
											echo "<br />";
											echo "Agent Product   <b>".$agentDetails->agent_product.'</b>';
											echo "<br />";
											
											if($agentDetails->agent_product == 'CARD')
											{
												echo "Agent CARD   <b>".$agentDetails->tc_card.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->tc_card/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
											else
											{
												echo "Agent Loan AED<b>".$agentDetails->final_loan_amount.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->final_loan_amount/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
										}
										else
										{
											echo "Agent not found";
										}
										
								} */
								/*
								*count dynamic target not achive
								*/
							}
							else
							{
								 if(count($salesTimeArray) == 1)
									{
										$graphArray[$indexC]['Total Agents'] = 0;
									}
									$graphArray[$indexC]['Target Achived'] = 0;
									$graphArray[$indexC]['Target Achived (%)'] = "0%";
									$graphArray[$indexC]['Target Achived Less 80%'] = 0;
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsPerTLENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
		/*
		*show data as per sales time
		*end code
		*/
		}
		}
		
		
		
					
					
						$graphArray[$indexC]['Sales Time'] = "Total";
						
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
							$targetNotAchive80 = 0;
							$totalCards = 0;
							$totalCardsCS = 0;
							$totalCardsCSOnly = 0;
							$totalCardsCount = 0;
						
							
							$totalLoan = 0;
							$totalLoanCount = 0;
							
							$totalLoanCS = 0;
							$totalLoanCSOnly = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTarget80 = round(($AgentTarget/100)*80);
								$totalCardsCS = $totalCardsCS+$_tdata->tc_card;
								
								
								$totalLoanCS = $totalLoanCS+$_tdata->final_loan_amount;
								
								if($_tdata->agent_product == 'CARD')
								{
									$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan_amount;
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsCount++;
									if($agentTarget80 > $_tdata->tc_card)
									{
										$targetNotAchive80++;
									}
								}
								else
								{
									$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->tc_card;
									$totalLoan = $totalLoan+$_tdata->final_loan_amount;
									$totalLoanCount++;
									if($agentTarget80 > $_tdata->final_loan_amount)
									{
										$targetNotAchive80++;
									}
								}
							}
							/*
							*count 80% target not achive
							*/
							
							/*
							*candidate count achived target
							*/
							$achivedCandidate = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								if($_tdata->agent_product == 'CARDS')
								{
									if($AgentTarget <= $_tdata->tc_card)
									{
										$achivedCandidate++;
									}
								}
								else
								{
									if($AgentTarget <= $_tdata->final_loan_amount)
									{
										$achivedCandidate++;
									}
								}
							}
							/*
							*candidate count achived target
							*/
							 if(count($salesTimeArray) == 1)
								{
									$graphArray[$indexC]['Total Agents'] = count($allMashreqData);
								}
							$graphArray[$indexC]['Target Achived'] = $achivedCandidate;
							/* echo "Total Agents Head Count  ".count($allMashreqData);
							echo "<br />";
							echo "Agent Count who achived their Target  ".$achivedCandidate; */
							if(count($allMashreqData) >0)
							{
								$graphArray[$indexC]['Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
								/* echo "<br />";
								echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%"; */
							}
							else
							{
								$graphArray[$indexC]['Target Achived (%)'] = "0%";
								/* echo "<br />";
								echo "Agent Percentage who achived their Target  0%"; */
							}
							$graphArray[$indexC]['Target Achived Less 80%'] = $targetNotAchive80;
							/* echo "<br />";
							echo "Agents Achived less than 80% of Target   ".$targetNotAchive80; */
							/* if($qt != 'No')
							{
							
							$targetNotAchiveD = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTargetD = round(($AgentTarget/100)*$qt);
								if($_tdata->agent_product == 'CARD')
								{
									if($agentTargetD > $_tdata->tc_card)
									{
										$targetNotAchiveD++;
									}
								}
								else
								{
									if($agentTargetD > $_tdata->final_loan_amount)
									{
										$targetNotAchiveD++;
									}
								}
							}
							echo "<br />";
							echo "Agents Achived less than ".$qt."% of Target   ".$targetNotAchiveD;
							} */
							/* echo "<br />";
							echo "Total Agents in Card ".$totalCardsCount;
							echo "<br />";
							echo "Total Agents in loan ".$totalLoanCount;
							if($totalCardsCount >0)
							{
								echo "<br />";
								echo "Core Team Productivity (Cards) ".round($totalCards/$totalCardsCount,2);
							}
							else
							{
								echo "<br />";
								echo "Core Team Productivity (Cards) 0";
							}
							if($totalLoanCount >0)
							{
								echo "<br />";
								echo "Core Team Productivity (PLs) ".round($totalLoan/$totalLoanCount,2);
							}
							else
							{
								echo "<br />";
								echo "Core Team Productivity (PLs) 0";
							}
							if($totalCardsCount >0)
							{
								echo "<br />";
								echo "Team Cards Productivity (Cards including XS) ".round($totalCardsCS/$totalCardsCount,2);
							}
							else
							{
								echo "<br />";
								echo "Team Cards Productivity (Cards including XS) 0";

							}
							if($totalLoanCount >0)
							{
								echo "<br />";
								echo "Team Loan Productivity (Loan including XS) ".round($totalLoanCS/$totalLoanCount,2);
							}
							else
							{
								echo "<br />";
								echo "Team Loan Productivity (Loan including XS) 0";
							}
							if($totalCardsCS >0)
							{
								echo "<br />";
								echo "XS (Card)  ".round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
							}
							else
							{
								echo "<br />";
								echo "XS (Card)  0%";

							}
							if($totalLoanCS >0)
							{
							echo "<br />";
							echo "XS (Loan)   ".round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
							}
							else
							{
								echo "<br />";
							echo "XS (Loan)   0%";
							}
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "Total Cards with XS -".$totalCardsCS;
							echo "<br />";
							echo "Total Cards By Loan Agent -".$totalCardsCSOnly;
							echo "<br />";
							echo "Total Loan with XS -".$totalLoanCS;
							echo "<br />";
							echo "Total Loan By Card Agent -".$totalLoanCSOnly; */
							/*
							*count dynamic target not achive
							*/
							
								/* if($agentId != "No")
								{
										$agentDetails = AgentPayout::where("id",$agentId)->first();
										if($agentDetails != '')
										{
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
											echo "<br />";
											echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
											echo "<br />";
											echo "Agent Target   <b>".$agentDetails->agent_target.'</b>';
											echo "<br />";
											echo "Agent Product   <b>".$agentDetails->agent_product.'</b>';
											echo "<br />";
											
											if($agentDetails->agent_product == 'CARD')
											{
												echo "Agent CARD   <b>".$agentDetails->tc_card.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->tc_card/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
											else
											{
												echo "Agent Loan AED<b>".$agentDetails->final_loan_amount.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->final_loan_amount/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
										}
										else
										{
											echo "Agent not found";
										}
										
								} */
								/*
								*count dynamic target not achive
								*/
							}
							else
							{
								 if(count($salesTimeArray) == 1)
									{
										$graphArray[$indexC]['Total Agents'] = 0;
									}
									$graphArray[$indexC]['Target Achived'] = 0;
									$graphArray[$indexC]['Target Achived (%)'] = "0%";
									$graphArray[$indexC]['Target Achived Less 80%'] = 0;
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsPerTLENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							/* echo "<pre>";
					print_r($graphArrayM);
					exit; */
					return $graphArrayM;
	}
}

protected function getDataAsPerTLENBDTotal($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
{
	$graphArray = array();
					
						$graphArray['Sales Time'] = "Total";
						$graphArray['TL Name'] = "";
						$graphArray['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
									$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereIn("tl_name",$tl_name_array)->get();
							
						
						}
						else
						{
							
								    $allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereIn("tl_name",$tl_name_array)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
							$targetNotAchive80 = 0;
							$totalCards = 0;
							$totalCardsCS = 0;
							$totalCardsCSOnly = 0;
							$totalCardsCount = 0;
						
							
							$totalLoan = 0;
							$totalLoanCount = 0;
							
							$totalLoanCS = 0;
							$totalLoanCSOnly = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTarget80 = round(($AgentTarget/100)*80);
								$totalCardsCS = $totalCardsCS+$_tdata->tc_card;
								
								
								$totalLoanCS = $totalLoanCS+$_tdata->final_loan_amount;
								
								if($_tdata->agent_product == 'CARD')
								{
									$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan_amount;
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsCount++;
									if($agentTarget80 > $_tdata->tc_card)
									{
										$targetNotAchive80++;
									}
								}
								else
								{
									$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->tc_card;
									$totalLoan = $totalLoan+$_tdata->final_loan_amount;
									$totalLoanCount++;
									if($agentTarget80 > $_tdata->final_loan_amount)
									{
										$targetNotAchive80++;
									}
								}
							}
							/*
							*count 80% target not achive
							*/
							
							/*
							*candidate count achived target
							*/
							$achivedCandidate = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								if($_tdata->agent_product == 'CARDS')
								{
									if($AgentTarget <= $_tdata->tc_card)
									{
										$achivedCandidate++;
									}
								}
								else
								{
									if($AgentTarget <= $_tdata->final_loan_amount)
									{
										$achivedCandidate++;
									}
								}
							}
							/*
							*candidate count achived target
							*/
							 if(count($salesTimeArray) == 1)
								{
							$graphArray['Total Agents'] = count($allMashreqData);
								}
							$graphArray['Target Achived'] = $achivedCandidate;
							/* echo "Total Agents Head Count  ".count($allMashreqData);
							echo "<br />";
							echo "Agent Count who achived their Target  ".$achivedCandidate; */
							if(count($allMashreqData) >0)
							{
								$graphArray['Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
								/* echo "<br />";
								echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%"; */
							}
							else
							{
								$graphArray['Target Achived (%)'] = "0%";
								/* echo "<br />";
								echo "Agent Percentage who achived their Target  0%"; */
							}
							$graphArray['Target Achived Less 80%'] = $targetNotAchive80;
							/* echo "<br />";
							echo "Agents Achived less than 80% of Target   ".$targetNotAchive80; */
							/* if($qt != 'No')
							{
							
							$targetNotAchiveD = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTargetD = round(($AgentTarget/100)*$qt);
								if($_tdata->agent_product == 'CARD')
								{
									if($agentTargetD > $_tdata->tc_card)
									{
										$targetNotAchiveD++;
									}
								}
								else
								{
									if($agentTargetD > $_tdata->final_loan_amount)
									{
										$targetNotAchiveD++;
									}
								}
							}
							echo "<br />";
							echo "Agents Achived less than ".$qt."% of Target   ".$targetNotAchiveD;
							} */
							/* echo "<br />";
							echo "Total Agents in Card ".$totalCardsCount;
							echo "<br />";
							echo "Total Agents in loan ".$totalLoanCount;
							if($totalCardsCount >0)
							{
								echo "<br />";
								echo "Core Team Productivity (Cards) ".round($totalCards/$totalCardsCount,2);
							}
							else
							{
								echo "<br />";
								echo "Core Team Productivity (Cards) 0";
							}
							if($totalLoanCount >0)
							{
								echo "<br />";
								echo "Core Team Productivity (PLs) ".round($totalLoan/$totalLoanCount,2);
							}
							else
							{
								echo "<br />";
								echo "Core Team Productivity (PLs) 0";
							}
							if($totalCardsCount >0)
							{
								echo "<br />";
								echo "Team Cards Productivity (Cards including XS) ".round($totalCardsCS/$totalCardsCount,2);
							}
							else
							{
								echo "<br />";
								echo "Team Cards Productivity (Cards including XS) 0";

							}
							if($totalLoanCount >0)
							{
								echo "<br />";
								echo "Team Loan Productivity (Loan including XS) ".round($totalLoanCS/$totalLoanCount,2);
							}
							else
							{
								echo "<br />";
								echo "Team Loan Productivity (Loan including XS) 0";
							}
							if($totalCardsCS >0)
							{
								echo "<br />";
								echo "XS (Card)  ".round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
							}
							else
							{
								echo "<br />";
								echo "XS (Card)  0%";

							}
							if($totalLoanCS >0)
							{
							echo "<br />";
							echo "XS (Loan)   ".round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
							}
							else
							{
								echo "<br />";
							echo "XS (Loan)   0%";
							}
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "Total Cards with XS -".$totalCardsCS;
							echo "<br />";
							echo "Total Cards By Loan Agent -".$totalCardsCSOnly;
							echo "<br />";
							echo "Total Loan with XS -".$totalLoanCS;
							echo "<br />";
							echo "Total Loan By Card Agent -".$totalLoanCSOnly; */
							/*
							*count dynamic target not achive
							*/
							
								/* if($agentId != "No")
								{
										$agentDetails = AgentPayout::where("id",$agentId)->first();
										if($agentDetails != '')
										{
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
											echo "<br />";
											echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
											echo "<br />";
											echo "Agent Target   <b>".$agentDetails->agent_target.'</b>';
											echo "<br />";
											echo "Agent Product   <b>".$agentDetails->agent_product.'</b>';
											echo "<br />";
											
											if($agentDetails->agent_product == 'CARD')
											{
												echo "Agent CARD   <b>".$agentDetails->tc_card.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->tc_card/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
											else
											{
												echo "Agent Loan AED<b>".$agentDetails->final_loan_amount.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->final_loan_amount/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
										}
										else
										{
											echo "Agent not found";
										}
										
								} */
								/*
								*count dynamic target not achive
								*/
							}
							else
							{
									 if(count($salesTimeArray) == 1)
										{
									$graphArray['Total Agents'] = 0;
										}
									$graphArray['Target Achived'] = 0;
									$graphArray['Target Achived (%)'] = "0%";
									$graphArray['Target Achived Less 80%'] = 0;
							}
							if($historical_data == "yes")
							{
								 $graphArrayT = $this->getDataAsPerTLENBDHistroyTotal($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout);
								 $graphArrayTD = array_merge($graphArray,$graphArrayT); 
							}
							else
							{
								$graphArrayTD  = $graphArray;
							}
							return $graphArrayTD;
							
					
}
protected function getDataAsPerTLENBDHistroyTotal($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout)
{
	
		
					
						
						$whereRaw = '';
						/* if($teamleaderwithout != "yes")
						{
							if($tl_name != 'No')
							{
								if($whereRaw == '')
								{
									$whereRaw = "tl_name = '".$tl_name."'";
								}
								else
								{
									$whereRaw .= " AND tl_name= '".$tl_name."'";
								}
							} 
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereraw($whereRaw)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
							$targetNotAchive80 = 0;
							$totalCards = 0;
							$totalCardsCS = 0;
							$totalCardsCSOnly = 0;
							$totalCardsCount = 0;
						
							
							$totalLoan = 0;
							$totalLoanCount = 0;
							
							$totalLoanCS = 0;
							$totalLoanCSOnly = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTarget80 = round(($AgentTarget/100)*80);
								$totalCardsCS = $totalCardsCS+$_tdata->tc_card;
								
								
								$totalLoanCS = $totalLoanCS+$_tdata->final_loan_amount;
								
								if($_tdata->agent_product == 'CARD')
								{
									$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan_amount;
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsCount++;
									if($agentTarget80 > $_tdata->tc_card)
									{
										$targetNotAchive80++;
									}
								}
								else
								{
									$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->tc_card;
									$totalLoan = $totalLoan+$_tdata->final_loan_amount;
									$totalLoanCount++;
									if($agentTarget80 > $_tdata->final_loan_amount)
									{
										$targetNotAchive80++;
									}
								}
							}
							/*
							*count 80% target not achive
							*/
							
							/*
							*candidate count achived target
							*/
							$achivedCandidate = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								if($_tdata->agent_product == 'CARDS')
								{
									if($AgentTarget <= $_tdata->tc_card)
									{
										$achivedCandidate++;
									}
								}
								else
								{
									if($AgentTarget <= $_tdata->final_loan_amount)
									{
										$achivedCandidate++;
									}
								}
							}
							/*
							*candidate count achived target
							*/
							
							/* $graphArray[$indexC]['Historical Total Agents'] = count($allMashreqData); */
							$graphArray['Historical Target Achived'] = $achivedCandidate;
							/* echo "Total Agents Head Count  ".count($allMashreqData);
							echo "<br />";
							echo "Agent Count who achived their Target  ".$achivedCandidate; */
							if(count($allMashreqData) >0)
							{
								$graphArray['Historical Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
								/* echo "<br />";
								echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%"; */
							}
							else
							{
								$graphArray['Historical Target Achived (%)'] = "0%";
								/* echo "<br />";
								echo "Agent Percentage who achived their Target  0%"; */
							}
							$graphArray['Historical Target Achived Less 80%'] = $targetNotAchive80;
							
							/*
							*count dynamic target not achive
							*/
							
								
								/*
								*count dynamic target not achive
								*/
							}
							else
							{
									/* $graphArray[$indexC]['Historical Total Agents'] = 0; */
									$graphArray['Historical Target Achived'] = 0;
									$graphArray['Historical Target Achived (%)'] = "0%";
									$graphArray['Historical Target Achived Less 80%'] = 0;
							}
							
				return $graphArray;
}
protected function getDataAsPerTLENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC)
{
	
		
					
						
						$whereRaw = '';
						if($teamleaderwithout != "yes")
						{
							if($tl_name != 'No')
							{
								if($whereRaw == '')
								{
									$whereRaw = "tl_name = '".$tl_name."'";
								}
								else
								{
									$whereRaw .= " AND tl_name= '".$tl_name."'";
								}
							} 
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
							$targetNotAchive80 = 0;
							$totalCards = 0;
							$totalCardsCS = 0;
							$totalCardsCSOnly = 0;
							$totalCardsCount = 0;
						
							
							$totalLoan = 0;
							$totalLoanCount = 0;
							
							$totalLoanCS = 0;
							$totalLoanCSOnly = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTarget80 = round(($AgentTarget/100)*80);
								$totalCardsCS = $totalCardsCS+$_tdata->tc_card;
								
								
								$totalLoanCS = $totalLoanCS+$_tdata->final_loan_amount;
								
								if($_tdata->agent_product == 'CARD')
								{
									$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan_amount;
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsCount++;
									if($agentTarget80 > $_tdata->tc_card)
									{
										$targetNotAchive80++;
									}
								}
								else
								{
									$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->tc_card;
									$totalLoan = $totalLoan+$_tdata->final_loan_amount;
									$totalLoanCount++;
									if($agentTarget80 > $_tdata->final_loan_amount)
									{
										$targetNotAchive80++;
									}
								}
							}
							/*
							*count 80% target not achive
							*/
							
							/*
							*candidate count achived target
							*/
							$achivedCandidate = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								if($_tdata->agent_product == 'CARDS')
								{
									if($AgentTarget <= $_tdata->tc_card)
									{
										$achivedCandidate++;
									}
								}
								else
								{
									if($AgentTarget <= $_tdata->final_loan_amount)
									{
										$achivedCandidate++;
									}
								}
							}
							/*
							*candidate count achived target
							*/
							
							/* $graphArray[$indexC]['Historical Total Agents'] = count($allMashreqData); */
							$graphArray[$indexC]['Historical Target Achived'] = $achivedCandidate;
							/* echo "Total Agents Head Count  ".count($allMashreqData);
							echo "<br />";
							echo "Agent Count who achived their Target  ".$achivedCandidate; */
							if(count($allMashreqData) >0)
							{
								$graphArray[$indexC]['Historical Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
								/* echo "<br />";
								echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%"; */
							}
							else
							{
								$graphArray[$indexC]['Historical Target Achived (%)'] = "0%";
								/* echo "<br />";
								echo "Agent Percentage who achived their Target  0%"; */
							}
							$graphArray[$indexC]['Historical Target Achived Less 80%'] = $targetNotAchive80;
							/* echo "<br />";
							echo "Agents Achived less than 80% of Target   ".$targetNotAchive80; */
							/* if($qt != 'No')
							{
							
							$targetNotAchiveD = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTargetD = round(($AgentTarget/100)*$qt);
								if($_tdata->agent_product == 'CARD')
								{
									if($agentTargetD > $_tdata->tc_card)
									{
										$targetNotAchiveD++;
									}
								}
								else
								{
									if($agentTargetD > $_tdata->final_loan_amount)
									{
										$targetNotAchiveD++;
									}
								}
							}
							echo "<br />";
							echo "Agents Achived less than ".$qt."% of Target   ".$targetNotAchiveD;
							} */
							/* echo "<br />";
							echo "Total Agents in Card ".$totalCardsCount;
							echo "<br />";
							echo "Total Agents in loan ".$totalLoanCount;
							if($totalCardsCount >0)
							{
								echo "<br />";
								echo "Core Team Productivity (Cards) ".round($totalCards/$totalCardsCount,2);
							}
							else
							{
								echo "<br />";
								echo "Core Team Productivity (Cards) 0";
							}
							if($totalLoanCount >0)
							{
								echo "<br />";
								echo "Core Team Productivity (PLs) ".round($totalLoan/$totalLoanCount,2);
							}
							else
							{
								echo "<br />";
								echo "Core Team Productivity (PLs) 0";
							}
							if($totalCardsCount >0)
							{
								echo "<br />";
								echo "Team Cards Productivity (Cards including XS) ".round($totalCardsCS/$totalCardsCount,2);
							}
							else
							{
								echo "<br />";
								echo "Team Cards Productivity (Cards including XS) 0";

							}
							if($totalLoanCount >0)
							{
								echo "<br />";
								echo "Team Loan Productivity (Loan including XS) ".round($totalLoanCS/$totalLoanCount,2);
							}
							else
							{
								echo "<br />";
								echo "Team Loan Productivity (Loan including XS) 0";
							}
							if($totalCardsCS >0)
							{
								echo "<br />";
								echo "XS (Card)  ".round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
							}
							else
							{
								echo "<br />";
								echo "XS (Card)  0%";

							}
							if($totalLoanCS >0)
							{
							echo "<br />";
							echo "XS (Loan)   ".round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
							}
							else
							{
								echo "<br />";
							echo "XS (Loan)   0%";
							}
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "Total Cards with XS -".$totalCardsCS;
							echo "<br />";
							echo "Total Cards By Loan Agent -".$totalCardsCSOnly;
							echo "<br />";
							echo "Total Loan with XS -".$totalLoanCS;
							echo "<br />";
							echo "Total Loan By Card Agent -".$totalLoanCSOnly; */
							/*
							*count dynamic target not achive
							*/
							
								/* if($agentId != "No")
								{
										$agentDetails = AgentPayout::where("id",$agentId)->first();
										if($agentDetails != '')
										{
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
											echo "<br />";
											echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
											echo "<br />";
											echo "Agent Target   <b>".$agentDetails->agent_target.'</b>';
											echo "<br />";
											echo "Agent Product   <b>".$agentDetails->agent_product.'</b>';
											echo "<br />";
											
											if($agentDetails->agent_product == 'CARD')
											{
												echo "Agent CARD   <b>".$agentDetails->tc_card.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->tc_card/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
											else
											{
												echo "Agent Loan AED<b>".$agentDetails->final_loan_amount.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->final_loan_amount/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
										}
										else
										{
											echo "Agent not found";
										}
										
								} */
								/*
								*count dynamic target not achive
								*/
							}
							else
							{
									/* $graphArray[$indexC]['Historical Total Agents'] = 0; */
									$graphArray[$indexC]['Historical Target Achived'] = 0;
									$graphArray[$indexC]['Historical Target Achived (%)'] = "0%";
									$graphArray[$indexC]['Historical Target Achived Less 80%'] = 0;
							}
							
				return $graphArray;
}
public function updateTLSalesTime(Request $request)
{
	$bankName = $request->bankName;
	$fromDate = $request->fromDate;
	$toDate = $request->toDate;
	
	$from_dateSI = $fromDate."-10";
			$to_dateSI = $toDate."-10";
			
			
			
			
			
			 $salesMonthFrom =  date("m",strtotime($from_dateSI));
		
			 $salesYearFrom =  date("Y",strtotime($from_dateSI));
		
			 $salesMonthTo = date("m",strtotime($to_dateSI));
			
			 $salesYearTo =  date("Y",strtotime($to_dateSI));
			 
			 
			 /*start code*/
						$salesTimeArray = array();
						$year = $salesYearFrom;
						$conditions = $salesMonthTo;
						if($salesYearFrom < $salesYearTo)
						{
							if($salesMonthFrom != 12)
							{
								$interval = 12-$salesMonthFrom;
								$conditions = $salesMonthFrom+$salesMonthTo+$interval;
							}
							else
							{
							$conditions = $salesMonthFrom+$salesMonthTo;
							}
						}
						//echo $conditions;exit;
						$m = $salesMonthFrom;
						for($i=$salesMonthFrom;$i<=$conditions;$i++)
						{
							
							if($m  > 12)
							{
								$m  = 1;
								$year = $year+1;
							}
							$salesTimeArray[] = ltrim($m, "0")."-".$year;
							$m++;
						}
						/*
						*code for mashreq bank
						*/
						
						
						
	$opthtml = '';
	if($bankName == 'Mashreq')
	{
		$TLDetails = AgentPayoutMashreq::groupBy('tl_name')
				->selectRaw('count(*) as total, tl_name')->whereIn("end_sales_time",$salesTimeArray)
				->get();
		foreach($TLDetails as $tlData)
		{
			if($opthtml == '')
			{
				$opthtml = '<option value="'.$tlData->tl_name.'">'.$tlData->tl_name.'</option>';
			}	
			else
			{
				$opthtml .= '<option value="'.$tlData->tl_name.'">'.$tlData->tl_name.'</option>';
			}
		}		
	}
	else
	{
		$TLDetails = AgentPayout::groupBy('tl_name')
				->selectRaw('count(*) as total, tl_name')->whereIn("sales_time",$salesTimeArray)
				->get();
		foreach($TLDetails as $tlData)
		{
			if($opthtml == '')
			{
				$opthtml = '<option value="'.$tlData->tl_name.'">'.$tlData->tl_name.'</option>';
			}	
			else
			{
				$opthtml .= '<option value="'.$tlData->tl_name.'">'.$tlData->tl_name.'</option>';
			}
		}	
	}
	
	echo $opthtml;
	exit;
	
}
public function getTLByBank(Request $request)
{
	$bankName = $request->bankName;
	$fromDate = $request->fromDate;
	$toDate = $request->toDate;
	
	$from_dateSI = $fromDate."-10";
			$to_dateSI = $toDate."-10";
			
			
			
			
			
			 $salesMonthFrom =  date("m",strtotime($from_dateSI));
		
			 $salesYearFrom =  date("Y",strtotime($from_dateSI));
		
			 $salesMonthTo = date("m",strtotime($to_dateSI));
			
			 $salesYearTo =  date("Y",strtotime($to_dateSI));
			 
			 
			 /*start code*/
						$salesTimeArray = array();
						$year = $salesYearFrom;
						$conditions = $salesMonthTo;
						if($salesYearFrom < $salesYearTo)
						{
							if($salesMonthFrom != 12)
							{
								$interval = 12-$salesMonthFrom;
								$conditions = $salesMonthFrom+$salesMonthTo+$interval;
							}
							else
							{
							$conditions = $salesMonthFrom+$salesMonthTo;
							}
						}
						//echo $conditions;exit;
						$m = $salesMonthFrom;
						for($i=$salesMonthFrom;$i<=$conditions;$i++)
						{
							
							if($m  > 12)
							{
								$m  = 1;
								$year = $year+1;
							}
							$salesTimeArray[] = ltrim($m, "0")."-".$year;
							$m++;
						}
						/*
						*code for mashreq bank
						*/
						
						
	$opthtml = '';
	if($bankName == 'Mashreq')
	{
		$TLDetails = AgentPayoutMashreq::groupBy('tl_name')
				->selectRaw('count(*) as total, tl_name')->whereIn("end_sales_time",$salesTimeArray)
				->get();
		foreach($TLDetails as $tlData)
		{
			if($opthtml == '')
			{
				$opthtml = '<option value="'.$tlData->tl_name.'">'.$tlData->tl_name.'</option>';
			}	
			else
			{
				$opthtml .= '<option value="'.$tlData->tl_name.'">'.$tlData->tl_name.'</option>';
			}
		}		
	}
	else
	{
		$TLDetails = AgentPayout::groupBy('tl_name')
				->selectRaw('count(*) as total, tl_name')->whereIn("sales_time",$salesTimeArray)
				->get();
		foreach($TLDetails as $tlData)
		{
			if($opthtml == '')
			{
				$opthtml = '<option value="'.$tlData->tl_name.'">'.$tlData->tl_name.'</option>';
			}	
			else
			{
				$opthtml .= '<option value="'.$tlData->tl_name.'">'.$tlData->tl_name.'</option>';
			}
		}	
	}
	
	echo $opthtml;
	exit;
}


public function getTLByBankHistroy(Request $request)
{
	$bankName = $request->bankName;
	
						
	$opthtml = '';
	if($bankName == 'Mashreq')
	{
		$TLDetails = AgentPayoutMashreq::groupBy('tl_name')
				->selectRaw('count(*) as total, tl_name')
				->get();
		foreach($TLDetails as $tlData)
		{
			if($opthtml == '')
			{
				$opthtml = '<option value="'.$tlData->tl_name.'">'.$tlData->tl_name.'</option>';
			}	
			else
			{
				$opthtml .= '<option value="'.$tlData->tl_name.'">'.$tlData->tl_name.'</option>';
			}
		}		
	}
	else
	{
		$TLDetails = AgentPayout::groupBy('tl_name')
				->selectRaw('count(*) as total, tl_name')
				->get();
		foreach($TLDetails as $tlData)
		{
			if($opthtml == '')
			{
				$opthtml = '<option value="'.$tlData->tl_name.'">'.$tlData->tl_name.'</option>';
			}	
			else
			{
				$opthtml .= '<option value="'.$tlData->tl_name.'">'.$tlData->tl_name.'</option>';
			}
		}	
	}
	
	echo $opthtml;
	exit;
}


public function updateTLLocation(Request $request)
{
	$bankName = $request->bankName;
	$location = $request->location;
	$fromDate = $request->fromDate;
	$toDate = $request->toDate;
	
	$from_dateSI = $fromDate."-10";
			$to_dateSI = $toDate."-10";
			
			
			
			
			
			 $salesMonthFrom =  date("m",strtotime($from_dateSI));
		
			 $salesYearFrom =  date("Y",strtotime($from_dateSI));
		
			 $salesMonthTo = date("m",strtotime($to_dateSI));
			
			 $salesYearTo =  date("Y",strtotime($to_dateSI));
			 
			 
			 /*start code*/
						$salesTimeArray = array();
						$year = $salesYearFrom;
						$conditions = $salesMonthTo;
						if($salesYearFrom < $salesYearTo)
						{
							if($salesMonthFrom != 12)
							{
								$interval = 12-$salesMonthFrom;
								$conditions = $salesMonthFrom+$salesMonthTo+$interval;
							}
							else
							{
							$conditions = $salesMonthFrom+$salesMonthTo;
							}
						}
						//echo $conditions;exit;
						$m = $salesMonthFrom;
						for($i=$salesMonthFrom;$i<=$conditions;$i++)
						{
							
							if($m  > 12)
							{
								$m  = 1;
								$year = $year+1;
							}
							$salesTimeArray[] = ltrim($m, "0")."-".$year;
							$m++;
						}
						/*
						*code for mashreq bank
						*/
	$opthtml = '';
	if($bankName == 'Mashreq')
	{
		if($location != 'All')
		{
				$TLDetails = AgentPayoutMashreq::groupBy('tl_name')
				->selectRaw('count(*) as total, tl_name')->whereIn("end_sales_time",$salesTimeArray)
				->get();
		}
		else
		{
				$TLDetails = AgentPayoutMashreq::groupBy('tl_name')
				->selectRaw('count(*) as total, tl_name')->whereIn("end_sales_time",$salesTimeArray)
				->get();
		}
		foreach($TLDetails as $tlData)
		{
			if($opthtml == '')
			{
				$opthtml = '<option value="'.$tlData->tl_name.'">'.$tlData->tl_name.'</option>';
			}	
			else
			{
				$opthtml .= '<option value="'.$tlData->tl_name.'">'.$tlData->tl_name.'</option>';
			}
		}		
	}
	else
	{
		if($location != 'All')
		{
			if($location == 'DXB')
			{
				$TLDetails = AgentPayout::groupBy('tl_name')
				->selectRaw('count(*) as total, tl_name')->where("location","DUBAI")->whereIn("sales_time",$salesTimeArray)
				->get();
			}
			else
			{
				$TLDetails = AgentPayout::groupBy('tl_name')
				->selectRaw('count(*) as total, tl_name')->where("location","ABU DHABI")->whereIn("sales_time",$salesTimeArray)
				->get();
			}
			
			
		}
		else
		{
			$TLDetails = AgentPayout::groupBy('tl_name')
				->selectRaw('count(*) as total, tl_name')->whereIn("sales_time",$salesTimeArray)
				->get();
		}
		foreach($TLDetails as $tlData)
		{
			if($opthtml == '')
			{
				$opthtml = '<option value="'.$tlData->tl_name.'">'.$tlData->tl_name.'</option>';
			}	
			else
			{
				$opthtml .= '<option value="'.$tlData->tl_name.'">'.$tlData->tl_name.'</option>';
			}
		}	
	}
	
	echo $opthtml;
	exit;
}




public function updateTLLocationHistroy(Request $request)
{
	$bankName = $request->bankName;
	$location = $request->location;

	$opthtml = '';
	if($bankName == 'Mashreq')
	{
		if($location != 'All')
		{
				$TLDetails = AgentPayoutMashreq::groupBy('tl_name')
				->selectRaw('count(*) as total, tl_name')
				->get();
		}
		else
		{
				$TLDetails = AgentPayoutMashreq::groupBy('tl_name')
				->selectRaw('count(*) as total, tl_name')
				->get();
		}
		foreach($TLDetails as $tlData)
		{
			if($opthtml == '')
			{
				$opthtml = '<option value="'.$tlData->tl_name.'">'.$tlData->tl_name.'</option>';
			}	
			else
			{
				$opthtml .= '<option value="'.$tlData->tl_name.'">'.$tlData->tl_name.'</option>';
			}
		}		
	}
	else
	{
		if($location != 'All')
		{
			if($location == 'DXB')
			{
				$TLDetails = AgentPayout::groupBy('tl_name')
				->selectRaw('count(*) as total, tl_name')->where("location","DUBAI")
				->get();
			}
			else
			{
				$TLDetails = AgentPayout::groupBy('tl_name')
				->selectRaw('count(*) as total, tl_name')->where("location","ABU DHABI")
				->get();
			}
			
			
		}
		else
		{
			$TLDetails = AgentPayout::groupBy('tl_name')
				->selectRaw('count(*) as total, tl_name')
				->get();
		}
		foreach($TLDetails as $tlData)
		{
			if($opthtml == '')
			{
				$opthtml = '<option value="'.$tlData->tl_name.'">'.$tlData->tl_name.'</option>';
			}	
			else
			{
				$opthtml .= '<option value="'.$tlData->tl_name.'">'.$tlData->tl_name.'</option>';
			}
		}	
	}
	
	echo $opthtml;
	exit;
}

protected function getDataAsXS_Card_ENBD($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
{
	if($teamleaderwithout != "yes")
	{
					$indexC = 0;
					$graphArray = array();
					foreach($tl_name_array as $tl_name)
					{
						$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						$graphArray[$indexC]['TL Name'] = $tl_name;
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->get();	
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
							$targetNotAchive80 = 0;
							$totalCards = 0;
							$totalCardsCS = 0;
							$totalCardsCSOnly = 0;
							$totalCardsCount = 0;
						
							
							$totalLoan = 0;
							$totalLoanCount = 0;
							
							$totalLoanCS = 0;
							$totalLoanCSOnly = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTarget80 = round(($AgentTarget/100)*80);
								$totalCardsCS = $totalCardsCS+$_tdata->tc_card;
								
								
								$totalLoanCS = $totalLoanCS+$_tdata->final_loan_amount;
								
								if($_tdata->agent_product == 'CARD')
								{
									$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan_amount;
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsCount++;
									if($agentTarget80 > $_tdata->tc_card)
									{
										$targetNotAchive80++;
									}
								}
								else
								{
									$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->tc_card;
									$totalLoan = $totalLoan+$_tdata->final_loan_amount;
									$totalLoanCount++;
									if($agentTarget80 > $_tdata->final_loan_amount)
									{
										$targetNotAchive80++;
									}
								}
							}
							/*
							*count 80% target not achive
							*/
							
							/*
							*candidate count achived target
							*/
							$achivedCandidate = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								if($_tdata->agent_product == 'CARDS')
								{
									if($AgentTarget <= $_tdata->tc_card)
									{
										$achivedCandidate++;
									}
								}
								else
								{
									if($AgentTarget <= $_tdata->final_loan_amount)
									{
										$achivedCandidate++;
									}
								}
							}
							/*
							*candidate count achived target
							*/
							 if(count($salesTimeArray) == 1)
								{
								 $graphArray[$indexC]['Total Agents'] = count($allMashreqData);
								 $graphArray[$indexC]['Agents in Cards'] = $totalCardsCount;
								}
							/*$graphArray[$indexC]['Target Achived'] = $achivedCandidate; */
							/* echo "Total Agents Head Count  ".count($allMashreqData);
							echo "<br />";
							echo "Agent Count who achived their Target  ".$achivedCandidate; */
							if(count($allMashreqData) >0)
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%"; */
							}
							else
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = "0%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  0%"; */
							}
							/*$graphArray[$indexC]['Target Achived Less 80%'] = $targetNotAchive80;
							 echo "<br />";
							echo "Agents Achived less than 80% of Target   ".$targetNotAchive80; */
							/* if($qt != 'No')
							{
							
							$targetNotAchiveD = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTargetD = round(($AgentTarget/100)*$qt);
								if($_tdata->agent_product == 'CARD')
								{
									if($agentTargetD > $_tdata->tc_card)
									{
										$targetNotAchiveD++;
									}
								}
								else
								{
									if($agentTargetD > $_tdata->final_loan_amount)
									{
										$targetNotAchiveD++;
									}
								}
							}
							echo "<br />";
							echo "Agents Achived less than ".$qt."% of Target   ".$targetNotAchiveD;
							} */
							
							/* echo "<br />";
							echo "Total Agents in Card ".$totalCardsCount;
							echo "<br />";
							echo "Total Agents in loan ".$totalLoanCount;*/
							if($totalCardsCount >0)
							{
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = round($totalCards/$totalCardsCount,2);
								/* echo "<br />";
								echo "Core Team Productivity (Cards) ".round($totalCards/$totalCardsCount,2); */
							}
							else
							{
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
								/* echo "<br />";
								echo "Core Team Productivity (Cards) 0"; */
							}
							/*
							if($totalLoanCount >0)
							{
								echo "<br />";
								echo "Core Team Productivity (PLs) ".round($totalLoan/$totalLoanCount,2);
							}
							else
							{
								echo "<br />";
								echo "Core Team Productivity (PLs) 0";
							}
							*/
							if($totalCardsCount >0)
							{
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
								/* echo "<br />";
								echo "Team Cards Productivity (Cards including XS) ".round($totalCardsCS/$totalCardsCount,2); */
							}
							else
							{
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
								/* echo "<br />";
								echo "Team Cards Productivity (Cards including XS) 0"; */

							}
							/*
							if($totalLoanCount >0)
							{
								echo "<br />";
								echo "Team Loan Productivity (Loan including XS) ".round($totalLoanCS/$totalLoanCount,2);
							}
							else
							{
								echo "<br />";
								echo "Team Loan Productivity (Loan including XS) 0";
							}*/
							if($totalCardsCS >0)
							{
								$graphArray[$indexC]['XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
								/* echo "<br />";
								echo "XS (Card)  ".round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%'; */
							}
							else
							{
								$graphArray[$indexC]['XS (Card)'] = '0%';
								/* echo "<br />";
								echo "XS (Card)  0%"; */

							}
							/*
							if($totalLoanCS >0)
							{
							echo "<br />";
							echo "XS (Loan)   ".round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
							}
							else
							{
								echo "<br />";
							echo "XS (Loan)   0%";
							}
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "Total Cards with XS -".$totalCardsCS;
							echo "<br />";
							echo "Total Cards By Loan Agent -".$totalCardsCSOnly;
							echo "<br />";
							echo "Total Loan with XS -".$totalLoanCS;
							echo "<br />";
							echo "Total Loan By Card Agent -".$totalLoanCSOnly; */
							/*
							*count dynamic target not achive
							*/
							
								/* if($agentId != "No")
								{
										$agentDetails = AgentPayout::where("id",$agentId)->first();
										if($agentDetails != '')
										{
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
											echo "<br />";
											echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
											echo "<br />";
											echo "Agent Target   <b>".$agentDetails->agent_target.'</b>';
											echo "<br />";
											echo "Agent Product   <b>".$agentDetails->agent_product.'</b>';
											echo "<br />";
											
											if($agentDetails->agent_product == 'CARD')
											{
												echo "Agent CARD   <b>".$agentDetails->tc_card.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->tc_card/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
											else
											{
												echo "Agent Loan AED<b>".$agentDetails->final_loan_amount.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->final_loan_amount/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
										}
										else
										{
											echo "Agent not found";
										}
										
								} */
								/*
								*count dynamic target not achive
								*/
							}
							else
							{
								 if(count($salesTimeArray) == 1)
									{
										$graphArray[$indexC]['Total Agents'] = 0;
										$graphArray[$indexC]['Agents in Cards'] = 0;
									}
								
							
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
								
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
							
								$graphArray[$indexC]['XS (Card)'] = 0;
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsXS_Card_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
					}
					
					$graphArrayM[$indexC] = $this->getDataAsXS_Card_ENBDTotal($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
					
					return $graphArrayM;
	}
	else
	{
					$indexC = 0;
					$graphArray = array();
					$tl_name = '';
					
					if(count($salesTimeArray) == 1 && $vintage_name_SI != 'No')
					{
					/*
					*report as per Vintage
					*coding start
					*/
					$vintage_name_SIArray = explode(",",$vintage_name_SI);
					foreach($vintage_name_SIArray as $vintage)
					{
						$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id = ".$vintage;
							}
							else
							{
								$whereRaw .= " AND range_id = ".$vintage;
							}
							$graphArray[$indexC]['Vintage'] = $vintage;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
							$targetNotAchive80 = 0;
							$totalCards = 0;
							$totalCardsCS = 0;
							$totalCardsCSOnly = 0;
							$totalCardsCount = 0;
						
							
							$totalLoan = 0;
							$totalLoanCount = 0;
							
							$totalLoanCS = 0;
							$totalLoanCSOnly = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTarget80 = round(($AgentTarget/100)*80);
								$totalCardsCS = $totalCardsCS+$_tdata->tc_card;
								
								
								$totalLoanCS = $totalLoanCS+$_tdata->final_loan_amount;
								
								if($_tdata->agent_product == 'CARD')
								{
									$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan_amount;
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsCount++;
									if($agentTarget80 > $_tdata->tc_card)
									{
										$targetNotAchive80++;
									}
								}
								else
								{
									$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->tc_card;
									$totalLoan = $totalLoan+$_tdata->final_loan_amount;
									$totalLoanCount++;
									if($agentTarget80 > $_tdata->final_loan_amount)
									{
										$targetNotAchive80++;
									}
								}
							}
							/*
							*count 80% target not achive
							*/
							
							/*
							*candidate count achived target
							*/
							$achivedCandidate = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								if($_tdata->agent_product == 'CARDS')
								{
									if($AgentTarget <= $_tdata->tc_card)
									{
										$achivedCandidate++;
									}
								}
								else
								{
									if($AgentTarget <= $_tdata->final_loan_amount)
									{
										$achivedCandidate++;
									}
								}
							}
							/*
							*candidate count achived target
							*/
							 if(count($salesTimeArray) == 1)
								{
									$graphArray[$indexC]['Total Agents'] = count($allMashreqData);
									$graphArray[$indexC]['Agents in Cards'] = $totalCardsCount;
								}
							/*$graphArray[$indexC]['Target Achived'] = $achivedCandidate; */
							/* echo "Total Agents Head Count  ".count($allMashreqData);
							echo "<br />";
							echo "Agent Count who achived their Target  ".$achivedCandidate; */
							if(count($allMashreqData) >0)
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%"; */
							}
							else
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = "0%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  0%"; */
							}
							/*$graphArray[$indexC]['Target Achived Less 80%'] = $targetNotAchive80;
							 echo "<br />";
							echo "Agents Achived less than 80% of Target   ".$targetNotAchive80; */
							/* if($qt != 'No')
							{
							
							$targetNotAchiveD = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTargetD = round(($AgentTarget/100)*$qt);
								if($_tdata->agent_product == 'CARD')
								{
									if($agentTargetD > $_tdata->tc_card)
									{
										$targetNotAchiveD++;
									}
								}
								else
								{
									if($agentTargetD > $_tdata->final_loan_amount)
									{
										$targetNotAchiveD++;
									}
								}
							}
							echo "<br />";
							echo "Agents Achived less than ".$qt."% of Target   ".$targetNotAchiveD;
							} */
							
							/* echo "<br />";
							echo "Total Agents in Card ".$totalCardsCount;
							echo "<br />";
							echo "Total Agents in loan ".$totalLoanCount;*/
							if($totalCardsCount >0)
							{
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = round($totalCards/$totalCardsCount,2);
								/* echo "<br />";
								echo "Core Team Productivity (Cards) ".round($totalCards/$totalCardsCount,2); */
							}
							else
							{
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
								/* echo "<br />";
								echo "Core Team Productivity (Cards) 0"; */
							}
							/*
							if($totalLoanCount >0)
							{
								echo "<br />";
								echo "Core Team Productivity (PLs) ".round($totalLoan/$totalLoanCount,2);
							}
							else
							{
								echo "<br />";
								echo "Core Team Productivity (PLs) 0";
							}
							*/
							if($totalCardsCount >0)
							{
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
								/* echo "<br />";
								echo "Team Cards Productivity (Cards including XS) ".round($totalCardsCS/$totalCardsCount,2); */
							}
							else
							{
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
								/* echo "<br />";
								echo "Team Cards Productivity (Cards including XS) 0"; */

							}
							/*
							if($totalLoanCount >0)
							{
								echo "<br />";
								echo "Team Loan Productivity (Loan including XS) ".round($totalLoanCS/$totalLoanCount,2);
							}
							else
							{
								echo "<br />";
								echo "Team Loan Productivity (Loan including XS) 0";
							}*/
							if($totalCardsCS >0)
							{
								$graphArray[$indexC]['XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
								/* echo "<br />";
								echo "XS (Card)  ".round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%'; */
							}
							else
							{
								$graphArray[$indexC]['XS (Card)'] = '0%';
								/* echo "<br />";
								echo "XS (Card)  0%"; */

							}
							/*
							if($totalLoanCS >0)
							{
							echo "<br />";
							echo "XS (Loan)   ".round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
							}
							else
							{
								echo "<br />";
							echo "XS (Loan)   0%";
							}
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "Total Cards with XS -".$totalCardsCS;
							echo "<br />";
							echo "Total Cards By Loan Agent -".$totalCardsCSOnly;
							echo "<br />";
							echo "Total Loan with XS -".$totalLoanCS;
							echo "<br />";
							echo "Total Loan By Card Agent -".$totalLoanCSOnly; */
							/*
							*count dynamic target not achive
							*/
							
								/* if($agentId != "No")
								{
										$agentDetails = AgentPayout::where("id",$agentId)->first();
										if($agentDetails != '')
										{
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
											echo "<br />";
											echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
											echo "<br />";
											echo "Agent Target   <b>".$agentDetails->agent_target.'</b>';
											echo "<br />";
											echo "Agent Product   <b>".$agentDetails->agent_product.'</b>';
											echo "<br />";
											
											if($agentDetails->agent_product == 'CARD')
											{
												echo "Agent CARD   <b>".$agentDetails->tc_card.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->tc_card/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
											else
											{
												echo "Agent Loan AED<b>".$agentDetails->final_loan_amount.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->final_loan_amount/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
										}
										else
										{
											echo "Agent not found";
										}
										
								} */
								/*
								*count dynamic target not achive
								*/
							}
							else
							{
								if(count($salesTimeArray) == 1)
								{
									$graphArray[$indexC]['Total Agents'] = 0;
									$graphArray[$indexC]['Agents in Cards'] = 0;
								}
								
							
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
								
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
							
								$graphArray[$indexC]['XS (Card)'] = 0;
							}
						if($historical_data == "yes")
						{							
							$graphArray1 = $this->getDataAsXS_Card_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
						}
						else
						{
							$graphArrayM[$indexC] = $graphArray[$indexC];
						}
						$indexC++;
					
					}
					/*
					*report as per Vintage
					*coding start
					*/
					}
					else
					{
					/*
					*report as per salesTime
					*coding start
					*/
					foreach($salesTimeArray as $_salesT)
					{
						$graphArray[$indexC]['Sales Time'] = $_salesT;
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->where("sales_time",$_salesT)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->where("sales_time",$_salesT)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
							$targetNotAchive80 = 0;
							$totalCards = 0;
							$totalCardsCS = 0;
							$totalCardsCSOnly = 0;
							$totalCardsCount = 0;
						
							
							$totalLoan = 0;
							$totalLoanCount = 0;
							
							$totalLoanCS = 0;
							$totalLoanCSOnly = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTarget80 = round(($AgentTarget/100)*80);
								$totalCardsCS = $totalCardsCS+$_tdata->tc_card;
								
								
								$totalLoanCS = $totalLoanCS+$_tdata->final_loan_amount;
								
								if($_tdata->agent_product == 'CARD')
								{
									$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan_amount;
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsCount++;
									if($agentTarget80 > $_tdata->tc_card)
									{
										$targetNotAchive80++;
									}
								}
								else
								{
									$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->tc_card;
									$totalLoan = $totalLoan+$_tdata->final_loan_amount;
									$totalLoanCount++;
									if($agentTarget80 > $_tdata->final_loan_amount)
									{
										$targetNotAchive80++;
									}
								}
							}
							/*
							*count 80% target not achive
							*/
							
							/*
							*candidate count achived target
							*/
							$achivedCandidate = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								if($_tdata->agent_product == 'CARDS')
								{
									if($AgentTarget <= $_tdata->tc_card)
									{
										$achivedCandidate++;
									}
								}
								else
								{
									if($AgentTarget <= $_tdata->final_loan_amount)
									{
										$achivedCandidate++;
									}
								}
							}
							/*
							*candidate count achived target
							*/
							 if(count($salesTimeArray) == 1)
								{
									$graphArray[$indexC]['Total Agents'] = count($allMashreqData);
									$graphArray[$indexC]['Agents in Cards'] = $totalCardsCount;
								}
							/*$graphArray[$indexC]['Target Achived'] = $achivedCandidate; */
							/* echo "Total Agents Head Count  ".count($allMashreqData);
							echo "<br />";
							echo "Agent Count who achived their Target  ".$achivedCandidate; */
							if(count($allMashreqData) >0)
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%"; */
							}
							else
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = "0%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  0%"; */
							}
							/*$graphArray[$indexC]['Target Achived Less 80%'] = $targetNotAchive80;
							 echo "<br />";
							echo "Agents Achived less than 80% of Target   ".$targetNotAchive80; */
							/* if($qt != 'No')
							{
							
							$targetNotAchiveD = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTargetD = round(($AgentTarget/100)*$qt);
								if($_tdata->agent_product == 'CARD')
								{
									if($agentTargetD > $_tdata->tc_card)
									{
										$targetNotAchiveD++;
									}
								}
								else
								{
									if($agentTargetD > $_tdata->final_loan_amount)
									{
										$targetNotAchiveD++;
									}
								}
							}
							echo "<br />";
							echo "Agents Achived less than ".$qt."% of Target   ".$targetNotAchiveD;
							} */
							
							/* echo "<br />";
							echo "Total Agents in Card ".$totalCardsCount;
							echo "<br />";
							echo "Total Agents in loan ".$totalLoanCount;*/
							if($totalCardsCount >0)
							{
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = round($totalCards/$totalCardsCount,2);
								/* echo "<br />";
								echo "Core Team Productivity (Cards) ".round($totalCards/$totalCardsCount,2); */
							}
							else
							{
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
								/* echo "<br />";
								echo "Core Team Productivity (Cards) 0"; */
							}
							/*
							if($totalLoanCount >0)
							{
								echo "<br />";
								echo "Core Team Productivity (PLs) ".round($totalLoan/$totalLoanCount,2);
							}
							else
							{
								echo "<br />";
								echo "Core Team Productivity (PLs) 0";
							}
							*/
							if($totalCardsCount >0)
							{
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
								/* echo "<br />";
								echo "Team Cards Productivity (Cards including XS) ".round($totalCardsCS/$totalCardsCount,2); */
							}
							else
							{
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
								/* echo "<br />";
								echo "Team Cards Productivity (Cards including XS) 0"; */

							}
							/*
							if($totalLoanCount >0)
							{
								echo "<br />";
								echo "Team Loan Productivity (Loan including XS) ".round($totalLoanCS/$totalLoanCount,2);
							}
							else
							{
								echo "<br />";
								echo "Team Loan Productivity (Loan including XS) 0";
							}*/
							if($totalCardsCS >0)
							{
								$graphArray[$indexC]['XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
								/* echo "<br />";
								echo "XS (Card)  ".round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%'; */
							}
							else
							{
								$graphArray[$indexC]['XS (Card)'] = '0%';
								/* echo "<br />";
								echo "XS (Card)  0%"; */

							}
							/*
							if($totalLoanCS >0)
							{
							echo "<br />";
							echo "XS (Loan)   ".round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
							}
							else
							{
								echo "<br />";
							echo "XS (Loan)   0%";
							}
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "Total Cards with XS -".$totalCardsCS;
							echo "<br />";
							echo "Total Cards By Loan Agent -".$totalCardsCSOnly;
							echo "<br />";
							echo "Total Loan with XS -".$totalLoanCS;
							echo "<br />";
							echo "Total Loan By Card Agent -".$totalLoanCSOnly; */
							/*
							*count dynamic target not achive
							*/
							
								/* if($agentId != "No")
								{
										$agentDetails = AgentPayout::where("id",$agentId)->first();
										if($agentDetails != '')
										{
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
											echo "<br />";
											echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
											echo "<br />";
											echo "Agent Target   <b>".$agentDetails->agent_target.'</b>';
											echo "<br />";
											echo "Agent Product   <b>".$agentDetails->agent_product.'</b>';
											echo "<br />";
											
											if($agentDetails->agent_product == 'CARD')
											{
												echo "Agent CARD   <b>".$agentDetails->tc_card.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->tc_card/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
											else
											{
												echo "Agent Loan AED<b>".$agentDetails->final_loan_amount.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->final_loan_amount/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
										}
										else
										{
											echo "Agent not found";
										}
										
								} */
								/*
								*count dynamic target not achive
								*/
							}
							else
							{
								if(count($salesTimeArray) == 1)
								{
									$graphArray[$indexC]['Total Agents'] = 0;
									$graphArray[$indexC]['Agents in Cards'] = 0;
								}
								
							
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
								
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
							
								$graphArray[$indexC]['XS (Card)'] = 0;
							}
						if($historical_data == "yes")
						{							
							$graphArray1 = $this->getDataAsXS_Card_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
						}
						else
						{
							$graphArrayM[$indexC] = $graphArray[$indexC];
						}
						$indexC++;
					
					}
					/*
					*report as per salesTime
					*coding end
					*/
					}
					
					
						$graphArray[$indexC]['Sales Time'] = "Total";
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
							$targetNotAchive80 = 0;
							$totalCards = 0;
							$totalCardsCS = 0;
							$totalCardsCSOnly = 0;
							$totalCardsCount = 0;
						
							
							$totalLoan = 0;
							$totalLoanCount = 0;
							
							$totalLoanCS = 0;
							$totalLoanCSOnly = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTarget80 = round(($AgentTarget/100)*80);
								$totalCardsCS = $totalCardsCS+$_tdata->tc_card;
								
								
								$totalLoanCS = $totalLoanCS+$_tdata->final_loan_amount;
								
								if($_tdata->agent_product == 'CARD')
								{
									$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan_amount;
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsCount++;
									if($agentTarget80 > $_tdata->tc_card)
									{
										$targetNotAchive80++;
									}
								}
								else
								{
									$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->tc_card;
									$totalLoan = $totalLoan+$_tdata->final_loan_amount;
									$totalLoanCount++;
									if($agentTarget80 > $_tdata->final_loan_amount)
									{
										$targetNotAchive80++;
									}
								}
							}
							/*
							*count 80% target not achive
							*/
							
							/*
							*candidate count achived target
							*/
							$achivedCandidate = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								if($_tdata->agent_product == 'CARDS')
								{
									if($AgentTarget <= $_tdata->tc_card)
									{
										$achivedCandidate++;
									}
								}
								else
								{
									if($AgentTarget <= $_tdata->final_loan_amount)
									{
										$achivedCandidate++;
									}
								}
							}
							/*
							*candidate count achived target
							*/
							 if(count($salesTimeArray) == 1)
								{
									$graphArray[$indexC]['Total Agents'] = count($allMashreqData);
									$graphArray[$indexC]['Agents in Cards'] = $totalCardsCount;
								}
							/*$graphArray[$indexC]['Target Achived'] = $achivedCandidate; */
							/* echo "Total Agents Head Count  ".count($allMashreqData);
							echo "<br />";
							echo "Agent Count who achived their Target  ".$achivedCandidate; */
							if(count($allMashreqData) >0)
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%"; */
							}
							else
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = "0%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  0%"; */
							}
							/*$graphArray[$indexC]['Target Achived Less 80%'] = $targetNotAchive80;
							 echo "<br />";
							echo "Agents Achived less than 80% of Target   ".$targetNotAchive80; */
							/* if($qt != 'No')
							{
							
							$targetNotAchiveD = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTargetD = round(($AgentTarget/100)*$qt);
								if($_tdata->agent_product == 'CARD')
								{
									if($agentTargetD > $_tdata->tc_card)
									{
										$targetNotAchiveD++;
									}
								}
								else
								{
									if($agentTargetD > $_tdata->final_loan_amount)
									{
										$targetNotAchiveD++;
									}
								}
							}
							echo "<br />";
							echo "Agents Achived less than ".$qt."% of Target   ".$targetNotAchiveD;
							} */
							
							/* echo "<br />";
							echo "Total Agents in Card ".$totalCardsCount;
							echo "<br />";
							echo "Total Agents in loan ".$totalLoanCount;*/
							if($totalCardsCount >0)
							{
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = round($totalCards/$totalCardsCount,2);
								/* echo "<br />";
								echo "Core Team Productivity (Cards) ".round($totalCards/$totalCardsCount,2); */
							}
							else
							{
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
								/* echo "<br />";
								echo "Core Team Productivity (Cards) 0"; */
							}
							/*
							if($totalLoanCount >0)
							{
								echo "<br />";
								echo "Core Team Productivity (PLs) ".round($totalLoan/$totalLoanCount,2);
							}
							else
							{
								echo "<br />";
								echo "Core Team Productivity (PLs) 0";
							}
							*/
							if($totalCardsCount >0)
							{
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
								/* echo "<br />";
								echo "Team Cards Productivity (Cards including XS) ".round($totalCardsCS/$totalCardsCount,2); */
							}
							else
							{
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
								/* echo "<br />";
								echo "Team Cards Productivity (Cards including XS) 0"; */

							}
							/*
							if($totalLoanCount >0)
							{
								echo "<br />";
								echo "Team Loan Productivity (Loan including XS) ".round($totalLoanCS/$totalLoanCount,2);
							}
							else
							{
								echo "<br />";
								echo "Team Loan Productivity (Loan including XS) 0";
							}*/
							if($totalCardsCS >0)
							{
								$graphArray[$indexC]['XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
								/* echo "<br />";
								echo "XS (Card)  ".round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%'; */
							}
							else
							{
								$graphArray[$indexC]['XS (Card)'] = '0%';
								/* echo "<br />";
								echo "XS (Card)  0%"; */

							}
							/*
							if($totalLoanCS >0)
							{
							echo "<br />";
							echo "XS (Loan)   ".round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
							}
							else
							{
								echo "<br />";
							echo "XS (Loan)   0%";
							}
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "Total Cards with XS -".$totalCardsCS;
							echo "<br />";
							echo "Total Cards By Loan Agent -".$totalCardsCSOnly;
							echo "<br />";
							echo "Total Loan with XS -".$totalLoanCS;
							echo "<br />";
							echo "Total Loan By Card Agent -".$totalLoanCSOnly; */
							/*
							*count dynamic target not achive
							*/
							
								/* if($agentId != "No")
								{
										$agentDetails = AgentPayout::where("id",$agentId)->first();
										if($agentDetails != '')
										{
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
											echo "<br />";
											echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
											echo "<br />";
											echo "Agent Target   <b>".$agentDetails->agent_target.'</b>';
											echo "<br />";
											echo "Agent Product   <b>".$agentDetails->agent_product.'</b>';
											echo "<br />";
											
											if($agentDetails->agent_product == 'CARD')
											{
												echo "Agent CARD   <b>".$agentDetails->tc_card.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->tc_card/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
											else
											{
												echo "Agent Loan AED<b>".$agentDetails->final_loan_amount.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->final_loan_amount/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
										}
										else
										{
											echo "Agent not found";
										}
										
								} */
								/*
								*count dynamic target not achive
								*/
							}
							else
							{
								if(count($salesTimeArray) == 1)
								{
									$graphArray[$indexC]['Total Agents'] = 0;
									$graphArray[$indexC]['Agents in Cards'] = 0;
								}
								
							
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
								
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
							
								$graphArray[$indexC]['XS (Card)'] = 0;
							}
						if($historical_data == "yes")
						{							
							$graphArray1 = $this->getDataAsXS_Card_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
						}
						else
						{
							$graphArrayM[$indexC] = $graphArray[$indexC];
						}
					return $graphArrayM;
	}
}
protected function getDataAsXS_Card_ENBDTotal($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
{
						$graphArray = array();
						$graphArray['Sales Time'] = "Total";
						$graphArray['TL Name'] = "";
						$graphArray['Bank'] = "ENBD";
						
						$whereRaw = '';
/* 						if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereIn("tl_name",$tl_name_array)->get();	
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereIn("tl_name",$tl_name_array)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
							$targetNotAchive80 = 0;
							$totalCards = 0;
							$totalCardsCS = 0;
							$totalCardsCSOnly = 0;
							$totalCardsCount = 0;
						
							
							$totalLoan = 0;
							$totalLoanCount = 0;
							
							$totalLoanCS = 0;
							$totalLoanCSOnly = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTarget80 = round(($AgentTarget/100)*80);
								$totalCardsCS = $totalCardsCS+$_tdata->tc_card;
								
								
								$totalLoanCS = $totalLoanCS+$_tdata->final_loan_amount;
								
								if($_tdata->agent_product == 'CARD')
								{
									$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan_amount;
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsCount++;
									if($agentTarget80 > $_tdata->tc_card)
									{
										$targetNotAchive80++;
									}
								}
								else
								{
									$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->tc_card;
									$totalLoan = $totalLoan+$_tdata->final_loan_amount;
									$totalLoanCount++;
									if($agentTarget80 > $_tdata->final_loan_amount)
									{
										$targetNotAchive80++;
									}
								}
							}
							/*
							*count 80% target not achive
							*/
							
							/*
							*candidate count achived target
							*/
							$achivedCandidate = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								if($_tdata->agent_product == 'CARDS')
								{
									if($AgentTarget <= $_tdata->tc_card)
									{
										$achivedCandidate++;
									}
								}
								else
								{
									if($AgentTarget <= $_tdata->final_loan_amount)
									{
										$achivedCandidate++;
									}
								}
							}
							/*
							*candidate count achived target
							*/
							 if(count($salesTimeArray) == 1)
								{
								 $graphArray['Total Agents'] = count($allMashreqData);
								 $graphArray['Agents in Cards'] = $totalCardsCount;
								}
							/*$graphArray[$indexC]['Target Achived'] = $achivedCandidate; */
							/* echo "Total Agents Head Count  ".count($allMashreqData);
							echo "<br />";
							echo "Agent Count who achived their Target  ".$achivedCandidate; */
							if(count($allMashreqData) >0)
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%"; */
							}
							else
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = "0%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  0%"; */
							}
							/*$graphArray[$indexC]['Target Achived Less 80%'] = $targetNotAchive80;
							 echo "<br />";
							echo "Agents Achived less than 80% of Target   ".$targetNotAchive80; */
							/* if($qt != 'No')
							{
							
							$targetNotAchiveD = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTargetD = round(($AgentTarget/100)*$qt);
								if($_tdata->agent_product == 'CARD')
								{
									if($agentTargetD > $_tdata->tc_card)
									{
										$targetNotAchiveD++;
									}
								}
								else
								{
									if($agentTargetD > $_tdata->final_loan_amount)
									{
										$targetNotAchiveD++;
									}
								}
							}
							echo "<br />";
							echo "Agents Achived less than ".$qt."% of Target   ".$targetNotAchiveD;
							} */
							
							/* echo "<br />";
							echo "Total Agents in Card ".$totalCardsCount;
							echo "<br />";
							echo "Total Agents in loan ".$totalLoanCount;*/
							if($totalCardsCount >0)
							{
								$graphArray['Core Team Productivity (Cards)'] = round($totalCards/$totalCardsCount,2);
								/* echo "<br />";
								echo "Core Team Productivity (Cards) ".round($totalCards/$totalCardsCount,2); */
							}
							else
							{
								$graphArray['Core Team Productivity (Cards)'] = 0;
								/* echo "<br />";
								echo "Core Team Productivity (Cards) 0"; */
							}
							/*
							if($totalLoanCount >0)
							{
								echo "<br />";
								echo "Core Team Productivity (PLs) ".round($totalLoan/$totalLoanCount,2);
							}
							else
							{
								echo "<br />";
								echo "Core Team Productivity (PLs) 0";
							}
							*/
							if($totalCardsCount >0)
							{
								$graphArray['Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
								/* echo "<br />";
								echo "Team Cards Productivity (Cards including XS) ".round($totalCardsCS/$totalCardsCount,2); */
							}
							else
							{
								$graphArray['Team Cards Productivity (Cards including XS)'] = 0;
								/* echo "<br />";
								echo "Team Cards Productivity (Cards including XS) 0"; */

							}
							/*
							if($totalLoanCount >0)
							{
								echo "<br />";
								echo "Team Loan Productivity (Loan including XS) ".round($totalLoanCS/$totalLoanCount,2);
							}
							else
							{
								echo "<br />";
								echo "Team Loan Productivity (Loan including XS) 0";
							}*/
							if($totalCardsCS >0)
							{
								$graphArray['XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
								/* echo "<br />";
								echo "XS (Card)  ".round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%'; */
							}
							else
							{
								$graphArray['XS (Card)'] = '0%';
								/* echo "<br />";
								echo "XS (Card)  0%"; */

							}
							/*
							if($totalLoanCS >0)
							{
							echo "<br />";
							echo "XS (Loan)   ".round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
							}
							else
							{
								echo "<br />";
							echo "XS (Loan)   0%";
							}
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "Total Cards with XS -".$totalCardsCS;
							echo "<br />";
							echo "Total Cards By Loan Agent -".$totalCardsCSOnly;
							echo "<br />";
							echo "Total Loan with XS -".$totalLoanCS;
							echo "<br />";
							echo "Total Loan By Card Agent -".$totalLoanCSOnly; */
							/*
							*count dynamic target not achive
							*/
							
								/* if($agentId != "No")
								{
										$agentDetails = AgentPayout::where("id",$agentId)->first();
										if($agentDetails != '')
										{
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
											echo "<br />";
											echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
											echo "<br />";
											echo "Agent Target   <b>".$agentDetails->agent_target.'</b>';
											echo "<br />";
											echo "Agent Product   <b>".$agentDetails->agent_product.'</b>';
											echo "<br />";
											
											if($agentDetails->agent_product == 'CARD')
											{
												echo "Agent CARD   <b>".$agentDetails->tc_card.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->tc_card/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
											else
											{
												echo "Agent Loan AED<b>".$agentDetails->final_loan_amount.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->final_loan_amount/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
										}
										else
										{
											echo "Agent not found";
										}
										
								} */
								/*
								*count dynamic target not achive
								*/
							}
							else
							{
								 if(count($salesTimeArray) == 1)
									{
										$graphArray['Total Agents'] = 0;
										$graphArray['Agents in Cards'] = 0;
									}
								
							
								$graphArray['Core Team Productivity (Cards)'] = 0;
								
								$graphArray['Team Cards Productivity (Cards including XS)'] = 0;
							
								$graphArray['XS (Card)'] = 0;
							}
							if($historical_data == "yes")
							{
								$graphArrayT = $this->getDataAsXS_Card_ENBDHistroyTotal($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout);
								$graphArrayTD = array_merge($graphArray,$graphArrayT);
							}
							else
							{
								$graphArrayTD = $graphArray;
							}
						return $graphArrayTD;
							
}

protected function getDataAsXS_Card_ENBDHistroyTotal($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout)
{
	$whereRaw = '';
						
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereraw($whereRaw)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
							$targetNotAchive80 = 0;
							$totalCards = 0;
							$totalCardsCS = 0;
							$totalCardsCSOnly = 0;
							$totalCardsCount = 0;
						
							
							$totalLoan = 0;
							$totalLoanCount = 0;
							
							$totalLoanCS = 0;
							$totalLoanCSOnly = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTarget80 = round(($AgentTarget/100)*80);
								$totalCardsCS = $totalCardsCS+$_tdata->tc_card;
								
								
								$totalLoanCS = $totalLoanCS+$_tdata->final_loan_amount;
								
								if($_tdata->agent_product == 'CARD')
								{
									$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan_amount;
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsCount++;
									if($agentTarget80 > $_tdata->tc_card)
									{
										$targetNotAchive80++;
									}
								}
								else
								{
									$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->tc_card;
									$totalLoan = $totalLoan+$_tdata->final_loan_amount;
									$totalLoanCount++;
									if($agentTarget80 > $_tdata->final_loan_amount)
									{
										$targetNotAchive80++;
									}
								}
							}
							/*
							*count 80% target not achive
							*/
							
							/*
							*candidate count achived target
							*/
							$achivedCandidate = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								if($_tdata->agent_product == 'CARDS')
								{
									if($AgentTarget <= $_tdata->tc_card)
									{
										$achivedCandidate++;
									}
								}
								else
								{
									if($AgentTarget <= $_tdata->final_loan_amount)
									{
										$achivedCandidate++;
									}
								}
							}
							/*
							*candidate count achived target
							*/
							
							/*  $graphArray[$indexC]['Historical Total Agents'] = count($allMashreqData); */
							/*$graphArray[$indexC]['Target Achived'] = $achivedCandidate; */
							/* echo "Total Agents Head Count  ".count($allMashreqData);
							echo "<br />";
							echo "Agent Count who achived their Target  ".$achivedCandidate; */
							if(count($allMashreqData) >0)
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%"; */
							}
							else
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = "0%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  0%"; */
							}
							
							
							/* $graphArray[$indexC]['Historical Agents in Cards'] = $totalCardsCount; */
							/* echo "<br />";
							echo "Total Agents in Card ".$totalCardsCount;
							echo "<br />";
							echo "Total Agents in loan ".$totalLoanCount;*/
							if($totalCardsCount >0)
							{
								$graphArray['Historical Core Team Productivity (Cards)'] = round($totalCards/$totalCardsCount,2);
								/* echo "<br />";
								echo "Core Team Productivity (Cards) ".round($totalCards/$totalCardsCount,2); */
							}
							else
							{
								$graphArray['Historical Core Team Productivity (Cards)'] = 0;
								/* echo "<br />";
								echo "Core Team Productivity (Cards) 0"; */
							}
							
							if($totalCardsCount >0)
							{
								$graphArray['Historical Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
								/* echo "<br />";
								echo "Team Cards Productivity (Cards including XS) ".round($totalCardsCS/$totalCardsCount,2); */
							}
							else
							{
								$graphArray['Historical Team Cards Productivity (Cards including XS)'] = 0;
								/* echo "<br />";
								echo "Team Cards Productivity (Cards including XS) 0"; */

							}
						
							if($totalCardsCS >0)
							{
								$graphArray['Historical XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
								/* echo "<br />";
								echo "XS (Card)  ".round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%'; */
							}
							else
							{
								$graphArray['Historical XS (Card)'] = '0%';
								/* echo "<br />";
								echo "XS (Card)  0%"; */

							}
							
							/*
							*count dynamic target not achive
							*/
							
							
								/*
								*count dynamic target not achive
								*/
							}
							else
							{
									/* $graphArray[$indexC]['Historical Total Agents'] = 0; */
								/* $graphArray[$indexC]['Historical Agents in Cards'] = 0; */
							
								$graphArray['Historical Core Team Productivity (Cards)'] = 0;
								
								$graphArray['Historical Team Cards Productivity (Cards including XS)'] = 0;
							
								$graphArray['Historical XS (Card)'] = 0;
							}
							
							return $graphArray;
}
protected function getDataAsXS_Card_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC)
{
	
						
						
						$whereRaw = '';
						if($teamleaderwithout != "yes")
						{
							if($tl_name != 'No')
							{
								if($whereRaw == '')
								{
									$whereRaw = "tl_name = '".$tl_name."'";
								}
								else
								{
									$whereRaw .= " AND tl_name= '".$tl_name."'";
								}
							} 
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
							$targetNotAchive80 = 0;
							$totalCards = 0;
							$totalCardsCS = 0;
							$totalCardsCSOnly = 0;
							$totalCardsCount = 0;
						
							
							$totalLoan = 0;
							$totalLoanCount = 0;
							
							$totalLoanCS = 0;
							$totalLoanCSOnly = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTarget80 = round(($AgentTarget/100)*80);
								$totalCardsCS = $totalCardsCS+$_tdata->tc_card;
								
								
								$totalLoanCS = $totalLoanCS+$_tdata->final_loan_amount;
								
								if($_tdata->agent_product == 'CARD')
								{
									$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan_amount;
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsCount++;
									if($agentTarget80 > $_tdata->tc_card)
									{
										$targetNotAchive80++;
									}
								}
								else
								{
									$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->tc_card;
									$totalLoan = $totalLoan+$_tdata->final_loan_amount;
									$totalLoanCount++;
									if($agentTarget80 > $_tdata->final_loan_amount)
									{
										$targetNotAchive80++;
									}
								}
							}
							/*
							*count 80% target not achive
							*/
							
							/*
							*candidate count achived target
							*/
							$achivedCandidate = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								if($_tdata->agent_product == 'CARDS')
								{
									if($AgentTarget <= $_tdata->tc_card)
									{
										$achivedCandidate++;
									}
								}
								else
								{
									if($AgentTarget <= $_tdata->final_loan_amount)
									{
										$achivedCandidate++;
									}
								}
							}
							/*
							*candidate count achived target
							*/
							
							/*  $graphArray[$indexC]['Historical Total Agents'] = count($allMashreqData); */
							/*$graphArray[$indexC]['Target Achived'] = $achivedCandidate; */
							/* echo "Total Agents Head Count  ".count($allMashreqData);
							echo "<br />";
							echo "Agent Count who achived their Target  ".$achivedCandidate; */
							if(count($allMashreqData) >0)
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%"; */
							}
							else
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = "0%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  0%"; */
							}
							/*$graphArray[$indexC]['Target Achived Less 80%'] = $targetNotAchive80;
							 echo "<br />";
							echo "Agents Achived less than 80% of Target   ".$targetNotAchive80; */
							/* if($qt != 'No')
							{
							
							$targetNotAchiveD = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTargetD = round(($AgentTarget/100)*$qt);
								if($_tdata->agent_product == 'CARD')
								{
									if($agentTargetD > $_tdata->tc_card)
									{
										$targetNotAchiveD++;
									}
								}
								else
								{
									if($agentTargetD > $_tdata->final_loan_amount)
									{
										$targetNotAchiveD++;
									}
								}
							}
							echo "<br />";
							echo "Agents Achived less than ".$qt."% of Target   ".$targetNotAchiveD;
							} */
							/* $graphArray[$indexC]['Historical Agents in Cards'] = $totalCardsCount; */
							/* echo "<br />";
							echo "Total Agents in Card ".$totalCardsCount;
							echo "<br />";
							echo "Total Agents in loan ".$totalLoanCount;*/
							if($totalCardsCount >0)
							{
								$graphArray[$indexC]['Historical Core Team Productivity (Cards)'] = round($totalCards/$totalCardsCount,2);
								/* echo "<br />";
								echo "Core Team Productivity (Cards) ".round($totalCards/$totalCardsCount,2); */
							}
							else
							{
								$graphArray[$indexC]['Historical Core Team Productivity (Cards)'] = 0;
								/* echo "<br />";
								echo "Core Team Productivity (Cards) 0"; */
							}
							/*
							if($totalLoanCount >0)
							{
								echo "<br />";
								echo "Core Team Productivity (PLs) ".round($totalLoan/$totalLoanCount,2);
							}
							else
							{
								echo "<br />";
								echo "Core Team Productivity (PLs) 0";
							}
							*/
							if($totalCardsCount >0)
							{
								$graphArray[$indexC]['Historical Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
								/* echo "<br />";
								echo "Team Cards Productivity (Cards including XS) ".round($totalCardsCS/$totalCardsCount,2); */
							}
							else
							{
								$graphArray[$indexC]['Historical Team Cards Productivity (Cards including XS)'] = 0;
								/* echo "<br />";
								echo "Team Cards Productivity (Cards including XS) 0"; */

							}
							/*
							if($totalLoanCount >0)
							{
								echo "<br />";
								echo "Team Loan Productivity (Loan including XS) ".round($totalLoanCS/$totalLoanCount,2);
							}
							else
							{
								echo "<br />";
								echo "Team Loan Productivity (Loan including XS) 0";
							}*/
							if($totalCardsCS >0)
							{
								$graphArray[$indexC]['Historical XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
								/* echo "<br />";
								echo "XS (Card)  ".round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%'; */
							}
							else
							{
								$graphArray[$indexC]['Historical XS (Card)'] = '0%';
								/* echo "<br />";
								echo "XS (Card)  0%"; */

							}
							/*
							if($totalLoanCS >0)
							{
							echo "<br />";
							echo "XS (Loan)   ".round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
							}
							else
							{
								echo "<br />";
							echo "XS (Loan)   0%";
							}
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "Total Cards with XS -".$totalCardsCS;
							echo "<br />";
							echo "Total Cards By Loan Agent -".$totalCardsCSOnly;
							echo "<br />";
							echo "Total Loan with XS -".$totalLoanCS;
							echo "<br />";
							echo "Total Loan By Card Agent -".$totalLoanCSOnly; */
							/*
							*count dynamic target not achive
							*/
							
								/* if($agentId != "No")
								{
										$agentDetails = AgentPayout::where("id",$agentId)->first();
										if($agentDetails != '')
										{
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
											echo "<br />";
											echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
											echo "<br />";
											echo "Agent Target   <b>".$agentDetails->agent_target.'</b>';
											echo "<br />";
											echo "Agent Product   <b>".$agentDetails->agent_product.'</b>';
											echo "<br />";
											
											if($agentDetails->agent_product == 'CARD')
											{
												echo "Agent CARD   <b>".$agentDetails->tc_card.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->tc_card/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
											else
											{
												echo "Agent Loan AED<b>".$agentDetails->final_loan_amount.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->final_loan_amount/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
										}
										else
										{
											echo "Agent not found";
										}
										
								} */
								/*
								*count dynamic target not achive
								*/
							}
							else
							{
									/* $graphArray[$indexC]['Historical Total Agents'] = 0; */
								/* $graphArray[$indexC]['Historical Agents in Cards'] = 0; */
							
								$graphArray[$indexC]['Historical Core Team Productivity (Cards)'] = 0;
								
								$graphArray[$indexC]['Historical Team Cards Productivity (Cards including XS)'] = 0;
							
								$graphArray[$indexC]['Historical XS (Card)'] = 0;
							}
							
							return $graphArray;
}
protected function getDataAsXS_Loan_ENBD($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
{
	if($teamleaderwithout != "yes")
	{
	$indexC = 0;
					$graphArray = array();
					foreach($tl_name_array as $tl_name)
					{
						$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						$graphArray[$indexC]['TL Name'] = $tl_name;
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
							$targetNotAchive80 = 0;
							$totalCards = 0;
							$totalCardsCS = 0;
							$totalCardsCSOnly = 0;
							$totalCardsCount = 0;
						
							
							$totalLoan = 0;
							$totalLoanCount = 0;
							
							$totalLoanCS = 0;
							$totalLoanCSOnly = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTarget80 = round(($AgentTarget/100)*80);
								$totalCardsCS = $totalCardsCS+$_tdata->tc_card;
								
								
								$totalLoanCS = $totalLoanCS+$_tdata->final_loan_amount;
								
								if($_tdata->agent_product == 'CARD')
								{
									$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan_amount;
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsCount++;
									if($agentTarget80 > $_tdata->tc_card)
									{
										$targetNotAchive80++;
									}
								}
								else
								{
									$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->tc_card;
									$totalLoan = $totalLoan+$_tdata->final_loan_amount;
									$totalLoanCount++;
									if($agentTarget80 > $_tdata->final_loan_amount)
									{
										$targetNotAchive80++;
									}
								}
							}
							/*
							*count 80% target not achive
							*/
							
							/*
							*candidate count achived target
							*/
							$achivedCandidate = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								if($_tdata->agent_product == 'CARDS')
								{
									if($AgentTarget <= $_tdata->tc_card)
									{
										$achivedCandidate++;
									}
								}
								else
								{
									if($AgentTarget <= $_tdata->final_loan_amount)
									{
										$achivedCandidate++;
									}
								}
							}
							/*
							*candidate count achived target
							*/
							 if(count($salesTimeArray) == 1)
								{
									$graphArray[$indexC]['Total Agents'] = count($allMashreqData);
									$graphArray[$indexC]['Agents in Loan'] = $totalLoanCount;
								}
							/*$graphArray[$indexC]['Target Achived'] = $achivedCandidate; */
							/* echo "Total Agents Head Count  ".count($allMashreqData);
							echo "<br />";
							echo "Agent Count who achived their Target  ".$achivedCandidate; */
							if(count($allMashreqData) >0)
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%"; */
							}
							else
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = "0%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  0%"; */
							}
							/*$graphArray[$indexC]['Target Achived Less 80%'] = $targetNotAchive80;
							 echo "<br />";
							echo "Agents Achived less than 80% of Target   ".$targetNotAchive80; */
							/* if($qt != 'No')
							{
							
							$targetNotAchiveD = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTargetD = round(($AgentTarget/100)*$qt);
								if($_tdata->agent_product == 'CARD')
								{
									if($agentTargetD > $_tdata->tc_card)
									{
										$targetNotAchiveD++;
									}
								}
								else
								{
									if($agentTargetD > $_tdata->final_loan_amount)
									{
										$targetNotAchiveD++;
									}
								}
							}
							echo "<br />";
							echo "Agents Achived less than ".$qt."% of Target   ".$targetNotAchiveD;
							} */
							
							/* echo "<br />";
							echo "Total Agents in Card ".$totalCardsCount;
							echo "<br />";
							echo "Total Agents in loan ".$totalLoanCount;*/
							/* if($totalCardsCount >0)
							{
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = round($totalCards/$totalCardsCount,2);
								
							}
							else
							{
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
								
							} */
							
							if($totalLoanCount >0)
							{
								$graphArray[$indexC]['Core Team Productivity (Loan)'] = round($totalLoan/$totalLoanCount,2);
								/* echo "<br />";
								echo "Core Team Productivity (PLs) ".round($totalLoan/$totalLoanCount,2); */
							}
							else
							{
								$graphArray[$indexC]['Core Team Productivity (Loan)'] = 0;
								/* echo "<br />";
								echo "Core Team Productivity (PLs) 0"; */
							}
							
							/* if($totalCardsCount >0)
							{
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
								
							}
							else
							{
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
								

							} */
							
							if($totalLoanCount >0)
							{
								$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = round($totalLoanCS/$totalLoanCount,2);
								/* echo "<br />";
								echo "Team Loan Productivity (Loan including XS) ".round($totalLoanCS/$totalLoanCount,2); */
							}
							else
							{
								$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = 0;
								/* echo "<br />";
								echo "Team Loan Productivity (Loan including XS) 0"; */
							}
							/* if($totalCardsCS >0)
							{
								$graphArray[$indexC]['XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
							
							}
							else
							{
								$graphArray[$indexC]['XS (Card)'] = '0%';
								

							} */
							
							if($totalLoanCS >0)
							{
								$graphArray[$indexC]['XS (Loan)'] = round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
							/* echo "<br />";
							echo "XS (Loan)   ".round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%'; */
							}
							else
							{
								$graphArray[$indexC]['XS (Loan)'] = '0%';
								/* echo "<br />";
							echo "XS (Loan)   0%"; */
							}
							/*echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "Total Cards with XS -".$totalCardsCS;
							echo "<br />";
							echo "Total Cards By Loan Agent -".$totalCardsCSOnly;
							echo "<br />";
							echo "Total Loan with XS -".$totalLoanCS;
							echo "<br />";
							echo "Total Loan By Card Agent -".$totalLoanCSOnly; */
							/*
							*count dynamic target not achive
							*/
							
								/* if($agentId != "No")
								{
										$agentDetails = AgentPayout::where("id",$agentId)->first();
										if($agentDetails != '')
										{
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
											echo "<br />";
											echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
											echo "<br />";
											echo "Agent Target   <b>".$agentDetails->agent_target.'</b>';
											echo "<br />";
											echo "Agent Product   <b>".$agentDetails->agent_product.'</b>';
											echo "<br />";
											
											if($agentDetails->agent_product == 'CARD')
											{
												echo "Agent CARD   <b>".$agentDetails->tc_card.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->tc_card/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
											else
											{
												echo "Agent Loan AED<b>".$agentDetails->final_loan_amount.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->final_loan_amount/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
										}
										else
										{
											echo "Agent not found";
										}
										
								} */
								/*
								*count dynamic target not achive
								*/
							}
							else
							{
								 if(count($salesTimeArray) == 1)
									{
									$graphArray[$indexC]['Total Agents'] = 0;
									$graphArray[$indexC]['Agents in Loan'] = 0;
									}
								
								
								$graphArray[$indexC]['Core Team Productivity (Loan)'] = 0;
								
								$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = 0;
							
								$graphArray[$indexC]['XS (Loan)'] = 0;
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsXS_Loan_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
					}
					
					$graphArrayM[$indexC] = $this->getDataAsXS_Loan_ENBDTotal($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
					/* echo "<pre>";
					print_r($graphArray);
					exit; */
					return $graphArrayM;
	}
	else
	{
		$indexC = 0;
					$graphArray = array();
					$tl_name = '';
					
					if(count($salesTimeArray) == 1 && $vintage_name_SI != 'No')
					{
					/*
					*Report as per Vintage
					*Start code
					*/
					$vintage_name_SIArray = explode(",",$vintage_name_SI);
					foreach($vintage_name_SIArray as $vintage)
					{
						$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id = ".$vintage;
							}
							else
							{
								$whereRaw .= " AND range_id = ".$vintage;
							}
							$graphArray[$indexC]['Vintage'] = $vintage;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
							$targetNotAchive80 = 0;
							$totalCards = 0;
							$totalCardsCS = 0;
							$totalCardsCSOnly = 0;
							$totalCardsCount = 0;
						
							
							$totalLoan = 0;
							$totalLoanCount = 0;
							
							$totalLoanCS = 0;
							$totalLoanCSOnly = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTarget80 = round(($AgentTarget/100)*80);
								$totalCardsCS = $totalCardsCS+$_tdata->tc_card;
								
								
								$totalLoanCS = $totalLoanCS+$_tdata->final_loan_amount;
								
								if($_tdata->agent_product == 'CARD')
								{
									$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan_amount;
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsCount++;
									if($agentTarget80 > $_tdata->tc_card)
									{
										$targetNotAchive80++;
									}
								}
								else
								{
									$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->tc_card;
									$totalLoan = $totalLoan+$_tdata->final_loan_amount;
									$totalLoanCount++;
									if($agentTarget80 > $_tdata->final_loan_amount)
									{
										$targetNotAchive80++;
									}
								}
							}
							/*
							*count 80% target not achive
							*/
							
							/*
							*candidate count achived target
							*/
							$achivedCandidate = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								if($_tdata->agent_product == 'CARDS')
								{
									if($AgentTarget <= $_tdata->tc_card)
									{
										$achivedCandidate++;
									}
								}
								else
								{
									if($AgentTarget <= $_tdata->final_loan_amount)
									{
										$achivedCandidate++;
									}
								}
							}
							/*
							*candidate count achived target
							*/
							 if(count($salesTimeArray) == 1)
								{
									$graphArray[$indexC]['Total Agents'] = count($allMashreqData);
									$graphArray[$indexC]['Agents in Loan'] = $totalLoanCount;
								}
							/*$graphArray[$indexC]['Target Achived'] = $achivedCandidate; */
							/* echo "Total Agents Head Count  ".count($allMashreqData);
							echo "<br />";
							echo "Agent Count who achived their Target  ".$achivedCandidate; */
							if(count($allMashreqData) >0)
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%"; */
							}
							else
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = "0%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  0%"; */
							}
							/*$graphArray[$indexC]['Target Achived Less 80%'] = $targetNotAchive80;
							 echo "<br />";
							echo "Agents Achived less than 80% of Target   ".$targetNotAchive80; */
							/* if($qt != 'No')
							{
							
							$targetNotAchiveD = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTargetD = round(($AgentTarget/100)*$qt);
								if($_tdata->agent_product == 'CARD')
								{
									if($agentTargetD > $_tdata->tc_card)
									{
										$targetNotAchiveD++;
									}
								}
								else
								{
									if($agentTargetD > $_tdata->final_loan_amount)
									{
										$targetNotAchiveD++;
									}
								}
							}
							echo "<br />";
							echo "Agents Achived less than ".$qt."% of Target   ".$targetNotAchiveD;
							} */
							
							/* echo "<br />";
							echo "Total Agents in Card ".$totalCardsCount;
							echo "<br />";
							echo "Total Agents in loan ".$totalLoanCount;*/
							/* if($totalCardsCount >0)
							{
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = round($totalCards/$totalCardsCount,2);
								
							}
							else
							{
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
								
							} */
							
							if($totalLoanCount >0)
							{
								$graphArray[$indexC]['Core Team Productivity (Loan)'] = round($totalLoan/$totalLoanCount,2);
								/* echo "<br />";
								echo "Core Team Productivity (PLs) ".round($totalLoan/$totalLoanCount,2); */
							}
							else
							{
								$graphArray[$indexC]['Core Team Productivity (Loan)'] = 0;
								/* echo "<br />";
								echo "Core Team Productivity (PLs) 0"; */
							}
							
							/* if($totalCardsCount >0)
							{
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
								
							}
							else
							{
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
								

							} */
							
							if($totalLoanCount >0)
							{
								$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = round($totalLoanCS/$totalLoanCount,2);
								/* echo "<br />";
								echo "Team Loan Productivity (Loan including XS) ".round($totalLoanCS/$totalLoanCount,2); */
							}
							else
							{
								$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = 0;
								/* echo "<br />";
								echo "Team Loan Productivity (Loan including XS) 0"; */
							}
							/* if($totalCardsCS >0)
							{
								$graphArray[$indexC]['XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
							
							}
							else
							{
								$graphArray[$indexC]['XS (Card)'] = '0%';
								

							} */
							
							if($totalLoanCS >0)
							{
								$graphArray[$indexC]['XS (Loan)'] = round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
							/* echo "<br />";
							echo "XS (Loan)   ".round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%'; */
							}
							else
							{
								$graphArray[$indexC]['XS (Loan)'] = '0%';
								/* echo "<br />";
							echo "XS (Loan)   0%"; */
							}
							/*echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "Total Cards with XS -".$totalCardsCS;
							echo "<br />";
							echo "Total Cards By Loan Agent -".$totalCardsCSOnly;
							echo "<br />";
							echo "Total Loan with XS -".$totalLoanCS;
							echo "<br />";
							echo "Total Loan By Card Agent -".$totalLoanCSOnly; */
							/*
							*count dynamic target not achive
							*/
							
								/* if($agentId != "No")
								{
										$agentDetails = AgentPayout::where("id",$agentId)->first();
										if($agentDetails != '')
										{
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
											echo "<br />";
											echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
											echo "<br />";
											echo "Agent Target   <b>".$agentDetails->agent_target.'</b>';
											echo "<br />";
											echo "Agent Product   <b>".$agentDetails->agent_product.'</b>';
											echo "<br />";
											
											if($agentDetails->agent_product == 'CARD')
											{
												echo "Agent CARD   <b>".$agentDetails->tc_card.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->tc_card/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
											else
											{
												echo "Agent Loan AED<b>".$agentDetails->final_loan_amount.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->final_loan_amount/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
										}
										else
										{
											echo "Agent not found";
										}
										
								} */
								/*
								*count dynamic target not achive
								*/
							}
							else
							{
								 if(count($salesTimeArray) == 1)
									{
									  $graphArray[$indexC]['Total Agents'] = 0;
									  $graphArray[$indexC]['Agents in Loan'] = 0;
									}
								
								
								$graphArray[$indexC]['Core Team Productivity (Loan)'] = 0;
								
								$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = 0;
							
								$graphArray[$indexC]['XS (Loan)'] = 0;
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsXS_Loan_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
					}
					
					
					/*
					*Report as per Vintage
					*Start code
					*/
					}
					else
					{
					/*
					*Report as per sales time
					*Start code
					*/
					foreach($salesTimeArray as $_salesT)
					{
						$graphArray[$indexC]['Sales Time'] = $_salesT;
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->where("sales_time",$_salesT)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->where("sales_time",$_salesT)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
							$targetNotAchive80 = 0;
							$totalCards = 0;
							$totalCardsCS = 0;
							$totalCardsCSOnly = 0;
							$totalCardsCount = 0;
						
							
							$totalLoan = 0;
							$totalLoanCount = 0;
							
							$totalLoanCS = 0;
							$totalLoanCSOnly = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTarget80 = round(($AgentTarget/100)*80);
								$totalCardsCS = $totalCardsCS+$_tdata->tc_card;
								
								
								$totalLoanCS = $totalLoanCS+$_tdata->final_loan_amount;
								
								if($_tdata->agent_product == 'CARD')
								{
									$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan_amount;
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsCount++;
									if($agentTarget80 > $_tdata->tc_card)
									{
										$targetNotAchive80++;
									}
								}
								else
								{
									$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->tc_card;
									$totalLoan = $totalLoan+$_tdata->final_loan_amount;
									$totalLoanCount++;
									if($agentTarget80 > $_tdata->final_loan_amount)
									{
										$targetNotAchive80++;
									}
								}
							}
							/*
							*count 80% target not achive
							*/
							
							/*
							*candidate count achived target
							*/
							$achivedCandidate = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								if($_tdata->agent_product == 'CARDS')
								{
									if($AgentTarget <= $_tdata->tc_card)
									{
										$achivedCandidate++;
									}
								}
								else
								{
									if($AgentTarget <= $_tdata->final_loan_amount)
									{
										$achivedCandidate++;
									}
								}
							}
							/*
							*candidate count achived target
							*/
							 if(count($salesTimeArray) == 1)
								{
									$graphArray[$indexC]['Total Agents'] = count($allMashreqData);
									$graphArray[$indexC]['Agents in Loan'] = $totalLoanCount;
								}
							/*$graphArray[$indexC]['Target Achived'] = $achivedCandidate; */
							/* echo "Total Agents Head Count  ".count($allMashreqData);
							echo "<br />";
							echo "Agent Count who achived their Target  ".$achivedCandidate; */
							if(count($allMashreqData) >0)
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%"; */
							}
							else
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = "0%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  0%"; */
							}
							/*$graphArray[$indexC]['Target Achived Less 80%'] = $targetNotAchive80;
							 echo "<br />";
							echo "Agents Achived less than 80% of Target   ".$targetNotAchive80; */
							/* if($qt != 'No')
							{
							
							$targetNotAchiveD = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTargetD = round(($AgentTarget/100)*$qt);
								if($_tdata->agent_product == 'CARD')
								{
									if($agentTargetD > $_tdata->tc_card)
									{
										$targetNotAchiveD++;
									}
								}
								else
								{
									if($agentTargetD > $_tdata->final_loan_amount)
									{
										$targetNotAchiveD++;
									}
								}
							}
							echo "<br />";
							echo "Agents Achived less than ".$qt."% of Target   ".$targetNotAchiveD;
							} */
							
							/* echo "<br />";
							echo "Total Agents in Card ".$totalCardsCount;
							echo "<br />";
							echo "Total Agents in loan ".$totalLoanCount;*/
							/* if($totalCardsCount >0)
							{
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = round($totalCards/$totalCardsCount,2);
								
							}
							else
							{
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
								
							} */
							
							if($totalLoanCount >0)
							{
								$graphArray[$indexC]['Core Team Productivity (Loan)'] = round($totalLoan/$totalLoanCount,2);
								/* echo "<br />";
								echo "Core Team Productivity (PLs) ".round($totalLoan/$totalLoanCount,2); */
							}
							else
							{
								$graphArray[$indexC]['Core Team Productivity (Loan)'] = 0;
								/* echo "<br />";
								echo "Core Team Productivity (PLs) 0"; */
							}
							
							/* if($totalCardsCount >0)
							{
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
								
							}
							else
							{
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
								

							} */
							
							if($totalLoanCount >0)
							{
								$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = round($totalLoanCS/$totalLoanCount,2);
								/* echo "<br />";
								echo "Team Loan Productivity (Loan including XS) ".round($totalLoanCS/$totalLoanCount,2); */
							}
							else
							{
								$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = 0;
								/* echo "<br />";
								echo "Team Loan Productivity (Loan including XS) 0"; */
							}
							/* if($totalCardsCS >0)
							{
								$graphArray[$indexC]['XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
							
							}
							else
							{
								$graphArray[$indexC]['XS (Card)'] = '0%';
								

							} */
							
							if($totalLoanCS >0)
							{
								$graphArray[$indexC]['XS (Loan)'] = round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
							/* echo "<br />";
							echo "XS (Loan)   ".round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%'; */
							}
							else
							{
								$graphArray[$indexC]['XS (Loan)'] = '0%';
								/* echo "<br />";
							echo "XS (Loan)   0%"; */
							}
							/*echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "Total Cards with XS -".$totalCardsCS;
							echo "<br />";
							echo "Total Cards By Loan Agent -".$totalCardsCSOnly;
							echo "<br />";
							echo "Total Loan with XS -".$totalLoanCS;
							echo "<br />";
							echo "Total Loan By Card Agent -".$totalLoanCSOnly; */
							/*
							*count dynamic target not achive
							*/
							
								/* if($agentId != "No")
								{
										$agentDetails = AgentPayout::where("id",$agentId)->first();
										if($agentDetails != '')
										{
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
											echo "<br />";
											echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
											echo "<br />";
											echo "Agent Target   <b>".$agentDetails->agent_target.'</b>';
											echo "<br />";
											echo "Agent Product   <b>".$agentDetails->agent_product.'</b>';
											echo "<br />";
											
											if($agentDetails->agent_product == 'CARD')
											{
												echo "Agent CARD   <b>".$agentDetails->tc_card.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->tc_card/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
											else
											{
												echo "Agent Loan AED<b>".$agentDetails->final_loan_amount.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->final_loan_amount/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
										}
										else
										{
											echo "Agent not found";
										}
										
								} */
								/*
								*count dynamic target not achive
								*/
							}
							else
							{
								 if(count($salesTimeArray) == 1)
									{
									  $graphArray[$indexC]['Total Agents'] = 0;
									  $graphArray[$indexC]['Agents in Loan'] = 0;
									}
								
								
								$graphArray[$indexC]['Core Team Productivity (Loan)'] = 0;
								
								$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = 0;
							
								$graphArray[$indexC]['XS (Loan)'] = 0;
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsXS_Loan_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
					}
					/*
					*Report as per sales time
					*end code
					*/
					}
						$graphArray[$indexC]['Sales Time'] = "Total";
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
							$targetNotAchive80 = 0;
							$totalCards = 0;
							$totalCardsCS = 0;
							$totalCardsCSOnly = 0;
							$totalCardsCount = 0;
						
							
							$totalLoan = 0;
							$totalLoanCount = 0;
							
							$totalLoanCS = 0;
							$totalLoanCSOnly = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTarget80 = round(($AgentTarget/100)*80);
								$totalCardsCS = $totalCardsCS+$_tdata->tc_card;
								
								
								$totalLoanCS = $totalLoanCS+$_tdata->final_loan_amount;
								
								if($_tdata->agent_product == 'CARD')
								{
									$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan_amount;
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsCount++;
									if($agentTarget80 > $_tdata->tc_card)
									{
										$targetNotAchive80++;
									}
								}
								else
								{
									$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->tc_card;
									$totalLoan = $totalLoan+$_tdata->final_loan_amount;
									$totalLoanCount++;
									if($agentTarget80 > $_tdata->final_loan_amount)
									{
										$targetNotAchive80++;
									}
								}
							}
							/*
							*count 80% target not achive
							*/
							
							/*
							*candidate count achived target
							*/
							$achivedCandidate = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								if($_tdata->agent_product == 'CARDS')
								{
									if($AgentTarget <= $_tdata->tc_card)
									{
										$achivedCandidate++;
									}
								}
								else
								{
									if($AgentTarget <= $_tdata->final_loan_amount)
									{
										$achivedCandidate++;
									}
								}
							}
							/*
							*candidate count achived target
							*/
							 if(count($salesTimeArray) == 1)
								{
									$graphArray[$indexC]['Total Agents'] = count($allMashreqData);
									$graphArray[$indexC]['Agents in Loan'] = $totalLoanCount;
								}
							/*$graphArray[$indexC]['Target Achived'] = $achivedCandidate; */
							/* echo "Total Agents Head Count  ".count($allMashreqData);
							echo "<br />";
							echo "Agent Count who achived their Target  ".$achivedCandidate; */
							if(count($allMashreqData) >0)
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%"; */
							}
							else
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = "0%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  0%"; */
							}
							/*$graphArray[$indexC]['Target Achived Less 80%'] = $targetNotAchive80;
							 echo "<br />";
							echo "Agents Achived less than 80% of Target   ".$targetNotAchive80; */
							/* if($qt != 'No')
							{
							
							$targetNotAchiveD = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTargetD = round(($AgentTarget/100)*$qt);
								if($_tdata->agent_product == 'CARD')
								{
									if($agentTargetD > $_tdata->tc_card)
									{
										$targetNotAchiveD++;
									}
								}
								else
								{
									if($agentTargetD > $_tdata->final_loan_amount)
									{
										$targetNotAchiveD++;
									}
								}
							}
							echo "<br />";
							echo "Agents Achived less than ".$qt."% of Target   ".$targetNotAchiveD;
							} */
							
							/* echo "<br />";
							echo "Total Agents in Card ".$totalCardsCount;
							echo "<br />";
							echo "Total Agents in loan ".$totalLoanCount;*/
							/* if($totalCardsCount >0)
							{
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = round($totalCards/$totalCardsCount,2);
								
							}
							else
							{
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
								
							} */
							
							if($totalLoanCount >0)
							{
								$graphArray[$indexC]['Core Team Productivity (Loan)'] = round($totalLoan/$totalLoanCount,2);
								/* echo "<br />";
								echo "Core Team Productivity (PLs) ".round($totalLoan/$totalLoanCount,2); */
							}
							else
							{
								$graphArray[$indexC]['Core Team Productivity (Loan)'] = 0;
								/* echo "<br />";
								echo "Core Team Productivity (PLs) 0"; */
							}
							
							/* if($totalCardsCount >0)
							{
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
								
							}
							else
							{
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
								

							} */
							
							if($totalLoanCount >0)
							{
								$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = round($totalLoanCS/$totalLoanCount,2);
								/* echo "<br />";
								echo "Team Loan Productivity (Loan including XS) ".round($totalLoanCS/$totalLoanCount,2); */
							}
							else
							{
								$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = 0;
								/* echo "<br />";
								echo "Team Loan Productivity (Loan including XS) 0"; */
							}
							/* if($totalCardsCS >0)
							{
								$graphArray[$indexC]['XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
							
							}
							else
							{
								$graphArray[$indexC]['XS (Card)'] = '0%';
								

							} */
							
							if($totalLoanCS >0)
							{
								$graphArray[$indexC]['XS (Loan)'] = round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
							/* echo "<br />";
							echo "XS (Loan)   ".round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%'; */
							}
							else
							{
								$graphArray[$indexC]['XS (Loan)'] = '0%';
								/* echo "<br />";
							echo "XS (Loan)   0%"; */
							}
							/*echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "Total Cards with XS -".$totalCardsCS;
							echo "<br />";
							echo "Total Cards By Loan Agent -".$totalCardsCSOnly;
							echo "<br />";
							echo "Total Loan with XS -".$totalLoanCS;
							echo "<br />";
							echo "Total Loan By Card Agent -".$totalLoanCSOnly; */
							/*
							*count dynamic target not achive
							*/
							
								/* if($agentId != "No")
								{
										$agentDetails = AgentPayout::where("id",$agentId)->first();
										if($agentDetails != '')
										{
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
											echo "<br />";
											echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
											echo "<br />";
											echo "Agent Target   <b>".$agentDetails->agent_target.'</b>';
											echo "<br />";
											echo "Agent Product   <b>".$agentDetails->agent_product.'</b>';
											echo "<br />";
											
											if($agentDetails->agent_product == 'CARD')
											{
												echo "Agent CARD   <b>".$agentDetails->tc_card.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->tc_card/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
											else
											{
												echo "Agent Loan AED<b>".$agentDetails->final_loan_amount.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->final_loan_amount/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
										}
										else
										{
											echo "Agent not found";
										}
										
								} */
								/*
								*count dynamic target not achive
								*/
							}
							else
							{
								 if(count($salesTimeArray) == 1)
									{
									  $graphArray[$indexC]['Total Agents'] = 0;
									  $graphArray[$indexC]['Agents in Loan'] = 0;
									}
								
								
								$graphArray[$indexC]['Core Team Productivity (Loan)'] = 0;
								
								$graphArray[$indexC]['Team Loan Productivity (Loan including XS)'] = 0;
							
								$graphArray[$indexC]['XS (Loan)'] = 0;
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsXS_Loan_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
					/* echo "<pre>";
					print_r($graphArray);
					exit; */
					return $graphArrayM;
	}
}

protected function getDataAsXS_Loan_ENBDTotal($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
{
	
	$graphArray = array();
					
						$graphArray['Sales Time'] = "Total";
						$graphArray['TL Name'] = "";
						$graphArray['Bank'] = "ENBD";
						
						$whereRaw = '';
						
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereIn("tl_name",$tl_name_array)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
							$targetNotAchive80 = 0;
							$totalCards = 0;
							$totalCardsCS = 0;
							$totalCardsCSOnly = 0;
							$totalCardsCount = 0;
						
							
							$totalLoan = 0;
							$totalLoanCount = 0;
							
							$totalLoanCS = 0;
							$totalLoanCSOnly = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTarget80 = round(($AgentTarget/100)*80);
								$totalCardsCS = $totalCardsCS+$_tdata->tc_card;
								
								
								$totalLoanCS = $totalLoanCS+$_tdata->final_loan_amount;
								
								if($_tdata->agent_product == 'CARD')
								{
									$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan_amount;
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsCount++;
									if($agentTarget80 > $_tdata->tc_card)
									{
										$targetNotAchive80++;
									}
								}
								else
								{
									$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->tc_card;
									$totalLoan = $totalLoan+$_tdata->final_loan_amount;
									$totalLoanCount++;
									if($agentTarget80 > $_tdata->final_loan_amount)
									{
										$targetNotAchive80++;
									}
								}
							}
							/*
							*count 80% target not achive
							*/
							
							/*
							*candidate count achived target
							*/
							$achivedCandidate = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								if($_tdata->agent_product == 'CARDS')
								{
									if($AgentTarget <= $_tdata->tc_card)
									{
										$achivedCandidate++;
									}
								}
								else
								{
									if($AgentTarget <= $_tdata->final_loan_amount)
									{
										$achivedCandidate++;
									}
								}
							}
							/*
							*candidate count achived target
							*/
							 if(count($salesTimeArray) == 1)
								{
									$graphArray['Total Agents'] = count($allMashreqData);
									$graphArray['Agents in Loan'] = $totalLoanCount;
								}
							/*$graphArray[$indexC]['Target Achived'] = $achivedCandidate; */
							/* echo "Total Agents Head Count  ".count($allMashreqData);
							echo "<br />";
							echo "Agent Count who achived their Target  ".$achivedCandidate; */
							if(count($allMashreqData) >0)
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%"; */
							}
							else
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = "0%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  0%"; */
							}
							/*$graphArray[$indexC]['Target Achived Less 80%'] = $targetNotAchive80;
							 echo "<br />";
							echo "Agents Achived less than 80% of Target   ".$targetNotAchive80; */
							/* if($qt != 'No')
							{
							
							$targetNotAchiveD = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTargetD = round(($AgentTarget/100)*$qt);
								if($_tdata->agent_product == 'CARD')
								{
									if($agentTargetD > $_tdata->tc_card)
									{
										$targetNotAchiveD++;
									}
								}
								else
								{
									if($agentTargetD > $_tdata->final_loan_amount)
									{
										$targetNotAchiveD++;
									}
								}
							}
							echo "<br />";
							echo "Agents Achived less than ".$qt."% of Target   ".$targetNotAchiveD;
							} */
							
							/* echo "<br />";
							echo "Total Agents in Card ".$totalCardsCount;
							echo "<br />";
							echo "Total Agents in loan ".$totalLoanCount;*/
							/* if($totalCardsCount >0)
							{
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = round($totalCards/$totalCardsCount,2);
								
							}
							else
							{
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
								
							} */
							
							if($totalLoanCount >0)
							{
								$graphArray['Core Team Productivity (Loan)'] = round($totalLoan/$totalLoanCount,2);
								/* echo "<br />";
								echo "Core Team Productivity (PLs) ".round($totalLoan/$totalLoanCount,2); */
							}
							else
							{
								$graphArray['Core Team Productivity (Loan)'] = 0;
								/* echo "<br />";
								echo "Core Team Productivity (PLs) 0"; */
							}
							
							/* if($totalCardsCount >0)
							{
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
								
							}
							else
							{
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
								

							} */
							
							if($totalLoanCount >0)
							{
								$graphArray['Team Loan Productivity (Loan including XS)'] = round($totalLoanCS/$totalLoanCount,2);
								/* echo "<br />";
								echo "Team Loan Productivity (Loan including XS) ".round($totalLoanCS/$totalLoanCount,2); */
							}
							else
							{
								$graphArray['Team Loan Productivity (Loan including XS)'] = 0;
								/* echo "<br />";
								echo "Team Loan Productivity (Loan including XS) 0"; */
							}
							/* if($totalCardsCS >0)
							{
								$graphArray[$indexC]['XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
							
							}
							else
							{
								$graphArray[$indexC]['XS (Card)'] = '0%';
								

							} */
							
							if($totalLoanCS >0)
							{
								$graphArray['XS (Loan)'] = round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
							/* echo "<br />";
							echo "XS (Loan)   ".round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%'; */
							}
							else
							{
								$graphArray['XS (Loan)'] = '0%';
								/* echo "<br />";
							echo "XS (Loan)   0%"; */
							}
							/*echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "Total Cards with XS -".$totalCardsCS;
							echo "<br />";
							echo "Total Cards By Loan Agent -".$totalCardsCSOnly;
							echo "<br />";
							echo "Total Loan with XS -".$totalLoanCS;
							echo "<br />";
							echo "Total Loan By Card Agent -".$totalLoanCSOnly; */
							/*
							*count dynamic target not achive
							*/
							
								/* if($agentId != "No")
								{
										$agentDetails = AgentPayout::where("id",$agentId)->first();
										if($agentDetails != '')
										{
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
											echo "<br />";
											echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
											echo "<br />";
											echo "Agent Target   <b>".$agentDetails->agent_target.'</b>';
											echo "<br />";
											echo "Agent Product   <b>".$agentDetails->agent_product.'</b>';
											echo "<br />";
											
											if($agentDetails->agent_product == 'CARD')
											{
												echo "Agent CARD   <b>".$agentDetails->tc_card.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->tc_card/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
											else
											{
												echo "Agent Loan AED<b>".$agentDetails->final_loan_amount.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->final_loan_amount/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
										}
										else
										{
											echo "Agent not found";
										}
										
								} */
								/*
								*count dynamic target not achive
								*/
							}
							else
							{
								 if(count($salesTimeArray) == 1)
									{
									$graphArray['Total Agents'] = 0;
									$graphArray['Agents in Loan'] = 0;
									}
								
								
								$graphArray['Core Team Productivity (Loan)'] = 0;
								
								$graphArray['Team Loan Productivity (Loan including XS)'] = 0;
							
								$graphArray['XS (Loan)'] = 0;
							}
							if($historical_data == "yes")
							{
								$graphArrayT = $this->getDataAsXS_Loan_ENBDHistroyTotal($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout);
								$graphArrayTD = array_merge($graphArray,$graphArrayT);
							}
							else
							{
								$graphArrayTD = $graphArray;
							}
							
					return $graphArrayTD;
}

protected function getDataAsXS_Loan_ENBDHistroyTotal($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout)
{
	
					
						
						
						$whereRaw = '';
												
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereraw($whereRaw)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
							$targetNotAchive80 = 0;
							$totalCards = 0;
							$totalCardsCS = 0;
							$totalCardsCSOnly = 0;
							$totalCardsCount = 0;
						
							
							$totalLoan = 0;
							$totalLoanCount = 0;
							
							$totalLoanCS = 0;
							$totalLoanCSOnly = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTarget80 = round(($AgentTarget/100)*80);
								$totalCardsCS = $totalCardsCS+$_tdata->tc_card;
								
								
								$totalLoanCS = $totalLoanCS+$_tdata->final_loan_amount;
								
								if($_tdata->agent_product == 'CARD')
								{
									$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan_amount;
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsCount++;
									if($agentTarget80 > $_tdata->tc_card)
									{
										$targetNotAchive80++;
									}
								}
								else
								{
									$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->tc_card;
									$totalLoan = $totalLoan+$_tdata->final_loan_amount;
									$totalLoanCount++;
									if($agentTarget80 > $_tdata->final_loan_amount)
									{
										$targetNotAchive80++;
									}
								}
							}
							/*
							*count 80% target not achive
							*/
							
							/*
							*candidate count achived target
							*/
							$achivedCandidate = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								if($_tdata->agent_product == 'CARDS')
								{
									if($AgentTarget <= $_tdata->tc_card)
									{
										$achivedCandidate++;
									}
								}
								else
								{
									if($AgentTarget <= $_tdata->final_loan_amount)
									{
										$achivedCandidate++;
									}
								}
							}
							/*
							*candidate count achived target
							*/
							
							 /* $graphArray[$indexC]['Historical Total Agents'] = count($allMashreqData); */
							/*$graphArray[$indexC]['Target Achived'] = $achivedCandidate; */
							/* echo "Total Agents Head Count  ".count($allMashreqData);
							echo "<br />";
							echo "Agent Count who achived their Target  ".$achivedCandidate; */
							if(count($allMashreqData) >0)
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%"; */
							}
							else
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = "0%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  0%"; */
							}
							
							
							
							
							if($totalLoanCount >0)
							{
								$graphArray['Historical Core Team Productivity (Loan)'] = round($totalLoan/$totalLoanCount,2);
								/* echo "<br />";
								echo "Core Team Productivity (PLs) ".round($totalLoan/$totalLoanCount,2); */
							}
							else
							{
								$graphArray['Historical Core Team Productivity (Loan)'] = 0;
								/* echo "<br />";
								echo "Core Team Productivity (PLs) 0"; */
							}
							
							/* if($totalCardsCount >0)
							{
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
								
							}
							else
							{
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
								

							} */
							
							if($totalLoanCount >0)
							{
								$graphArray['Historical Team Loan Productivity (Loan including XS)'] = round($totalLoanCS/$totalLoanCount,2);
								/* echo "<br />";
								echo "Team Loan Productivity (Loan including XS) ".round($totalLoanCS/$totalLoanCount,2); */
							}
							else
							{
								$graphArray['Historical Team Loan Productivity (Loan including XS)'] = 0;
								/* echo "<br />";
								echo "Team Loan Productivity (Loan including XS) 0"; */
							}
							/* if($totalCardsCS >0)
							{
								$graphArray[$indexC]['XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
							
							}
							else
							{
								$graphArray[$indexC]['XS (Card)'] = '0%';
								

							} */
							
							if($totalLoanCS >0)
							{
								$graphArray['Historical XS (Loan)'] = round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
							/* echo "<br />";
							echo "XS (Loan)   ".round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%'; */
							}
							else
							{
								$graphArray['Historical XS (Loan)'] = '0%';
								/* echo "<br />";
							echo "XS (Loan)   0%"; */
							}
							
							/*
							*count dynamic target not achive
							*/
							
								
								/*
								*count dynamic target not achive
								*/
							}
							else
							{								
								$graphArray['Historical Core Team Productivity (Loan)'] = 0;
								
								$graphArray['Historical Team Loan Productivity (Loan including XS)'] = 0;
							
								$graphArray['Historical XS (Loan)'] = 0;
							}
							
							return $graphArray;
}
protected function getDataAsXS_Loan_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC)
{
	
					
						
						
						$whereRaw = '';
						if($teamleaderwithout != "yes")
						{							
						 if($tl_name != 'No')
							{
								if($whereRaw == '')
								{
									$whereRaw = "tl_name = '".$tl_name."'";
								}
								else
								{
									$whereRaw .= " AND tl_name= '".$tl_name."'";
								}
							}
						}							
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
							$targetNotAchive80 = 0;
							$totalCards = 0;
							$totalCardsCS = 0;
							$totalCardsCSOnly = 0;
							$totalCardsCount = 0;
						
							
							$totalLoan = 0;
							$totalLoanCount = 0;
							
							$totalLoanCS = 0;
							$totalLoanCSOnly = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTarget80 = round(($AgentTarget/100)*80);
								$totalCardsCS = $totalCardsCS+$_tdata->tc_card;
								
								
								$totalLoanCS = $totalLoanCS+$_tdata->final_loan_amount;
								
								if($_tdata->agent_product == 'CARD')
								{
									$totalLoanCSOnly = $totalLoanCSOnly+$_tdata->final_loan_amount;
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsCount++;
									if($agentTarget80 > $_tdata->tc_card)
									{
										$targetNotAchive80++;
									}
								}
								else
								{
									$totalCardsCSOnly = $totalCardsCSOnly+$_tdata->tc_card;
									$totalLoan = $totalLoan+$_tdata->final_loan_amount;
									$totalLoanCount++;
									if($agentTarget80 > $_tdata->final_loan_amount)
									{
										$targetNotAchive80++;
									}
								}
							}
							/*
							*count 80% target not achive
							*/
							
							/*
							*candidate count achived target
							*/
							$achivedCandidate = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								if($_tdata->agent_product == 'CARDS')
								{
									if($AgentTarget <= $_tdata->tc_card)
									{
										$achivedCandidate++;
									}
								}
								else
								{
									if($AgentTarget <= $_tdata->final_loan_amount)
									{
										$achivedCandidate++;
									}
								}
							}
							/*
							*candidate count achived target
							*/
							
							 /* $graphArray[$indexC]['Historical Total Agents'] = count($allMashreqData); */
							/*$graphArray[$indexC]['Target Achived'] = $achivedCandidate; */
							/* echo "Total Agents Head Count  ".count($allMashreqData);
							echo "<br />";
							echo "Agent Count who achived their Target  ".$achivedCandidate; */
							if(count($allMashreqData) >0)
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = round(($achivedCandidate/count($allMashreqData)*100),2)."%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  ".round(($achivedCandidate/count($allMashreqData)*100),2)."%"; */
							}
							else
							{
								/*$graphArray[$indexC]['Target Achived (%)'] = "0%";
								 echo "<br />";
								echo "Agent Percentage who achived their Target  0%"; */
							}
							/*$graphArray[$indexC]['Target Achived Less 80%'] = $targetNotAchive80;
							 echo "<br />";
							echo "Agents Achived less than 80% of Target   ".$targetNotAchive80; */
							/* if($qt != 'No')
							{
							
							$targetNotAchiveD = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTargetD = round(($AgentTarget/100)*$qt);
								if($_tdata->agent_product == 'CARD')
								{
									if($agentTargetD > $_tdata->tc_card)
									{
										$targetNotAchiveD++;
									}
								}
								else
								{
									if($agentTargetD > $_tdata->final_loan_amount)
									{
										$targetNotAchiveD++;
									}
								}
							}
							echo "<br />";
							echo "Agents Achived less than ".$qt."% of Target   ".$targetNotAchiveD;
							} */
							/* $graphArray[$indexC]['Historical Agents in Loan'] = $totalLoanCount; */
							/* echo "<br />";
							echo "Total Agents in Card ".$totalCardsCount;
							echo "<br />";
							echo "Total Agents in loan ".$totalLoanCount;*/
							/* if($totalCardsCount >0)
							{
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = round($totalCards/$totalCardsCount,2);
								
							}
							else
							{
								$graphArray[$indexC]['Core Team Productivity (Cards)'] = 0;
								
							} */
							
							if($totalLoanCount >0)
							{
								$graphArray[$indexC]['Historical Core Team Productivity (Loan)'] = round($totalLoan/$totalLoanCount,2);
								/* echo "<br />";
								echo "Core Team Productivity (PLs) ".round($totalLoan/$totalLoanCount,2); */
							}
							else
							{
								$graphArray[$indexC]['Historical Core Team Productivity (Loan)'] = 0;
								/* echo "<br />";
								echo "Core Team Productivity (PLs) 0"; */
							}
							
							/* if($totalCardsCount >0)
							{
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = round($totalCardsCS/$totalCardsCount,2);
								
							}
							else
							{
								$graphArray[$indexC]['Team Cards Productivity (Cards including XS)'] = 0;
								

							} */
							
							if($totalLoanCount >0)
							{
								$graphArray[$indexC]['Historical Team Loan Productivity (Loan including XS)'] = round($totalLoanCS/$totalLoanCount,2);
								/* echo "<br />";
								echo "Team Loan Productivity (Loan including XS) ".round($totalLoanCS/$totalLoanCount,2); */
							}
							else
							{
								$graphArray[$indexC]['Historical Team Loan Productivity (Loan including XS)'] = 0;
								/* echo "<br />";
								echo "Team Loan Productivity (Loan including XS) 0"; */
							}
							/* if($totalCardsCS >0)
							{
								$graphArray[$indexC]['XS (Card)'] = round(($totalCardsCSOnly/$totalCardsCS)*100,2).'%';
							
							}
							else
							{
								$graphArray[$indexC]['XS (Card)'] = '0%';
								

							} */
							
							if($totalLoanCS >0)
							{
								$graphArray[$indexC]['Historical XS (Loan)'] = round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
							/* echo "<br />";
							echo "XS (Loan)   ".round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%'; */
							}
							else
							{
								$graphArray[$indexC]['Historical XS (Loan)'] = '0%';
								/* echo "<br />";
							echo "XS (Loan)   0%"; */
							}
							/*echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "Total Cards with XS -".$totalCardsCS;
							echo "<br />";
							echo "Total Cards By Loan Agent -".$totalCardsCSOnly;
							echo "<br />";
							echo "Total Loan with XS -".$totalLoanCS;
							echo "<br />";
							echo "Total Loan By Card Agent -".$totalLoanCSOnly; */
							/*
							*count dynamic target not achive
							*/
							
								/* if($agentId != "No")
								{
										$agentDetails = AgentPayout::where("id",$agentId)->first();
										if($agentDetails != '')
										{
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
											echo "<br />";
											echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
											echo "<br />";
											echo "Agent Target   <b>".$agentDetails->agent_target.'</b>';
											echo "<br />";
											echo "Agent Product   <b>".$agentDetails->agent_product.'</b>';
											echo "<br />";
											
											if($agentDetails->agent_product == 'CARD')
											{
												echo "Agent CARD   <b>".$agentDetails->tc_card.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->tc_card/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
											else
											{
												echo "Agent Loan AED<b>".$agentDetails->final_loan_amount.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->final_loan_amount/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
										}
										else
										{
											echo "Agent not found";
										}
										
								} */
								/*
								*count dynamic target not achive
								*/
							}
							else
							{
									/* $graphArray[$indexC]['Historical Total Agents'] = 0; */
								/* $graphArray[$indexC]['Historical Agents in Loan'] = 0; */
								
								$graphArray[$indexC]['Historical Core Team Productivity (Loan)'] = 0;
								
								$graphArray[$indexC]['Historical Team Loan Productivity (Loan including XS)'] = 0;
							
								$graphArray[$indexC]['Historical XS (Loan)'] = 0;
							}
							
							return $graphArray;
}
public function getDataAsmean_median_rev_ENBD($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
{
	if($teamleaderwithout != "yes")
	{
					$indexC = 0;
					$graphArray = array();
					foreach($tl_name_array as $tl_name)
					{
						$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						$graphArray[$indexC]['TL Name'] = $tl_name;
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
						
							
						}
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray[$indexC]['Total Revenue'] = "AED ".number_format($totalReveue);
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									  if(count($salesTimeArray) == 1)
										{
											 $graphArray[$indexC]['Total Head Count'] = $countR;
										}
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									 $graphArray[$indexC]['Mean'] = "AED ".number_format($avg);
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex < 0)
									 {
										 $medianIndex = 0;
									 }
									  $graphArray[$indexC]['median'] = "AED ".number_format($takeReveue[$medianIndex-1]);
									/*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />"; */
									  /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray[$indexC]['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
											 $graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['Mean'] = "AED 0";
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
									}
							}
							else
							{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
											 $graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['Mean'] = "AED 0";
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsmean_median_rev_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
					}
					$graphArrayM[$indexC] = $this->getDataAsmean_median_rev_ENBDTotal($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
					/* echo "<pre>";
					print_r($graphArray);
					exit; */
					return $graphArrayM;
	}
	else
	{
		$indexC = 0;
					$graphArray = array();
					
					if(count($salesTimeArray) == 1 && $vintage_name_SI != 'No')
					{
					/*
					*report as per vintage
					*coding start
					*/
					$vintage_name_SIArray = explode(",",$vintage_name_SI);
					
					foreach($vintage_name_SIArray as $vintage)
					{
						$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id = ".$vintage;
							}
							else
							{
								$whereRaw .= " AND range_id = ".$vintage;
							}
							$graphArray[$indexC]['Vintage'] = $vintage;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
								$tl_name = '';
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray[$indexC]['Total Revenue'] = "AED ".number_format($totalReveue);
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									  if(count($salesTimeArray) == 1)
										{
											$graphArray[$indexC]['Total Head Count'] = $countR;
										}
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									 $graphArray[$indexC]['Mean'] = "AED ".$avg;;
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									  $graphArray[$indexC]['median'] = "AED ".number_format($takeReveue[$medianIndex-1]);
									/*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />"; */
									  /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray[$indexC]['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											 if(count($salesTimeArray) == 1)
												{
											 $graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['Mean'] = "AED 0";
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
									}
							}
							else
							{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
											 $graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['Mean'] = "AED 0";
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsmean_median_rev_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
					}
					
					/*
					*report as per vintage
					*coding start
					*/
					}
					else
					{
					/*
					*report as per sales time
					*coding start
					*/
					foreach($salesTimeArray as $_salesT)
					{
						$graphArray[$indexC]['Sales Time'] = $_salesT;
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->where("sales_time",$_salesT)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->where("sales_time",$_salesT)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
								$tl_name = '';
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray[$indexC]['Total Revenue'] = "AED ".number_format($totalReveue);
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									  if(count($salesTimeArray) == 1)
										{
											$graphArray[$indexC]['Total Head Count'] = $countR;
										}
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									 $graphArray[$indexC]['Mean'] = "AED ".$avg;;
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex < 0)
									 {
										 $medianIndex = 1;
									 }
									  $graphArray[$indexC]['median'] = "AED ".number_format($takeReveue[$medianIndex-1]);
									/*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />"; */
									  /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray[$indexC]['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											 if(count($salesTimeArray) == 1)
												{
											 $graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['Mean'] = "AED 0";
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
									}
							}
							else
							{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
											 $graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['Mean'] = "AED 0";
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsmean_median_rev_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
					}
					
					/*
					*report as per sales time
					*coding start
					*/
					}
					
						$graphArray[$indexC]['Sales Time'] = "Total";
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
								$tl_name = '';
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray[$indexC]['Total Revenue'] = "AED ".number_format($totalReveue);
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									  if(count($salesTimeArray) == 1)
										{
											$graphArray[$indexC]['Total Head Count'] = $countR;
										}
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									 $graphArray[$indexC]['Mean'] = "AED ".$avg;;
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									  $graphArray[$indexC]['median'] = "AED ".number_format($takeReveue[$medianIndex-1]);
									/*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />"; */
									  /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray[$indexC]['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											 if(count($salesTimeArray) == 1)
												{
											 $graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['Mean'] = "AED 0";
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
									}
							}
							else
							{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
											 $graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['Mean'] = "AED 0";
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsmean_median_rev_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
					/* echo "<pre>";
					print_r($graphArray);
					exit; */
					return $graphArrayM;
	}
}
protected function getDataAsmean_median_rev_ENBDTotal($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
{
	$graphArray = array();
					
						$graphArray['Sales Time'] = "Total";
						$graphArray['TL Name'] = "";
						$graphArray['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->whereIn("tl_name",$tl_name_array)->get();
							
						
							
						}
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray['Total Revenue'] = "AED ".number_format($totalReveue);
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									  if(count($salesTimeArray) == 1)
										{
											 $graphArray['Total Head Count'] = $countR;
										}
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									 $graphArray['Mean'] = "AED ".number_format($avg);
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex < 0)
									 {
										 $medianIndex = 0;
									 }
									  $graphArray['median'] = "AED ".number_format($takeReveue[$medianIndex-1]);
									/*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />"; */
									  /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
											 $graphArray['Total Head Count'] = 0;
												}
											 $graphArray['Mean'] = "AED 0";
											 $graphArray['median'] = "AED 0";
											 $graphArray['Total Productivity'] = "AED 0";
									}
							}
							else
							{
											 $graphArray['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
											 $graphArray['Total Head Count'] = 0;
												}
											 $graphArray['Mean'] = "AED 0";
											 $graphArray['median'] = "AED 0";
											 $graphArray['Total Productivity'] = "AED 0";
							}
							if($historical_data == "yes")
							{
								$graphArrayT = $this->getDataAsmean_median_rev_ENBDHistroyTotal($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout);
								$graphArrayTD = array_merge($graphArray,$graphArrayT);
							}
							else
							{
								$graphArrayTD = $graphArray;
							}
							return $graphArrayTD;
							
}

protected function getDataAsmean_median_rev_ENBDHistroyTotal($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout)
{
	$whereRaw = '';
						/* if($teamleaderwithout != "yes")
						{
							if($tl_name != 'No')
							{
								if($whereRaw == '')
								{
									$whereRaw = "tl_name = '".$tl_name."'";
								}
								else
								{
									$whereRaw .= " AND tl_name= '".$tl_name."'";
								}
							} 
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereraw($whereRaw)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
								$tl_name = '';
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray['Historical Total Revenue'] = "AED ".number_format($totalReveue);
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									/*  $graphArray[$indexC]['Historical Total Head Count'] = $countR; */
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									 $graphArray['Historical Mean'] = "AED ".$avg;;
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex < 0)
									 {
										 $medianIndex = 0;
									 }
									  $graphArray['Historical median'] = "AED ".number_format($takeReveue[$medianIndex-1]);
									/*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />"; */
									  /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray['Historical Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray['Historical Total Revenue'] = "AED 0";
											 /* $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											 $graphArray['Historical Mean'] = "AED 0";
											 $graphArray['Historical median'] = "AED 0";
											 $graphArray['Historical Total Productivity'] = "AED 0";
									}
							}
							else
							{
											 $graphArray['Historical Total Revenue'] = "AED 0";
											/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											 $graphArray['Historical Mean'] = "AED 0";
											 $graphArray['Historical median'] = "AED 0";
											 $graphArray['Historical Total Productivity'] = "AED 0";
							}
							return $graphArray;
}
protected function getDataAsmean_median_rev_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC)
{
	
							
					
						
						
						$whereRaw = '';
						if($teamleaderwithout != "yes")
						{
							if($tl_name != 'No')
							{
								if($whereRaw == '')
								{
									$whereRaw = "tl_name = '".$tl_name."'";
								}
								else
								{
									$whereRaw .= " AND tl_name= '".$tl_name."'";
								}
							} 
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
								$tl_name = '';
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray[$indexC]['Historical Total Revenue'] = "AED ".number_format($totalReveue);
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									/*  $graphArray[$indexC]['Historical Total Head Count'] = $countR; */
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									 $graphArray[$indexC]['Historical Mean'] = "AED ".$avg;;
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex < 0)
									 {
										 $medianIndex = 0;
									 }
									  $graphArray[$indexC]['Historical median'] = "AED ".number_format($takeReveue[$medianIndex-1]);
									/*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />"; */
									  /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray[$indexC]['Historical Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray[$indexC]['Historical Total Revenue'] = "AED 0";
											 /* $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											 $graphArray[$indexC]['Historical Mean'] = "AED 0";
											 $graphArray[$indexC]['Historical median'] = "AED 0";
											 $graphArray[$indexC]['Historical Total Productivity'] = "AED 0";
									}
							}
							else
							{
											 $graphArray[$indexC]['Historical Total Revenue'] = "AED 0";
											/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											 $graphArray[$indexC]['Historical Mean'] = "AED 0";
											 $graphArray[$indexC]['Historical median'] = "AED 0";
											 $graphArray[$indexC]['Historical Total Productivity'] = "AED 0";
							}
							return $graphArray;
}

public function getDataAsquartile_ENBD($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
{
	if($teamleaderwithout != "yes")
	{
	$indexC = 0;
					$graphArray = array();
					foreach($tl_name_array as $tl_name)
					{
						$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						$graphArray[$indexC]['TL Name'] = $tl_name;
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
									$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray[$indexC]['Total Revenue'] = "AED ".number_format($totalReveue);
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									  if(count($salesTimeArray) == 1)
												{
											$graphArray[$indexC]['Total Head Count'] = $countR;
												}
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									/*  $graphArray[$indexC]['Mean'] = "AED ".$avg;; */
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex < 0)
									 {
										 $medianIndex = 0;
									 }
									  $graphArray[$indexC]['median'] = "AED ".number_format($takeReveue[$medianIndex-1]);
									 /*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />";  */
									  if($q10Index-1 < 0)
									  {
										  $q10Index = 1;
									  }
									   $graphArray[$indexC]['quartilile 10%'] = "AED ".number_format($takeReveue[$q10Index-1]);
									   if($q25Index-1 < 0)
									  {
										  $q25Index = 1;
									  }
								 $graphArray[$indexC]['quartilile 25%'] = "AED ".number_format($takeReveue[$q25Index-1]);
								 if($q75Index-1 < 0)
									  {
										  $q75Index = 1;
									  }
								 $graphArray[$indexC]['quartilile 75%'] = "AED ".number_format($takeReveue[$q75Index-1]);
								 if($q100Index-1 < 0)
									  {
										  $q100Index = 1;
									  }
								 $graphArray[$indexC]['quartilile 100%'] = "AED ".number_format($takeReveue[$q100Index-1]);
									   /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray[$indexC]['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
													$graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['quartilile 10%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 25%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 75%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 100%'] = "AED 0";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
									}
							}
							else
							{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
													$graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['quartilile 10%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 25%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 75%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 100%'] = "AED 0";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsquartile_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
					}
					$graphArrayM[$indexC] = $this->getDataAsquartile_ENBDTotal($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
					/* echo "<pre>";
					print_r($graphArray);
					exit; */
					return $graphArrayM;
	}
	else
	{
		$indexC = 0;
					$graphArray = array();
					$tl_name = '';
					
					if(count($salesTimeArray)==1 && $vintage_name_SI != 'No')
					{
					/*
					*report as per vintage
					*coding start
					*/
					$vintage_name_SIArray = explode(",",$vintage_name_SI);
					foreach($vintage_name_SIArray as $vintage)
					{
						$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id = ".$vintage;
							}
							else
							{
								$whereRaw .= " AND range_id = ".$vintage;
							}
							$graphArray[$indexC]['Vintage'] = $vintage;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray[$indexC]['Total Revenue'] = "AED ".number_format($totalReveue);
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									  if(count($salesTimeArray) == 1)
												{
												$graphArray[$indexC]['Total Head Count'] = $countR;
												}
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									/*  $graphArray[$indexC]['Mean'] = "AED ".$avg;; */
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex-1 < 0)
									 {
										 $medianIndex = 1;
									 }
									  $graphArray[$indexC]['median'] = "AED ".number_format($takeReveue[$medianIndex-1]);
									 /*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />";  */
									   if($q10Index-1 < 0)
										 {
											 $q10Index = 1;
										 }
									   $graphArray[$indexC]['quartilile 10%'] = "AED ".number_format($takeReveue[$q10Index-1]);
									    if($q25Index-1 < 0)
										 {
											 $q25Index = 1;
										 }
								 $graphArray[$indexC]['quartilile 25%'] = "AED ".number_format($takeReveue[$q25Index-1]);
								  if($q75Index-1 < 0)
										 {
											 $q75Index = 1;
										 }
								 $graphArray[$indexC]['quartilile 75%'] = "AED ".number_format($takeReveue[$q75Index-1]);
								   if($q100Index-1 < 0)
										 {
											 $q100Index = 1;
										 }
								 $graphArray[$indexC]['quartilile 100%'] = "AED ".number_format($takeReveue[$q100Index-1]);
									   /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray[$indexC]['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
												$graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['quartilile 10%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 25%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 75%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 100%'] = "AED 0";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
									}
							}
							else
							{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
												$graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['quartilile 10%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 25%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 75%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 100%'] = "AED0";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
							}
							
					/* echo "<pre>";
					print_r($graphArray);
					exit; */
					if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsquartile_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
						else
						{
							$graphArrayM[$indexC] = $graphArray[$indexC];
						}
						
						$indexC++;
					}
					/*
					*report as per vintage
					*coding start
					*/
					
					}
					else
					{
					/*
					*report as per sales time
					*coding start
					*/
					foreach($salesTimeArray as $_salesT)
					{
						$graphArray[$indexC]['Sales Time'] = $_salesT;
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->where("sales_time",$_salesT)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->where("sales_time",$_salesT)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray[$indexC]['Total Revenue'] = "AED ".number_format($totalReveue);
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									  if(count($salesTimeArray) == 1)
												{
												$graphArray[$indexC]['Total Head Count'] = $countR;
												}
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									/*  $graphArray[$indexC]['Mean'] = "AED ".$avg;; */
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex <= 0)
									 {
										 $medianIndex = 1;
									 }
									  $graphArray[$indexC]['median'] = "AED ".number_format($takeReveue[$medianIndex-1]);
									 /*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />";  */
									  if($q10Index <= 0)
									  {
										  $q10Index = 1;
									  }
									   $graphArray[$indexC]['quartilile 10%'] = "AED ".number_format($takeReveue[$q10Index-1]);
									   if($q25Index <= 0)
									  {
										  $q25Index = 1;
									  }
								 $graphArray[$indexC]['quartilile 25%'] = "AED ".number_format($takeReveue[$q25Index-1]);
								 if($q75Index <= 0)
									  {
										  $q75Index = 1;
									  }
								 $graphArray[$indexC]['quartilile 75%'] = "AED ".number_format($takeReveue[$q75Index-1]);
								 if($q100Index <= 0)
									  {
										  $q100Index = 1;
									  }
								 $graphArray[$indexC]['quartilile 100%'] = "AED ".number_format($takeReveue[$q100Index-1]);
									   /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray[$indexC]['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
												$graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['quartilile 10%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 25%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 75%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 100%'] = "AED 0";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
									}
							}
							else
							{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
												$graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['quartilile 10%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 25%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 75%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 100%'] = "AED0";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
							}
							
					/* echo "<pre>";
					print_r($graphArray);
					exit; */
					if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsquartile_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
						else
						{
							$graphArrayM[$indexC] = $graphArray[$indexC];
						}
						
						$indexC++;
					}
					
					/*
					*report as per sales time
					*coding end
					*/
					}
						$graphArray[$indexC]['Sales Time'] = "Total";
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray[$indexC]['Total Revenue'] = "AED ".number_format($totalReveue);
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									  if(count($salesTimeArray) == 1)
												{
												$graphArray[$indexC]['Total Head Count'] = $countR;
												}
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									/*  $graphArray[$indexC]['Mean'] = "AED ".$avg;; */
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									  $graphArray[$indexC]['median'] = "AED ".number_format($takeReveue[$medianIndex-1]);
									 /*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />";  */
									   $graphArray[$indexC]['quartilile 10%'] = "AED ".number_format($takeReveue[$q10Index-1]);
								 $graphArray[$indexC]['quartilile 25%'] = "AED ".number_format($takeReveue[$q25Index-1]);
								 $graphArray[$indexC]['quartilile 75%'] = "AED ".number_format($takeReveue[$q75Index-1]);
								 $graphArray[$indexC]['quartilile 100%'] = "AED ".number_format($takeReveue[$q100Index-1]);
									   /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray[$indexC]['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
												$graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['quartilile 10%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 25%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 75%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 100%'] = "AED 0";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
									}
							}
							else
							{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
												$graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['quartilile 10%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 25%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 75%'] = "AED 0";
											 $graphArray[$indexC]['quartilile 100%'] = "AED0";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
							}
							
					/* echo "<pre>";
					print_r($graphArray);
					exit; */
					if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsquartile_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
						else
						{
							$graphArrayM[$indexC] = $graphArray[$indexC];
						}
					return $graphArrayM;
	}
}

protected function getDataAsquartile_ENBDTotal($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
{
	$graphArray = array();
					
						$graphArray['Sales Time'] = "Total";
						$graphArray['TL Name'] = "";
						$graphArray['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
									$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray['Total Revenue'] = "AED ".number_format($totalReveue);
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									  if(count($salesTimeArray) == 1)
												{
											$graphArray['Total Head Count'] = $countR;
												}
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									/*  $graphArray[$indexC]['Mean'] = "AED ".$avg;; */
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex < 0)
									 {
										 $medianIndex = 0;
									 }
									  $graphArray['median'] = "AED ".number_format($takeReveue[$medianIndex-1]);
									 /*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />";  */
									  if($q10Index-1 < 0)
									  {
										  $q10Index = 1;
									  }
									   $graphArray['quartilile 10%'] = "AED ".number_format($takeReveue[$q10Index-1]);
									   if($q25Index-1 < 0)
									  {
										  $q25Index = 1;
									  }
								 $graphArray['quartilile 25%'] = "AED ".number_format($takeReveue[$q25Index-1]);
								 if($q75Index-1 < 0)
									  {
										  $q75Index = 1;
									  }
								 $graphArray['quartilile 75%'] = "AED ".number_format($takeReveue[$q75Index-1]);
								 if($q100Index-1 < 0)
									  {
										  $q100Index = 1;
									  }
								 $graphArray['quartilile 100%'] = "AED ".number_format($takeReveue[$q100Index-1]);
									   /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
													$graphArray['Total Head Count'] = 0;
												}
											 $graphArray['median'] = "AED 0";
											 $graphArray['quartilile 10%'] = "AED 0";
											 $graphArray['quartilile 25%'] = "AED 0";
											 $graphArray['quartilile 75%'] = "AED 0";
											 $graphArray['quartilile 100%'] = "AED 0";
											 $graphArray['Total Productivity'] = "AED 0";
									}
							}
							else
							{
											 $graphArray['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
													$graphArray['Total Head Count'] = 0;
												}
											 $graphArray['median'] = "AED 0";
											 $graphArray['quartilile 10%'] = "AED 0";
											 $graphArray['quartilile 25%'] = "AED 0";
											 $graphArray['quartilile 75%'] = "AED 0";
											 $graphArray['quartilile 100%'] = "AED 0";
											 $graphArray['Total Productivity'] = "AED 0";
							}
							if($historical_data == "yes")
							{
								$graphArrayT = $this->getDataAsquartile_ENBDHistroyTotal($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout);
								$graphArrayTD = array_merge($graphArray,$graphArrayT);
							}
							else
							{
								$graphArrayTD = $graphArray;
							}
							return $graphArrayTD;
					
}

protected function getDataAsquartile_ENBDHistroyTotal($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout)
{
	$whereRaw = '';
						/* if($teamleaderwithout != "yes")
						{
							if($tl_name != 'No')
							{
								if($whereRaw == '')
								{
									$whereRaw = "tl_name = '".$tl_name."'";
								}
								else
								{
									$whereRaw .= " AND tl_name= '".$tl_name."'";
								}
							} 
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereraw($whereRaw)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray['Historical Total Revenue'] = "AED ".number_format($totalReveue);
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									/*  $graphArray[$indexC]['Historical Total Head Count'] = $countR; */
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									/*  $graphArray[$indexC]['Mean'] = "AED ".$avg;; */
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex-1 < 0)
									 {
										 $medianIndex = 1;
									 }
									  $graphArray['Historical median'] = "AED ".number_format($takeReveue[$medianIndex-1]);
									 /*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />";  */
									  if($q10Index-1 < 0)
									 {
										 $q10Index = 1;
									 }
									   $graphArray['Historical quartilile 10%'] = "AED ".number_format($takeReveue[$q10Index-1]);
									     if($q25Index-1 < 0)
											 {
												 $q25Index = 1;
											 }
								 $graphArray['Historical quartilile 25%'] = "AED ".number_format($takeReveue[$q25Index-1]);
								  if($q75Index-1 < 0)
											 {
												 $q75Index = 1;
											 }
								 $graphArray['Historical quartilile 75%'] = "AED ".number_format($takeReveue[$q75Index-1]);
								  if($q100Index-1 < 0)
											 {
												 $q100Index = 1;
											 }
								 $graphArray['Historical quartilile 100%'] = "AED ".number_format($takeReveue[$q100Index-1]);
									   /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray['Historical Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray['Historical Total Revenue'] = "AED 0";
											 /* $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											 $graphArray['Historical median'] = "AED 0";
											 $graphArray['Historical quartilile 10%'] = "AED 0";
											 $graphArray['Historical quartilile 25%'] = "AED 0";
											 $graphArray['Historical quartilile 75%'] = "AED 0";
											 $graphArray['Historical quartilile 100%'] = "AED 0";
											 $graphArray['Historical Total Productivity'] = "AED 0";
									}
							}
							else
							{
											 $graphArray['Historical Total Revenue'] = "AED 0";
											/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											 $graphArray['Historical median'] = "AED 0";
											 $graphArray['Historical quartilile 10%'] = "AED 0";
											 $graphArray['Historical quartilile 25%'] = "AED 0";
											 $graphArray['Historical quartilile 75%'] = "AED 0";
											 $graphArray['Historical quartilile 100%'] = "AED 0";
											 $graphArray['Historical Total Productivity'] = "AED 0";
							}
							return $graphArray;
}
protected function getDataAsquartile_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC)
{

						
						
						$whereRaw = '';
						if($teamleaderwithout != "yes")
						{
							if($tl_name != 'No')
							{
								if($whereRaw == '')
								{
									$whereRaw = "tl_name = '".$tl_name."'";
								}
								else
								{
									$whereRaw .= " AND tl_name= '".$tl_name."'";
								}
							} 
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray[$indexC]['Historical Total Revenue'] = "AED ".number_format($totalReveue);
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									/*  $graphArray[$indexC]['Historical Total Head Count'] = $countR; */
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									/*  $graphArray[$indexC]['Mean'] = "AED ".$avg;; */
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex-1 < 0)
									 {
										 $medianIndex = 1;
									 }
									  $graphArray[$indexC]['Historical median'] = "AED ".number_format($takeReveue[$medianIndex-1]);
									 /*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />";  */
									  if($q10Index-1 < 0)
									 {
										 $q10Index = 1;
									 }
									   $graphArray[$indexC]['Historical quartilile 10%'] = "AED ".number_format($takeReveue[$q10Index-1]);
									     if($q25Index-1 < 0)
											 {
												 $q25Index = 1;
											 }
								 $graphArray[$indexC]['Historical quartilile 25%'] = "AED ".number_format($takeReveue[$q25Index-1]);
								  if($q75Index-1 < 0)
											 {
												 $q75Index = 1;
											 }
								 $graphArray[$indexC]['Historical quartilile 75%'] = "AED ".number_format($takeReveue[$q75Index-1]);
								  if($q100Index-1 < 0)
											 {
												 $q100Index = 1;
											 }
								 $graphArray[$indexC]['Historical quartilile 100%'] = "AED ".number_format($takeReveue[$q100Index-1]);
									   /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray[$indexC]['Historical Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray[$indexC]['Historical Total Revenue'] = "AED 0";
											 /* $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											 $graphArray[$indexC]['Historical median'] = "AED 0";
											 $graphArray[$indexC]['Historical quartilile 10%'] = "AED 0";
											 $graphArray[$indexC]['Historical quartilile 25%'] = "AED 0";
											 $graphArray[$indexC]['Historical quartilile 75%'] = "AED 0";
											 $graphArray[$indexC]['Historical quartilile 100%'] = "AED 0";
											 $graphArray[$indexC]['Historical Total Productivity'] = "AED 0";
									}
							}
							else
							{
											 $graphArray[$indexC]['Historical Total Revenue'] = "AED 0";
											/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											 $graphArray[$indexC]['Historical median'] = "AED 0";
											 $graphArray[$indexC]['Historical quartilile 10%'] = "AED 0";
											 $graphArray[$indexC]['Historical quartilile 25%'] = "AED 0";
											 $graphArray[$indexC]['Historical quartilile 75%'] = "AED 0";
											 $graphArray[$indexC]['Historical quartilile 100%'] = "AED 0";
											 $graphArray[$indexC]['Historical Total Productivity'] = "AED 0";
							}
							return $graphArray;
}

protected function revenue_distribution_ENBD($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
{
	if($teamleaderwithout != "yes")
	{
					$indexC = 0;
					$graphArray = array();
					foreach($tl_name_array as $tl_name)
					{
						$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						$graphArray[$indexC]['TL Name'] = $tl_name;
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray[$indexC]['Total Revenue'] = "AED ".number_format($totalReveue);
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									  if(count($salesTimeArray) == 1)
												{
												$graphArray[$indexC]['Total Head Count'] = $countR;
												}
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									/*  $graphArray[$indexC]['Mean'] = "AED ".$avg;; */
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex < 0)
									 {
										 $medianIndex = 0;
									 }
									  $graphArray[$indexC]['median'] = "AED ".number_format($takeReveue[$medianIndex-1]);
									 /*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />";  */
									 /*   $graphArray[$indexC]['quartilile 10%'] = "AED ".$takeReveue[$q10Index-1];
								 $graphArray[$indexC]['quartilile 25%'] = "AED ".$takeReveue[$q25Index-1];
								 $graphArray[$indexC]['quartilile 75%'] = "AED ".$takeReveue[$q75Index-1];
								 $graphArray[$indexC]['quartilile 100%'] = "AED ".$takeReveue[$q100Index-1]; */
									   /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										 $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} 
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} 
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										 $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} 
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										 $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} 
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										*/
										/* echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%"; */
										
										
											 $graphArray[$indexC]['Top Revenue 10%'] = round(($top10Revenue/$totalReveue)*100)."%";
											 $graphArray[$indexC]['Top Revenue 25%'] = round(($top25Revenue/$totalReveue)*100)."%";
											 $graphArray[$indexC]['Top Revenue 75%'] = round(($top75Revenue/$totalReveue)*100)."%";
											 $graphArray[$indexC]['Top Revenue 100%'] = round(($top100Revenue/$totalReveue)*100)."%";
										/*echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray[$indexC]['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
												$graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['Top Revenue 10%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 25%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 75%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 100%'] = "0%";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
									}
							}
							else
							{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
												$graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['Top Revenue 10%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 25%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 75%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 100%'] = "0%";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->revenue_distribution_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
					}
					$graphArrayM[$indexC] = $this->revenue_distribution_ENBDTotal($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
					/* echo "<pre>";
					print_r($graphArray);
					exit; */
					return $graphArrayM;
	}
	else
	{
		$indexC = 0;
					$graphArray = array();
					$tl_name = '';
				 if(count($salesTimeArray) == 1 && $vintage_name_SI != 'No')
				 {
				 /*
				  *report as per sale time
				  *coding start
				  */
				  $vintage_name_SIArray = explode(",",$vintage_name_SI);
				  foreach($vintage_name_SIArray as $vintage)
				  {
					  $graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id = ".$vintage;
							}
							else
							{
								$whereRaw .= " AND range_id = ".$vintage;
							}
							$graphArray[$indexC]['Vintage'] = $vintage;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray[$indexC]['Total Revenue'] = "AED ".number_format($totalReveue);
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									  if(count($salesTimeArray) == 1)
												{
											$graphArray[$indexC]['Total Head Count'] = $countR;
												}
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									/*  $graphArray[$indexC]['Mean'] = "AED ".$avg;; */
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									  $graphArray[$indexC]['median'] = "AED ".number_format($takeReveue[$medianIndex-1]);
									 /*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />";  */
									 /*   $graphArray[$indexC]['quartilile 10%'] = "AED ".$takeReveue[$q10Index-1];
								 $graphArray[$indexC]['quartilile 25%'] = "AED ".$takeReveue[$q25Index-1];
								 $graphArray[$indexC]['quartilile 75%'] = "AED ".$takeReveue[$q75Index-1];
								 $graphArray[$indexC]['quartilile 100%'] = "AED ".$takeReveue[$q100Index-1]; */
									   /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										 $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} 
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} 
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										 $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} 
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										 $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} 
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										*/
										/* echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%"; */
										
											if($top10Revenue == 0)
											{
												$graphArray[$indexC]['Top Revenue 10%'] = "0%";
											}
											else
											{
											 $graphArray[$indexC]['Top Revenue 10%'] = round(($top10Revenue/$totalReveue)*100)."%";
											}
											if($top25Revenue == 0)
											{
												$graphArray[$indexC]['Top Revenue 25%'] = "0%";
											}
											else
											{
												$graphArray[$indexC]['Top Revenue 25%'] = round(($top25Revenue/$totalReveue)*100)."%";
											}
											 if($top75Revenue == 0)
											 {
												 $graphArray[$indexC]['Top Revenue 75%'] = "0%";
											 }
											 else
											 {
												$graphArray[$indexC]['Top Revenue 75%'] = round(($top75Revenue/$totalReveue)*100)."%";
											 }
											 if($top100Revenue == 0)
											 {
												 
												 $graphArray[$indexC]['Top Revenue 100%'] =  "0%";
											 }
											 else
											 {
											 $graphArray[$indexC]['Top Revenue 100%'] = round(($top100Revenue/$totalReveue)*100)."%";
											 }
										/*echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray[$indexC]['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
												$graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['Top Revenue 10%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 25%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 75%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 100%'] = "0%";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
									}
							}
							else
							{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
												$graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['Top Revenue 10%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 25%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 75%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 100%'] = "0%";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
							}
							if($historical_data == "yes")
							{
							$graphArray1 = $this->revenue_distribution_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
				  }
				  /*
				  *report as per sale time
				  *coding start
				  */
				 }
				 else
				 {
				  /*
				  *report as per sale time
				  *coding start
				  */
				  foreach($salesTimeArray as $_salesT)
				  {
					  $graphArray[$indexC]['Sales Time'] = $_salesT;
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->where("sales_time",$_salesT)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->where("sales_time",$_salesT)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray[$indexC]['Total Revenue'] = "AED ".number_format($totalReveue);
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									  if(count($salesTimeArray) == 1)
												{
											$graphArray[$indexC]['Total Head Count'] = $countR;
												}
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									/*  $graphArray[$indexC]['Mean'] = "AED ".$avg;; */
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									  $graphArray[$indexC]['median'] = "AED ".number_format($takeReveue[$medianIndex-1]);
									 /*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />";  */
									 /*   $graphArray[$indexC]['quartilile 10%'] = "AED ".$takeReveue[$q10Index-1];
								 $graphArray[$indexC]['quartilile 25%'] = "AED ".$takeReveue[$q25Index-1];
								 $graphArray[$indexC]['quartilile 75%'] = "AED ".$takeReveue[$q75Index-1];
								 $graphArray[$indexC]['quartilile 100%'] = "AED ".$takeReveue[$q100Index-1]; */
									   /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										 $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} 
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} 
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										 $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} 
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										 $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} 
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										*/
										/* echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%"; */
										
										
											 $graphArray[$indexC]['Top Revenue 10%'] = round(($top10Revenue/$totalReveue)*100)."%";
											 $graphArray[$indexC]['Top Revenue 25%'] = round(($top25Revenue/$totalReveue)*100)."%";
											 $graphArray[$indexC]['Top Revenue 75%'] = round(($top75Revenue/$totalReveue)*100)."%";
											 $graphArray[$indexC]['Top Revenue 100%'] = round(($top100Revenue/$totalReveue)*100)."%";
										/*echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray[$indexC]['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
												$graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['Top Revenue 10%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 25%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 75%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 100%'] = "0%";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
									}
							}
							else
							{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
												$graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['Top Revenue 10%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 25%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 75%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 100%'] = "0%";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
							}
							if($historical_data == "yes")
							{
							$graphArray1 = $this->revenue_distribution_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
				  }
				   /*
				  *report as per sale time
				  *coding end
				  */
				 }
				  
						$graphArray[$indexC]['Sales Time'] = "Total";
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray[$indexC]['Total Revenue'] = "AED ".number_format($totalReveue);
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									  if(count($salesTimeArray) == 1)
												{
											$graphArray[$indexC]['Total Head Count'] = $countR;
												}
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									/*  $graphArray[$indexC]['Mean'] = "AED ".$avg;; */
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									  $graphArray[$indexC]['median'] = "AED ".number_format($takeReveue[$medianIndex-1]);
									 /*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />";  */
									 /*   $graphArray[$indexC]['quartilile 10%'] = "AED ".$takeReveue[$q10Index-1];
								 $graphArray[$indexC]['quartilile 25%'] = "AED ".$takeReveue[$q25Index-1];
								 $graphArray[$indexC]['quartilile 75%'] = "AED ".$takeReveue[$q75Index-1];
								 $graphArray[$indexC]['quartilile 100%'] = "AED ".$takeReveue[$q100Index-1]; */
									   /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										 $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} 
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} 
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										 $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} 
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										 $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} 
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										*/
										/* echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%"; */
										
										
											 $graphArray[$indexC]['Top Revenue 10%'] = round(($top10Revenue/$totalReveue)*100)."%";
											 $graphArray[$indexC]['Top Revenue 25%'] = round(($top25Revenue/$totalReveue)*100)."%";
											 $graphArray[$indexC]['Top Revenue 75%'] = round(($top75Revenue/$totalReveue)*100)."%";
											 $graphArray[$indexC]['Top Revenue 100%'] = round(($top100Revenue/$totalReveue)*100)."%";
										/*echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray[$indexC]['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
												$graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['Top Revenue 10%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 25%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 75%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 100%'] = "0%";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
									}
							}
							else
							{
											 $graphArray[$indexC]['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
												$graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['median'] = "AED 0";
											 $graphArray[$indexC]['Top Revenue 10%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 25%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 75%'] = "0%";
											 $graphArray[$indexC]['Top Revenue 100%'] = "0%";
											 $graphArray[$indexC]['Total Productivity'] = "AED 0";
							}
							if($historical_data == "yes")
							{
							$graphArray1 = $this->revenue_distribution_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
					/* echo "<pre>";
					print_r($graphArray);
					exit; */
					return $graphArrayM;
	}
}

protected function revenue_distribution_ENBDTotal($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
{
	$graphArray = array();
				
						$graphArray['Sales Time'] = "Total";
						$graphArray['TL Name'] = "";
						$graphArray['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray['Total Revenue'] = "AED ".number_format($totalReveue);
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									  if(count($salesTimeArray) == 1)
												{
												$graphArray['Total Head Count'] = $countR;
												}
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									/*  $graphArray[$indexC]['Mean'] = "AED ".$avg;; */
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex < 0)
									 {
										 $medianIndex = 0;
									 }
									  $graphArray['median'] = "AED ".number_format($takeReveue[$medianIndex-1]);
									 /*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />";  */
									 /*   $graphArray[$indexC]['quartilile 10%'] = "AED ".$takeReveue[$q10Index-1];
								 $graphArray[$indexC]['quartilile 25%'] = "AED ".$takeReveue[$q25Index-1];
								 $graphArray[$indexC]['quartilile 75%'] = "AED ".$takeReveue[$q75Index-1];
								 $graphArray[$indexC]['quartilile 100%'] = "AED ".$takeReveue[$q100Index-1]; */
									   /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										 $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} 
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} 
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										 $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} 
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										 $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} 
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										*/
										/* echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%"; */
										
										
											 $graphArray['Top Revenue 10%'] = round(($top10Revenue/$totalReveue)*100)."%";
											 $graphArray['Top Revenue 25%'] = round(($top25Revenue/$totalReveue)*100)."%";
											 $graphArray['Top Revenue 75%'] = round(($top75Revenue/$totalReveue)*100)."%";
											 $graphArray['Top Revenue 100%'] = round(($top100Revenue/$totalReveue)*100)."%";
										/*echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray['Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
												$graphArray['Total Head Count'] = 0;
												}
											 $graphArray['median'] = "AED 0";
											 $graphArray['Top Revenue 10%'] = "0%";
											 $graphArray['Top Revenue 25%'] = "0%";
											 $graphArray['Top Revenue 75%'] = "0%";
											 $graphArray['Top Revenue 100%'] = "0%";
											 $graphArray['Total Productivity'] = "AED 0";
									}
							}
							else
							{
											 $graphArray['Total Revenue'] = "AED 0";
											  if(count($salesTimeArray) == 1)
												{
												$graphArray['Total Head Count'] = 0;
												}
											 $graphArray['median'] = "AED 0";
											 $graphArray['Top Revenue 10%'] = "0%";
											 $graphArray['Top Revenue 25%'] = "0%";
											 $graphArray['Top Revenue 75%'] = "0%";
											 $graphArray['Top Revenue 100%'] = "0%";
											 $graphArray['Total Productivity'] = "AED 0";
							}
							if($historical_data == "yes")
							{
								$graphArrayT = $this->revenue_distribution_ENBDHistroyTotal($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout);
								$graphArrayTD = array_merge($graphArray,$graphArrayT);
							}
							else
							{
								$graphArrayTD = $graphArray;
							}
							return $graphArrayTD;
							
					
}

protected function revenue_distribution_ENBDHistroyTotal($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout)
{
						
						
						$whereRaw = '';
						
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereraw($whereRaw)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray['Historical Total Revenue'] = "AED ".number_format($totalReveue);
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									 /* $graphArray[$indexC]['Historical Total Head Count'] = $countR; */
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									/*  $graphArray[$indexC]['Mean'] = "AED ".$avg;; */
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
								
									 
									 if($medianIndex < 0)
									 {
										 $medianIndex = 1;
									 }
									  $graphArray['Historical median'] = "AED ".number_format($takeReveue[$medianIndex-1]);
									 /*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />";  */
									 /*   $graphArray[$indexC]['quartilile 10%'] = "AED ".$takeReveue[$q10Index-1];
								 $graphArray[$indexC]['quartilile 25%'] = "AED ".$takeReveue[$q25Index-1];
								 $graphArray[$indexC]['quartilile 75%'] = "AED ".$takeReveue[$q75Index-1];
								 $graphArray[$indexC]['quartilile 100%'] = "AED ".$takeReveue[$q100Index-1]; */
									   /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										 $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} 
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} 
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										 $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} 
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										 $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} 
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										*/
										/* echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%"; */
										
										
											 $graphArray['Historical Top Revenue 10%'] = round(($top10Revenue/$totalReveue)*100)."%";
											 $graphArray['Historical Top Revenue 25%'] = round(($top25Revenue/$totalReveue)*100)."%";
											 $graphArray['Historical Top Revenue 75%'] = round(($top75Revenue/$totalReveue)*100)."%";
											 $graphArray['Historical Top Revenue 100%'] = round(($top100Revenue/$totalReveue)*100)."%";
										/*echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray['Historical Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray['Historical Total Revenue'] = "AED 0";
											/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											 $graphArray['Historical median'] = "AED 0";
											 $graphArray['Historical Top Revenue 10%'] = "0%";
											 $graphArray['Historical Top Revenue 25%'] = "0%";
											 $graphArray['Historical Top Revenue 75%'] = "0%";
											 $graphArray['Historical Top Revenue 100%'] = "0%";
											 $graphArray['Historical Total Productivity'] = "AED 0";
									}
							}
							else
							{
											 $graphArray['Historical Total Revenue'] = "AED 0";
											 /* $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											 $graphArray['Historical median'] = "AED 0";
											 $graphArray['Historical Top Revenue 10%'] = "0%";
											 $graphArray['Historical Top Revenue 25%'] = "0%";
											 $graphArray['Historical Top Revenue 75%'] = "0%";
											 $graphArray['Historical Top Revenue 100%'] = "0%";
											 $graphArray['Historical Total Productivity'] = "AED 0";
							}
							
							return $graphArray;
}
protected function revenue_distribution_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC)
{
	
					
						
						
						$whereRaw = '';
						if($teamleaderwithout != "yes")
						{
							if($tl_name != 'No')
							{
								if($whereRaw == '')
								{
									$whereRaw = "tl_name = '".$tl_name."'";
								}
								else
								{
									$whereRaw .= " AND tl_name= '".$tl_name."'";
								}
							} 
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->total_revenue;
										$totalReveue = $totalReveue+$_mashreq->total_revenue;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray[$indexC]['Historical Total Revenue'] = "AED ".number_format($totalReveue);
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									 /* $graphArray[$indexC]['Historical Total Head Count'] = $countR; */
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									/*  $graphArray[$indexC]['Mean'] = "AED ".$avg;; */
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
								
									 
									 if($medianIndex < 0)
									 {
										 $medianIndex = 1;
									 }
									  $graphArray[$indexC]['Historical median'] = "AED ".number_format($takeReveue[$medianIndex-1]);
									 /*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />";  */
									 /*   $graphArray[$indexC]['quartilile 10%'] = "AED ".$takeReveue[$q10Index-1];
								 $graphArray[$indexC]['quartilile 25%'] = "AED ".$takeReveue[$q25Index-1];
								 $graphArray[$indexC]['quartilile 75%'] = "AED ".$takeReveue[$q75Index-1];
								 $graphArray[$indexC]['quartilile 100%'] = "AED ".$takeReveue[$q100Index-1]; */
									   /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										 $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} 
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} 
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										 $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} 
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										 $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} 
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										*/
										/* echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%"; */
										
										
											 $graphArray[$indexC]['Historical Top Revenue 10%'] = round(($top10Revenue/$totalReveue)*100)."%";
											 $graphArray[$indexC]['Historical Top Revenue 25%'] = round(($top25Revenue/$totalReveue)*100)."%";
											 $graphArray[$indexC]['Historical Top Revenue 75%'] = round(($top75Revenue/$totalReveue)*100)."%";
											 $graphArray[$indexC]['Historical Top Revenue 100%'] = round(($top100Revenue/$totalReveue)*100)."%";
										/*echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray[$indexC]['Historical Total Productivity'] = "AED ".number_format($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray[$indexC]['Historical Total Revenue'] = "AED 0";
											/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											 $graphArray[$indexC]['Historical median'] = "AED 0";
											 $graphArray[$indexC]['Historical Top Revenue 10%'] = "0%";
											 $graphArray[$indexC]['Historical Top Revenue 25%'] = "0%";
											 $graphArray[$indexC]['Historical Top Revenue 75%'] = "0%";
											 $graphArray[$indexC]['Historical Top Revenue 100%'] = "0%";
											 $graphArray[$indexC]['Historical Total Productivity'] = "AED 0";
									}
							}
							else
							{
											 $graphArray[$indexC]['Historical Total Revenue'] = "AED 0";
											 /* $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											 $graphArray[$indexC]['Historical median'] = "AED 0";
											 $graphArray[$indexC]['Historical Top Revenue 10%'] = "0%";
											 $graphArray[$indexC]['Historical Top Revenue 25%'] = "0%";
											 $graphArray[$indexC]['Historical Top Revenue 75%'] = "0%";
											 $graphArray[$indexC]['Historical Top Revenue 100%'] = "0%";
											 $graphArray[$indexC]['Historical Total Productivity'] = "AED 0";
							}
							
							return $graphArray;
}
public function updateCode()
{
	$data = AgentPayout::where("agent_bank_code","agent_bank_code")->get();
	foreach($data as $_d)
	{
		$dataMatch = AgentPayoutB::where("agent_name",$_d->agent_name)->first();
		if($dataMatch != '')
		{
			$data1 = AgentPayout::where("agent_name",$_d->agent_name)->get();
			foreach($data1 as $up)
			{
				$update  = AgentPayout::find($up->id);
				$update->agent_bank_code = $dataMatch->agent_bank_code;
				$update->save();
			}
		}
	}
	exit;
}
	public function declareTitleOfPanel(Request $request)
	{
		$panelId = $request->idValue;
		$title = $request->titleV;
		$userId = $request->session()->get('EmployeeId');
		$salesMod = SalesDashboardPanelTitle::where("panel_id",$panelId)->where("user_id",$userId)->first();
		if($salesMod != "")
		{
			$salesDashboardTitleMod = SalesDashboardPanelTitle::find($salesMod->id);
		}
		else
		{
			$salesDashboardTitleMod = new SalesDashboardPanelTitle();
		}
		
		$salesDashboardTitleMod->name = $title;
		$salesDashboardTitleMod->panel_id = $panelId;
		$salesDashboardTitleMod->user_id = $request->session()->get('EmployeeId');
		$salesDashboardTitleMod->save();
		echo "yes";
		exit;
	}
	
	public function getTitlePanel(Request $request)
	{
		$indexId = $request->index;
		$user_id = $request->session()->get('EmployeeId');
		
		$salesDashBoardMod = SalesDashboardPanelTitle::where("panel_id",$indexId)->where("user_id",$user_id)->first();
		if($salesDashBoardMod != "")
		{
			echo $salesDashBoardMod->name;
		}			
		else
		{
		   echo "no";
		   
		}
		exit;
	}
	
	public function removeWidgetDFromDB(Request $request)
	{
		$indexId = $request->index;
		$user_id = $request->session()->get('EmployeeId');
		$salesDashBoardMod = SalesDashboardPanelTitle::where("panel_id",$indexId)->where("user_id",$user_id)->first();
		if($salesDashBoardMod != "")
		{
			$salesDMod = SalesDashboardPanelTitle::find($salesDashBoardMod->id);
			$salesDMod->delete();
		}
		
		$salesMod = SalesDashboardValues::where("panel_id",$indexId)->where("user_id",$user_id)->first();
		if($salesMod != "")
		{
			$salesDModContent = SalesDashboardValues::find($salesMod->id);
			$salesDModContent->delete();
		}
		echo "yes";
		exit;
	}
	
	public function popupWidgetD(Request $request)
	{
		$indexId = $request->index;
		$user_id = $request->session()->get('EmployeeId');
		$dashboardTitle = SalesDashboardPanelTitle::where("panel_id",$indexId)->where("user_id",$user_id)->first();
		$dashboardValues = SalesDashboardValues::where("panel_id",$indexId)->where("user_id",$user_id)->first();
		
		$results = array();
		if($dashboardValues != '')
		{
		if($dashboardTitle!= '')
		{
		$results['dashboardTitle'] = $dashboardTitle->name;
		}
		else
		{
			$results['dashboardTitle'] = "No";
		}
		$results['from_date'] = $dashboardValues->from_date;
		$results['to_date'] = $dashboardValues->to_date;
		$results['bank'] = $dashboardValues->bank;
		$results['location'] = $dashboardValues->location;
		$results['team_leader'] = $dashboardValues->team_leader;
		$results['without_tl'] = $dashboardValues->without_tl;
		$results['vintage'] = $dashboardValues->vintage;
		$results['product'] = $dashboardValues->product;
		$results['performance'] = $dashboardValues->performance;
		$results['historical_data'] = $dashboardValues->historical_data;
		$results['code'] = 200;
		}
		else
		{
			$results['code'] = 300;
		}
		echo json_encode($results);
		exit;
		
	}
	
	
	
	
	
	protected function getDataAsmean_median_rev_p($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
	{
		
		if($teamleaderwithout != "yes")
		{
		$indexC = 0;
				
					foreach($tl_name_array as $tl_name)
					{
						$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						$graphArray[$indexC]['TL Name'] = $tl_name;
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
							$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->get();	
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->get();	
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->cards_mashreq;
										$totalReveue = $totalReveue+$_mashreq->cards_mashreq;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray[$indexC]['Total Cards'] = $totalReveue;
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									 if(count($salesTimeArray) == 1)
									{
									  $graphArray[$indexC]['Total Head Count'] =$countR;
									}
									  $graphArray[$indexC]['Mean'] = $avg;
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray[$indexC]['median'] = $takeReveue[$medianIndex];
									/*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />";
									  echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										/*
										*top 10% revenue
										*/
										$top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										}
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										}
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										$top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										}
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										$top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										}
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray[$indexC]['Total Productivity'] = round($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											$graphArray[$indexC]['Total Cards'] = "0";
											if(count($salesTimeArray) == 1)
												{
											 $graphArray[$indexC]['Total Head Count'] = 0;
												}
								 $graphArray[$indexC]['Mean'] = "0";
								 $graphArray[$indexC]['median'] = "0";
								/*  $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray[$indexC]['Total Productivity'] = "0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray[$indexC]['Total Cards'] = "0";
								 if(count($salesTimeArray) == 1)
									{
								 $graphArray[$indexC]['Total Head Count'] = 0;
									}
								 $graphArray[$indexC]['Mean'] = "0";
								 $graphArray[$indexC]['median'] = "0";
								 /* $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray[$indexC]['Total Productivity'] = "0";
							}
							if($historical_data == "yes")
							{
							$graphArray1 = $this->getDataAsmean_median_revHistroy_p($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
						
					}
					$graphArrayM[$indexC] = $this->getDataAsmean_median_revTotal_p($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
					return $graphArrayM;
		}
		else
		{
			$indexC = 0;
				$tl_name ='';
				$graphArray = array();
				
				if(count($salesTimeArray) == 1 && $vintage_name_SI != 'No')
				{
				/*
				*report as per vintage
				*coding start
				*/
				$vintage_name_SIArray = explode(",",$vintage_name_SI);
				foreach($vintage_name_SIArray as $vintage)
				{
					    $graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
					/* 	$graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id = ".$vintage;
							}
							else
							{
								$whereRaw .= " AND range_id = ".$vintage;
							}
							$graphArray[$indexC]['Vintage'] = $vintage;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->get();	
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->cards_mashreq;
										$totalReveue = $totalReveue+$_mashreq->cards_mashreq;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray[$indexC]['Total Cards'] = $totalReveue;
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									 if(count($salesTimeArray) == 1)
									{
									  $graphArray[$indexC]['Total Head Count'] =$countR;
									}
									  $graphArray[$indexC]['Mean'] = $avg;
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray[$indexC]['median'] = $takeReveue[$medianIndex];
									/*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />";
									  echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										/*
										*top 10% revenue
										*/
										$top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										}
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										}
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										$top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										}
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										$top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										}
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray[$indexC]['Total Productivity'] = round($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											$graphArray[$indexC]['Total Cards'] = "0";
											if(count($salesTimeArray) == 1)
											{
										 $graphArray[$indexC]['Total Head Count'] = 0;
											}
								 $graphArray[$indexC]['Mean'] = "0";
								 $graphArray[$indexC]['median'] = "0";
								/*  $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray[$indexC]['Total Productivity'] = "0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray[$indexC]['Total Cards'] = "0";
								 if(count($salesTimeArray) == 1)
									{
									$graphArray[$indexC]['Total Head Count'] = 0;
									}
								 $graphArray[$indexC]['Mean'] = "0";
								 $graphArray[$indexC]['median'] = "0";
								 /* $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray[$indexC]['Total Productivity'] = "0";
							}
							if($historical_data == "yes")
							{
							$graphArray1 = $this->getDataAsmean_median_revHistroy_p($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
				}
				
				/*
				*report as per vintage
				*coding start
				*/
				}
				else
				{
				
				/*
				*report as per sales time
				*coding start
				*/
				foreach($salesTimeArray as $_salesT)
				{
					$graphArray[$indexC]['Sales Time'] = $_salesT;
					/* 	$graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::where("end_sales_time",$_salesT)->get();	
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->cards_mashreq;
										$totalReveue = $totalReveue+$_mashreq->cards_mashreq;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray[$indexC]['Total Cards'] =  $totalReveue;
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									 if(count($salesTimeArray) == 1)
									{
									  $graphArray[$indexC]['Total Head Count'] =$countR;
									}
									  $graphArray[$indexC]['Mean'] = $avg;
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray[$indexC]['median'] = $takeReveue[$medianIndex];
									/*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />";
									  echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										/*
										*top 10% revenue
										*/
										$top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										}
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										}
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										$top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										}
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										$top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										}
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray[$indexC]['Total Productivity'] = round($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											$graphArray[$indexC]['Total Cards'] = "0";
											if(count($salesTimeArray) == 1)
											{
										 $graphArray[$indexC]['Total Head Count'] = 0;
											}
								 $graphArray[$indexC]['Mean'] = "0";
								 $graphArray[$indexC]['median'] = "0";
								/*  $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray[$indexC]['Total Productivity'] = "0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray[$indexC]['Total Cards'] = "0";
								 if(count($salesTimeArray) == 1)
									{
									$graphArray[$indexC]['Total Head Count'] = 0;
									}
								 $graphArray[$indexC]['Mean'] = "0";
								 $graphArray[$indexC]['median'] = "0";
								 /* $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray[$indexC]['Total Productivity'] = "0";
							}
							if($historical_data == "yes")
							{
							$graphArray1 = $this->getDataAsmean_median_revHistroy_p($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
				}
				/*
				*report as per sales time
				*coding end
				*/
				}
					
						$graphArray[$indexC]['Sales Time'] = "Total";
					/* 	$graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->get();	
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->cards_mashreq;
										$totalReveue = $totalReveue+$_mashreq->cards_mashreq;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray[$indexC]['Total Cards'] = $totalReveue;
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									 if(count($salesTimeArray) == 1)
									{
									  $graphArray[$indexC]['Total Head Count'] =$countR;
									}
									  $graphArray[$indexC]['Mean'] = $avg;
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray[$indexC]['median'] = $takeReveue[$medianIndex];
									/*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />";
									  echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										/*
										*top 10% revenue
										*/
										$top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										}
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										}
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										$top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										}
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										$top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										}
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray[$indexC]['Total Productivity'] = round($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											$graphArray[$indexC]['Total Cards'] = "0";
											if(count($salesTimeArray) == 1)
											{
										 $graphArray[$indexC]['Total Head Count'] = 0;
											}
								 $graphArray[$indexC]['Mean'] = "0";
								 $graphArray[$indexC]['median'] = "0";
								/*  $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray[$indexC]['Total Productivity'] = "0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray[$indexC]['Total Cards'] = "0";
								 if(count($salesTimeArray) == 1)
									{
									$graphArray[$indexC]['Total Head Count'] = 0;
									}
								 $graphArray[$indexC]['Mean'] = "0";
								 $graphArray[$indexC]['median'] = "0";
								 /* $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray[$indexC]['Total Productivity'] = "0";
							}
							if($historical_data == "yes")
							{
							$graphArray1 = $this->getDataAsmean_median_revHistroy_p($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
					return $graphArrayM;
		}
	}
	
	
	protected function getDataAsmean_median_revTotal_p($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
	{
		$graphArray = array();
						$graphArray['Sales Time'] = "Total";
						$graphArray['TL Name'] = "";
						$graphArray['Bank'] = "Mashreq";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
							$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->whereIn("tl_name",$tl_name_array)->get();	
							
							
						}
						else
						{
							
							$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->whereIn("tl_name",$tl_name_array)->get();	
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->cards_mashreq;
										$totalReveue = $totalReveue+$_mashreq->cards_mashreq;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray['Total Cards'] = $totalReveue;
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									 if(count($salesTimeArray) == 1)
									{
									  $graphArray['Total Head Count'] =$countR;
									}
									  $graphArray['Mean'] = $avg;
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray['median'] = $takeReveue[$medianIndex];
									/*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />";
									  echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										/*
										*top 10% revenue
										*/
										$top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										}
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										}
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										$top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										}
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										$top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										}
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray['Total Productivity'] = round($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											$graphArray['Total Cards'] = "0";
											if(count($salesTimeArray) == 1)
												{
											 $graphArray['Total Head Count'] = 0;
												}
								 $graphArray['Mean'] = "0";
								 $graphArray['median'] = "0";
								/*  $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray['Total Productivity'] = "0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray['Total Cards'] = "0";
								 if(count($salesTimeArray) == 1)
									{
								 $graphArray['Total Head Count'] = 0;
									}
								 $graphArray['Mean'] = "0";
								 $graphArray['median'] = "0";
								 /* $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray['Total Productivity'] = "0";
							}
							if($historical_data == "yes")
							{
							$graphArrayT = $this->getDataAsmean_median_revHistroyTotal_p($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout);
							$graphArrayTD = array_merge($graphArray,$graphArrayT);
							}
							else
							{
								$graphArrayTD = $graphArray;
							}
							
						return $graphArrayTD;
					
	}
	
	protected function getDataAsmean_median_revHistroyTotal_p($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout)
	{
			$whereRaw = '';
						
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("tl_name",$tl_name_array)->get();	
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereraw($whereRaw)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->cards_mashreq;
										$totalReveue = $totalReveue+$_mashreq->cards_mashreq;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray['Historical Total Cards'] = $totalReveue;
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									  /* $graphArray[$indexC]['Historical Total Head Count'] =$countR; */
									  $graphArray['Historical Mean'] = $avg;
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray['Historical median'] = $takeReveue[$medianIndex];
									/*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />";
									  echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										/*
										*top 10% revenue
										*/
										$top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										}
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										}
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										$top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										}
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										$top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										}
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray['Historical Total Productivity'] = round($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											$graphArray['Historical Total Cards'] = "0";
								/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
								 $graphArray['Historical Mean'] = "0";
								 $graphArray['Historical median'] = "0";
								/*  $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray['Historical Total Productivity'] = "0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray['Historical Total Cards'] = "0";
								/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
								 $graphArray['Historical Mean'] = "0";
								 $graphArray['Historical median'] = "0";
								 /* $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray['Historical Total Productivity'] = "0";
							}
							return $graphArray;
	}
	protected function getDataAsmean_median_revHistroy_p($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC)
	{
	
					
						
						
						$whereRaw = '';
						if($teamleaderwithout != "yes")
						{
						 if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} 
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::get();	
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereraw($whereRaw)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->cards_mashreq;
										$totalReveue = $totalReveue+$_mashreq->cards_mashreq;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray[$indexC]['Historical Total Cards'] = $totalReveue;
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									  /* $graphArray[$indexC]['Historical Total Head Count'] =$countR; */
									  $graphArray[$indexC]['Historical Mean'] = $avg;
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray[$indexC]['Historical median'] = $takeReveue[$medianIndex];
									/*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />";
									  echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										/*
										*top 10% revenue
										*/
										$top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										}
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										$top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										}
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										$top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										}
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										$top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										}
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray[$indexC]['Historical Total Productivity'] = round($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											$graphArray[$indexC]['Historical Total Cards'] = "0";
								/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
								 $graphArray[$indexC]['Historical Mean'] = "0";
								 $graphArray[$indexC]['Historical median'] = "0";
								/*  $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray[$indexC]['Historical Total Productivity'] = "0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray[$indexC]['Historical Total Cards'] = "0";
								/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
								 $graphArray[$indexC]['Historical Mean'] = "0";
								 $graphArray[$indexC]['Historical median'] = "0";
								 /* $graphArray[$indexC]['top10 Revenue'] = "0%";
								 $graphArray[$indexC]['top25 Revenue'] = "0%";
								 $graphArray[$indexC]['top75 Revenue'] = "0%";
								 $graphArray[$indexC]['top100 Revenue'] = "0%"; */
								 $graphArray[$indexC]['Historical Total Productivity'] = "0";
							}
							return $graphArray;
	}
	
	
	
	
	
	
	public function getDataAsmean_median_rev_ENBD_p($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
{
	if($teamleaderwithout != "yes")
	{
					$indexC = 0;
					$graphArray = array();
					foreach($tl_name_array as $tl_name)
					{
						$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						$graphArray[$indexC]['TL Name'] = $tl_name;
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
						
							
						}
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->tc_card;
										$totalReveue = $totalReveue+$_mashreq->tc_card;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray[$indexC]['Total Cards'] = $totalReveue;
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									  if(count($salesTimeArray) == 1)
										{
											 $graphArray[$indexC]['Total Head Count'] = $countR;
										}
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									 $graphArray[$indexC]['Mean'] = $avg;
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex < 0)
									 {
										 $medianIndex = 0;
									 }
									  $graphArray[$indexC]['median'] = $takeReveue[$medianIndex-1];
									/*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />"; */
									  /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray[$indexC]['Total Productivity'] = round($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray[$indexC]['Total Cards'] = "0";
											  if(count($salesTimeArray) == 1)
												{
											 $graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['Mean'] = "0";
											 $graphArray[$indexC]['median'] = "0";
											 $graphArray[$indexC]['Total Productivity'] = "0";
									}
							}
							else
							{
											 $graphArray[$indexC]['Total Cards'] = "0";
											  if(count($salesTimeArray) == 1)
												{
											 $graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['Mean'] = "0";
											 $graphArray[$indexC]['median'] = "0";
											 $graphArray[$indexC]['Total Productivity'] = "0";
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsmean_median_rev_ENBDHistroy_p($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
					}
					$graphArrayM[$indexC] = $this->getDataAsmean_median_rev_ENBDTotal_p($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
					/* echo "<pre>";
					print_r($graphArray);
					exit; */
					return $graphArrayM;
	}
	else
	{
		$indexC = 0;
					$graphArray = array();
					
					if(count($salesTimeArray) == 1 && $vintage_name_SI != 'No')
					{
					/*
					*report as per vintage
					*coding start
					*/
					$vintage_name_SIArray = explode(",",$vintage_name_SI);
					
					foreach($vintage_name_SIArray as $vintage)
					{
						$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id = ".$vintage;
							}
							else
							{
								$whereRaw .= " AND range_id = ".$vintage;
							}
							$graphArray[$indexC]['Vintage'] = $vintage;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
								$tl_name = '';
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->tc_card;
										$totalReveue = $totalReveue+$_mashreq->tc_card;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray[$indexC]['Total Cards'] = $totalReveue;
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									  if(count($salesTimeArray) == 1)
										{
											$graphArray[$indexC]['Total Head Count'] = $countR;
										}
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									 $graphArray[$indexC]['Mean'] = $avg;;
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									  $graphArray[$indexC]['median'] = $takeReveue[$medianIndex-1];
									/*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />"; */
									  /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray[$indexC]['Total Productivity'] = round($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray[$indexC]['Total Cards'] = "0";
											 if(count($salesTimeArray) == 1)
												{
											 $graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['Mean'] = "0";
											 $graphArray[$indexC]['median'] = "0";
											 $graphArray[$indexC]['Total Productivity'] = "0";
									}
							}
							else
							{
											 $graphArray[$indexC]['Total Revenue'] = "0";
											  if(count($salesTimeArray) == 1)
												{
											 $graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['Mean'] = "0";
											 $graphArray[$indexC]['median'] = "0";
											 $graphArray[$indexC]['Total Productivity'] = "0";
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsmean_median_rev_ENBDHistroy_p($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
					}
					
					/*
					*report as per vintage
					*coding start
					*/
					}
					else
					{
					/*
					*report as per sales time
					*coding start
					*/
					foreach($salesTimeArray as $_salesT)
					{
						$graphArray[$indexC]['Sales Time'] = $_salesT;
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->where("sales_time",$_salesT)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->where("sales_time",$_salesT)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
								$tl_name = '';
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->tc_card;
										$totalReveue = $totalReveue+$_mashreq->tc_card;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray[$indexC]['Total Cards'] = $totalReveue;
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									  if(count($salesTimeArray) == 1)
										{
											$graphArray[$indexC]['Total Head Count'] = $countR;
										}
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									 $graphArray[$indexC]['Mean'] = $avg;;
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex < 0)
									 {
										 $medianIndex = 1;
									 }
									  $graphArray[$indexC]['median'] = $takeReveue[$medianIndex-1];
									/*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />"; */
									  /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray[$indexC]['Total Productivity'] = round($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray[$indexC]['Total Cards'] = "0";
											 if(count($salesTimeArray) == 1)
												{
											 $graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['Mean'] = "0";
											 $graphArray[$indexC]['median'] = "0";
											 $graphArray[$indexC]['Total Productivity'] = "0";
									}
							}
							else
							{
											 $graphArray[$indexC]['Total Revenue'] = "0";
											  if(count($salesTimeArray) == 1)
												{
											 $graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['Mean'] = "0";
											 $graphArray[$indexC]['median'] = "0";
											 $graphArray[$indexC]['Total Productivity'] = "0";
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsmean_median_rev_ENBDHistroy_p($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
					}
					
					/*
					*report as per sales time
					*coding start
					*/
					}
					
						$graphArray[$indexC]['Sales Time'] = "Total";
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
								$tl_name = '';
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->tc_card;
										$totalReveue = $totalReveue+$_mashreq->tc_card;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray[$indexC]['Total Cards'] = $totalReveue;
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									  if(count($salesTimeArray) == 1)
										{
											$graphArray[$indexC]['Total Head Count'] = $countR;
										}
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									 $graphArray[$indexC]['Mean'] = $avg;;
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									  $graphArray[$indexC]['median'] = $takeReveue[$medianIndex-1];
									/*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />"; */
									  /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray[$indexC]['Total Productivity'] = round($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray[$indexC]['Total Cards'] = "0";
											 if(count($salesTimeArray) == 1)
												{
											 $graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['Mean'] = "0";
											 $graphArray[$indexC]['median'] = "0";
											 $graphArray[$indexC]['Total Productivity'] = "0";
									}
							}
							else
							{
											 $graphArray[$indexC]['Total Revenue'] = "0";
											  if(count($salesTimeArray) == 1)
												{
											 $graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['Mean'] = "0";
											 $graphArray[$indexC]['median'] = "0";
											 $graphArray[$indexC]['Total Productivity'] = "0";
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsmean_median_rev_ENBDHistroy_p($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
					/* echo "<pre>";
					print_r($graphArray);
					exit; */
					return $graphArrayM;
	}
}
protected function getDataAsmean_median_rev_ENBDTotal_p($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
{
	$graphArray = array();
					
						$graphArray['Sales Time'] = "Total";
						$graphArray['TL Name'] = "";
						$graphArray['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->whereIn("tl_name",$tl_name_array)->get();
							
						
							
						}
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->tc_card;
										$totalReveue = $totalReveue+$_mashreq->tc_card;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray['Total Cards'] = $totalReveue;
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									  if(count($salesTimeArray) == 1)
										{
											 $graphArray['Total Head Count'] = $countR;
										}
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									 $graphArray['Mean'] = $avg;
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex < 0)
									 {
										 $medianIndex = 0;
									 }
									  $graphArray['median'] = $takeReveue[$medianIndex-1];
									/*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />"; */
									  /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray['Total Productivity'] = round($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray['Total Cards'] = "0";
											  if(count($salesTimeArray) == 1)
												{
											 $graphArray['Total Head Count'] = 0;
												}
											 $graphArray['Mean'] = "0";
											 $graphArray['median'] = "0";
											 $graphArray['Total Productivity'] = "0";
									}
							}
							else
							{
											 $graphArray['Total Cards'] = "0";
											  if(count($salesTimeArray) == 1)
												{
											 $graphArray['Total Head Count'] = 0;
												}
											 $graphArray['Mean'] = "0";
											 $graphArray['median'] = "0";
											 $graphArray['Total Productivity'] = "0";
							}
							if($historical_data == "yes")
							{
								$graphArrayT = $this->getDataAsmean_median_rev_ENBDHistroyTotal_p($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout);
								$graphArrayTD = array_merge($graphArray,$graphArrayT);
							}
							else
							{
								$graphArrayTD = $graphArray;
							}
							return $graphArrayTD;
							
}

protected function getDataAsmean_median_rev_ENBDHistroyTotal_p($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout)
{
	$whereRaw = '';
						/* if($teamleaderwithout != "yes")
						{
							if($tl_name != 'No')
							{
								if($whereRaw == '')
								{
									$whereRaw = "tl_name = '".$tl_name."'";
								}
								else
								{
									$whereRaw .= " AND tl_name= '".$tl_name."'";
								}
							} 
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereraw($whereRaw)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
								$tl_name = '';
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->tc_card;
										$totalReveue = $totalReveue+$_mashreq->tc_card;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray['Historical Total Cards'] = $totalReveue;
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									/*  $graphArray[$indexC]['Historical Total Head Count'] = $countR; */
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									 $graphArray['Historical Mean'] = $avg;;
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex < 0)
									 {
										 $medianIndex = 0;
									 }
									  $graphArray['Historical median'] = $takeReveue[$medianIndex-1];
									/*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />"; */
									  /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray['Historical Total Productivity'] = round($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray['Historical Total Cards'] = "0";
											 /* $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											 $graphArray['Historical Mean'] = "0";
											 $graphArray['Historical median'] = "0";
											 $graphArray['Historical Total Productivity'] = "0";
									}
							}
							else
							{
											 $graphArray['Historical Total Cards'] = "0";
											/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											 $graphArray['Historical Mean'] = "0";
											 $graphArray['Historical median'] = "0";
											 $graphArray['Historical Total Productivity'] = "0";
							}
							return $graphArray;
}
protected function getDataAsmean_median_rev_ENBDHistroy_p($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC)
{
	
							
					
						
						
						$whereRaw = '';
						if($teamleaderwithout != "yes")
						{
							if($tl_name != 'No')
							{
								if($whereRaw == '')
								{
									$whereRaw = "tl_name = '".$tl_name."'";
								}
								else
								{
									$whereRaw .= " AND tl_name= '".$tl_name."'";
								}
							} 
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
								$tl_name = '';
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->tc_card;
										$totalReveue = $totalReveue+$_mashreq->tc_card;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray[$indexC]['Historical Total Cards'] = $totalReveue;
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									/*  $graphArray[$indexC]['Historical Total Head Count'] = $countR; */
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									 $graphArray[$indexC]['Historical Mean'] = $avg;;
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex < 0)
									 {
										 $medianIndex = 0;
									 }
									  $graphArray[$indexC]['Historical median'] = $takeReveue[$medianIndex-1];
									/*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />"; */
									  /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />"; */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray[$indexC]['Historical Total Productivity'] = round($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray[$indexC]['Historical Total Cards'] = "0";
											 /* $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											 $graphArray[$indexC]['Historical Mean'] = "0";
											 $graphArray[$indexC]['Historical median'] = "0";
											 $graphArray[$indexC]['Historical Total Productivity'] = "0";
									}
							}
							else
							{
											 $graphArray[$indexC]['Historical Total Cards'] = "0";
											/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											 $graphArray[$indexC]['Historical Mean'] = "0";
											 $graphArray[$indexC]['Historical median'] = "0";
											 $graphArray[$indexC]['Historical Total Productivity'] = "0";
							}
							return $graphArray;
}


protected function getDataAsquartile_p($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
	{
		if($teamleaderwithout != "yes")
		{
		$indexC = 0;
				
					foreach($tl_name_array as $tl_name)
					{
						$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						$graphArray[$indexC]['TL Name'] = $tl_name;
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->cards_mashreq;
										$totalReveue = $totalReveue+$_mashreq->cards_mashreq;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray[$indexC]['Total Cards'] = $totalReveue;
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									 if(count($salesTimeArray) == 1)
									 {
									  $graphArray[$indexC]['Total Head Count'] =$countR;
									 }
									  //$graphArray[$indexC]['Mean'] = "AED ".$avg;
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray[$indexC]['median'] = $takeReveue[$medianIndex];
									 /*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />"; */
									  if($q10Index-1 <0)
									  {
										  $q10Index = $q10Index+1;
									  }
									  $graphArray[$indexC]['quartilile 10%'] = $takeReveue[$q10Index-1];
									   if($q25Index-1 <0)
									  {
										  $q25Index = $q25Index+1;
									  }
									  $graphArray[$indexC]['quartilile 25%'] = $takeReveue[$q25Index-1];
									  if($q75Index-1 <0)
									  {
										  $q75Index = $q75Index+1;
									  }
									  $graphArray[$indexC]['quartilile 75%'] = $takeReveue[$q75Index-1];
									    if($q100Index-1 <0)
									  {
										  $q75Index = $q100Index+1;
									  }
									  $graphArray[$indexC]['quartilile 100%'] = $takeReveue[$q100Index-1];
									  
									/*   echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										
										
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray[$indexC]['Total Productivity'] = round($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											 $graphArray[$indexC]['Total Cards'] = "0";
											  if(count($salesTimeArray) == 1)
												{
											 $graphArray[$indexC]['Total Head Count'] = 0;
												}
											/*  $graphArray[$indexC]['Mean'] = "AED 0"; */
											 $graphArray[$indexC]['median'] = "0";
											 $graphArray[$indexC]['quartilile 10%'] = "0";
											 $graphArray[$indexC]['quartilile 25%'] = "0";
											 $graphArray[$indexC]['quartilile 75%'] = "0";
											 $graphArray[$indexC]['quartilile 100%'] = "0";
											 $graphArray[$indexC]['Total Productivity'] = "0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray[$indexC]['Total Cards'] = "0";
								  if(count($salesTimeArray) == 1)
									 {
								 $graphArray[$indexC]['Total Head Count'] = 0;
									 }
								 $graphArray[$indexC]['median'] = "0";
								 $graphArray[$indexC]['quartilile 10%'] = "0";
								 $graphArray[$indexC]['quartilile 25%'] = "0";
								 $graphArray[$indexC]['quartilile 75%'] = "0";
								 $graphArray[$indexC]['quartilile 100%'] = "0";
								 $graphArray[$indexC]['Total Productivity'] = "0";
							}
							if($historical_data == "yes")
							{
							$graphArray1 = $this->getDataAsquartileHistroy_p($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
						
					}
					$graphArrayM[$indexC] = $this->getDataAsquartileTotal_p($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
					return $graphArrayM;
		}
		else
		{
			$indexC = 0;
			$tl_name = '';	
			$graphArray = array();
			
			if(count($salesTimeArray) == 1 && $vintage_name_SI != 'No')
			{
			/*
			*report as per vintage
			*coding start
			*/
			$vintage_name_SIArray = explode(",",$vintage_name_SI);
			foreach($vintage_name_SIArray as $vintage)
			{
				$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id = ".$vintage;
							}
							else
							{
								$whereRaw .= " AND range_id = ".$vintage;
							}
							$graphArray[$indexC]['Vintage'] = $vintage;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->cards_mashreq;
										$totalReveue = $totalReveue+$_mashreq->cards_mashreq;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray[$indexC]['Total Cards'] = $totalReveue;
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									  if(count($salesTimeArray) == 1)
										 {
										  $graphArray[$indexC]['Total Head Count'] =$countR;
										 }
									  //$graphArray[$indexC]['Mean'] = "AED ".$avg;
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray[$indexC]['median'] = $takeReveue[$medianIndex];
									 /*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />"; */
									  if($q10Index-1 <0)
									  {
										  $q10Index = $q10Index+1;
									  }
									  $graphArray[$indexC]['quartilile 10%'] = $takeReveue[$q10Index-1];
									   if($q25Index-1 <0)
									  {
										  $q25Index = $q25Index+1;
									  }
									  $graphArray[$indexC]['quartilile 25%'] = $takeReveue[$q25Index-1];
									  if($q75Index-1 <0)
									  {
										  $q75Index = $q75Index+1;
									  }
									  $graphArray[$indexC]['quartilile 75%'] = $takeReveue[$q75Index-1];
									    if($q100Index-1 <0)
									  {
										  $q75Index = $q100Index+1;
									  }
									  $graphArray[$indexC]['quartilile 100%'] = $takeReveue[$q100Index-1];
									  
									/*   echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										
										
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray[$indexC]['Total Productivity'] = round($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											 $graphArray[$indexC]['Total Cards'] = "0";
											  if(count($salesTimeArray) == 1)
												{
												 $graphArray[$indexC]['Total Head Count'] = 0;
												}
											/*  $graphArray[$indexC]['Mean'] = "AED 0"; */
											 $graphArray[$indexC]['median'] = "0";
											 $graphArray[$indexC]['quartilile 10%'] = "0";
											 $graphArray[$indexC]['quartilile 25%'] = "0";
											 $graphArray[$indexC]['quartilile 75%'] = "0";
											 $graphArray[$indexC]['quartilile 100%'] = "0";
											 $graphArray[$indexC]['Total Productivity'] = "0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray[$indexC]['Total Cards'] = "0";
								  if(count($salesTimeArray) == 1)
									 {
								 $graphArray[$indexC]['Total Head Count'] = 0;
									 }
								 $graphArray[$indexC]['median'] = "0";
								 $graphArray[$indexC]['quartilile 10%'] = "0";
								 $graphArray[$indexC]['quartilile 25%'] = "0";
								 $graphArray[$indexC]['quartilile 75%'] = "0";
								 $graphArray[$indexC]['quartilile 100%'] = "0";
								 $graphArray[$indexC]['Total Productivity'] = "0";
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsquartileHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
			}
			
			/*
			*report as per vintage
			*coding start
			*/
			
			}
			else
			{
			/*
			*report as per sales time
			*coding start
			*/
			foreach($salesTimeArray as $_salesT)
			{
				$graphArray[$indexC]['Sales Time'] = $_salesT;
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::where("end_sales_time",$_salesT)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->cards_mashreq;
										$totalReveue = $totalReveue+$_mashreq->cards_mashreq;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray[$indexC]['Total Cards'] = $totalReveue;
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									  if(count($salesTimeArray) == 1)
										 {
										  $graphArray[$indexC]['Total Head Count'] =$countR;
										 }
									  //$graphArray[$indexC]['Mean'] = "AED ".$avg;
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray[$indexC]['median'] = $takeReveue[$medianIndex];
									 /*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />"; */
									  if($q10Index-1 <0)
									  {
										  $q10Index = $q10Index+1;
									  }
									  $graphArray[$indexC]['quartilile 10%'] = $takeReveue[$q10Index-1];
									   if($q25Index-1 <0)
									  {
										  $q25Index = $q25Index+1;
									  }
									  $graphArray[$indexC]['quartilile 25%'] = $takeReveue[$q25Index-1];
									  if($q75Index-1 <0)
									  {
										  $q75Index = $q75Index+1;
									  }
									  $graphArray[$indexC]['quartilile 75%'] = $takeReveue[$q75Index-1];
									    if($q100Index-1 <0)
									  {
										  $q75Index = $q100Index+1;
									  }
									  $graphArray[$indexC]['quartilile 100%'] = $takeReveue[$q100Index-1];
									  
									/*   echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										
										
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray[$indexC]['Total Productivity'] = round($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											 $graphArray[$indexC]['Total Cards'] = "0";
											  if(count($salesTimeArray) == 1)
												{
												 $graphArray[$indexC]['Total Head Count'] = 0;
												}
											/*  $graphArray[$indexC]['Mean'] = "AED 0"; */
											 $graphArray[$indexC]['median'] = "0";
											 $graphArray[$indexC]['quartilile 10%'] = "0";
											 $graphArray[$indexC]['quartilile 25%'] = "0";
											 $graphArray[$indexC]['quartilile 75%'] = "0";
											 $graphArray[$indexC]['quartilile 100%'] = "0";
											 $graphArray[$indexC]['Total Productivity'] = "0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray[$indexC]['Total Cards'] = "0";
								  if(count($salesTimeArray) == 1)
									 {
								 $graphArray[$indexC]['Total Head Count'] = 0;
									 }
								 $graphArray[$indexC]['median'] = "0";
								 $graphArray[$indexC]['quartilile 10%'] = "0";
								 $graphArray[$indexC]['quartilile 25%'] = "0";
								 $graphArray[$indexC]['quartilile 75%'] = "0";
								 $graphArray[$indexC]['quartilile 100%'] = "0";
								 $graphArray[$indexC]['Total Productivity'] = "0";
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsquartileHistroy_p($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
			}
			/*
			*report as per sales time
			*coding end
			*/
			}
					
						$graphArray[$indexC]['Sales Time'] = "Total";
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "Mashreq";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->cards_mashreq;
										$totalReveue = $totalReveue+$_mashreq->cards_mashreq;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray[$indexC]['Total Cards'] = $totalReveue;
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									  if(count($salesTimeArray) == 1)
										 {
										  $graphArray[$indexC]['Total Head Count'] =$countR;
										 }
									  //$graphArray[$indexC]['Mean'] = "AED ".$avg;
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray[$indexC]['median'] = $takeReveue[$medianIndex];
									 /*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />"; */
									  if($q10Index-1 <0)
									  {
										  $q10Index = $q10Index+1;
									  }
									  $graphArray[$indexC]['quartilile 10%'] = $takeReveue[$q10Index-1];
									   if($q25Index-1 <0)
									  {
										  $q25Index = $q25Index+1;
									  }
									  $graphArray[$indexC]['quartilile 25%'] = $takeReveue[$q25Index-1];
									  if($q75Index-1 <0)
									  {
										  $q75Index = $q75Index+1;
									  }
									  $graphArray[$indexC]['quartilile 75%'] = $takeReveue[$q75Index-1];
									    if($q100Index-1 <0)
									  {
										  $q75Index = $q100Index+1;
									  }
									  $graphArray[$indexC]['quartilile 100%'] = $takeReveue[$q100Index-1];
									  
									/*   echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										
										
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray[$indexC]['Total Productivity'] = round($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											 $graphArray[$indexC]['Total Cards'] = "0";
											  if(count($salesTimeArray) == 1)
												{
												 $graphArray[$indexC]['Total Head Count'] = 0;
												}
											/*  $graphArray[$indexC]['Mean'] = "AED 0"; */
											 $graphArray[$indexC]['median'] = "0";
											 $graphArray[$indexC]['quartilile 10%'] = "0";
											 $graphArray[$indexC]['quartilile 25%'] = "0";
											 $graphArray[$indexC]['quartilile 75%'] = "0";
											 $graphArray[$indexC]['quartilile 100%'] = "0";
											 $graphArray[$indexC]['Total Productivity'] = "0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray[$indexC]['Total Cards'] = "0";
								  if(count($salesTimeArray) == 1)
									 {
								 $graphArray[$indexC]['Total Head Count'] = 0;
									 }
								 $graphArray[$indexC]['median'] = "0";
								 $graphArray[$indexC]['quartilile 10%'] = "0";
								 $graphArray[$indexC]['quartilile 25%'] = "0";
								 $graphArray[$indexC]['quartilile 75%'] = "0";
								 $graphArray[$indexC]['quartilile 100%'] = "0";
								 $graphArray[$indexC]['Total Productivity'] = "0";
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsquartileHistroy_p($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
					return $graphArrayM;
		}
	}
	protected function getDataAsquartileTotal_p($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
	{
						$graphArray = array();
						$graphArray['Sales Time'] = "Total";
						$graphArray['TL Name'] = "";
						$graphArray['Bank'] = "Mashreq";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							$graphArray['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							$graphArray['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray['Vintage'] = $vintage_name_SI;
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("end_sales_time",$salesTimeArray)->whereraw($whereRaw)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->cards_mashreq;
										$totalReveue = $totalReveue+$_mashreq->cards_mashreq;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray['Total Cards'] = $totalReveue;
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									 if(count($salesTimeArray) == 1)
									 {
									  $graphArray['Total Head Count'] =$countR;
									 }
									  //$graphArray[$indexC]['Mean'] = "AED ".$avg;
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray['median'] = $takeReveue[$medianIndex];
									 /*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />"; */
									  if($q10Index-1 <0)
									  {
										  $q10Index = $q10Index+1;
									  }
									  $graphArray['quartilile 10%'] = $takeReveue[$q10Index-1];
									   if($q25Index-1 <0)
									  {
										  $q25Index = $q25Index+1;
									  }
									  $graphArray['quartilile 25%'] = $takeReveue[$q25Index-1];
									  if($q75Index-1 <0)
									  {
										  $q75Index = $q75Index+1;
									  }
									  $graphArray['quartilile 75%'] = $takeReveue[$q75Index-1];
									    if($q100Index-1 <0)
									  {
										  $q75Index = $q100Index+1;
									  }
									  $graphArray['quartilile 100%'] = $takeReveue[$q100Index-1];
									  
									/*   echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										
										
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray['Total Productivity'] = round($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											 $graphArray['Total Cards'] = "0";
											  if(count($salesTimeArray) == 1)
												{
											 $graphArray['Total Head Count'] = 0;
												}
											/*  $graphArray[$indexC]['Mean'] = "AED 0"; */
											 $graphArray['median'] = "0";
											 $graphArray['quartilile 10%'] = "0";
											 $graphArray['quartilile 25%'] = "0";
											 $graphArray['quartilile 75%'] = "0";
											 $graphArray['quartilile 100%'] = "0";
											 $graphArray['Total Productivity'] = "0";
										}
							
						
						/*end code*/
						}
						else
							{
								 $graphArray['Total Cards'] = "0";
								  if(count($salesTimeArray) == 1)
									 {
								 $graphArray['Total Head Count'] = 0;
									 }
								 $graphArray['median'] = "0";
								 $graphArray['quartilile 10%'] = "0";
								 $graphArray['quartilile 25%'] = "0";
								 $graphArray['quartilile 75%'] = "0";
								 $graphArray['quartilile 100%'] = "0";
								 $graphArray['Total Productivity'] = "0";
							}
							if($historical_data == "yes")
							{
							$graphArrayT = $this->getDataAsquartileHistroyTotal_p($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout);
							$graphArrayTD = array_merge($graphArray,$graphArrayT);
							}
							else
							{
								$graphArrayTD = $graphArray;
							}
							return $graphArrayTD;
						
					
	}
	protected function getDataAsquartileHistroyTotal_p($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout)
	{
			$whereRaw = '';
						/* if($teamleaderwithout != "yes")
						{
							if($tl_name != 'No')
							{
								if($whereRaw == '')
								{
									$whereRaw = "tl_name = '".$tl_name."'";
								}
								else
								{
									$whereRaw .= " AND tl_name= '".$tl_name."'";
								}
							} 
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereraw($whereRaw)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->cards_mashreq;
										$totalReveue = $totalReveue+$_mashreq->cards_mashreq;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray['Historical Total Cards'] = $totalReveue;
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									 /*  $graphArray[$indexC]['Historical Total Head Count'] =$countR; */
									  //$graphArray[$indexC]['Mean'] = "AED ".$avg;
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray['Historical median'] = $takeReveue[$medianIndex];
									 /*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />"; */
									  if($q10Index-1 <0)
									  {
										  $q10Index = $q10Index+1;
									  }
									  $graphArray['Historical quartilile 10%'] = $takeReveue[$q10Index-1];
									   if($q25Index-1 <0)
									  {
										  $q25Index = $q25Index+1;
									  }
									  $graphArray['Historical quartilile 25%'] = $takeReveue[$q25Index-1];
									  if($q75Index-1 <0)
									  {
										  $q75Index = $q75Index+1;
									  }
									  $graphArray['Historical quartilile 75%'] = $takeReveue[$q75Index-1];
									    if($q100Index-1 <0)
									  {
										  $q75Index = $q100Index+1;
									  }
									  $graphArray['Historical quartilile 100%'] = $takeReveue[$q100Index-1];
									  
									/*   echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										
										
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray['Historical Total Productivity'] = round($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											 $graphArray['Historical Total Cards'] = "0";
											/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											/*  $graphArray[$indexC]['Mean'] = "AED 0"; */
											 $graphArray['Historical median'] = "0";
											 $graphArray['Historical quartilile 10%'] = "0";
											 $graphArray['Historical quartilile 25%'] = "0";
											 $graphArray['Historical quartilile 75%'] = "0";
											 $graphArray['Historical quartilile 100%'] = "0";
											 $graphArray['Historical Total Productivity'] = "0";
										}
							
						
						/*end code*/
						}
						else
							{
											$graphArray['Historical Total Cards'] = "0";
											/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											/*  $graphArray[$indexC]['Mean'] = "AED 0"; */
											 $graphArray['Historical median'] = "0";
											 $graphArray['Historical quartilile 10%'] = "0";
											 $graphArray['Historical quartilile 25%'] = "0";
											 $graphArray['Historical quartilile 75%'] = "0";
											 $graphArray['Historical quartilile 100%'] = "0";
											 $graphArray['Historical Total Productivity'] = "0";
							}
							return $graphArray;
	}
	protected function getDataAsquartileHistroy_p($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC)
	{

						
						
						$whereRaw = '';
						if($teamleaderwithout != "yes")
						{
							if($tl_name != 'No')
							{
								if($whereRaw == '')
								{
									$whereRaw = "tl_name = '".$tl_name."'";
								}
								else
								{
									$whereRaw .= " AND tl_name= '".$tl_name."'";
								}
							} 
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARDS'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARDS'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARDS'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						 /* echo $whereRaw;exit;
						 echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayoutMashreq::get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayoutMashreq::whereraw($whereRaw)->get();
							
							
						}
						 /*  echo "<pre>";
						echo count($allMashreqData);
						exit; */  
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->cards_mashreq;
										$totalReveue = $totalReveue+$_mashreq->cards_mashreq;
										
									}
									
									rsort($takeReveue);
									  /* echo "<pre>";
									print_r($takeReveue);
									echo "<br>"; exit; */
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									 /*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									 $graphArray[$indexC]['Historical Total Cards'] = $totalReveue;
									 
									 /* foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayoutMashreq::where("end_sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										
									 } */
									 /*  $graphArray[$indexC]['Historical Total Head Count'] =$countR; */
									  //$graphArray[$indexC]['Mean'] = "AED ".$avg;
									
									 /* echo "Mean - AED".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									 $graphArray[$indexC]['Historical median'] = $takeReveue[$medianIndex];
									 /*  echo "median - AED".$takeReveue[$medianIndex];
									  echo "<br />"; */
									  if($q10Index-1 <0)
									  {
										  $q10Index = $q10Index+1;
									  }
									  $graphArray[$indexC]['Historical quartilile 10%'] = $takeReveue[$q10Index-1];
									   if($q25Index-1 <0)
									  {
										  $q25Index = $q25Index+1;
									  }
									  $graphArray[$indexC]['Historical quartilile 25%'] = $takeReveue[$q25Index-1];
									  if($q75Index-1 <0)
									  {
										  $q75Index = $q75Index+1;
									  }
									  $graphArray[$indexC]['Historical quartilile 75%'] = $takeReveue[$q75Index-1];
									    if($q100Index-1 <0)
									  {
										  $q75Index = $q100Index+1;
									  }
									  $graphArray[$indexC]['Historical quartilile 100%'] = $takeReveue[$q100Index-1];
									  
									/*   echo "quartilile 10% - AED".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25% - AED".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75% - AED".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100% - AED".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									 /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED".$takeReveue[$quarD-1];
											echo "<br />"; 
										} */
									  
									
										
										
										
										
										/*
										*top 100% revenue
										*/
												/*
												*top dynamic revenue
												*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 }
												 
												
												$topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												}
												
												
											 } */
											 /* echo '<pre>';
												print_r($takeReveue);
												exit; */
												/*
												*top dynamic revenue
												*/
										/*  echo "<br />";
										echo "top10 Revenue  - AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Revenue - AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Revenue - AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Revenue - AED ".$top100Revenue;
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - AED ".$topqtRevenue;
										echo "<br />"; */
										/* } */
										/* $graphArray[$indexC]['top10 Revenue'] = round(($top10Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top25 Revenue'] = round(($top25Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top75 Revenue'] = round(($top75Revenue/$totalReveue)*100)."%";
										$graphArray[$indexC]['top100 Revenue'] = round(($top100Revenue/$totalReveue)*100)."%"; */
									/* 	echo "top10 Revenue  - ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* echo "top25 Revenue - ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Revenue - ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Revenue - ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/*  if($qt1 != "No" && $qt2 != "No")
										{ */
										/* echo "top".$qt1."-".$qt2." Revenue - ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />"; */
										/* } */
											$graphArray[$indexC]['Historical Total Productivity'] = round($totalReveue/$countR,2);
									
									
									
									
									
										}
										else
										{
											 $graphArray[$indexC]['Historical Total Cards'] = "0";
											/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											/*  $graphArray[$indexC]['Mean'] = "AED 0"; */
											 $graphArray[$indexC]['Historical median'] = "0";
											 $graphArray[$indexC]['Historical quartilile 10%'] = "0";
											 $graphArray[$indexC]['Historical quartilile 25%'] = "0";
											 $graphArray[$indexC]['Historical quartilile 75%'] = "0";
											 $graphArray[$indexC]['Historical quartilile 100%'] = "0";
											 $graphArray[$indexC]['Historical Total Productivity'] = "0";
										}
							
						
						/*end code*/
						}
						else
							{
								$graphArray[$indexC]['Historical Total Cards'] = "0";
											/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											/*  $graphArray[$indexC]['Mean'] = "AED 0"; */
											 $graphArray[$indexC]['Historical median'] = "0";
											 $graphArray[$indexC]['Historical quartilile 10%'] = "0";
											 $graphArray[$indexC]['Historical quartilile 25%'] = "0";
											 $graphArray[$indexC]['Historical quartilile 75%'] = "0";
											 $graphArray[$indexC]['Historical quartilile 100%'] = "0";
											 $graphArray[$indexC]['Historical Total Productivity'] = "0";
							}
							return $graphArray;
	}
	
	
	public function getDataAsquartile_ENBD_p($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
{
	if($teamleaderwithout != "yes")
	{
	$indexC = 0;
					$graphArray = array();
					foreach($tl_name_array as $tl_name)
					{
						$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						$graphArray[$indexC]['TL Name'] = $tl_name;
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
									$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->tc_card;
										$totalReveue = $totalReveue+$_mashreq->tc_card;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray[$indexC]['Total Cards'] = $totalReveue;
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									  if(count($salesTimeArray) == 1)
												{
											$graphArray[$indexC]['Total Head Count'] = $countR;
												}
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									/*  $graphArray[$indexC]['Mean'] = "AED ".$avg;; */
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex < 0)
									 {
										 $medianIndex = 0;
									 }
									  $graphArray[$indexC]['median'] = $takeReveue[$medianIndex-1];
									 /*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />";  */
									  if($q10Index-1 < 0)
									  {
										  $q10Index = 1;
									  }
									   $graphArray[$indexC]['quartilile 10%'] = $takeReveue[$q10Index-1];
									   if($q25Index-1 < 0)
									  {
										  $q25Index = 1;
									  }
								 $graphArray[$indexC]['quartilile 25%'] = $takeReveue[$q25Index-1];
								 if($q75Index-1 < 0)
									  {
										  $q75Index = 1;
									  }
								 $graphArray[$indexC]['quartilile 75%'] = $takeReveue[$q75Index-1];
								 if($q100Index-1 < 0)
									  {
										  $q100Index = 1;
									  }
								 $graphArray[$indexC]['quartilile 100%'] = $takeReveue[$q100Index-1];
									   /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray[$indexC]['Total Productivity'] = round($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray[$indexC]['Total Cards'] = "0";
											  if(count($salesTimeArray) == 1)
												{
													$graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['median'] = "0";
											 $graphArray[$indexC]['quartilile 10%'] = "0";
											 $graphArray[$indexC]['quartilile 25%'] = "0";
											 $graphArray[$indexC]['quartilile 75%'] = "0";
											 $graphArray[$indexC]['quartilile 100%'] = "0";
											 $graphArray[$indexC]['Total Productivity'] = "0";
									}
							}
							else
							{
											 $graphArray[$indexC]['Total Cards'] = "0";
											  if(count($salesTimeArray) == 1)
												{
													$graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['median'] = "0";
											 $graphArray[$indexC]['quartilile 10%'] = "0";
											 $graphArray[$indexC]['quartilile 25%'] = "0";
											 $graphArray[$indexC]['quartilile 75%'] = "0";
											 $graphArray[$indexC]['quartilile 100%'] = "0";
											 $graphArray[$indexC]['Total Productivity'] = "0";
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsquartile_ENBDHistroy_p($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
					}
					$graphArrayM[$indexC] = $this->getDataAsquartile_ENBDTotal_p($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
					/* echo "<pre>";
					print_r($graphArray);
					exit; */
					return $graphArrayM;
	}
	else
	{
		$indexC = 0;
					$graphArray = array();
					$tl_name = '';
					
					if(count($salesTimeArray)==1 && $vintage_name_SI != 'No')
					{
					/*
					*report as per vintage
					*coding start
					*/
					$vintage_name_SIArray = explode(",",$vintage_name_SI);
					foreach($vintage_name_SIArray as $vintage)
					{
						$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id = ".$vintage;
							}
							else
							{
								$whereRaw .= " AND range_id = ".$vintage;
							}
							$graphArray[$indexC]['Vintage'] = $vintage;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->tc_card;
										$totalReveue = $totalReveue+$_mashreq->tc_card;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray[$indexC]['Total Cards'] = $totalReveue;
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									  if(count($salesTimeArray) == 1)
												{
												$graphArray[$indexC]['Total Head Count'] = $countR;
												}
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									/*  $graphArray[$indexC]['Mean'] = "AED ".$avg;; */
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex-1 < 0)
									 {
										 $medianIndex = 1;
									 }
									  $graphArray[$indexC]['median'] = $takeReveue[$medianIndex-1];
									 /*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />";  */
									   if($q10Index-1 < 0)
										 {
											 $q10Index = 1;
										 }
									   $graphArray[$indexC]['quartilile 10%'] =$takeReveue[$q10Index-1];
									    if($q25Index-1 < 0)
										 {
											 $q25Index = 1;
										 }
								 $graphArray[$indexC]['quartilile 25%'] = $takeReveue[$q25Index-1];
								  if($q75Index-1 < 0)
										 {
											 $q75Index = 1;
										 }
								 $graphArray[$indexC]['quartilile 75%'] = $takeReveue[$q75Index-1];
								   if($q100Index-1 < 0)
										 {
											 $q100Index = 1;
										 }
								 $graphArray[$indexC]['quartilile 100%'] = $takeReveue[$q100Index-1];
									   /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray[$indexC]['Total Productivity'] = round($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray[$indexC]['Total Cards'] = "0";
											  if(count($salesTimeArray) == 1)
												{
												$graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['median'] = "0";
											 $graphArray[$indexC]['quartilile 10%'] = "0";
											 $graphArray[$indexC]['quartilile 25%'] = "0";
											 $graphArray[$indexC]['quartilile 75%'] = "0";
											 $graphArray[$indexC]['quartilile 100%'] = "0";
											 $graphArray[$indexC]['Total Productivity'] = "0";
									}
							}
							else
							{
											 $graphArray[$indexC]['Total Revenue'] = "0";
											  if(count($salesTimeArray) == 1)
												{
												$graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['median'] = "0";
											 $graphArray[$indexC]['quartilile 10%'] = "0";
											 $graphArray[$indexC]['quartilile 25%'] = "0";
											 $graphArray[$indexC]['quartilile 75%'] = "0";
											 $graphArray[$indexC]['quartilile 100%'] = "0";
											 $graphArray[$indexC]['Total Productivity'] = "0";
							}
							
					/* echo "<pre>";
					print_r($graphArray);
					exit; */
					if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsquartile_ENBDHistroy_p($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
						else
						{
							$graphArrayM[$indexC] = $graphArray[$indexC];
						}
						
						$indexC++;
					}
					/*
					*report as per vintage
					*coding start
					*/
					
					}
					else
					{
					/*
					*report as per sales time
					*coding start
					*/
					foreach($salesTimeArray as $_salesT)
					{
						$graphArray[$indexC]['Sales Time'] = $_salesT;
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->where("sales_time",$_salesT)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->where("sales_time",$_salesT)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->tc_card;
										$totalReveue = $totalReveue+$_mashreq->tc_card;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray[$indexC]['Total Cards'] = $totalReveue;
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									  if(count($salesTimeArray) == 1)
												{
												$graphArray[$indexC]['Total Head Count'] = $countR;
												}
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									/*  $graphArray[$indexC]['Mean'] = "AED ".$avg;; */
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex <= 0)
									 {
										 $medianIndex = 1;
									 }
									  $graphArray[$indexC]['median'] = $takeReveue[$medianIndex-1];
									 /*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />";  */
									   if($q10Index <= 0)
									 {
										 $q10Index = 1;
									 }
									   $graphArray[$indexC]['quartilile 10%'] = $takeReveue[$q10Index-1];
									     if($q25Index <= 0)
									 {
										 $q25Index = 1;
									 }
								 $graphArray[$indexC]['quartilile 25%'] = $takeReveue[$q25Index-1];
								   if($q75Index <= 0)
									 {
										 $q75Index = 1;
									 }
								 $graphArray[$indexC]['quartilile 75%'] = $takeReveue[$q75Index-1];
								  if($q100Index <= 0)
									 {
										 $q100Index = 1;
									 }
								 $graphArray[$indexC]['quartilile 100%'] = $takeReveue[$q100Index-1];
									   /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray[$indexC]['Total Productivity'] = round($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray[$indexC]['Total Revenue'] = "0";
											  if(count($salesTimeArray) == 1)
												{
												$graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['median'] = "0";
											 $graphArray[$indexC]['quartilile 10%'] = "0";
											 $graphArray[$indexC]['quartilile 25%'] = "0";
											 $graphArray[$indexC]['quartilile 75%'] = "0";
											 $graphArray[$indexC]['quartilile 100%'] = "0";
											 $graphArray[$indexC]['Total Productivity'] = "0";
									}
							}
							else
							{
											 $graphArray[$indexC]['Total Revenue'] = "0";
											  if(count($salesTimeArray) == 1)
												{
												$graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['median'] = "0";
											 $graphArray[$indexC]['quartilile 10%'] = "0";
											 $graphArray[$indexC]['quartilile 25%'] = "0";
											 $graphArray[$indexC]['quartilile 75%'] = "0";
											 $graphArray[$indexC]['quartilile 100%'] = "0";
											 $graphArray[$indexC]['Total Productivity'] = "0";
							}
							
					/* echo "<pre>";
					print_r($graphArray);
					exit; */
					if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsquartile_ENBDHistroy_p($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
						else
						{
							$graphArrayM[$indexC] = $graphArray[$indexC];
						}
						
						$indexC++;
					}
					
					/*
					*report as per sales time
					*coding end
					*/
					}
						$graphArray[$indexC]['Sales Time'] = "Total";
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->tc_card;
										$totalReveue = $totalReveue+$_mashreq->tc_card;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray[$indexC]['Total Cards'] = $totalReveue;
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									  if(count($salesTimeArray) == 1)
												{
												$graphArray[$indexC]['Total Head Count'] = $countR;
												}
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									/*  $graphArray[$indexC]['Mean'] = "AED ".$avg;; */
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex == 1)
									 {
										 $medianIndex = 0;
									 }
									  $graphArray[$indexC]['median'] = $takeReveue[$medianIndex-1];
									 /*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />";  */
									   $graphArray[$indexC]['quartilile 10%'] = $takeReveue[$q10Index-1];
								 $graphArray[$indexC]['quartilile 25%'] = $takeReveue[$q25Index-1];
								 $graphArray[$indexC]['quartilile 75%'] = $takeReveue[$q75Index-1];
								 $graphArray[$indexC]['quartilile 100%'] = $takeReveue[$q100Index-1];
									   /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray[$indexC]['Total Productivity'] = round($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray[$indexC]['Total Cards'] = "0";
											  if(count($salesTimeArray) == 1)
												{
												$graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['median'] = "0";
											 $graphArray[$indexC]['quartilile 10%'] = "0";
											 $graphArray[$indexC]['quartilile 25%'] = "0";
											 $graphArray[$indexC]['quartilile 75%'] = "0";
											 $graphArray[$indexC]['quartilile 100%'] = "0";
											 $graphArray[$indexC]['Total Productivity'] = "0";
									}
							}
							else
							{
											 $graphArray[$indexC]['Total Revenue'] = "0";
											  if(count($salesTimeArray) == 1)
												{
												$graphArray[$indexC]['Total Head Count'] = 0;
												}
											 $graphArray[$indexC]['median'] = "0";
											 $graphArray[$indexC]['quartilile 10%'] = "0";
											 $graphArray[$indexC]['quartilile 25%'] = "0";
											 $graphArray[$indexC]['quartilile 75%'] = "0";
											 $graphArray[$indexC]['quartilile 100%'] = "0";
											 $graphArray[$indexC]['Total Productivity'] = "0";
							}
							
					/* echo "<pre>";
					print_r($graphArray);
					exit; */
					if($historical_data == "yes")
							{
								$graphArray1 = $this->getDataAsquartile_ENBDHistroy_p($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
						else
						{
							$graphArrayM[$indexC] = $graphArray[$indexC];
						}
					return $graphArrayM;
	}
}

protected function getDataAsquartile_ENBDTotal_p($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
{
	$graphArray = array();
					
						$graphArray['Sales Time'] = "Total";
						$graphArray['TL Name'] = "";
						$graphArray['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
									$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->tc_card;
										$totalReveue = $totalReveue+$_mashreq->tc_card;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray['Total Cards'] = $totalReveue;
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									  if(count($salesTimeArray) == 1)
												{
											$graphArray['Total Head Count'] = $countR;
												}
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									/*  $graphArray[$indexC]['Mean'] = "AED ".$avg;; */
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex < 0)
									 {
										 $medianIndex = 0;
									 }
									  $graphArray['median'] = $takeReveue[$medianIndex-1];
									 /*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />";  */
									  if($q10Index-1 < 0)
									  {
										  $q10Index = 1;
									  }
									   $graphArray['quartilile 10%'] = $takeReveue[$q10Index-1];
									   if($q25Index-1 < 0)
									  {
										  $q25Index = 1;
									  }
								 $graphArray['quartilile 25%'] = $takeReveue[$q25Index-1];
								 if($q75Index-1 < 0)
									  {
										  $q75Index = 1;
									  }
								 $graphArray['quartilile 75%'] = $takeReveue[$q75Index-1];
								 if($q100Index-1 < 0)
									  {
										  $q100Index = 1;
									  }
								 $graphArray['quartilile 100%'] = $takeReveue[$q100Index-1];
									   /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray['Total Productivity'] = round($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray['Total Cards'] = "0";
											  if(count($salesTimeArray) == 1)
												{
													$graphArray['Total Head Count'] = 0;
												}
											 $graphArray['median'] = "0";
											 $graphArray['quartilile 10%'] = "0";
											 $graphArray['quartilile 25%'] = "0";
											 $graphArray['quartilile 75%'] = "0";
											 $graphArray['quartilile 100%'] = "0";
											 $graphArray['Total Productivity'] =  "0";
									}
							}
							else
							{
											 $graphArray['Total Cards'] = "0";
											  if(count($salesTimeArray) == 1)
												{
													$graphArray['Total Head Count'] = 0;
												}
											 $graphArray['median'] = "0";
											 $graphArray['quartilile 10%'] = "0";
											 $graphArray['quartilile 25%'] = "0";
											 $graphArray['quartilile 75%'] = "0";
											 $graphArray['quartilile 100%'] = "0";
											 $graphArray['Total Productivity'] = "0";
							}
							if($historical_data == "yes")
							{
								$graphArrayT = $this->getDataAsquartile_ENBDHistroyTotal_p($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout);
								$graphArrayTD = array_merge($graphArray,$graphArrayT);
							}
							else
							{
								$graphArrayTD = $graphArray;
							}
							return $graphArrayTD;
					
}

protected function getDataAsquartile_ENBDHistroyTotal_p($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout)
{
	$whereRaw = '';
						/* if($teamleaderwithout != "yes")
						{
							if($tl_name != 'No')
							{
								if($whereRaw == '')
								{
									$whereRaw = "tl_name = '".$tl_name."'";
								}
								else
								{
									$whereRaw .= " AND tl_name= '".$tl_name."'";
								}
							} 
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereraw($whereRaw)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->tc_card;
										$totalReveue = $totalReveue+$_mashreq->tc_card;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray['Historical Total Cards'] = $totalReveue;
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									/*  $graphArray[$indexC]['Historical Total Head Count'] = $countR; */
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									/*  $graphArray[$indexC]['Mean'] = "AED ".$avg;; */
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex-1 < 0)
									 {
										 $medianIndex = 1;
									 }
									  $graphArray['Historical median'] = $takeReveue[$medianIndex-1];
									 /*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />";  */
									  if($q10Index-1 < 0)
									 {
										 $q10Index = 1;
									 }
									   $graphArray['Historical quartilile 10%'] = $takeReveue[$q10Index-1];
									     if($q25Index-1 < 0)
											 {
												 $q25Index = 1;
											 }
								 $graphArray['Historical quartilile 25%'] = $takeReveue[$q25Index-1];
								  if($q75Index-1 < 0)
											 {
												 $q75Index = 1;
											 }
								 $graphArray['Historical quartilile 75%'] = $takeReveue[$q75Index-1];
								  if($q100Index-1 < 0)
											 {
												 $q100Index = 1;
											 }
								 $graphArray['Historical quartilile 100%'] = $takeReveue[$q100Index-1];
									   /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray['Historical Total Productivity'] = round($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray['Historical Total Cards'] = "0";
											 /* $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											 $graphArray['Historical median'] = "0";
											 $graphArray['Historical quartilile 10%'] = "0";
											 $graphArray['Historical quartilile 25%'] = "0";
											 $graphArray['Historical quartilile 75%'] = "0";
											 $graphArray['Historical quartilile 100%'] = "0";
											 $graphArray['Historical Total Productivity'] = "0";
									}
							}
							else
							{
											 $graphArray['Historical Total Cards'] = "0";
											/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											 $graphArray['Historical median'] = "0";
											 $graphArray['Historical quartilile 10%'] = "0";
											 $graphArray['Historical quartilile 25%'] = "0";
											 $graphArray['Historical quartilile 75%'] = "0";
											 $graphArray['Historical quartilile 100%'] = "0";
											 $graphArray['Historical Total Productivity'] = "0";
							}
							return $graphArray;
}
protected function getDataAsquartile_ENBDHistroy_p($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC)
{

						
						
						$whereRaw = '';
						if($teamleaderwithout != "yes")
						{
							if($tl_name != 'No')
							{
								if($whereRaw == '')
								{
									$whereRaw = "tl_name = '".$tl_name."'";
								}
								else
								{
									$whereRaw .= " AND tl_name= '".$tl_name."'";
								}
							} 
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
									$takeReveue = array();
									$totalReveue = 0;
									foreach($allMashreqData as $_mashreq)
									{
										$takeReveue[] = $_mashreq->tc_card;
										$totalReveue = $totalReveue+$_mashreq->tc_card;
										
									}
									rsort($takeReveue);
									/*   echo "<pre>";
									print_r($takeReveue);
									 */
									
									$countR = count($takeReveue);
									/*
									*avg revenue
									*/
									/* echo $totalReveue;
									echo '<br >';
									echo $countR;
									exit; */
									if($countR != 0)
									{
									 $avg = round($totalReveue/$countR,2);
									 $medianIndex = round($countR/2);
									  $q10Index = round(($countR/100)*10);
									 $q25Index = round(($countR/100)*25);
									 $q75Index = round(($countR/100)*75);
									 $q100Index = round(($countR/100)*100);
									 
									/*  if($qt1 != "No" && $qt2 != "No")
									 {
										   $q1Index = round(($countR/100)*$qt1);
											$q2Index = round(($countR/100)*$qt2);
									 } */
									/*  echo '<pre>';
									 print_r($salesTimeArray);
									 exit; */
									$graphArray[$indexC]['Historical Total Cards'] = $totalReveue;
									/*  echo "Total Revenue   AED".$totalReveue;
									 echo "<br />"; */
									/*  foreach($salesTimeArray as $_salesT)
									 {
										 if($whereRaw == '')
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->count();
											}
										}
										else
										{
											if($range_id != "No")
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereIn("range_id",$rangeIdArray)->whereraw($whereRaw)->count();
											}
											else
											{
												$countPerRange = AgentPayout::where("sales_time",$_salesT)->whereraw($whereRaw)->count();
											}
										}
										$_salesTA = explode("-",$_salesT);
										echo "Agent Count (".$_salesTA[0]."-".$_salesTA[1].")   ".$countPerRange;
										 echo "<br />";
									 } */
									/*  $graphArray[$indexC]['Historical Total Head Count'] = $countR; */
									 /* echo "Total Agent Count   ".$countR;
									 echo "<br />"; */
									/*  $graphArray[$indexC]['Mean'] = "AED ".$avg;; */
									 /* echo "Mean   AED ".$avg;
									 echo "<br />"; */
									 
									 if($medianIndex-1 < 0)
									 {
										 $medianIndex = 1;
									 }
									  $graphArray[$indexC]['Historical median'] = $takeReveue[$medianIndex-1];
									 /*  echo "median   AED ".$takeReveue[$medianIndex-1];
									  echo "<br />";  */
									  if($q10Index-1 < 0)
									 {
										 $q10Index = 1;
									 }
									   $graphArray[$indexC]['Historical quartilile 10%'] = $takeReveue[$q10Index-1];
									     if($q25Index-1 < 0)
											 {
												 $q25Index = 1;
											 }
								 $graphArray[$indexC]['Historical quartilile 25%'] = $takeReveue[$q25Index-1];
								  if($q75Index-1 < 0)
											 {
												 $q75Index = 1;
											 }
								 $graphArray[$indexC]['Historical quartilile 75%'] = $takeReveue[$q75Index-1];
								  if($q100Index-1 < 0)
											 {
												 $q100Index = 1;
											 }
								 $graphArray[$indexC]['Historical quartilile 100%'] = $takeReveue[$q100Index-1];
									   /* echo "quartilile 10%   AED ".$takeReveue[$q10Index-1];
									  echo "<br />";
									  echo "quartilile 25%   AED ".$takeReveue[$q25Index-1];
									  echo "<br />";
									  echo "quartilile 75%   AED ".$takeReveue[$q75Index-1];
									  echo "<br />";
									  echo "quartilile 100%   AED ".$takeReveue[$q100Index-1];
									  echo "<br />";  */
									  /*  if($qt != "No")
										{
											$quarD = round(($countR/100)*$qt);
											echo "quartilile ".$qt."% - AED ".$takeReveue[$quarD-1];
											echo "<br />";
										} */
									/*  if($range_id == "No")
										{ */
											 //echo "Range Id - ".$range_id;
											 //echo "<br />";
										/* }
										else
										{
											 echo "Range Id   ".$range_id;
											 echo "<br />";
										} */

										/*
										*top 10% revenue
										*/
									/* 	echo '<pre>';
										print_r($takeReveue);
										echo $q10Index;exit;
										exit; */
										/* $top10Revenue = 0;
										
										for($i=0;$i<=$q10Index-1;$i++)
										{
											
											$top10Revenue = $top10Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 10% revenue
										*/
										
										/*
										*top 25% revenue
										*/
										/* $top25Revenue = 0;
										if($q10Index > $q25Index-1)
										{
											$q25Index = $q10Index+1;
										}
										for($i=$q10Index;$i<=$q25Index-1;$i++)
										{
											
											$top25Revenue = $top25Revenue+$takeReveue[$i];
											
										} */
										
										
										/*
										*top 25% revenue
										*//* 
											echo '<br />';
										echo $q10Index;
										echo '<br />';
										echo $q25Index-1;
											echo '<br />'; */
										/*
										*top 75% revenue
										*/
										/* $top75Revenue = 0;
										
										for($i=$q25Index;$i<=$q75Index-1;$i++)
										{
											
											$top75Revenue = $top75Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 75% revenue
										*/
										
										/*
										*top 100% revenue
										*/
										/* $top100Revenue = 0;
										
										for($i=$q75Index;$i<=$q100Index-1;$i++)
										{
											
											$top100Revenue = $top100Revenue+$takeReveue[$i];
											
										} */
										/*
										*top 100% revenue
										*/
										/*  if($qt1 != "No" && $qt2 != "No")
											 {
												
												 if($q1Index >0)
												 {
													 $q1Index = $q1Index-1;
												 } */
												/*
												*top dynamic revenue
												*/
												/* $topqtRevenue = 0;
												
												for($i=$q1Index;$i<=$q2Index-1;$i++)
												{
													
													$topqtRevenue = $topqtRevenue+$takeReveue[$i];
													
												} */
												/*
												*top dynamic revenue
												*/
											 /* } */
										
										/*  echo "<br />";
										echo "top10 Agent Revenue    AED ".$top10Revenue;
										echo "<br />";
										echo "top25 Agent Revenue   AED ".$top25Revenue;
										echo "<br />";
										echo "top75 Agent Revenue   AED ".$top75Revenue;
										echo "<br />";
										echo "top100 Agent Revenue   AED ".$top100Revenue;
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   AED ".$topqtRevenue;
										echo "<br />";
										}
										
										echo "top10 Agent Revenue    ".round(($top10Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top25 Agent Revenue    ".round(($top25Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top75 Agent Revenue    ".round(($top75Revenue/$totalReveue)*100)."%";
										echo "<br />";
										echo "top100 Agent Revenue    ".round(($top100Revenue/$totalReveue)*100)."%";
										echo "<br />";
										 if($qt1 != "No" && $qt2 != "No")
										{
										echo "top".$qt1."-".$qt2." Agent Revenue   ".round(($topqtRevenue/$totalReveue)*100)."%";
										echo "<br />";
										} */
										$graphArray[$indexC]['Historical Total Productivity'] = round($totalReveue/$countR,2);
											/* echo "<br />";
											echo "Total Productivity   ".round($totalReveue/$countR,2); */
										
										/* $c = 0;
										foreach($takeReveue as $aa)
										{
											$c = $c+$aa;
										}
										echo "total - ".$c;
										echo "<br />";
										*/
										 
										
										/*
										*agent coding
										*/
										/* if($agentID != 'No')
										{
											$agentDetails = AgentPayout::where("id",$agentID)->first();
											if($agentDetails != '')
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
												echo "<br />";
												echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
												echo "<br />";
												echo "Agent Revenue   <b>AED".$agentDetails->total_revenue.'</b>';
												echo "<br />";
												
												$takeReveueAgent = $takeReveue;
												sort($takeReveueAgent);
												
												$agentRevenue = $agentDetails->total_revenue;
												//$agentRevenue = 13501;
												$allowChecking = 1;
												 $similarRevenue =0;
												
												foreach($takeReveueAgent as $_r)
												{
													if($_r >= $agentRevenue && $allowChecking ==1)
													{
														
														$similarRevenue = $_r;
														$allowChecking = 2;
													}
												
												}
												//echo $similarRevenue;exit;
												 $keyIndexQ = array_search($similarRevenue, $takeReveue); 
												 
												
												if($totalReveue >= $agentRevenue)
												{
													
													echo "Agent Quartilile  <b>".round(($keyIndexQ/$countR)*100,2)."%</b>";
													echo "<br />";
													$positionpercentageAgent = round(($keyIndexQ/$countR)*100,2);
													
													if($positionpercentageAgent <= 10)
													{
														echo "Top <b>10</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 25)
													{
														echo "top <b>10-25</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 75)
													{
														echo "top <b>25-75</b> Revenue Performer";
													}
													else if($positionpercentageAgent <= 100)
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
													else
													{
														echo "top <b>75-100</b> Revenue Performer";
													}
												}
												else
												{
													echo "Agent Quartilile  <b>1%</b>";
													echo "<br />";
													echo "Top <b>1</b> Revenue Performer";
												}
												
												echo "<br />";
												if($totalReveue >= $agentRevenue)
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>".round(($agentRevenue/$totalReveue)*100,2)." %</b>";
												}
												else
												{
													echo "Agent's Contribution Percentage in Total Revenue <b>100%</b>";
												}
												echo "<br />";
												if($avg > $agentRevenue)
												{
													echo "<b>Agent Revenue less than Average</b>";
												}
												else
												{
													echo "<b>Agent Revenue greater than Average</b>";
												}
												
											}
											else
											{
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "<br />";
												echo "Agent not found";
											}
										} */
										/*
										*agent coding
										*/
									}
									else
									{
											 $graphArray[$indexC]['Historical Total Cards'] = "0";
											 /* $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											 $graphArray[$indexC]['Historical median'] = "0";
											 $graphArray[$indexC]['Historical quartilile 10%'] = "0";
											 $graphArray[$indexC]['Historical quartilile 25%'] = "0";
											 $graphArray[$indexC]['Historical quartilile 75%'] = "0";
											 $graphArray[$indexC]['Historical quartilile 100%'] = "0";
											 $graphArray[$indexC]['Historical Total Productivity'] = "0";
									}
							}
							else
							{
											 $graphArray[$indexC]['Historical Total Cards'] = "0";
											/*  $graphArray[$indexC]['Historical Total Head Count'] = 0; */
											 $graphArray[$indexC]['Historical median'] = "0";
											 $graphArray[$indexC]['Historical quartilile 10%'] = "0";
											 $graphArray[$indexC]['Historical quartilile 25%'] = "0";
											 $graphArray[$indexC]['Historical quartilile 75%'] = "0";
											 $graphArray[$indexC]['Historical quartilile 100%'] = "0";
											 $graphArray[$indexC]['Historical Total Productivity'] = "0";
							}
							return $graphArray;
}

public function updateEmpENBD()
{
	$agentPayoutMod = AgentPayout::where("employee_id_status",1)->get();
	
	foreach($agentPayoutMod as $_agent)
	{
		$agentName = $_agent->agent_name;
		$enbdNameMod = EnbdPayoutEmpId::where("name",$agentName)->first();
		
		if($enbdNameMod != "")
		{
			$agentPayoutUpdate = AgentPayout::find($_agent->id);
			$agentPayoutUpdate->employee_id = $enbdNameMod->employee_id;
			$agentPayoutUpdate->employee_id_status = 2;
			$agentPayoutUpdate->save();
		}
		else
		{
			$agentPayoutUpdate = AgentPayout::find($_agent->id);
			$agentPayoutUpdate->employee_id_status = 2;
			$agentPayoutUpdate->save();
		}
	}
	echo "yes";
	exit;
}
protected function getPlastic_ENBD($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
{
	if($teamleaderwithout != "yes")
	{
					$indexC = 0;
					$graphArray = array();
					foreach($tl_name_array as $tl_name)
					{
						$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						$graphArray[$indexC]['TL Name'] = $tl_name;
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->get();	
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
							
							$totalCards = 0;
							$totalCardsMass = 0;
							$totalCardsP = 0;
							$totalCardsSP = 0;
							$totalCardsCount = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								
								
								if($_tdata->agent_product == 'CARD')
								{
									
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsMass = $totalCardsMass+$_tdata->mass;
									$totalCardsP = $totalCardsP+$_tdata->premium;
									$totalCardsSP = $totalCardsSP+$_tdata->super_premium;
									$totalCardsCount++;
									
								}
								
							}
							/*
							*count 80% target not achive
							*/
							
							/*
							*candidate count achived target
							*/
							
							/*
							*candidate count achived target
							*/
							 if(count($salesTimeArray) == 1)
								{
								 $graphArray[$indexC]['Total Agents'] = count($allMashreqData);
								 $graphArray[$indexC]['Agents in Cards'] = $totalCardsCount;
								}
								$graphArray[$indexC]['Total Cards'] = $totalCards;
								if($totalCardsMass ==0)
								{
									$graphArray[$indexC]['Mass'] = "0%";
								}
								else
								{
								$graphArray[$indexC]['Mass'] = round(($totalCardsMass/$totalCards)*100,2)."%";
								}
								if($totalCardsP == 0)
								{
									$graphArray[$indexC]['Premium'] = "0%";
								}
								else
								{
								$graphArray[$indexC]['Premium'] = round(($totalCardsP/$totalCards)*100,2)."%";
								}
								if($totalCardsSP == 0)
								{
									$graphArray[$indexC]['Super Premium'] = "0%";
								}
								else
								{
								$graphArray[$indexC]['Super Premium'] = round(($totalCardsSP/$totalCards)*100,2)."%";
								}
							/*$graphArray[$indexC]['Target Achived'] = $achivedCandidate; */
							/* echo "Total Agents Head Count  ".count($allMashreqData);
							echo "<br />";
							echo "Agent Count who achived their Target  ".$achivedCandidate; */
							
							/*$graphArray[$indexC]['Target Achived Less 80%'] = $targetNotAchive80;
							 echo "<br />";
							echo "Agents Achived less than 80% of Target   ".$targetNotAchive80; */
							/* if($qt != 'No')
							{
							
							$targetNotAchiveD = 0;
							foreach($allMashreqData as $_tdata)
							{
								$AgentTarget = $_tdata->agent_target;
								$agentTargetD = round(($AgentTarget/100)*$qt);
								if($_tdata->agent_product == 'CARD')
								{
									if($agentTargetD > $_tdata->tc_card)
									{
										$targetNotAchiveD++;
									}
								}
								else
								{
									if($agentTargetD > $_tdata->final_loan_amount)
									{
										$targetNotAchiveD++;
									}
								}
							}
							echo "<br />";
							echo "Agents Achived less than ".$qt."% of Target   ".$targetNotAchiveD;
							} */
							
							/* echo "<br />";
							echo "Total Agents in Card ".$totalCardsCount;
							echo "<br />";
							echo "Total Agents in loan ".$totalLoanCount;*/
							
							/*
							if($totalLoanCount >0)
							{
								echo "<br />";
								echo "Core Team Productivity (PLs) ".round($totalLoan/$totalLoanCount,2);
							}
							else
							{
								echo "<br />";
								echo "Core Team Productivity (PLs) 0";
							}
							*/
							
							/*
							if($totalLoanCount >0)
							{
								echo "<br />";
								echo "Team Loan Productivity (Loan including XS) ".round($totalLoanCS/$totalLoanCount,2);
							}
							else
							{
								echo "<br />";
								echo "Team Loan Productivity (Loan including XS) 0";
							}*/
							
							/*
							if($totalLoanCS >0)
							{
							echo "<br />";
							echo "XS (Loan)   ".round(($totalLoanCSOnly/$totalLoanCS)*100,2).'%';
							}
							else
							{
								echo "<br />";
							echo "XS (Loan)   0%";
							}
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "<br />";
							echo "Total Cards with XS -".$totalCardsCS;
							echo "<br />";
							echo "Total Cards By Loan Agent -".$totalCardsCSOnly;
							echo "<br />";
							echo "Total Loan with XS -".$totalLoanCS;
							echo "<br />";
							echo "Total Loan By Card Agent -".$totalLoanCSOnly; */
							/*
							*count dynamic target not achive
							*/
							
								/* if($agentId != "No")
								{
										$agentDetails = AgentPayout::where("id",$agentId)->first();
										if($agentDetails != '')
										{
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "<br />";
											echo "Agent Name  <b>".$agentDetails->agent_name.'</b>';
											echo "<br />";
											echo "Agent's TL  <b>".$agentDetails->tl_name.'</b>';
											echo "<br />";
											echo "Agent Target   <b>".$agentDetails->agent_target.'</b>';
											echo "<br />";
											echo "Agent Product   <b>".$agentDetails->agent_product.'</b>';
											echo "<br />";
											
											if($agentDetails->agent_product == 'CARD')
											{
												echo "Agent CARD   <b>".$agentDetails->tc_card.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->tc_card/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
											else
											{
												echo "Agent Loan AED<b>".$agentDetails->final_loan_amount.'</b>';
												echo "<br />";
												if($agentDetails->agent_target > 0)
												{
													echo "Agent Achived Target ".round(($agentDetails->final_loan_amount/$agentDetails->agent_target)*100,2).'%';
												}
												else
												{
													echo "Agent Achived Target 0%";
												}
											}
										}
										else
										{
											echo "Agent not found";
										}
										
								} */
								/*
								*count dynamic target not achive
								*/
							}
							else
							{
								 if(count($salesTimeArray) == 1)
									{
										$graphArray[$indexC]['Total Agents'] = 0;
										$graphArray[$indexC]['Agents in Cards'] = 0;
									}
								
							
								$graphArray[$indexC]['Total Cards'] =0;
								$graphArray[$indexC]['Mass'] = "0%";
								$graphArray[$indexC]['Premium'] = "0%";
								$graphArray[$indexC]['Super Premium'] = "0%";
							}
							if($historical_data == "yes")
							{
								$graphArray1 = $this->getPlastic_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
								$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
							}
							else
							{
								$graphArrayM[$indexC] = $graphArray[$indexC];
							}
							$indexC++;
					}
					
					$graphArrayM[$indexC] = $this->getPlastic_ENBDTotal($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data);
					
					return $graphArrayM;
	}
	else
	{
					$indexC = 0;
					$graphArray = array();
					$tl_name = '';
					
					if(count($salesTimeArray) == 1 && $vintage_name_SI != 'No')
					{
					/*
					*report as per Vintage
					*coding start
					*/
					$vintage_name_SIArray = explode(",",$vintage_name_SI);
					foreach($vintage_name_SIArray as $vintage)
					{
						$graphArray[$indexC]['Sales Time'] = $fromRange.'-'.$toRange;
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id = ".$vintage;
							}
							else
							{
								$whereRaw .= " AND range_id = ".$vintage;
							}
							$graphArray[$indexC]['Vintage'] = $vintage;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
							$totalCards = 0;
							$totalCardsMass = 0;
							$totalCardsP = 0;
							$totalCardsSP = 0;
							$totalCardsCount = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								
								
								if($_tdata->agent_product == 'CARD')
								{
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsMass = $totalCardsMass+$_tdata->mass;
									$totalCardsP = $totalCardsP+$_tdata->premium;
									$totalCardsSP = $totalCardsSP+$_tdata->super_premium;
									$totalCardsCount++;
									
								}
									
							}
							/*
							*count 80% target not achive
							*/
							
							/*
							*candidate count achived target
							*/
							
							/*
							*candidate count achived target
							*/
							if(count($salesTimeArray) == 1)
								{
								 $graphArray[$indexC]['Total Agents'] = count($allMashreqData);
								 $graphArray[$indexC]['Agents in Cards'] = $totalCardsCount;
								}
								$graphArray[$indexC]['Total Cards'] = $totalCards;
								if($totalCardsMass == 0)
								{
									$graphArray[$indexC]['Mass'] = "0%";
								}
								else
								{
									$graphArray[$indexC]['Mass'] = round(($totalCardsMass/$totalCards)*100,2)."%";
								}
								if($totalCardsP == 0)
								{
									$graphArray[$indexC]['Premium'] = "0%";
								}
								else
								{
								$graphArray[$indexC]['Premium'] = round(($totalCardsP/$totalCards)*100,2)."%";
								}
								if($totalCardsP == 0)
								{
									$graphArray[$indexC]['Super Premium'] = "0%";
								}
								else
								{
								$graphArray[$indexC]['Super Premium'] = round(($totalCardsSP/$totalCards)*100,2)."%";
								}
							
							
							
							
								/*
								*count dynamic target not achive
								*/
							}
							else
							{
								if(count($salesTimeArray) == 1)
								{
									$graphArray[$indexC]['Total Agents'] = 0;
									$graphArray[$indexC]['Agents in Cards'] = 0;
								}
								
							
								$graphArray[$indexC]['Total Cards'] =0;
								$graphArray[$indexC]['Mass'] = "0%";
								$graphArray[$indexC]['Premium'] = "0%";
								$graphArray[$indexC]['Super Premium'] = "0%";
							}
						if($historical_data == "yes")
						{							
							$graphArray1 = $this->getPlastic_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
						}
						else
						{
							$graphArrayM[$indexC] = $graphArray[$indexC];
						}
						$indexC++;
					
					}
					/*
					*report as per Vintage
					*coding start
					*/
					}
					else
					{
					/*
					*report as per salesTime
					*coding start
					*/
					foreach($salesTimeArray as $_salesT)
					{
						$graphArray[$indexC]['Sales Time'] = $_salesT;
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->where("sales_time",$_salesT)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->where("sales_time",$_salesT)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
							$totalCards = 0;
							$totalCardsMass = 0;
							$totalCardsP = 0;
							$totalCardsSP = 0;
							$totalCardsCount = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								
								
								if($_tdata->agent_product == 'CARD')
								{
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsMass = $totalCardsMass+$_tdata->mass;
									$totalCardsP = $totalCardsP+$_tdata->premium;
									$totalCardsSP = $totalCardsSP+$_tdata->super_premium;
									$totalCardsCount++;
								}
								
							}
							/*
							*count 80% target not achive
							*/
							
							
							 if(count($salesTimeArray) == 1)
								{
									$graphArray[$indexC]['Total Agents'] = count($allMashreqData);
									$graphArray[$indexC]['Agents in Cards'] = $totalCardsCount;
								}
						if(count($salesTimeArray) == 1)
								{
								 $graphArray[$indexC]['Total Agents'] = count($allMashreqData);
								 $graphArray[$indexC]['Agents in Cards'] = $totalCardsCount;
								}
								$graphArray[$indexC]['Total Cards'] = $totalCards;
								if($totalCardsMass == 0)
								{
									$graphArray[$indexC]['Mass'] = "0%";
								}
								else
								{
								$graphArray[$indexC]['Mass'] = round(($totalCardsMass/$totalCards)*100,2)."%";
								}
								if($totalCardsP == 0)
								{
									$graphArray[$indexC]['Premium'] = "0%";
								}
								else
								{
								$graphArray[$indexC]['Premium'] = round(($totalCardsP/$totalCards)*100,2)."%";
								}
								if($totalCardsSP == 0)
								{
									$graphArray[$indexC]['Super Premium'] = "0%";
								}
								else
								{
								$graphArray[$indexC]['Super Premium'] = round(($totalCardsSP/$totalCards)*100,2)."%";
								}
								/*
								*count dynamic target not achive
								*/
							}
							else
							{
								if(count($salesTimeArray) == 1)
								{
									$graphArray[$indexC]['Total Agents'] = 0;
									$graphArray[$indexC]['Agents in Cards'] = 0;
								}
								
							
								$graphArray[$indexC]['Total Cards'] =0;
								$graphArray[$indexC]['Mass'] = "0%";
								$graphArray[$indexC]['Premium'] = "0%";
								$graphArray[$indexC]['Super Premium'] = "0%";
							}
						if($historical_data == "yes")
						{							
							$graphArray1 = $this->getPlastic_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
						}
						else
						{
							$graphArrayM[$indexC] = $graphArray[$indexC];
						}
						$indexC++;
					
					}
					/*
					*report as per salesTime
					*coding end
					*/
					}
					
					
						$graphArray[$indexC]['Sales Time'] = "Total";
						/* $graphArray[$indexC]['TL Name'] = $tl_name; */
						$graphArray[$indexC]['Bank'] = "ENBD";
						
						$whereRaw = '';
						/* if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray[$indexC]['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray[$indexC]['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray[$indexC]['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
								$totalCards = 0;
							$totalCardsMass = 0;
							$totalCardsP = 0;
							$totalCardsSP = 0;
							$totalCardsCount = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								
								
								if($_tdata->agent_product == 'CARD')
								{
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsMass = $totalCardsMass+$_tdata->mass;
									$totalCardsP = $totalCardsP+$_tdata->premium;
									$totalCardsSP = $totalCardsSP+$_tdata->super_premium;
									$totalCardsCount++;
								}
								
							}
							/*
							*count 80% target not achive
							*/
							
							
							if(count($salesTimeArray) == 1)
								{
								 $graphArray[$indexC]['Total Agents'] = count($allMashreqData);
								 $graphArray[$indexC]['Agents in Cards'] = $totalCardsCount;
								}
								$graphArray[$indexC]['Total Cards'] = $totalCards;
								if($totalCardsMass == 0)
								{
									$graphArray[$indexC]['Mass'] = "0%";
								}
								else
								{
								$graphArray[$indexC]['Mass'] = round(($totalCardsMass/$totalCards)*100,2)."%";
								}
								if($totalCardsP == 0)
								{
									$graphArray[$indexC]['Premium'] ="0%";
								}
								else
								{
								$graphArray[$indexC]['Premium'] = round(($totalCardsP/$totalCards)*100,2)."%";
								}
								
								if($totalCardsSP == 0)
								{
									$graphArray[$indexC]['Super Premium'] = "0%";
								}
								else
								{
								$graphArray[$indexC]['Super Premium'] = round(($totalCardsSP/$totalCards)*100,2)."%";
								}
								/*
								*count dynamic target not achive
								*/
							}
							else
							{
								if(count($salesTimeArray) == 1)
								{
									$graphArray[$indexC]['Total Agents'] = 0;
									$graphArray[$indexC]['Agents in Cards'] = 0;
								}
								
							
								$graphArray[$indexC]['Total Cards'] =0;
								$graphArray[$indexC]['Mass'] = "0%";
								$graphArray[$indexC]['Premium'] = "0%";
								$graphArray[$indexC]['Super Premium'] = "0%";
							}
						if($historical_data == "yes")
						{							
							$graphArray1 = $this->getPlastic_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC);
							$graphArrayM[$indexC] = array_merge($graphArray[$indexC],$graphArray1[$indexC]);
						}
						else
						{
							$graphArrayM[$indexC] = $graphArray[$indexC];
						}
					return $graphArrayM;
	}
}
protected function getPlastic_ENBDTotal($salesTimeArray,$fromRange,$toRange,$tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout,$historical_data)
{
						$graphArray = array();
						
						$graphArray['Sales Time'] = "Total";
						$graphArray['TL Name'] = "";
						$graphArray['Bank'] = "ENBD";
						
						$whereRaw = '';
/* 						if($tl_name != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "tl_name = '".$tl_name."'";
							}
							else
							{
								$whereRaw .= " AND tl_name= '".$tl_name."'";
							}
						} */
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							$graphArray['Product'] = "CARDS";
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							$graphArray['Product'] = "Loan";
						}
						if($productSI == 'No')
						{
							$graphArray['Product'] = "All";
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							$graphArray['Vintage'] = $vintage_name_SI;
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereIn("tl_name",$tl_name_array)->get();	
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("sales_time",$salesTimeArray)->whereIn("tl_name",$tl_name_array)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
							$totalCards = 0;
							$totalCardsMass = 0;
							$totalCardsP = 0;
							$totalCardsSP = 0;
							$totalCardsCount = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								
								if($_tdata->agent_product == 'CARD')
								{
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsMass = $totalCardsMass+$_tdata->mass;
									$totalCardsP = $totalCardsP+$_tdata->premium;
									$totalCardsSP = $totalCardsSP+$_tdata->super_premium;
									$totalCardsCount++;
								}
								
							}
							/*
							*count 80% target not achive
							*/
							
							
							 if(count($salesTimeArray) == 1)
								{
								 $graphArray['Total Agents'] = count($allMashreqData);
								 $graphArray['Agents in Cards'] = $totalCardsCount;
								}
								$graphArray['Total Cards'] = $totalCards;
								if($totalCardsMass == 0)
								{
									$graphArray['Mass'] = "0%";
								}
								else
								{
									$graphArray['Mass'] = round(($totalCardsMass/$totalCards)*100,2)."%";
								}
								
								if($totalCardsP == 0)
								{
									$graphArray['Premium'] = "0%";
								}
								else
								{
									$graphArray['Premium'] = round(($totalCardsP/$totalCards)*100,2)."%";
								}
								if($totalCardsSP == 0)
								{
									$graphArray['Super Premium'] = "0%";
								}
								else
								{
									$graphArray['Super Premium'] = round(($totalCardsSP/$totalCards)*100,2)."%";
								}
								/*
								*count dynamic target not achive
								*/
							}
							else
							{
								 if(count($salesTimeArray) == 1)
									{
										$graphArray['Total Agents'] = 0;
										$graphArray['Agents in Cards'] = 0;
									}
								
							
									$graphArray['Total Cards'] =0;
								$graphArray['Mass'] = "0%";
								$graphArray['Premium'] = "0%";
								$graphArray['Super Premium'] = "0%";
							}
							if($historical_data == "yes")
							{
								$graphArrayT = $this->getPlastic_ENBDHistroyTotal($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout);
								$graphArrayTD = array_merge($graphArray,$graphArrayT);
							}
							else
							{
								$graphArrayTD = $graphArray;
							}
						return $graphArrayTD;
							
}

protected function getPlastic_ENBDHistroyTotal($tl_name_array,$productSI,$vintage_name_SI,$teamleaderwithout)
{
	$whereRaw = '';
						
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereraw($whereRaw)->whereIn("tl_name",$tl_name_array)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
							$totalCards = 0;
							$totalCardsMass = 0;
							$totalCardsP = 0;
							$totalCardsSP = 0;
							$totalCardsCount = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								
								if($_tdata->agent_product == 'CARD')
								{
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsMass = $totalCardsMass+$_tdata->mass;
									$totalCardsP = $totalCardsP+$_tdata->premium;
									$totalCardsSP = $totalCardsSP+$_tdata->super_premium;
									$totalCardsCount++;
								}
								
							}
							
							
							
							
							
								$graphArray['Historical Total Cards'] = $totalCards;
								$graphArray['Historical Mass'] = round(($totalCardsMass/$totalCards)*100,2)."%";
								$graphArray['Historical Premium'] = round(($totalCardsP/$totalCards)*100,2)."%";
								$graphArray['Historical Super Premium'] = round(($totalCardsSP/$totalCards)*100,2)."%";
							
							/*
							*count dynamic target not achive
							*/
							
							
								/*
								*count dynamic target not achive
								*/
							}
							else
							{
									/* $graphArray[$indexC]['Historical Total Agents'] = 0; */
								/* $graphArray[$indexC]['Historical Agents in Cards'] = 0; */
							
								$graphArray['Historical Total Cards'] =0;
								$graphArray['Historical Mass'] = "0%";
								$graphArray['Historical Premium'] = "0%";
								$graphArray['Historical Super Premium'] = "0%";
							}
							
							return $graphArray;
}
protected function getPlastic_ENBDHistroy($tl_name,$productSI,$vintage_name_SI,$teamleaderwithout,$indexC)
{
	
						
						
						$whereRaw = '';
						if($teamleaderwithout != "yes")
						{
							if($tl_name != 'No')
							{
								if($whereRaw == '')
								{
									$whereRaw = "tl_name = '".$tl_name."'";
								}
								else
								{
									$whereRaw .= " AND tl_name= '".$tl_name."'";
								}
							} 
						}
						if($productSI != 'No' && $productSI == 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product = 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product= 'CARD'";
							}
							
						}
						if($productSI != 'No' && $productSI != 'CARDS')
						{
							
							if($whereRaw == '')
							{
								$whereRaw = "agent_product != 'CARD'";
							}
							else
							{
								$whereRaw .= " AND agent_product != 'CARD'";
							}
							
						}
						if($productSI == 'No')
						{
							
						}
						if($vintage_name_SI != 'No')
						{
							if($whereRaw == '')
							{
								$whereRaw = "range_id IN (".$vintage_name_SI.")";
							}
							else
							{
								$whereRaw .= " AND range_id IN (".$vintage_name_SI.")";
							}
							
						}
						  /* echo $whereRaw;
						  echo "<br />";
						  echo "<pre>";
						  print_r($salesTimeArray);
						  exit;
						  
						  exit; */
						  
						/* echo "<br />";
						echo "<pre>";
						print_r($salesTimeArray);  */
						/*exit; */
						if($whereRaw == '')
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->get();
							
							
						}
						else
						{
							
								$allMashreqData = AgentPayout::where("agent_target","!=",0)->whereraw($whereRaw)->get();
							
							
						}
						if(count($allMashreqData) >0)
							{
							/*
							*count 80% target not achive
							*/
							$totalCards = 0;
							$totalCardsMass = 0;
							$totalCardsP = 0;
							$totalCardsSP = 0;
							$totalCardsCount = 0;
							
							foreach($allMashreqData as $_tdata)
							{
								
								if($_tdata->agent_product == 'CARD')
								{
									$totalCards = $totalCards+$_tdata->tc_card;
									$totalCardsMass = $totalCardsMass+$_tdata->mass;
									$totalCardsP = $totalCardsP+$_tdata->premium;
									$totalCardsSP = $totalCardsSP+$_tdata->super_premium;
									$totalCardsCount++;
								}
								
							}
							/*
							*count 80% target not achive
							*/
							
							    $graphArray[$indexC]['Historical Total Cards'] = $totalCards;
								if($totalCardsMass == 0)
								{
									$graphArray[$indexC]['Historical Mass'] = "0%";
							
								}
								else
								{
									$graphArray[$indexC]['Historical Mass'] = round(($totalCardsMass/$totalCards)*100,2)."%";
								}
								if($totalCardsP == 0)
								{
									$graphArray[$indexC]['Historical Premium'] = "0%";
								}
								else
								{
									$graphArray[$indexC]['Historical Premium'] = round(($totalCardsP/$totalCards)*100,2)."%";
								}
								if($totalCardsSP == 0)
								{
									$graphArray[$indexC]['Historical Super Premium'] = "0%";
								}
								else
								{
									$graphArray[$indexC]['Historical Super Premium'] = round(($totalCardsSP/$totalCards)*100,2)."%";
								}
								
								/*
								*count dynamic target not achive
								*/
							}
							else
							{
									
							
								$graphArray[$indexC]['Historical Total Cards'] =0;
								$graphArray[$indexC]['Historical Mass'] = "0%";
								$graphArray[$indexC]['Historical Premium'] = "0%";
								$graphArray[$indexC]['Historical Super Premium'] = "0%";
							}
							
							return $graphArray;
}
	
	
public function updateEmpMashreq()
{
	$agentPayoutModM = AgentPayoutMashreq::where("employee_id_status",1)->get();
	
	foreach($agentPayoutModM as $_agent)
	{
		$agentName = $_agent->agent_name;
		$enbdNameMod = MashreqEmpDetails::where("name",$agentName)->first();
		
		if($enbdNameMod != "")
		{
			$agentPayoutUpdate = AgentPayoutMashreq::find($_agent->id);
			$agentPayoutUpdate->employee_id = $enbdNameMod->employee_id;
			$agentPayoutUpdate->employee_id_status = 2;
			$agentPayoutUpdate->save();
		}
		else
		{
			$agentPayoutUpdate = AgentPayoutMashreq::find($_agent->id);
			$agentPayoutUpdate->employee_id_status = 3;
			$agentPayoutUpdate->save();
		}
	}
	echo "yes";
	exit;
}	

public function mashreqAgentHostroyLogs()
{
	
	$collectionMashreq = AgentPayoutMashreq::groupBy('employee_id')
	->selectRaw('count(*) as total, employee_id')->whereIn("employee_id_status",array(2,4))
	->get();
	
	
	foreach($collectionMashreq as $_mashreqData)
	{
		
		$empID =  $_mashreqData['employee_id'];
		$agentMod = AgentPayoutMashreq::where("employee_id",$empID)->orderBy("range_id","ASC")->get();
		/* echo "<pre>";
		print_r($agentMod);
		exit; */
		foreach($agentMod as $_mod)
		{
			$hostroyLogs = BanksAgentHistroyLogs::where("employee_id",$_mod->employee_id)->orderBy("id","DESC")->first();
			if($hostroyLogs == '')
			{
				$logsInsetMod = new BanksAgentHistroyLogs();
				$logsInsetMod->agent_name = $_mod->agent_name;
				$logsInsetMod->range_id = $_mod->range_id;
				$logsInsetMod->employee_id = $_mod->employee_id;
				$logsInsetMod->TL_name = $_mod->tl_name;
				$logsInsetMod->Target = $_mod->agent_target;
				$logsInsetMod->product = $_mod->agent_product;
				$logsInsetMod->change_action = "first entry";
				$logsInsetMod->bank = "Mashreq";
				$logsInsetMod->change_sales_time = $_mod->end_sales_time;
				$logsInsetMod->monthsCountService = count($agentMod);
				$logsInsetMod->save();
			}
			else
			{
				if($hostroyLogs->TL_name != $_mod->tl_name)
				{
					$logsInsetMod = new BanksAgentHistroyLogs();
					$logsInsetMod->agent_name = $_mod->agent_name;
					$logsInsetMod->range_id = $_mod->range_id;
					$logsInsetMod->employee_id = $_mod->employee_id;
					$logsInsetMod->TL_name = $_mod->tl_name;
					$logsInsetMod->Target = $_mod->agent_target;
					$logsInsetMod->product = $_mod->agent_product;
					$logsInsetMod->change_action = "TL Change";
					$logsInsetMod->bank = "Mashreq";
					$logsInsetMod->change_sales_time = $_mod->end_sales_time;
					$logsInsetMod->monthsCountService = count($agentMod);
					$logsInsetMod->save();
				}
				if($hostroyLogs->Target != $_mod->agent_target)
				{
					$logsInsetMod = new BanksAgentHistroyLogs();
					$logsInsetMod->agent_name = $_mod->agent_name;
					$logsInsetMod->range_id = $_mod->range_id;
					$logsInsetMod->employee_id = $_mod->employee_id;
					$logsInsetMod->TL_name = $_mod->tl_name;
					$logsInsetMod->Target = $_mod->agent_target;
					$logsInsetMod->product = $_mod->agent_product;
					$logsInsetMod->change_action = "Target Change";
					$logsInsetMod->bank = "Mashreq";
					$logsInsetMod->change_sales_time = $_mod->end_sales_time;
					$logsInsetMod->monthsCountService = count($agentMod);
					$logsInsetMod->save();
				}
				if($hostroyLogs->product != $_mod->agent_product)
				{
					$logsInsetMod = new BanksAgentHistroyLogs();
					$logsInsetMod->agent_name = $_mod->agent_name;
					$logsInsetMod->range_id = $_mod->range_id;
					$logsInsetMod->employee_id = $_mod->employee_id;
					$logsInsetMod->TL_name = $_mod->tl_name;
					$logsInsetMod->Target = $_mod->agent_target;
					$logsInsetMod->product = $_mod->agent_product;
					$logsInsetMod->change_action = "Product Change";
					$logsInsetMod->bank = "Mashreq";
					$logsInsetMod->change_sales_time = $_mod->end_sales_time;
					$logsInsetMod->monthsCountService = count($agentMod);
					$logsInsetMod->save();
				}
			}
		}
	
	}
	echo "yes";
	exit;
}


public function updateMashreqDOJ()
{
	$agentM = AgentPayoutMashreq::where("employee_id_status",5)->whereNull("range_id")->get();
	
	foreach($agentM as $agent)
	{
		$employeeId = $agent->employee_id;
		$empAttrMod = Employee_attribute::where("emp_id",$employeeId)->where("attribute_code","DOJ")->first();
		if($empAttrMod != '')
		{
			$empdojValue = $empAttrMod->attribute_values;
			if($empdojValue != '')
			{
				$agentMUpdate = AgentPayoutMashreq::find($agent->id);
				$agentMUpdate->doj = date("Y-m-d",strtotime($empdojValue));
				$agentMUpdate->employee_id_status = 4;
				$agentMUpdate->save();
			}
		}
		/* echo "<pre>";
		print_r($empAttrMod);
		exit; */
	}
	echo "Done";
	exit;
}



public function enbdAgentHostroyLogs()
{
	
	$collectionMashreq = AgentPayout::groupBy('employee_id')
	->selectRaw('count(*) as total, employee_id')->where("employee_id_status",2)
	->get();
	/* echo "<pre>";
	print_r($collectionMashreq);
	exit; */
	
	foreach($collectionMashreq as $_mashreqData)
	{
		
		$empID =  $_mashreqData['employee_id'];
		$agentMod = AgentPayout::where("employee_id",$empID)->orderBy("range_id","ASC")->get();
		/* echo "<pre>";
		print_r($agentMod);
		exit; */
		foreach($agentMod as $_mod)
		{
			$hostroyLogs = BanksAgentHistroyLogs::where("employee_id",$_mod->employee_id)->orderBy("id","DESC")->first();
			if($hostroyLogs == '')
			{
				/*
				*check exist in other bank
				*start code
				*/
				$empId = $_mod->employee_id;
				$empExist = AgentPayoutMashreq::where("employee_id",$empId)->get()->count();
				
				/*
				*check exist in other bank
				*end code
				*/
				$logsInsetMod = new BanksAgentHistroyLogs();
				$logsInsetMod->agent_name = $_mod->agent_name;
				$logsInsetMod->range_id = $_mod->range_id;
				$logsInsetMod->employee_id = $_mod->employee_id;
				$logsInsetMod->location = $_mod->location;
				$logsInsetMod->TL_name = $_mod->tl_name;
				$logsInsetMod->Target = $_mod->agent_target;
				$logsInsetMod->product = $_mod->agent_product;
				$logsInsetMod->change_action = "first entry";
				$logsInsetMod->change_sales_time = $_mod->sales_time;
				$logsInsetMod->monthsCountService = count($agentMod);
				$logsInsetMod->bank = "ENBD";
				if($empExist >0)
				{
					$logsInsetMod->change_bank = 1;
				}
				
				$logsInsetMod->save();
			}
			else
			{
				if($hostroyLogs->TL_name != $_mod->tl_name)
				{
					$logsInsetMod = new BanksAgentHistroyLogs();
					$logsInsetMod->agent_name = $_mod->agent_name;
					$logsInsetMod->range_id = $_mod->range_id;
					$logsInsetMod->employee_id = $_mod->employee_id;
					$logsInsetMod->location = $_mod->location;
					$logsInsetMod->TL_name = $_mod->tl_name;
					$logsInsetMod->Target = $_mod->agent_target;
					$logsInsetMod->product = $_mod->agent_product;
					$logsInsetMod->change_action = "TL Change";
					$logsInsetMod->change_sales_time = $_mod->sales_time;
					$logsInsetMod->monthsCountService = count($agentMod);
					$logsInsetMod->bank = "ENBD";
					$logsInsetMod->save();
				}
				if($hostroyLogs->Target != $_mod->agent_target)
				{
					$logsInsetMod = new BanksAgentHistroyLogs();
					$logsInsetMod->agent_name = $_mod->agent_name;
					$logsInsetMod->range_id = $_mod->range_id;
					$logsInsetMod->employee_id = $_mod->employee_id;
					$logsInsetMod->location = $_mod->location;
					$logsInsetMod->TL_name = $_mod->tl_name;
					$logsInsetMod->Target = $_mod->agent_target;
					$logsInsetMod->product = $_mod->agent_product;
					$logsInsetMod->change_action = "Target Change";
					$logsInsetMod->change_sales_time = $_mod->sales_time;
					$logsInsetMod->monthsCountService = count($agentMod);
					$logsInsetMod->bank = "ENBD";
					$logsInsetMod->save();
				}
				if($hostroyLogs->location != $_mod->location)
				{
					$logsInsetMod = new BanksAgentHistroyLogs();
					$logsInsetMod->agent_name = $_mod->agent_name;
					$logsInsetMod->range_id = $_mod->range_id;
					$logsInsetMod->employee_id = $_mod->employee_id;
					$logsInsetMod->location = $_mod->location;
					$logsInsetMod->TL_name = $_mod->tl_name;
					$logsInsetMod->Target = $_mod->agent_target;
					$logsInsetMod->product = $_mod->agent_product;
					$logsInsetMod->change_action = "Location Change";
					$logsInsetMod->change_sales_time = $_mod->sales_time;
					$logsInsetMod->monthsCountService = count($agentMod);
					$logsInsetMod->bank = "ENBD";
					$logsInsetMod->save();
				}
			}
		}
	
	}
	echo "yes";
	exit;
}

public function updateAttritionENBD()
{
	$enbdAttritionModel = EnbdAttrition::where("update_status",1)->get();
	
	foreach($enbdAttritionModel as $attrition)
	{
		$empAgent = AgentPayout::where("employee_id",$attrition->emp_id)->first();
		if($empAgent != '')
		{
			$agentPayoutMOd = AgentPayout::find($empAgent->id);
			
			$agentPayoutMOd->attrition_id = 2;
			$agentPayoutMOd->last_working_day = $attrition->last_working_date;
			$agentPayoutMOd->reason = $attrition->reason;
			$agentPayoutMOd->save();
			
			
			$EnbdAttritionUpdate = EnbdAttrition::find($attrition->id);
			$EnbdAttritionUpdate->update_status = 2;
			$EnbdAttritionUpdate->save();
		}
		else
		{
			$EnbdAttritionUpdate = EnbdAttrition::find($attrition->id);
			$EnbdAttritionUpdate->update_status = 3;
			$EnbdAttritionUpdate->save();
		}
	}
	echo "yes";
	exit;
}

public function updateAttritionMashreq()
{
	$enbdAttritionModel = MashreqAttrition::where("update_status",1)->get();
	
	foreach($enbdAttritionModel as $attrition)
	{
		$empAgent = AgentPayoutMashreq::where("employee_id",$attrition->emp_id)->first();
		if($empAgent != '')
		{
			$agentPayoutMOd = AgentPayoutMashreq::find($empAgent->id);
			
			$agentPayoutMOd->attrition_id = 2;
			$agentPayoutMOd->last_working_day = $attrition->last_working_date;
			$agentPayoutMOd->reason = $attrition->reason;
			$agentPayoutMOd->save();
			
			
			$EnbdAttritionUpdate = MashreqAttrition::find($attrition->id);
			$EnbdAttritionUpdate->update_status = 2;
			$EnbdAttritionUpdate->save();
		}
		else
		{
			$EnbdAttritionUpdate = MashreqAttrition::find($attrition->id);
			$EnbdAttritionUpdate->update_status = 3;
			$EnbdAttritionUpdate->save();
		}
	}
	echo "yes";
	exit;
}


public function deemAgentHostroyLogs()
{
	
	$collectionMashreq = AgentPayoutDeem::groupBy('emp_id')
	->selectRaw('count(*) as total, emp_id')->where("employee_id_status",2)
	->get();
	/* echo "<pre>";
	print_r($collectionMashreq);
	exit;  */
	
	foreach($collectionMashreq as $_mashreqData)
	{
		
		$empID =  $_mashreqData['emp_id'];
		$agentMod = AgentPayoutDeem::where("emp_id",$empID)->orderBy("range_id","ASC")->get();
		/* echo "<pre>";
		print_r($agentMod);
		exit; */
		foreach($agentMod as $_mod)
		{
			$hostroyLogs = BanksAgentHistroyLogs::where("employee_id",$_mod->emp_id)->where("bank","DEEM")->orderBy("id","DESC")->first();
			if($hostroyLogs == '')
			{
				/*
				*check exist in other bank
				*start code
				*/
				$empId = $_mod->emp_id;
				$empExist = BanksAgentHistroyLogs::where("employee_id",$empId)->get()->count();
				
				/*
				*check exist in other bank
				*end code
				*/
				$logsInsetMod = new BanksAgentHistroyLogs();
				$logsInsetMod->agent_name = $_mod->agent_name;
				$logsInsetMod->range_id = $_mod->range_id;
				$logsInsetMod->employee_id = $_mod->emp_id;
				$logsInsetMod->location = $_mod->location;
				$logsInsetMod->TL_name = $_mod->tl_name;
				$logsInsetMod->Target = $_mod->target;
				$logsInsetMod->product = "CARD";
				$logsInsetMod->change_action = "first entry";
				$logsInsetMod->change_sales_time = $_mod->sales_time;
				$logsInsetMod->monthsCountService = count($agentMod);
				$logsInsetMod->bank = "DEEM";
				if($empExist >0)
				{
					$logsInsetMod->change_bank = 1;
				}
				
				$logsInsetMod->save();
			}
			else
			{
				/* if($hostroyLogs->TL_name != $_mod->tl_name)
				{
					$logsInsetMod = new BanksAgentHistroyLogs();
					$logsInsetMod->agent_name = $_mod->agent_name;
					$logsInsetMod->range_id = $_mod->range_id;
					$logsInsetMod->employee_id = $_mod->employee_id;
					$logsInsetMod->location = $_mod->location;
					$logsInsetMod->TL_name = $_mod->tl_name;
					$logsInsetMod->Target = $_mod->agent_target;
					$logsInsetMod->product = $_mod->agent_product;
					$logsInsetMod->change_action = "TL Change";
					$logsInsetMod->change_sales_time = $_mod->sales_time;
					$logsInsetMod->monthsCountService = count($agentMod);
					$logsInsetMod->bank = "ENBD";
					$logsInsetMod->save();
				} */
				if($hostroyLogs->Target != $_mod->target)
				{
					$logsInsetMod = new BanksAgentHistroyLogs();
					$logsInsetMod->agent_name = $_mod->agent_name;
					$logsInsetMod->range_id = $_mod->range_id;
					$logsInsetMod->employee_id = $_mod->emp_id;
					$logsInsetMod->location = $_mod->location;
					$logsInsetMod->TL_name = $_mod->tl_name;
					$logsInsetMod->Target = $_mod->target;
					$logsInsetMod->product = "CARD";
					$logsInsetMod->change_action = "Target Change";
					$logsInsetMod->change_sales_time = $_mod->sales_time;
					$logsInsetMod->monthsCountService = count($agentMod);
					$logsInsetMod->bank = "DEEM";
					$logsInsetMod->save();
				}
				/* if($hostroyLogs->location != $_mod->location)
				{
					$logsInsetMod = new BanksAgentHistroyLogs();
					$logsInsetMod->agent_name = $_mod->agent_name;
					$logsInsetMod->range_id = $_mod->range_id;
					$logsInsetMod->employee_id = $_mod->employee_id;
					$logsInsetMod->location = $_mod->location;
					$logsInsetMod->TL_name = $_mod->tl_name;
					$logsInsetMod->Target = $_mod->agent_target;
					$logsInsetMod->product = $_mod->agent_product;
					$logsInsetMod->change_action = "Location Change";
					$logsInsetMod->change_sales_time = $_mod->sales_time;
					$logsInsetMod->monthsCountService = count($agentMod);
					$logsInsetMod->bank = "ENBD";
					$logsInsetMod->save();
				} */
			}
		}
	
	}
	echo "yes";
	exit;
}
}
